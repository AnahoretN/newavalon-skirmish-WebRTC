# –ü–ª–∞–Ω –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ New Avalon: Skirmish

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 2026-02-15
**–í–µ—Ä—Å–∏—è:** 0.2.11
**–°—Ç–∞—Ç—É—Å:** –ê–∫—Ç–∏–≤–Ω—ã–π

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ –≤ v0.2.11 (Stage 2)

### WebRTC P2P Optimization
- ‚úÖ **MessagePack Binary Serialization** - ~72% —Ä–µ–¥—É–∫—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
  - –î–æ–±–∞–≤–ª–µ–Ω `@msgpack/msgpack` –ø–∞–∫–µ—Ç
  - –°–æ–∑–¥–∞–Ω –º–æ–¥—É–ª—å `client/utils/webrtcSerialization.ts` (796 —Å—Ç—Ä–æ–∫)
  - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç (id + stats, —Ç–æ–∫–µ–Ω—ã –æ—Ç–¥–µ–ª—å–Ω–æ)
  - Short property keys –¥–ª—è delta —Ñ–æ—Ä–º–∞—Ç–∞

### Code Splitting
- ‚úÖ **useGameState.ts —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥** - —Ä–∞–∑–±–∏—Ç –Ω–∞ 18 —Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–æ–¥—É–ª–µ–π:
  - `useGameLifecycle.ts` - —Å–æ–∑–¥–∞–Ω–∏–µ/–ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ/–≤—ã—Ö–æ–¥ –∏–∑ –∏–≥—Ä—ã
  - `gameCreators.ts` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è gameId, —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–ª–æ–¥—ã, –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
  - `gameStateStorage.ts` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–∑–∞–≥—Ä—É–∑–∫–∞/–æ—á–∏—Å—Ç–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
  - `useVisualEffects.ts` - –≤–∏–∑—É–∞–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã (highlights, floating texts)
  - `useWebRTC.ts` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ WebRTC P2P —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏
  - `useTargetingMode.ts` - —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ç–∞—Ä–≥–µ—Ç–∏–Ω–≥–∞
  - `useBoardManipulation.ts` - –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –¥–æ—Å–∫–æ–π
  - `useCardMovement.ts` - drag-and-drop –∫–∞—Ä—Ç
  - `useCardOperations.ts` - —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –∏ —Å—Ç–∞—Ç—É—Å—ã –∫–∞—Ä—Ç
  - `useCardStatus.ts` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞–º–∏ –∫–∞—Ä—Ç
  - `useDeckManagement.ts` - –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –∫–æ–ª–æ–¥–æ–π
  - `useGameSettings.ts` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–≥—Ä—ã
  - `usePhaseManagement.ts` - –ø–µ—Ä–µ—Ö–æ–¥—ã —Ñ–∞–∑
  - `usePlayerActions.ts` - –¥–µ–π—Å—Ç–≤–∏—è –∏–≥—Ä–æ–∫–æ–≤
  - `useReadyCheck.ts` - —Å–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
  - `useScoring.ts` - –ø–æ–¥—Å—á—ë—Ç –æ—á–∫–æ–≤
  - `websocketHelpers.ts` - WebSocket —É—Ç–∏–ª–∏—Ç—ã
  - `types.ts` - –æ–±—â–∏–µ —Ç–∏–ø—ã

### Bug Fixes
- ‚úÖ **DeckType Runtime Error** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω import type vs regular import
- ‚úÖ **WebRTC Reconnection Loop** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª –ø—Ä–∏ HMR
  - –î–æ–±–∞–≤–ª–µ–Ω sessionStorage —Ñ–ª–∞–≥ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è auto-restore
- ‚úÖ **Unused Imports** - —É–¥–∞–ª–µ–Ω—ã –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–º–ø–æ—Ä—Ç—ã

### –†–µ–∑—É–ª—å—Ç–∞—Ç
- **useGameState.ts**: 6,884 ‚Üí 3,775 —Å—Ç—Ä–æ–∫ (-45%)
- **WebRTC —Å–æ–æ–±—â–µ–Ω–∏—è**: ~72% —Ä–µ–¥—É–∫—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞
- **–ö–æ–¥**: –±–æ–ª–µ–µ –º–æ–¥—É–ª—å–Ω—ã–π –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π

---

## üìä TODO - –ß—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å —Å–¥–µ–ª–∞—Ç—å

### 1. PlayerPanel.tsx - 1,157 —Å—Ç—Ä–æ–∫ üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ª–æ–≥–∏–∫–∏

**–ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
PlayerPanel.tsx (–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, ~200 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ PlayerHeader.tsx           # –ò–º—è, —Ü–≤–µ—Ç, –æ—á–∫–∏ (~100 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ PlayerHand.tsx             # –ö–∞—Ä—Ç–æ—á–Ω—ã–µ —Ä—É–∫–∏ (~300 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ PlayerDeckControls.tsx     # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–æ–¥–æ–π (~200 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ PlayerDiscard.tsx          # –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ discard (~150 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ PlayerAnnounced.tsx        # –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ announced (~100 —Å—Ç—Ä–æ–∫)
‚îî‚îÄ‚îÄ PlayerStatus.tsx           # –°—Ç–∞—Ç—É—Å –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ (~100 —Å—Ç—Ä–æ–∫)
```

### 2. React.lazy –¥–ª—è –º–æ–¥–∞–ª–æ–∫ üü° –í—ã—Å–æ–∫–∏–π

**–ü—Ä–æ–±–ª–µ–º–∞:** –í—Å–µ –º–æ–¥–∞–ª–∫–∏ –≥—Ä—É–∑—è—Ç—Å—è —Å—Ä–∞–∑—É

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å lazy loading –¥–ª—è 13+ –º–æ–¥–∞–ª—å–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

```typescript
const DeckViewModal = lazy(() => import('./components/DeckViewModal'))
const CardDetailModal = lazy(() => import('./components/CardDetailModal'))
// ... –∏ —Ç.–¥.
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** -50-100 KB initial bundle

### 3. –£–ª—É—á—à–∏—Ç—å memoization üü° –í—ã—Å–æ–∫–∏–π

**–ü—Ä–æ–±–ª–µ–º–∞:** –õ–∏—à–Ω–∏–µ —Ä–µ–Ω–¥–µ—Ä—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

**–†–µ—à–µ–Ω–∏–µ:**
- –£–ª—É—á—à–∏—Ç—å memo –≤ PlayerPanel
- –î–æ–±–∞–≤–∏—Ç—å useTransition –¥–ª—è —Ç—è–∂—ë–ª—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å useDeferredValue –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤

### 4. –ë–∞—Ç—á–∏–Ω–≥ –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ üü¢ –°—Ä–µ–¥–Ω–∏–π

**–ü—Ä–æ–±–ª–µ–º–∞:** –≠—Ñ—Ñ–µ–∫—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –ø–æ –æ–¥–Ω–æ–º—É

**–†–µ—à–µ–Ω–∏–µ:** –°–æ–±–∏—Ä–∞—Ç—å —ç—Ñ—Ñ–µ–∫—Ç—ã –≤ –±–∞—Ç—á –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ä–∞–∑ –≤ 50–º—Å

```typescript
const EFFECT_BATCH_INTERVAL = 50
// –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å –±–∞—Ç—á —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –≤–º–µ—Å—Ç–æ –æ–¥–∏–Ω–æ—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
```

### 5. Virtual Scrolling üü¢ –°—Ä–µ–¥–Ω–∏–π

**–ü—Ä–æ–±–ª–µ–º–∞:** –ë–æ–ª—å—à–∏–µ —Å–ø–∏—Å–∫–∏ –∫–∞—Ä—Ç —Ä–µ–Ω–¥–µ—Ä—è—Ç—Å—è —Ü–µ–ª–∏–∫–æ–º

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å react-window –¥–ª—è hand/deck

### 6. –ú–æ–¥–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ üü° –í—ã—Å–æ–∫–∏–π

**–ü—Ä–æ–±–ª–µ–º–∞:** 13+ –º–æ–¥–∞–ª–æ–∫ —Å –¥—É–±–ª–∏—Ä—É—é—â–∏–º—Å—è –∫–æ–¥–æ–º

**–†–µ—à–µ–Ω–∏–µ:**
- –£–ª—É—á—à–∏—Ç—å BaseModal (—É–∂–µ –µ—Å—Ç—å)
- –°–æ–∑–¥–∞—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä –º–æ–¥–∞–ª–æ–∫ (zustand)
- –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–º–µ—Ä—ã –∏ —Å—Ç–∏–ª–∏

### 7. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ üü¢ –ù–∏–∑–∫–∏–π

**–ò–¥–µ–∏:**
- –†–∞–∑–¥–µ–ª–∏—Ç—å contentDatabase.json –ø–æ —Ñ—Ä–∞–∫—Ü–∏—è–º
- Lazy loading –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∫–∞—Ä—Ç
- Progressive image loading

---

## üìã –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–±–æ—Ä–∫–∏

```
index.html              2.72 KB ‚îÇ gzip: 0.89 KB
CSS                     50.99 KB ‚îÇ gzip: 9.16 KB
vendor-webrtc          38.65 KB ‚îÇ gzip: 11.34 KB (PeerJS)
vendor                 76.07 KB ‚îÇ gzip: 20.74 KB (–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏)
vendor-react          137.55 KB ‚îÇ gzip: 43.99 KB (React + DOM)
game-logic            259.67 KB ‚îÇ gzip: 63.21 KB (—Ö—É–∫–∏ + shared)
index (main)           285.96 KB ‚îÇ gzip: 88.11 KB
```

**–ò—Ç–æ–≥–æ:** ~815 KB (–±–µ–∑ gzip), ~225 KB (—Å gzip)

---

## üéØ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é –≤–µ—Ä—Å–∏—é

1. üî¥ **PlayerPanel.tsx —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥** - –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç–∏
2. üü° **React.lazy –¥–ª—è –º–æ–¥–∞–ª–æ–∫** - –±—ã—Å—Ç—Ä–æ, –¥–∞—Å—Ç -50-100 KB
3. üü° **–£–ª—É—á—à–∏—Ç—å memoization** - —É–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
4. üü¢ **–ë–∞—Ç—á–∏–Ω–≥ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤** - –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞

---

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [React Performance](https://react.dev/learn/render-and-commit)
- [Vite Performance](https://vitejs.dev/guide/performance.html)
- [WebRTC Optimization](https://webrtc.org/getting-started/performance)
- [Bundle Analysis](https://bundlephobia.com/)

---

**–ê–≤—Ç–æ—Ä –∞–Ω–∞–ª–∏–∑–∞:** Claude (Anthropic)
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2026-02-15
