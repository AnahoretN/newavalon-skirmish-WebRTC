var i0=e=>{throw TypeError(e)};var ss=(e,t,n)=>t.has(e)?i0("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n);function l0(e,t){for(var n=0;n<t.length;n++){const r=t[n];if(typeof r!="string"&&!Array.isArray(r)){for(const a in r)if(a!=="default"&&!(a in e)){const o=Object.getOwnPropertyDescriptor(r,a);o&&Object.defineProperty(e,a,o.get?o:{enumerable:!0,get:()=>r[a]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(a){if(a.ep)return;a.ep=!0;const o=n(a);fetch(a.href,o)}})();function Ph(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Nh={exports:{}},dc={},Ah={exports:{}},vt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gi=Symbol.for("react.element"),c0=Symbol.for("react.portal"),d0=Symbol.for("react.fragment"),u0=Symbol.for("react.strict_mode"),f0=Symbol.for("react.profiler"),p0=Symbol.for("react.provider"),h0=Symbol.for("react.context"),m0=Symbol.for("react.forward_ref"),g0=Symbol.for("react.suspense"),y0=Symbol.for("react.memo"),v0=Symbol.for("react.lazy"),Kf=Symbol.iterator;function b0(e){return e===null||typeof e!="object"?null:(e=Kf&&e[Kf]||e["@@iterator"],typeof e=="function"?e:null)}var Oh={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Lh=Object.assign,Mh={};function Ko(e,t,n){this.props=e,this.context=t,this.refs=Mh,this.updater=n||Oh}Ko.prototype.isReactComponent={};Ko.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Ko.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function zh(){}zh.prototype=Ko.prototype;function zu(e,t,n){this.props=e,this.context=t,this.refs=Mh,this.updater=n||Oh}var $u=zu.prototype=new zh;$u.constructor=zu;Lh($u,Ko.prototype);$u.isPureReactComponent=!0;var Yf=Array.isArray,$h=Object.prototype.hasOwnProperty,Gu={current:null},Gh={key:!0,ref:!0,__self:!0,__source:!0};function Uh(e,t,n){var r,a={},o=null,s=null;if(t!=null)for(r in t.ref!==void 0&&(s=t.ref),t.key!==void 0&&(o=""+t.key),t)$h.call(t,r)&&!Gh.hasOwnProperty(r)&&(a[r]=t[r]);var l=arguments.length-2;if(l===1)a.children=n;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];a.children=c}if(e&&e.defaultProps)for(r in l=e.defaultProps,l)a[r]===void 0&&(a[r]=l[r]);return{$$typeof:gi,type:e,key:o,ref:s,props:a,_owner:Gu.current}}function x0(e,t){return{$$typeof:gi,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function Uu(e){return typeof e=="object"&&e!==null&&e.$$typeof===gi}function C0(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var qf=/\/+/g;function Gc(e,t){return typeof e=="object"&&e!==null&&e.key!=null?C0(""+e.key):t.toString(36)}function fl(e,t,n,r,a){var o=typeof e;(o==="undefined"||o==="boolean")&&(e=null);var s=!1;if(e===null)s=!0;else switch(o){case"string":case"number":s=!0;break;case"object":switch(e.$$typeof){case gi:case c0:s=!0}}if(s)return s=e,a=a(s),e=r===""?"."+Gc(s,0):r,Yf(a)?(n="",e!=null&&(n=e.replace(qf,"$&/")+"/"),fl(a,t,n,"",function(d){return d})):a!=null&&(Uu(a)&&(a=x0(a,n+(!a.key||s&&s.key===a.key?"":(""+a.key).replace(qf,"$&/")+"/")+e)),t.push(a)),1;if(s=0,r=r===""?".":r+":",Yf(e))for(var l=0;l<e.length;l++){o=e[l];var c=r+Gc(o,l);s+=fl(o,t,n,c,a)}else if(c=b0(e),typeof c=="function")for(e=c.call(e),l=0;!(o=e.next()).done;)o=o.value,c=r+Gc(o,l++),s+=fl(o,t,n,c,a);else if(o==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return s}function Bi(e,t,n){if(e==null)return e;var r=[],a=0;return fl(e,r,"","",function(o){return t.call(n,o,a++)}),r}function w0(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var On={current:null},pl={transition:null},k0={ReactCurrentDispatcher:On,ReactCurrentBatchConfig:pl,ReactCurrentOwner:Gu};function Fh(){throw Error("act(...) is not supported in production builds of React.")}vt.Children={map:Bi,forEach:function(e,t,n){Bi(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return Bi(e,function(){t++}),t},toArray:function(e){return Bi(e,function(t){return t})||[]},only:function(e){if(!Uu(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};vt.Component=Ko;vt.Fragment=d0;vt.Profiler=f0;vt.PureComponent=zu;vt.StrictMode=u0;vt.Suspense=g0;vt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=k0;vt.act=Fh;vt.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=Lh({},e.props),a=e.key,o=e.ref,s=e._owner;if(t!=null){if(t.ref!==void 0&&(o=t.ref,s=Gu.current),t.key!==void 0&&(a=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)$h.call(t,c)&&!Gh.hasOwnProperty(c)&&(r[c]=t[c]===void 0&&l!==void 0?l[c]:t[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];r.children=l}return{$$typeof:gi,type:e.type,key:a,ref:o,props:r,_owner:s}};vt.createContext=function(e){return e={$$typeof:h0,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:p0,_context:e},e.Consumer=e};vt.createElement=Uh;vt.createFactory=function(e){var t=Uh.bind(null,e);return t.type=e,t};vt.createRef=function(){return{current:null}};vt.forwardRef=function(e){return{$$typeof:m0,render:e}};vt.isValidElement=Uu;vt.lazy=function(e){return{$$typeof:v0,_payload:{_status:-1,_result:e},_init:w0}};vt.memo=function(e,t){return{$$typeof:y0,type:e,compare:t===void 0?null:t}};vt.startTransition=function(e){var t=pl.transition;pl.transition={};try{e()}finally{pl.transition=t}};vt.unstable_act=Fh;vt.useCallback=function(e,t){return On.current.useCallback(e,t)};vt.useContext=function(e){return On.current.useContext(e)};vt.useDebugValue=function(){};vt.useDeferredValue=function(e){return On.current.useDeferredValue(e)};vt.useEffect=function(e,t){return On.current.useEffect(e,t)};vt.useId=function(){return On.current.useId()};vt.useImperativeHandle=function(e,t,n){return On.current.useImperativeHandle(e,t,n)};vt.useInsertionEffect=function(e,t){return On.current.useInsertionEffect(e,t)};vt.useLayoutEffect=function(e,t){return On.current.useLayoutEffect(e,t)};vt.useMemo=function(e,t){return On.current.useMemo(e,t)};vt.useReducer=function(e,t,n){return On.current.useReducer(e,t,n)};vt.useRef=function(e){return On.current.useRef(e)};vt.useState=function(e){return On.current.useState(e)};vt.useSyncExternalStore=function(e,t,n){return On.current.useSyncExternalStore(e,t,n)};vt.useTransition=function(){return On.current.useTransition()};vt.version="18.3.1";Ah.exports=vt;var m=Ah.exports;const ca=Ph(m);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var T0=m,E0=Symbol.for("react.element"),I0=Symbol.for("react.fragment"),S0=Object.prototype.hasOwnProperty,_0=T0.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,D0={key:!0,ref:!0,__self:!0,__source:!0};function Bh(e,t,n){var r,a={},o=null,s=null;n!==void 0&&(o=""+n),t.key!==void 0&&(o=""+t.key),t.ref!==void 0&&(s=t.ref);for(r in t)S0.call(t,r)&&!D0.hasOwnProperty(r)&&(a[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps,t)a[r]===void 0&&(a[r]=t[r]);return{$$typeof:E0,type:e,key:o,ref:s,props:a,_owner:_0.current}}dc.Fragment=I0;dc.jsx=Bh;dc.jsxs=Bh;Nh.exports=dc;var i=Nh.exports,Id={},Hh={exports:{}},nr={},Wh={exports:{}},Vh={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(J,q){var H=J.length;J.push(q);e:for(;0<H;){var ne=H-1>>>1,de=J[ne];if(0<a(de,q))J[ne]=q,J[H]=de,H=ne;else break e}}function n(J){return J.length===0?null:J[0]}function r(J){if(J.length===0)return null;var q=J[0],H=J.pop();if(H!==q){J[0]=H;e:for(var ne=0,de=J.length,xe=de>>>1;ne<xe;){var Z=2*(ne+1)-1,Oe=J[Z],Re=Z+1,Ce=J[Re];if(0>a(Oe,H))Re<de&&0>a(Ce,Oe)?(J[ne]=Ce,J[Re]=H,ne=Re):(J[ne]=Oe,J[Z]=H,ne=Z);else if(Re<de&&0>a(Ce,H))J[ne]=Ce,J[Re]=H,ne=Re;else break e}}return q}function a(J,q){var H=J.sortIndex-q.sortIndex;return H!==0?H:J.id-q.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;e.unstable_now=function(){return o.now()}}else{var s=Date,l=s.now();e.unstable_now=function(){return s.now()-l}}var c=[],d=[],f=1,h=null,v=3,w=!1,_=!1,C=!1,D=typeof setTimeout=="function"?setTimeout:null,x=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function k(J){for(var q=n(d);q!==null;){if(q.callback===null)r(d);else if(q.startTime<=J)r(d),q.sortIndex=q.expirationTime,t(c,q);else break;q=n(d)}}function j(J){if(C=!1,k(J),!_)if(n(c)!==null)_=!0,ie($);else{var q=n(d);q!==null&&ae(j,q.startTime-J)}}function $(J,q){_=!1,C&&(C=!1,x(K),K=-1),w=!0;var H=v;try{for(k(q),h=n(c);h!==null&&(!(h.expirationTime>q)||J&&!Ie());){var ne=h.callback;if(typeof ne=="function"){h.callback=null,v=h.priorityLevel;var de=ne(h.expirationTime<=q);q=e.unstable_now(),typeof de=="function"?h.callback=de:h===n(c)&&r(c),k(q)}else r(c);h=n(c)}if(h!==null)var xe=!0;else{var Z=n(d);Z!==null&&ae(j,Z.startTime-q),xe=!1}return xe}finally{h=null,v=H,w=!1}}var A=!1,M=null,K=-1,ee=5,re=-1;function Ie(){return!(e.unstable_now()-re<ee)}function B(){if(M!==null){var J=e.unstable_now();re=J;var q=!0;try{q=M(!0,J)}finally{q?fe():(A=!1,M=null)}}else A=!1}var fe;if(typeof y=="function")fe=function(){y(B)};else if(typeof MessageChannel<"u"){var he=new MessageChannel,ke=he.port2;he.port1.onmessage=B,fe=function(){ke.postMessage(null)}}else fe=function(){D(B,0)};function ie(J){M=J,A||(A=!0,fe())}function ae(J,q){K=D(function(){J(e.unstable_now())},q)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(J){J.callback=null},e.unstable_continueExecution=function(){_||w||(_=!0,ie($))},e.unstable_forceFrameRate=function(J){0>J||125<J?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ee=0<J?Math.floor(1e3/J):5},e.unstable_getCurrentPriorityLevel=function(){return v},e.unstable_getFirstCallbackNode=function(){return n(c)},e.unstable_next=function(J){switch(v){case 1:case 2:case 3:var q=3;break;default:q=v}var H=v;v=q;try{return J()}finally{v=H}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(J,q){switch(J){case 1:case 2:case 3:case 4:case 5:break;default:J=3}var H=v;v=J;try{return q()}finally{v=H}},e.unstable_scheduleCallback=function(J,q,H){var ne=e.unstable_now();switch(typeof H=="object"&&H!==null?(H=H.delay,H=typeof H=="number"&&0<H?ne+H:ne):H=ne,J){case 1:var de=-1;break;case 2:de=250;break;case 5:de=1073741823;break;case 4:de=1e4;break;default:de=5e3}return de=H+de,J={id:f++,callback:q,priorityLevel:J,startTime:H,expirationTime:de,sortIndex:-1},H>ne?(J.sortIndex=H,t(d,J),n(c)===null&&J===n(d)&&(C?(x(K),K=-1):C=!0,ae(j,H-ne))):(J.sortIndex=de,t(c,J),_||w||(_=!0,ie($))),J},e.unstable_shouldYield=Ie,e.unstable_wrapCallback=function(J){var q=v;return function(){var H=v;v=q;try{return J.apply(this,arguments)}finally{v=H}}}})(Vh);Wh.exports=Vh;var R0=Wh.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var j0=m,tr=R0;function _e(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Kh=new Set,Ks={};function Za(e,t){zo(e,t),zo(e+"Capture",t)}function zo(e,t){for(Ks[e]=t,e=0;e<t.length;e++)Kh.add(t[e])}var Yr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Sd=Object.prototype.hasOwnProperty,P0=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Jf={},Xf={};function N0(e){return Sd.call(Xf,e)?!0:Sd.call(Jf,e)?!1:P0.test(e)?Xf[e]=!0:(Jf[e]=!0,!1)}function A0(e,t,n,r){if(n!==null&&n.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function O0(e,t,n,r){if(t===null||typeof t>"u"||A0(e,t,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Ln(e,t,n,r,a,o,s){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=r,this.attributeNamespace=a,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=s}var yn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){yn[e]=new Ln(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];yn[t]=new Ln(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){yn[e]=new Ln(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){yn[e]=new Ln(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){yn[e]=new Ln(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){yn[e]=new Ln(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){yn[e]=new Ln(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){yn[e]=new Ln(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){yn[e]=new Ln(e,5,!1,e.toLowerCase(),null,!1,!1)});var Fu=/[\-:]([a-z])/g;function Bu(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(Fu,Bu);yn[t]=new Ln(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(Fu,Bu);yn[t]=new Ln(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(Fu,Bu);yn[t]=new Ln(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){yn[e]=new Ln(e,1,!1,e.toLowerCase(),null,!1,!1)});yn.xlinkHref=new Ln("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){yn[e]=new Ln(e,1,!1,e.toLowerCase(),null,!0,!0)});function Hu(e,t,n,r){var a=yn.hasOwnProperty(t)?yn[t]:null;(a!==null?a.type!==0:r||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(O0(t,n,a,r)&&(n=null),r||a===null?N0(t)&&(n===null?e.removeAttribute(t):e.setAttribute(t,""+n)):a.mustUseProperty?e[a.propertyName]=n===null?a.type===3?!1:"":n:(t=a.attributeName,r=a.attributeNamespace,n===null?e.removeAttribute(t):(a=a.type,n=a===3||a===4&&n===!0?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}var Qr=j0.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Hi=Symbol.for("react.element"),yo=Symbol.for("react.portal"),vo=Symbol.for("react.fragment"),Wu=Symbol.for("react.strict_mode"),_d=Symbol.for("react.profiler"),Yh=Symbol.for("react.provider"),qh=Symbol.for("react.context"),Vu=Symbol.for("react.forward_ref"),Dd=Symbol.for("react.suspense"),Rd=Symbol.for("react.suspense_list"),Ku=Symbol.for("react.memo"),na=Symbol.for("react.lazy"),Jh=Symbol.for("react.offscreen"),Zf=Symbol.iterator;function is(e){return e===null||typeof e!="object"?null:(e=Zf&&e[Zf]||e["@@iterator"],typeof e=="function"?e:null)}var Ht=Object.assign,Uc;function bs(e){if(Uc===void 0)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);Uc=t&&t[1]||""}return`
`+Uc+e}var Fc=!1;function Bc(e,t){if(!e||Fc)return"";Fc=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(d){var r=d}Reflect.construct(e,[],t)}else{try{t.call()}catch(d){r=d}e.call(t.prototype)}else{try{throw Error()}catch(d){r=d}e()}}catch(d){if(d&&r&&typeof d.stack=="string"){for(var a=d.stack.split(`
`),o=r.stack.split(`
`),s=a.length-1,l=o.length-1;1<=s&&0<=l&&a[s]!==o[l];)l--;for(;1<=s&&0<=l;s--,l--)if(a[s]!==o[l]){if(s!==1||l!==1)do if(s--,l--,0>l||a[s]!==o[l]){var c=`
`+a[s].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}while(1<=s&&0<=l);break}}}finally{Fc=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?bs(e):""}function L0(e){switch(e.tag){case 5:return bs(e.type);case 16:return bs("Lazy");case 13:return bs("Suspense");case 19:return bs("SuspenseList");case 0:case 2:case 15:return e=Bc(e.type,!1),e;case 11:return e=Bc(e.type.render,!1),e;case 1:return e=Bc(e.type,!0),e;default:return""}}function jd(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case vo:return"Fragment";case yo:return"Portal";case _d:return"Profiler";case Wu:return"StrictMode";case Dd:return"Suspense";case Rd:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case qh:return(e.displayName||"Context")+".Consumer";case Yh:return(e._context.displayName||"Context")+".Provider";case Vu:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Ku:return t=e.displayName||null,t!==null?t:jd(e.type)||"Memo";case na:t=e._payload,e=e._init;try{return jd(e(t))}catch{}}return null}function M0(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return jd(t);case 8:return t===Wu?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function xa(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Xh(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function z0(e){var t=Xh(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var a=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(s){r=""+s,o.call(this,s)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(s){r=""+s},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Wi(e){e._valueTracker||(e._valueTracker=z0(e))}function Zh(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=Xh(e)?e.checked?"true":"false":e.value),e=r,e!==n?(t.setValue(e),!0):!1}function Pl(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function Pd(e,t){var n=t.checked;return Ht({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function Qf(e,t){var n=t.defaultValue==null?"":t.defaultValue,r=t.checked!=null?t.checked:t.defaultChecked;n=xa(t.value!=null?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function Qh(e,t){t=t.checked,t!=null&&Hu(e,"checked",t,!1)}function Nd(e,t){Qh(e,t);var n=xa(t.value),r=t.type;if(n!=null)r==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if(r==="submit"||r==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?Ad(e,t.type,n):t.hasOwnProperty("defaultValue")&&Ad(e,t.type,xa(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function ep(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!(r!=="submit"&&r!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,n!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,n!==""&&(e.name=n)}function Ad(e,t,n){(t!=="number"||Pl(e.ownerDocument)!==e)&&(n==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var xs=Array.isArray;function Ro(e,t,n,r){if(e=e.options,t){t={};for(var a=0;a<n.length;a++)t["$"+n[a]]=!0;for(n=0;n<e.length;n++)a=t.hasOwnProperty("$"+e[n].value),e[n].selected!==a&&(e[n].selected=a),a&&r&&(e[n].defaultSelected=!0)}else{for(n=""+xa(n),t=null,a=0;a<e.length;a++){if(e[a].value===n){e[a].selected=!0,r&&(e[a].defaultSelected=!0);return}t!==null||e[a].disabled||(t=e[a])}t!==null&&(t.selected=!0)}}function Od(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(_e(91));return Ht({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function tp(e,t){var n=t.value;if(n==null){if(n=t.children,t=t.defaultValue,n!=null){if(t!=null)throw Error(_e(92));if(xs(n)){if(1<n.length)throw Error(_e(93));n=n[0]}t=n}t==null&&(t=""),n=t}e._wrapperState={initialValue:xa(n)}}function em(e,t){var n=xa(t.value),r=xa(t.defaultValue);n!=null&&(n=""+n,n!==e.value&&(e.value=n),t.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),r!=null&&(e.defaultValue=""+r)}function np(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function tm(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ld(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?tm(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var Vi,nm=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,n,r,a){MSApp.execUnsafeLocalFunction(function(){return e(t,n,r,a)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(Vi=Vi||document.createElement("div"),Vi.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Vi.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function Ys(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var Ss={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},$0=["Webkit","ms","Moz","O"];Object.keys(Ss).forEach(function(e){$0.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Ss[t]=Ss[e]})});function rm(e,t,n){return t==null||typeof t=="boolean"||t===""?"":n||typeof t!="number"||t===0||Ss.hasOwnProperty(e)&&Ss[e]?(""+t).trim():t+"px"}function am(e,t){e=e.style;for(var n in t)if(t.hasOwnProperty(n)){var r=n.indexOf("--")===0,a=rm(n,t[n],r);n==="float"&&(n="cssFloat"),r?e.setProperty(n,a):e[n]=a}}var G0=Ht({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Md(e,t){if(t){if(G0[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(_e(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(_e(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(_e(61))}if(t.style!=null&&typeof t.style!="object")throw Error(_e(62))}}function zd(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var $d=null;function Yu(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Gd=null,jo=null,Po=null;function rp(e){if(e=bi(e)){if(typeof Gd!="function")throw Error(_e(280));var t=e.stateNode;t&&(t=mc(t),Gd(e.stateNode,e.type,t))}}function om(e){jo?Po?Po.push(e):Po=[e]:jo=e}function sm(){if(jo){var e=jo,t=Po;if(Po=jo=null,rp(e),t)for(e=0;e<t.length;e++)rp(t[e])}}function im(e,t){return e(t)}function lm(){}var Hc=!1;function cm(e,t,n){if(Hc)return e(t,n);Hc=!0;try{return im(e,t,n)}finally{Hc=!1,(jo!==null||Po!==null)&&(lm(),sm())}}function qs(e,t){var n=e.stateNode;if(n===null)return null;var r=mc(n);if(r===null)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(e=e.type,r=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!r;break e;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(_e(231,t,typeof n));return n}var Ud=!1;if(Yr)try{var ls={};Object.defineProperty(ls,"passive",{get:function(){Ud=!0}}),window.addEventListener("test",ls,ls),window.removeEventListener("test",ls,ls)}catch{Ud=!1}function U0(e,t,n,r,a,o,s,l,c){var d=Array.prototype.slice.call(arguments,3);try{t.apply(n,d)}catch(f){this.onError(f)}}var _s=!1,Nl=null,Al=!1,Fd=null,F0={onError:function(e){_s=!0,Nl=e}};function B0(e,t,n,r,a,o,s,l,c){_s=!1,Nl=null,U0.apply(F0,arguments)}function H0(e,t,n,r,a,o,s,l,c){if(B0.apply(this,arguments),_s){if(_s){var d=Nl;_s=!1,Nl=null}else throw Error(_e(198));Al||(Al=!0,Fd=d)}}function Qa(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function dm(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function ap(e){if(Qa(e)!==e)throw Error(_e(188))}function W0(e){var t=e.alternate;if(!t){if(t=Qa(e),t===null)throw Error(_e(188));return t!==e?null:e}for(var n=e,r=t;;){var a=n.return;if(a===null)break;var o=a.alternate;if(o===null){if(r=a.return,r!==null){n=r;continue}break}if(a.child===o.child){for(o=a.child;o;){if(o===n)return ap(a),e;if(o===r)return ap(a),t;o=o.sibling}throw Error(_e(188))}if(n.return!==r.return)n=a,r=o;else{for(var s=!1,l=a.child;l;){if(l===n){s=!0,n=a,r=o;break}if(l===r){s=!0,r=a,n=o;break}l=l.sibling}if(!s){for(l=o.child;l;){if(l===n){s=!0,n=o,r=a;break}if(l===r){s=!0,r=o,n=a;break}l=l.sibling}if(!s)throw Error(_e(189))}}if(n.alternate!==r)throw Error(_e(190))}if(n.tag!==3)throw Error(_e(188));return n.stateNode.current===n?e:t}function um(e){return e=W0(e),e!==null?fm(e):null}function fm(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=fm(e);if(t!==null)return t;e=e.sibling}return null}var pm=tr.unstable_scheduleCallback,op=tr.unstable_cancelCallback,V0=tr.unstable_shouldYield,K0=tr.unstable_requestPaint,Xt=tr.unstable_now,Y0=tr.unstable_getCurrentPriorityLevel,qu=tr.unstable_ImmediatePriority,hm=tr.unstable_UserBlockingPriority,Ol=tr.unstable_NormalPriority,q0=tr.unstable_LowPriority,mm=tr.unstable_IdlePriority,uc=null,Mr=null;function J0(e){if(Mr&&typeof Mr.onCommitFiberRoot=="function")try{Mr.onCommitFiberRoot(uc,e,void 0,(e.current.flags&128)===128)}catch{}}var Er=Math.clz32?Math.clz32:Q0,X0=Math.log,Z0=Math.LN2;function Q0(e){return e>>>=0,e===0?32:31-(X0(e)/Z0|0)|0}var Ki=64,Yi=4194304;function Cs(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Ll(e,t){var n=e.pendingLanes;if(n===0)return 0;var r=0,a=e.suspendedLanes,o=e.pingedLanes,s=n&268435455;if(s!==0){var l=s&~a;l!==0?r=Cs(l):(o&=s,o!==0&&(r=Cs(o)))}else s=n&~a,s!==0?r=Cs(s):o!==0&&(r=Cs(o));if(r===0)return 0;if(t!==0&&t!==r&&!(t&a)&&(a=r&-r,o=t&-t,a>=o||a===16&&(o&4194240)!==0))return t;if(r&4&&(r|=n&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=r;0<t;)n=31-Er(t),a=1<<n,r|=e[n],t&=~a;return r}function ev(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function tv(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,a=e.expirationTimes,o=e.pendingLanes;0<o;){var s=31-Er(o),l=1<<s,c=a[s];c===-1?(!(l&n)||l&r)&&(a[s]=ev(l,t)):c<=t&&(e.expiredLanes|=l),o&=~l}}function Bd(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function gm(){var e=Ki;return Ki<<=1,!(Ki&4194240)&&(Ki=64),e}function Wc(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function yi(e,t,n){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Er(t),e[t]=n}function nv(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var a=31-Er(n),o=1<<a;t[a]=0,r[a]=-1,e[a]=-1,n&=~o}}function Ju(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-Er(n),a=1<<r;a&t|e[r]&t&&(e[r]|=t),n&=~a}}var St=0;function ym(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var vm,Xu,bm,xm,Cm,Hd=!1,qi=[],da=null,ua=null,fa=null,Js=new Map,Xs=new Map,aa=[],rv="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function sp(e,t){switch(e){case"focusin":case"focusout":da=null;break;case"dragenter":case"dragleave":ua=null;break;case"mouseover":case"mouseout":fa=null;break;case"pointerover":case"pointerout":Js.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Xs.delete(t.pointerId)}}function cs(e,t,n,r,a,o){return e===null||e.nativeEvent!==o?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:o,targetContainers:[a]},t!==null&&(t=bi(t),t!==null&&Xu(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,a!==null&&t.indexOf(a)===-1&&t.push(a),e)}function av(e,t,n,r,a){switch(t){case"focusin":return da=cs(da,e,t,n,r,a),!0;case"dragenter":return ua=cs(ua,e,t,n,r,a),!0;case"mouseover":return fa=cs(fa,e,t,n,r,a),!0;case"pointerover":var o=a.pointerId;return Js.set(o,cs(Js.get(o)||null,e,t,n,r,a)),!0;case"gotpointercapture":return o=a.pointerId,Xs.set(o,cs(Xs.get(o)||null,e,t,n,r,a)),!0}return!1}function wm(e){var t=Ga(e.target);if(t!==null){var n=Qa(t);if(n!==null){if(t=n.tag,t===13){if(t=dm(n),t!==null){e.blockedOn=t,Cm(e.priority,function(){bm(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function hl(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=Wd(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(n===null){n=e.nativeEvent;var r=new n.constructor(n.type,n);$d=r,n.target.dispatchEvent(r),$d=null}else return t=bi(n),t!==null&&Xu(t),e.blockedOn=n,!1;t.shift()}return!0}function ip(e,t,n){hl(e)&&n.delete(t)}function ov(){Hd=!1,da!==null&&hl(da)&&(da=null),ua!==null&&hl(ua)&&(ua=null),fa!==null&&hl(fa)&&(fa=null),Js.forEach(ip),Xs.forEach(ip)}function ds(e,t){e.blockedOn===t&&(e.blockedOn=null,Hd||(Hd=!0,tr.unstable_scheduleCallback(tr.unstable_NormalPriority,ov)))}function Zs(e){function t(a){return ds(a,e)}if(0<qi.length){ds(qi[0],e);for(var n=1;n<qi.length;n++){var r=qi[n];r.blockedOn===e&&(r.blockedOn=null)}}for(da!==null&&ds(da,e),ua!==null&&ds(ua,e),fa!==null&&ds(fa,e),Js.forEach(t),Xs.forEach(t),n=0;n<aa.length;n++)r=aa[n],r.blockedOn===e&&(r.blockedOn=null);for(;0<aa.length&&(n=aa[0],n.blockedOn===null);)wm(n),n.blockedOn===null&&aa.shift()}var No=Qr.ReactCurrentBatchConfig,Ml=!0;function sv(e,t,n,r){var a=St,o=No.transition;No.transition=null;try{St=1,Zu(e,t,n,r)}finally{St=a,No.transition=o}}function iv(e,t,n,r){var a=St,o=No.transition;No.transition=null;try{St=4,Zu(e,t,n,r)}finally{St=a,No.transition=o}}function Zu(e,t,n,r){if(Ml){var a=Wd(e,t,n,r);if(a===null)td(e,t,r,zl,n),sp(e,r);else if(av(a,e,t,n,r))r.stopPropagation();else if(sp(e,r),t&4&&-1<rv.indexOf(e)){for(;a!==null;){var o=bi(a);if(o!==null&&vm(o),o=Wd(e,t,n,r),o===null&&td(e,t,r,zl,n),o===a)break;a=o}a!==null&&r.stopPropagation()}else td(e,t,r,null,n)}}var zl=null;function Wd(e,t,n,r){if(zl=null,e=Yu(r),e=Ga(e),e!==null)if(t=Qa(e),t===null)e=null;else if(n=t.tag,n===13){if(e=dm(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return zl=e,null}function km(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Y0()){case qu:return 1;case hm:return 4;case Ol:case q0:return 16;case mm:return 536870912;default:return 16}default:return 16}}var sa=null,Qu=null,ml=null;function Tm(){if(ml)return ml;var e,t=Qu,n=t.length,r,a="value"in sa?sa.value:sa.textContent,o=a.length;for(e=0;e<n&&t[e]===a[e];e++);var s=n-e;for(r=1;r<=s&&t[n-r]===a[o-r];r++);return ml=a.slice(e,1<r?1-r:void 0)}function gl(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Ji(){return!0}function lp(){return!1}function rr(e){function t(n,r,a,o,s){this._reactName=n,this._targetInst=a,this.type=r,this.nativeEvent=o,this.target=s,this.currentTarget=null;for(var l in e)e.hasOwnProperty(l)&&(n=e[l],this[l]=n?n(o):o[l]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?Ji:lp,this.isPropagationStopped=lp,this}return Ht(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Ji)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Ji)},persist:function(){},isPersistent:Ji}),t}var Yo={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ef=rr(Yo),vi=Ht({},Yo,{view:0,detail:0}),lv=rr(vi),Vc,Kc,us,fc=Ht({},vi,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:tf,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==us&&(us&&e.type==="mousemove"?(Vc=e.screenX-us.screenX,Kc=e.screenY-us.screenY):Kc=Vc=0,us=e),Vc)},movementY:function(e){return"movementY"in e?e.movementY:Kc}}),cp=rr(fc),cv=Ht({},fc,{dataTransfer:0}),dv=rr(cv),uv=Ht({},vi,{relatedTarget:0}),Yc=rr(uv),fv=Ht({},Yo,{animationName:0,elapsedTime:0,pseudoElement:0}),pv=rr(fv),hv=Ht({},Yo,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),mv=rr(hv),gv=Ht({},Yo,{data:0}),dp=rr(gv),yv={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},vv={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},bv={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function xv(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=bv[e])?!!t[e]:!1}function tf(){return xv}var Cv=Ht({},vi,{key:function(e){if(e.key){var t=yv[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=gl(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?vv[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:tf,charCode:function(e){return e.type==="keypress"?gl(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?gl(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),wv=rr(Cv),kv=Ht({},fc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),up=rr(kv),Tv=Ht({},vi,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:tf}),Ev=rr(Tv),Iv=Ht({},Yo,{propertyName:0,elapsedTime:0,pseudoElement:0}),Sv=rr(Iv),_v=Ht({},fc,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Dv=rr(_v),Rv=[9,13,27,32],nf=Yr&&"CompositionEvent"in window,Ds=null;Yr&&"documentMode"in document&&(Ds=document.documentMode);var jv=Yr&&"TextEvent"in window&&!Ds,Em=Yr&&(!nf||Ds&&8<Ds&&11>=Ds),fp=" ",pp=!1;function Im(e,t){switch(e){case"keyup":return Rv.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Sm(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var bo=!1;function Pv(e,t){switch(e){case"compositionend":return Sm(t);case"keypress":return t.which!==32?null:(pp=!0,fp);case"textInput":return e=t.data,e===fp&&pp?null:e;default:return null}}function Nv(e,t){if(bo)return e==="compositionend"||!nf&&Im(e,t)?(e=Tm(),ml=Qu=sa=null,bo=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Em&&t.locale!=="ko"?null:t.data;default:return null}}var Av={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function hp(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Av[e.type]:t==="textarea"}function _m(e,t,n,r){om(r),t=$l(t,"onChange"),0<t.length&&(n=new ef("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Rs=null,Qs=null;function Ov(e){$m(e,0)}function pc(e){var t=wo(e);if(Zh(t))return e}function Lv(e,t){if(e==="change")return t}var Dm=!1;if(Yr){var qc;if(Yr){var Jc="oninput"in document;if(!Jc){var mp=document.createElement("div");mp.setAttribute("oninput","return;"),Jc=typeof mp.oninput=="function"}qc=Jc}else qc=!1;Dm=qc&&(!document.documentMode||9<document.documentMode)}function gp(){Rs&&(Rs.detachEvent("onpropertychange",Rm),Qs=Rs=null)}function Rm(e){if(e.propertyName==="value"&&pc(Qs)){var t=[];_m(t,Qs,e,Yu(e)),cm(Ov,t)}}function Mv(e,t,n){e==="focusin"?(gp(),Rs=t,Qs=n,Rs.attachEvent("onpropertychange",Rm)):e==="focusout"&&gp()}function zv(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return pc(Qs)}function $v(e,t){if(e==="click")return pc(t)}function Gv(e,t){if(e==="input"||e==="change")return pc(t)}function Uv(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Sr=typeof Object.is=="function"?Object.is:Uv;function ei(e,t){if(Sr(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var a=n[r];if(!Sd.call(t,a)||!Sr(e[a],t[a]))return!1}return!0}function yp(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function vp(e,t){var n=yp(e);e=0;for(var r;n;){if(n.nodeType===3){if(r=e+n.textContent.length,e<=t&&r>=t)return{node:n,offset:t-e};e=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=yp(n)}}function jm(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?jm(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function Pm(){for(var e=window,t=Pl();t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href=="string"}catch{n=!1}if(n)e=t.contentWindow;else break;t=Pl(e.document)}return t}function rf(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function Fv(e){var t=Pm(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&jm(n.ownerDocument.documentElement,n)){if(r!==null&&rf(n)){if(t=r.start,e=r.end,e===void 0&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if(e=(t=n.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var a=n.textContent.length,o=Math.min(r.start,a);r=r.end===void 0?o:Math.min(r.end,a),!e.extend&&o>r&&(a=r,r=o,o=a),a=vp(n,o);var s=vp(n,r);a&&s&&(e.rangeCount!==1||e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==s.node||e.focusOffset!==s.offset)&&(t=t.createRange(),t.setStart(a.node,a.offset),e.removeAllRanges(),o>r?(e.addRange(t),e.extend(s.node,s.offset)):(t.setEnd(s.node,s.offset),e.addRange(t)))}}for(t=[],e=n;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<t.length;n++)e=t[n],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Bv=Yr&&"documentMode"in document&&11>=document.documentMode,xo=null,Vd=null,js=null,Kd=!1;function bp(e,t,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Kd||xo==null||xo!==Pl(r)||(r=xo,"selectionStart"in r&&rf(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),js&&ei(js,r)||(js=r,r=$l(Vd,"onSelect"),0<r.length&&(t=new ef("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=xo)))}function Xi(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Co={animationend:Xi("Animation","AnimationEnd"),animationiteration:Xi("Animation","AnimationIteration"),animationstart:Xi("Animation","AnimationStart"),transitionend:Xi("Transition","TransitionEnd")},Xc={},Nm={};Yr&&(Nm=document.createElement("div").style,"AnimationEvent"in window||(delete Co.animationend.animation,delete Co.animationiteration.animation,delete Co.animationstart.animation),"TransitionEvent"in window||delete Co.transitionend.transition);function hc(e){if(Xc[e])return Xc[e];if(!Co[e])return e;var t=Co[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in Nm)return Xc[e]=t[n];return e}var Am=hc("animationend"),Om=hc("animationiteration"),Lm=hc("animationstart"),Mm=hc("transitionend"),zm=new Map,xp="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function wa(e,t){zm.set(e,t),Za(t,[e])}for(var Zc=0;Zc<xp.length;Zc++){var Qc=xp[Zc],Hv=Qc.toLowerCase(),Wv=Qc[0].toUpperCase()+Qc.slice(1);wa(Hv,"on"+Wv)}wa(Am,"onAnimationEnd");wa(Om,"onAnimationIteration");wa(Lm,"onAnimationStart");wa("dblclick","onDoubleClick");wa("focusin","onFocus");wa("focusout","onBlur");wa(Mm,"onTransitionEnd");zo("onMouseEnter",["mouseout","mouseover"]);zo("onMouseLeave",["mouseout","mouseover"]);zo("onPointerEnter",["pointerout","pointerover"]);zo("onPointerLeave",["pointerout","pointerover"]);Za("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Za("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Za("onBeforeInput",["compositionend","keypress","textInput","paste"]);Za("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Za("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Za("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ws="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Vv=new Set("cancel close invalid load scroll toggle".split(" ").concat(ws));function Cp(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,H0(r,t,void 0,e),e.currentTarget=null}function $m(e,t){t=(t&4)!==0;for(var n=0;n<e.length;n++){var r=e[n],a=r.event;r=r.listeners;e:{var o=void 0;if(t)for(var s=r.length-1;0<=s;s--){var l=r[s],c=l.instance,d=l.currentTarget;if(l=l.listener,c!==o&&a.isPropagationStopped())break e;Cp(a,l,d),o=c}else for(s=0;s<r.length;s++){if(l=r[s],c=l.instance,d=l.currentTarget,l=l.listener,c!==o&&a.isPropagationStopped())break e;Cp(a,l,d),o=c}}}if(Al)throw e=Fd,Al=!1,Fd=null,e}function Ot(e,t){var n=t[Zd];n===void 0&&(n=t[Zd]=new Set);var r=e+"__bubble";n.has(r)||(Gm(t,e,2,!1),n.add(r))}function ed(e,t,n){var r=0;t&&(r|=4),Gm(n,e,r,t)}var Zi="_reactListening"+Math.random().toString(36).slice(2);function ti(e){if(!e[Zi]){e[Zi]=!0,Kh.forEach(function(n){n!=="selectionchange"&&(Vv.has(n)||ed(n,!1,e),ed(n,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Zi]||(t[Zi]=!0,ed("selectionchange",!1,t))}}function Gm(e,t,n,r){switch(km(t)){case 1:var a=sv;break;case 4:a=iv;break;default:a=Zu}n=a.bind(null,t,n,e),a=void 0,!Ud||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(a=!0),r?a!==void 0?e.addEventListener(t,n,{capture:!0,passive:a}):e.addEventListener(t,n,!0):a!==void 0?e.addEventListener(t,n,{passive:a}):e.addEventListener(t,n,!1)}function td(e,t,n,r,a){var o=r;if(!(t&1)&&!(t&2)&&r!==null)e:for(;;){if(r===null)return;var s=r.tag;if(s===3||s===4){var l=r.stateNode.containerInfo;if(l===a||l.nodeType===8&&l.parentNode===a)break;if(s===4)for(s=r.return;s!==null;){var c=s.tag;if((c===3||c===4)&&(c=s.stateNode.containerInfo,c===a||c.nodeType===8&&c.parentNode===a))return;s=s.return}for(;l!==null;){if(s=Ga(l),s===null)return;if(c=s.tag,c===5||c===6){r=o=s;continue e}l=l.parentNode}}r=r.return}cm(function(){var d=o,f=Yu(n),h=[];e:{var v=zm.get(e);if(v!==void 0){var w=ef,_=e;switch(e){case"keypress":if(gl(n)===0)break e;case"keydown":case"keyup":w=wv;break;case"focusin":_="focus",w=Yc;break;case"focusout":_="blur",w=Yc;break;case"beforeblur":case"afterblur":w=Yc;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":w=cp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":w=dv;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":w=Ev;break;case Am:case Om:case Lm:w=pv;break;case Mm:w=Sv;break;case"scroll":w=lv;break;case"wheel":w=Dv;break;case"copy":case"cut":case"paste":w=mv;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":w=up}var C=(t&4)!==0,D=!C&&e==="scroll",x=C?v!==null?v+"Capture":null:v;C=[];for(var y=d,k;y!==null;){k=y;var j=k.stateNode;if(k.tag===5&&j!==null&&(k=j,x!==null&&(j=qs(y,x),j!=null&&C.push(ni(y,j,k)))),D)break;y=y.return}0<C.length&&(v=new w(v,_,null,n,f),h.push({event:v,listeners:C}))}}if(!(t&7)){e:{if(v=e==="mouseover"||e==="pointerover",w=e==="mouseout"||e==="pointerout",v&&n!==$d&&(_=n.relatedTarget||n.fromElement)&&(Ga(_)||_[qr]))break e;if((w||v)&&(v=f.window===f?f:(v=f.ownerDocument)?v.defaultView||v.parentWindow:window,w?(_=n.relatedTarget||n.toElement,w=d,_=_?Ga(_):null,_!==null&&(D=Qa(_),_!==D||_.tag!==5&&_.tag!==6)&&(_=null)):(w=null,_=d),w!==_)){if(C=cp,j="onMouseLeave",x="onMouseEnter",y="mouse",(e==="pointerout"||e==="pointerover")&&(C=up,j="onPointerLeave",x="onPointerEnter",y="pointer"),D=w==null?v:wo(w),k=_==null?v:wo(_),v=new C(j,y+"leave",w,n,f),v.target=D,v.relatedTarget=k,j=null,Ga(f)===d&&(C=new C(x,y+"enter",_,n,f),C.target=k,C.relatedTarget=D,j=C),D=j,w&&_)t:{for(C=w,x=_,y=0,k=C;k;k=po(k))y++;for(k=0,j=x;j;j=po(j))k++;for(;0<y-k;)C=po(C),y--;for(;0<k-y;)x=po(x),k--;for(;y--;){if(C===x||x!==null&&C===x.alternate)break t;C=po(C),x=po(x)}C=null}else C=null;w!==null&&wp(h,v,w,C,!1),_!==null&&D!==null&&wp(h,D,_,C,!0)}}e:{if(v=d?wo(d):window,w=v.nodeName&&v.nodeName.toLowerCase(),w==="select"||w==="input"&&v.type==="file")var $=Lv;else if(hp(v))if(Dm)$=Gv;else{$=zv;var A=Mv}else(w=v.nodeName)&&w.toLowerCase()==="input"&&(v.type==="checkbox"||v.type==="radio")&&($=$v);if($&&($=$(e,d))){_m(h,$,n,f);break e}A&&A(e,v,d),e==="focusout"&&(A=v._wrapperState)&&A.controlled&&v.type==="number"&&Ad(v,"number",v.value)}switch(A=d?wo(d):window,e){case"focusin":(hp(A)||A.contentEditable==="true")&&(xo=A,Vd=d,js=null);break;case"focusout":js=Vd=xo=null;break;case"mousedown":Kd=!0;break;case"contextmenu":case"mouseup":case"dragend":Kd=!1,bp(h,n,f);break;case"selectionchange":if(Bv)break;case"keydown":case"keyup":bp(h,n,f)}var M;if(nf)e:{switch(e){case"compositionstart":var K="onCompositionStart";break e;case"compositionend":K="onCompositionEnd";break e;case"compositionupdate":K="onCompositionUpdate";break e}K=void 0}else bo?Im(e,n)&&(K="onCompositionEnd"):e==="keydown"&&n.keyCode===229&&(K="onCompositionStart");K&&(Em&&n.locale!=="ko"&&(bo||K!=="onCompositionStart"?K==="onCompositionEnd"&&bo&&(M=Tm()):(sa=f,Qu="value"in sa?sa.value:sa.textContent,bo=!0)),A=$l(d,K),0<A.length&&(K=new dp(K,e,null,n,f),h.push({event:K,listeners:A}),M?K.data=M:(M=Sm(n),M!==null&&(K.data=M)))),(M=jv?Pv(e,n):Nv(e,n))&&(d=$l(d,"onBeforeInput"),0<d.length&&(f=new dp("onBeforeInput","beforeinput",null,n,f),h.push({event:f,listeners:d}),f.data=M))}$m(h,t)})}function ni(e,t,n){return{instance:e,listener:t,currentTarget:n}}function $l(e,t){for(var n=t+"Capture",r=[];e!==null;){var a=e,o=a.stateNode;a.tag===5&&o!==null&&(a=o,o=qs(e,n),o!=null&&r.unshift(ni(e,o,a)),o=qs(e,t),o!=null&&r.push(ni(e,o,a))),e=e.return}return r}function po(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function wp(e,t,n,r,a){for(var o=t._reactName,s=[];n!==null&&n!==r;){var l=n,c=l.alternate,d=l.stateNode;if(c!==null&&c===r)break;l.tag===5&&d!==null&&(l=d,a?(c=qs(n,o),c!=null&&s.unshift(ni(n,c,l))):a||(c=qs(n,o),c!=null&&s.push(ni(n,c,l)))),n=n.return}s.length!==0&&e.push({event:t,listeners:s})}var Kv=/\r\n?/g,Yv=/\u0000|\uFFFD/g;function kp(e){return(typeof e=="string"?e:""+e).replace(Kv,`
`).replace(Yv,"")}function Qi(e,t,n){if(t=kp(t),kp(e)!==t&&n)throw Error(_e(425))}function Gl(){}var Yd=null,qd=null;function Jd(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Xd=typeof setTimeout=="function"?setTimeout:void 0,qv=typeof clearTimeout=="function"?clearTimeout:void 0,Tp=typeof Promise=="function"?Promise:void 0,Jv=typeof queueMicrotask=="function"?queueMicrotask:typeof Tp<"u"?function(e){return Tp.resolve(null).then(e).catch(Xv)}:Xd;function Xv(e){setTimeout(function(){throw e})}function nd(e,t){var n=t,r=0;do{var a=n.nextSibling;if(e.removeChild(n),a&&a.nodeType===8)if(n=a.data,n==="/$"){if(r===0){e.removeChild(a),Zs(t);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=a}while(n);Zs(t)}function pa(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function Ep(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="$"||n==="$!"||n==="$?"){if(t===0)return e;t--}else n==="/$"&&t++}e=e.previousSibling}return null}var qo=Math.random().toString(36).slice(2),Or="__reactFiber$"+qo,ri="__reactProps$"+qo,qr="__reactContainer$"+qo,Zd="__reactEvents$"+qo,Zv="__reactListeners$"+qo,Qv="__reactHandles$"+qo;function Ga(e){var t=e[Or];if(t)return t;for(var n=e.parentNode;n;){if(t=n[qr]||n[Or]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=Ep(e);e!==null;){if(n=e[Or])return n;e=Ep(e)}return t}e=n,n=e.parentNode}return null}function bi(e){return e=e[Or]||e[qr],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function wo(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(_e(33))}function mc(e){return e[ri]||null}var Qd=[],ko=-1;function ka(e){return{current:e}}function Lt(e){0>ko||(e.current=Qd[ko],Qd[ko]=null,ko--)}function Pt(e,t){ko++,Qd[ko]=e.current,e.current=t}var Ca={},Tn=ka(Ca),Hn=ka(!1),Va=Ca;function $o(e,t){var n=e.type.contextTypes;if(!n)return Ca;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var a={},o;for(o in n)a[o]=t[o];return r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function Wn(e){return e=e.childContextTypes,e!=null}function Ul(){Lt(Hn),Lt(Tn)}function Ip(e,t,n){if(Tn.current!==Ca)throw Error(_e(168));Pt(Tn,t),Pt(Hn,n)}function Um(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var a in r)if(!(a in t))throw Error(_e(108,M0(e)||"Unknown",a));return Ht({},n,r)}function Fl(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ca,Va=Tn.current,Pt(Tn,e),Pt(Hn,Hn.current),!0}function Sp(e,t,n){var r=e.stateNode;if(!r)throw Error(_e(169));n?(e=Um(e,t,Va),r.__reactInternalMemoizedMergedChildContext=e,Lt(Hn),Lt(Tn),Pt(Tn,e)):Lt(Hn),Pt(Hn,n)}var Br=null,gc=!1,rd=!1;function Fm(e){Br===null?Br=[e]:Br.push(e)}function eb(e){gc=!0,Fm(e)}function Ta(){if(!rd&&Br!==null){rd=!0;var e=0,t=St;try{var n=Br;for(St=1;e<n.length;e++){var r=n[e];do r=r(!0);while(r!==null)}Br=null,gc=!1}catch(a){throw Br!==null&&(Br=Br.slice(e+1)),pm(qu,Ta),a}finally{St=t,rd=!1}}return null}var To=[],Eo=0,Bl=null,Hl=0,cr=[],dr=0,Ka=null,Hr=1,Wr="";function La(e,t){To[Eo++]=Hl,To[Eo++]=Bl,Bl=e,Hl=t}function Bm(e,t,n){cr[dr++]=Hr,cr[dr++]=Wr,cr[dr++]=Ka,Ka=e;var r=Hr;e=Wr;var a=32-Er(r)-1;r&=~(1<<a),n+=1;var o=32-Er(t)+a;if(30<o){var s=a-a%5;o=(r&(1<<s)-1).toString(32),r>>=s,a-=s,Hr=1<<32-Er(t)+a|n<<a|r,Wr=o+e}else Hr=1<<o|n<<a|r,Wr=e}function af(e){e.return!==null&&(La(e,1),Bm(e,1,0))}function of(e){for(;e===Bl;)Bl=To[--Eo],To[Eo]=null,Hl=To[--Eo],To[Eo]=null;for(;e===Ka;)Ka=cr[--dr],cr[dr]=null,Wr=cr[--dr],cr[dr]=null,Hr=cr[--dr],cr[dr]=null}var er=null,Qn=null,$t=!1,Tr=null;function Hm(e,t){var n=ur(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)}function _p(e,t){switch(e.tag){case 5:var n=e.type;return t=t.nodeType!==1||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,er=e,Qn=pa(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,er=e,Qn=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(n=Ka!==null?{id:Hr,overflow:Wr}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},n=ur(18,null,null,0),n.stateNode=t,n.return=e,e.child=n,er=e,Qn=null,!0):!1;default:return!1}}function eu(e){return(e.mode&1)!==0&&(e.flags&128)===0}function tu(e){if($t){var t=Qn;if(t){var n=t;if(!_p(e,t)){if(eu(e))throw Error(_e(418));t=pa(n.nextSibling);var r=er;t&&_p(e,t)?Hm(r,n):(e.flags=e.flags&-4097|2,$t=!1,er=e)}}else{if(eu(e))throw Error(_e(418));e.flags=e.flags&-4097|2,$t=!1,er=e}}}function Dp(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;er=e}function el(e){if(e!==er)return!1;if(!$t)return Dp(e),$t=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!Jd(e.type,e.memoizedProps)),t&&(t=Qn)){if(eu(e))throw Wm(),Error(_e(418));for(;t;)Hm(e,t),t=pa(t.nextSibling)}if(Dp(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(_e(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="/$"){if(t===0){Qn=pa(e.nextSibling);break e}t--}else n!=="$"&&n!=="$!"&&n!=="$?"||t++}e=e.nextSibling}Qn=null}}else Qn=er?pa(e.stateNode.nextSibling):null;return!0}function Wm(){for(var e=Qn;e;)e=pa(e.nextSibling)}function Go(){Qn=er=null,$t=!1}function sf(e){Tr===null?Tr=[e]:Tr.push(e)}var tb=Qr.ReactCurrentBatchConfig;function fs(e,t,n){if(e=n.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(_e(309));var r=n.stateNode}if(!r)throw Error(_e(147,e));var a=r,o=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===o?t.ref:(t=function(s){var l=a.refs;s===null?delete l[o]:l[o]=s},t._stringRef=o,t)}if(typeof e!="string")throw Error(_e(284));if(!n._owner)throw Error(_e(290,e))}return e}function tl(e,t){throw e=Object.prototype.toString.call(t),Error(_e(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Rp(e){var t=e._init;return t(e._payload)}function Vm(e){function t(x,y){if(e){var k=x.deletions;k===null?(x.deletions=[y],x.flags|=16):k.push(y)}}function n(x,y){if(!e)return null;for(;y!==null;)t(x,y),y=y.sibling;return null}function r(x,y){for(x=new Map;y!==null;)y.key!==null?x.set(y.key,y):x.set(y.index,y),y=y.sibling;return x}function a(x,y){return x=ya(x,y),x.index=0,x.sibling=null,x}function o(x,y,k){return x.index=k,e?(k=x.alternate,k!==null?(k=k.index,k<y?(x.flags|=2,y):k):(x.flags|=2,y)):(x.flags|=1048576,y)}function s(x){return e&&x.alternate===null&&(x.flags|=2),x}function l(x,y,k,j){return y===null||y.tag!==6?(y=dd(k,x.mode,j),y.return=x,y):(y=a(y,k),y.return=x,y)}function c(x,y,k,j){var $=k.type;return $===vo?f(x,y,k.props.children,j,k.key):y!==null&&(y.elementType===$||typeof $=="object"&&$!==null&&$.$$typeof===na&&Rp($)===y.type)?(j=a(y,k.props),j.ref=fs(x,y,k),j.return=x,j):(j=kl(k.type,k.key,k.props,null,x.mode,j),j.ref=fs(x,y,k),j.return=x,j)}function d(x,y,k,j){return y===null||y.tag!==4||y.stateNode.containerInfo!==k.containerInfo||y.stateNode.implementation!==k.implementation?(y=ud(k,x.mode,j),y.return=x,y):(y=a(y,k.children||[]),y.return=x,y)}function f(x,y,k,j,$){return y===null||y.tag!==7?(y=Wa(k,x.mode,j,$),y.return=x,y):(y=a(y,k),y.return=x,y)}function h(x,y,k){if(typeof y=="string"&&y!==""||typeof y=="number")return y=dd(""+y,x.mode,k),y.return=x,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case Hi:return k=kl(y.type,y.key,y.props,null,x.mode,k),k.ref=fs(x,null,y),k.return=x,k;case yo:return y=ud(y,x.mode,k),y.return=x,y;case na:var j=y._init;return h(x,j(y._payload),k)}if(xs(y)||is(y))return y=Wa(y,x.mode,k,null),y.return=x,y;tl(x,y)}return null}function v(x,y,k,j){var $=y!==null?y.key:null;if(typeof k=="string"&&k!==""||typeof k=="number")return $!==null?null:l(x,y,""+k,j);if(typeof k=="object"&&k!==null){switch(k.$$typeof){case Hi:return k.key===$?c(x,y,k,j):null;case yo:return k.key===$?d(x,y,k,j):null;case na:return $=k._init,v(x,y,$(k._payload),j)}if(xs(k)||is(k))return $!==null?null:f(x,y,k,j,null);tl(x,k)}return null}function w(x,y,k,j,$){if(typeof j=="string"&&j!==""||typeof j=="number")return x=x.get(k)||null,l(y,x,""+j,$);if(typeof j=="object"&&j!==null){switch(j.$$typeof){case Hi:return x=x.get(j.key===null?k:j.key)||null,c(y,x,j,$);case yo:return x=x.get(j.key===null?k:j.key)||null,d(y,x,j,$);case na:var A=j._init;return w(x,y,k,A(j._payload),$)}if(xs(j)||is(j))return x=x.get(k)||null,f(y,x,j,$,null);tl(y,j)}return null}function _(x,y,k,j){for(var $=null,A=null,M=y,K=y=0,ee=null;M!==null&&K<k.length;K++){M.index>K?(ee=M,M=null):ee=M.sibling;var re=v(x,M,k[K],j);if(re===null){M===null&&(M=ee);break}e&&M&&re.alternate===null&&t(x,M),y=o(re,y,K),A===null?$=re:A.sibling=re,A=re,M=ee}if(K===k.length)return n(x,M),$t&&La(x,K),$;if(M===null){for(;K<k.length;K++)M=h(x,k[K],j),M!==null&&(y=o(M,y,K),A===null?$=M:A.sibling=M,A=M);return $t&&La(x,K),$}for(M=r(x,M);K<k.length;K++)ee=w(M,x,K,k[K],j),ee!==null&&(e&&ee.alternate!==null&&M.delete(ee.key===null?K:ee.key),y=o(ee,y,K),A===null?$=ee:A.sibling=ee,A=ee);return e&&M.forEach(function(Ie){return t(x,Ie)}),$t&&La(x,K),$}function C(x,y,k,j){var $=is(k);if(typeof $!="function")throw Error(_e(150));if(k=$.call(k),k==null)throw Error(_e(151));for(var A=$=null,M=y,K=y=0,ee=null,re=k.next();M!==null&&!re.done;K++,re=k.next()){M.index>K?(ee=M,M=null):ee=M.sibling;var Ie=v(x,M,re.value,j);if(Ie===null){M===null&&(M=ee);break}e&&M&&Ie.alternate===null&&t(x,M),y=o(Ie,y,K),A===null?$=Ie:A.sibling=Ie,A=Ie,M=ee}if(re.done)return n(x,M),$t&&La(x,K),$;if(M===null){for(;!re.done;K++,re=k.next())re=h(x,re.value,j),re!==null&&(y=o(re,y,K),A===null?$=re:A.sibling=re,A=re);return $t&&La(x,K),$}for(M=r(x,M);!re.done;K++,re=k.next())re=w(M,x,K,re.value,j),re!==null&&(e&&re.alternate!==null&&M.delete(re.key===null?K:re.key),y=o(re,y,K),A===null?$=re:A.sibling=re,A=re);return e&&M.forEach(function(B){return t(x,B)}),$t&&La(x,K),$}function D(x,y,k,j){if(typeof k=="object"&&k!==null&&k.type===vo&&k.key===null&&(k=k.props.children),typeof k=="object"&&k!==null){switch(k.$$typeof){case Hi:e:{for(var $=k.key,A=y;A!==null;){if(A.key===$){if($=k.type,$===vo){if(A.tag===7){n(x,A.sibling),y=a(A,k.props.children),y.return=x,x=y;break e}}else if(A.elementType===$||typeof $=="object"&&$!==null&&$.$$typeof===na&&Rp($)===A.type){n(x,A.sibling),y=a(A,k.props),y.ref=fs(x,A,k),y.return=x,x=y;break e}n(x,A);break}else t(x,A);A=A.sibling}k.type===vo?(y=Wa(k.props.children,x.mode,j,k.key),y.return=x,x=y):(j=kl(k.type,k.key,k.props,null,x.mode,j),j.ref=fs(x,y,k),j.return=x,x=j)}return s(x);case yo:e:{for(A=k.key;y!==null;){if(y.key===A)if(y.tag===4&&y.stateNode.containerInfo===k.containerInfo&&y.stateNode.implementation===k.implementation){n(x,y.sibling),y=a(y,k.children||[]),y.return=x,x=y;break e}else{n(x,y);break}else t(x,y);y=y.sibling}y=ud(k,x.mode,j),y.return=x,x=y}return s(x);case na:return A=k._init,D(x,y,A(k._payload),j)}if(xs(k))return _(x,y,k,j);if(is(k))return C(x,y,k,j);tl(x,k)}return typeof k=="string"&&k!==""||typeof k=="number"?(k=""+k,y!==null&&y.tag===6?(n(x,y.sibling),y=a(y,k),y.return=x,x=y):(n(x,y),y=dd(k,x.mode,j),y.return=x,x=y),s(x)):n(x,y)}return D}var Uo=Vm(!0),Km=Vm(!1),Wl=ka(null),Vl=null,Io=null,lf=null;function cf(){lf=Io=Vl=null}function df(e){var t=Wl.current;Lt(Wl),e._currentValue=t}function nu(e,t,n){for(;e!==null;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,r!==null&&(r.childLanes|=t)):r!==null&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Ao(e,t){Vl=e,lf=Io=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Fn=!0),e.firstContext=null)}function pr(e){var t=e._currentValue;if(lf!==e)if(e={context:e,memoizedValue:t,next:null},Io===null){if(Vl===null)throw Error(_e(308));Io=e,Vl.dependencies={lanes:0,firstContext:e}}else Io=Io.next=e;return t}var Ua=null;function uf(e){Ua===null?Ua=[e]:Ua.push(e)}function Ym(e,t,n,r){var a=t.interleaved;return a===null?(n.next=n,uf(t)):(n.next=a.next,a.next=n),t.interleaved=n,Jr(e,r)}function Jr(e,t){e.lanes|=t;var n=e.alternate;for(n!==null&&(n.lanes|=t),n=e,e=e.return;e!==null;)e.childLanes|=t,n=e.alternate,n!==null&&(n.childLanes|=t),n=e,e=e.return;return n.tag===3?n.stateNode:null}var ra=!1;function ff(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function qm(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Vr(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function ha(e,t,n){var r=e.updateQueue;if(r===null)return null;if(r=r.shared,Tt&2){var a=r.pending;return a===null?t.next=t:(t.next=a.next,a.next=t),r.pending=t,Jr(e,n)}return a=r.interleaved,a===null?(t.next=t,uf(r)):(t.next=a.next,a.next=t),r.interleaved=t,Jr(e,n)}function yl(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,(n&4194240)!==0)){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,Ju(e,n)}}function jp(e,t){var n=e.updateQueue,r=e.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var a=null,o=null;if(n=n.firstBaseUpdate,n!==null){do{var s={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};o===null?a=o=s:o=o.next=s,n=n.next}while(n!==null);o===null?a=o=t:o=o.next=t}else a=o=t;n={baseState:r.baseState,firstBaseUpdate:a,lastBaseUpdate:o,shared:r.shared,effects:r.effects},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Kl(e,t,n,r){var a=e.updateQueue;ra=!1;var o=a.firstBaseUpdate,s=a.lastBaseUpdate,l=a.shared.pending;if(l!==null){a.shared.pending=null;var c=l,d=c.next;c.next=null,s===null?o=d:s.next=d,s=c;var f=e.alternate;f!==null&&(f=f.updateQueue,l=f.lastBaseUpdate,l!==s&&(l===null?f.firstBaseUpdate=d:l.next=d,f.lastBaseUpdate=c))}if(o!==null){var h=a.baseState;s=0,f=d=c=null,l=o;do{var v=l.lane,w=l.eventTime;if((r&v)===v){f!==null&&(f=f.next={eventTime:w,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var _=e,C=l;switch(v=t,w=n,C.tag){case 1:if(_=C.payload,typeof _=="function"){h=_.call(w,h,v);break e}h=_;break e;case 3:_.flags=_.flags&-65537|128;case 0:if(_=C.payload,v=typeof _=="function"?_.call(w,h,v):_,v==null)break e;h=Ht({},h,v);break e;case 2:ra=!0}}l.callback!==null&&l.lane!==0&&(e.flags|=64,v=a.effects,v===null?a.effects=[l]:v.push(l))}else w={eventTime:w,lane:v,tag:l.tag,payload:l.payload,callback:l.callback,next:null},f===null?(d=f=w,c=h):f=f.next=w,s|=v;if(l=l.next,l===null){if(l=a.shared.pending,l===null)break;v=l,l=v.next,v.next=null,a.lastBaseUpdate=v,a.shared.pending=null}}while(!0);if(f===null&&(c=h),a.baseState=c,a.firstBaseUpdate=d,a.lastBaseUpdate=f,t=a.shared.interleaved,t!==null){a=t;do s|=a.lane,a=a.next;while(a!==t)}else o===null&&(a.shared.lanes=0);qa|=s,e.lanes=s,e.memoizedState=h}}function Pp(e,t,n){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var r=e[t],a=r.callback;if(a!==null){if(r.callback=null,r=n,typeof a!="function")throw Error(_e(191,a));a.call(r)}}}var xi={},zr=ka(xi),ai=ka(xi),oi=ka(xi);function Fa(e){if(e===xi)throw Error(_e(174));return e}function pf(e,t){switch(Pt(oi,t),Pt(ai,e),Pt(zr,xi),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Ld(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=Ld(t,e)}Lt(zr),Pt(zr,t)}function Fo(){Lt(zr),Lt(ai),Lt(oi)}function Jm(e){Fa(oi.current);var t=Fa(zr.current),n=Ld(t,e.type);t!==n&&(Pt(ai,e),Pt(zr,n))}function hf(e){ai.current===e&&(Lt(zr),Lt(ai))}var Ft=ka(0);function Yl(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ad=[];function mf(){for(var e=0;e<ad.length;e++)ad[e]._workInProgressVersionPrimary=null;ad.length=0}var vl=Qr.ReactCurrentDispatcher,od=Qr.ReactCurrentBatchConfig,Ya=0,Bt=null,cn=null,fn=null,ql=!1,Ps=!1,si=0,nb=0;function bn(){throw Error(_e(321))}function gf(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Sr(e[n],t[n]))return!1;return!0}function yf(e,t,n,r,a,o){if(Ya=o,Bt=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,vl.current=e===null||e.memoizedState===null?sb:ib,e=n(r,a),Ps){o=0;do{if(Ps=!1,si=0,25<=o)throw Error(_e(301));o+=1,fn=cn=null,t.updateQueue=null,vl.current=lb,e=n(r,a)}while(Ps)}if(vl.current=Jl,t=cn!==null&&cn.next!==null,Ya=0,fn=cn=Bt=null,ql=!1,t)throw Error(_e(300));return e}function vf(){var e=si!==0;return si=0,e}function Nr(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return fn===null?Bt.memoizedState=fn=e:fn=fn.next=e,fn}function hr(){if(cn===null){var e=Bt.alternate;e=e!==null?e.memoizedState:null}else e=cn.next;var t=fn===null?Bt.memoizedState:fn.next;if(t!==null)fn=t,cn=e;else{if(e===null)throw Error(_e(310));cn=e,e={memoizedState:cn.memoizedState,baseState:cn.baseState,baseQueue:cn.baseQueue,queue:cn.queue,next:null},fn===null?Bt.memoizedState=fn=e:fn=fn.next=e}return fn}function ii(e,t){return typeof t=="function"?t(e):t}function sd(e){var t=hr(),n=t.queue;if(n===null)throw Error(_e(311));n.lastRenderedReducer=e;var r=cn,a=r.baseQueue,o=n.pending;if(o!==null){if(a!==null){var s=a.next;a.next=o.next,o.next=s}r.baseQueue=a=o,n.pending=null}if(a!==null){o=a.next,r=r.baseState;var l=s=null,c=null,d=o;do{var f=d.lane;if((Ya&f)===f)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:e(r,d.action);else{var h={lane:f,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(l=c=h,s=r):c=c.next=h,Bt.lanes|=f,qa|=f}d=d.next}while(d!==null&&d!==o);c===null?s=r:c.next=l,Sr(r,t.memoizedState)||(Fn=!0),t.memoizedState=r,t.baseState=s,t.baseQueue=c,n.lastRenderedState=r}if(e=n.interleaved,e!==null){a=e;do o=a.lane,Bt.lanes|=o,qa|=o,a=a.next;while(a!==e)}else a===null&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function id(e){var t=hr(),n=t.queue;if(n===null)throw Error(_e(311));n.lastRenderedReducer=e;var r=n.dispatch,a=n.pending,o=t.memoizedState;if(a!==null){n.pending=null;var s=a=a.next;do o=e(o,s.action),s=s.next;while(s!==a);Sr(o,t.memoizedState)||(Fn=!0),t.memoizedState=o,t.baseQueue===null&&(t.baseState=o),n.lastRenderedState=o}return[o,r]}function Xm(){}function Zm(e,t){var n=Bt,r=hr(),a=t(),o=!Sr(r.memoizedState,a);if(o&&(r.memoizedState=a,Fn=!0),r=r.queue,bf(tg.bind(null,n,r,e),[e]),r.getSnapshot!==t||o||fn!==null&&fn.memoizedState.tag&1){if(n.flags|=2048,li(9,eg.bind(null,n,r,a,t),void 0,null),pn===null)throw Error(_e(349));Ya&30||Qm(n,t,a)}return a}function Qm(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=Bt.updateQueue,t===null?(t={lastEffect:null,stores:null},Bt.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function eg(e,t,n,r){t.value=n,t.getSnapshot=r,ng(t)&&rg(e)}function tg(e,t,n){return n(function(){ng(t)&&rg(e)})}function ng(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Sr(e,n)}catch{return!0}}function rg(e){var t=Jr(e,1);t!==null&&Ir(t,e,1,-1)}function Np(e){var t=Nr();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ii,lastRenderedState:e},t.queue=e,e=e.dispatch=ob.bind(null,Bt,e),[t.memoizedState,e]}function li(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},t=Bt.updateQueue,t===null?(t={lastEffect:null,stores:null},Bt.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,n===null?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e)),e}function ag(){return hr().memoizedState}function bl(e,t,n,r){var a=Nr();Bt.flags|=e,a.memoizedState=li(1|t,n,void 0,r===void 0?null:r)}function yc(e,t,n,r){var a=hr();r=r===void 0?null:r;var o=void 0;if(cn!==null){var s=cn.memoizedState;if(o=s.destroy,r!==null&&gf(r,s.deps)){a.memoizedState=li(t,n,o,r);return}}Bt.flags|=e,a.memoizedState=li(1|t,n,o,r)}function Ap(e,t){return bl(8390656,8,e,t)}function bf(e,t){return yc(2048,8,e,t)}function og(e,t){return yc(4,2,e,t)}function sg(e,t){return yc(4,4,e,t)}function ig(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function lg(e,t,n){return n=n!=null?n.concat([e]):null,yc(4,4,ig.bind(null,t,e),n)}function xf(){}function cg(e,t){var n=hr();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&gf(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function dg(e,t){var n=hr();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&gf(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function ug(e,t,n){return Ya&21?(Sr(n,t)||(n=gm(),Bt.lanes|=n,qa|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Fn=!0),e.memoizedState=n)}function rb(e,t){var n=St;St=n!==0&&4>n?n:4,e(!0);var r=od.transition;od.transition={};try{e(!1),t()}finally{St=n,od.transition=r}}function fg(){return hr().memoizedState}function ab(e,t,n){var r=ga(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},pg(e))hg(t,n);else if(n=Ym(e,t,n,r),n!==null){var a=Nn();Ir(n,e,r,a),mg(n,t,r)}}function ob(e,t,n){var r=ga(e),a={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(pg(e))hg(t,a);else{var o=e.alternate;if(e.lanes===0&&(o===null||o.lanes===0)&&(o=t.lastRenderedReducer,o!==null))try{var s=t.lastRenderedState,l=o(s,n);if(a.hasEagerState=!0,a.eagerState=l,Sr(l,s)){var c=t.interleaved;c===null?(a.next=a,uf(t)):(a.next=c.next,c.next=a),t.interleaved=a;return}}catch{}finally{}n=Ym(e,t,a,r),n!==null&&(a=Nn(),Ir(n,e,r,a),mg(n,t,r))}}function pg(e){var t=e.alternate;return e===Bt||t!==null&&t===Bt}function hg(e,t){Ps=ql=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function mg(e,t,n){if(n&4194240){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,Ju(e,n)}}var Jl={readContext:pr,useCallback:bn,useContext:bn,useEffect:bn,useImperativeHandle:bn,useInsertionEffect:bn,useLayoutEffect:bn,useMemo:bn,useReducer:bn,useRef:bn,useState:bn,useDebugValue:bn,useDeferredValue:bn,useTransition:bn,useMutableSource:bn,useSyncExternalStore:bn,useId:bn,unstable_isNewReconciler:!1},sb={readContext:pr,useCallback:function(e,t){return Nr().memoizedState=[e,t===void 0?null:t],e},useContext:pr,useEffect:Ap,useImperativeHandle:function(e,t,n){return n=n!=null?n.concat([e]):null,bl(4194308,4,ig.bind(null,t,e),n)},useLayoutEffect:function(e,t){return bl(4194308,4,e,t)},useInsertionEffect:function(e,t){return bl(4,2,e,t)},useMemo:function(e,t){var n=Nr();return t=t===void 0?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Nr();return t=n!==void 0?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=ab.bind(null,Bt,e),[r.memoizedState,e]},useRef:function(e){var t=Nr();return e={current:e},t.memoizedState=e},useState:Np,useDebugValue:xf,useDeferredValue:function(e){return Nr().memoizedState=e},useTransition:function(){var e=Np(!1),t=e[0];return e=rb.bind(null,e[1]),Nr().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=Bt,a=Nr();if($t){if(n===void 0)throw Error(_e(407));n=n()}else{if(n=t(),pn===null)throw Error(_e(349));Ya&30||Qm(r,t,n)}a.memoizedState=n;var o={value:n,getSnapshot:t};return a.queue=o,Ap(tg.bind(null,r,o,e),[e]),r.flags|=2048,li(9,eg.bind(null,r,o,n,t),void 0,null),n},useId:function(){var e=Nr(),t=pn.identifierPrefix;if($t){var n=Wr,r=Hr;n=(r&~(1<<32-Er(r)-1)).toString(32)+n,t=":"+t+"R"+n,n=si++,0<n&&(t+="H"+n.toString(32)),t+=":"}else n=nb++,t=":"+t+"r"+n.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},ib={readContext:pr,useCallback:cg,useContext:pr,useEffect:bf,useImperativeHandle:lg,useInsertionEffect:og,useLayoutEffect:sg,useMemo:dg,useReducer:sd,useRef:ag,useState:function(){return sd(ii)},useDebugValue:xf,useDeferredValue:function(e){var t=hr();return ug(t,cn.memoizedState,e)},useTransition:function(){var e=sd(ii)[0],t=hr().memoizedState;return[e,t]},useMutableSource:Xm,useSyncExternalStore:Zm,useId:fg,unstable_isNewReconciler:!1},lb={readContext:pr,useCallback:cg,useContext:pr,useEffect:bf,useImperativeHandle:lg,useInsertionEffect:og,useLayoutEffect:sg,useMemo:dg,useReducer:id,useRef:ag,useState:function(){return id(ii)},useDebugValue:xf,useDeferredValue:function(e){var t=hr();return cn===null?t.memoizedState=e:ug(t,cn.memoizedState,e)},useTransition:function(){var e=id(ii)[0],t=hr().memoizedState;return[e,t]},useMutableSource:Xm,useSyncExternalStore:Zm,useId:fg,unstable_isNewReconciler:!1};function wr(e,t){if(e&&e.defaultProps){t=Ht({},t),e=e.defaultProps;for(var n in e)t[n]===void 0&&(t[n]=e[n]);return t}return t}function ru(e,t,n,r){t=e.memoizedState,n=n(r,t),n=n==null?t:Ht({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var vc={isMounted:function(e){return(e=e._reactInternals)?Qa(e)===e:!1},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=Nn(),a=ga(e),o=Vr(r,a);o.payload=t,n!=null&&(o.callback=n),t=ha(e,o,a),t!==null&&(Ir(t,e,a,r),yl(t,e,a))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=Nn(),a=ga(e),o=Vr(r,a);o.tag=1,o.payload=t,n!=null&&(o.callback=n),t=ha(e,o,a),t!==null&&(Ir(t,e,a,r),yl(t,e,a))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Nn(),r=ga(e),a=Vr(n,r);a.tag=2,t!=null&&(a.callback=t),t=ha(e,a,r),t!==null&&(Ir(t,e,r,n),yl(t,e,r))}};function Op(e,t,n,r,a,o,s){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(r,o,s):t.prototype&&t.prototype.isPureReactComponent?!ei(n,r)||!ei(a,o):!0}function gg(e,t,n){var r=!1,a=Ca,o=t.contextType;return typeof o=="object"&&o!==null?o=pr(o):(a=Wn(t)?Va:Tn.current,r=t.contextTypes,o=(r=r!=null)?$o(e,a):Ca),t=new t(n,o),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=vc,e.stateNode=t,t._reactInternals=e,r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=o),t}function Lp(e,t,n,r){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(n,r),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&vc.enqueueReplaceState(t,t.state,null)}function au(e,t,n,r){var a=e.stateNode;a.props=n,a.state=e.memoizedState,a.refs={},ff(e);var o=t.contextType;typeof o=="object"&&o!==null?a.context=pr(o):(o=Wn(t)?Va:Tn.current,a.context=$o(e,o)),a.state=e.memoizedState,o=t.getDerivedStateFromProps,typeof o=="function"&&(ru(e,t,o,n),a.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof a.getSnapshotBeforeUpdate=="function"||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(t=a.state,typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount(),t!==a.state&&vc.enqueueReplaceState(a,a.state,null),Kl(e,n,a,r),a.state=e.memoizedState),typeof a.componentDidMount=="function"&&(e.flags|=4194308)}function Bo(e,t){try{var n="",r=t;do n+=L0(r),r=r.return;while(r);var a=n}catch(o){a=`
Error generating stack: `+o.message+`
`+o.stack}return{value:e,source:t,stack:a,digest:null}}function ld(e,t,n){return{value:e,source:null,stack:n??null,digest:t??null}}function ou(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var cb=typeof WeakMap=="function"?WeakMap:Map;function yg(e,t,n){n=Vr(-1,n),n.tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Zl||(Zl=!0,mu=r),ou(e,t)},n}function vg(e,t,n){n=Vr(-1,n),n.tag=3;var r=e.type.getDerivedStateFromError;if(typeof r=="function"){var a=t.value;n.payload=function(){return r(a)},n.callback=function(){ou(e,t)}}var o=e.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(n.callback=function(){ou(e,t),typeof r!="function"&&(ma===null?ma=new Set([this]):ma.add(this));var s=t.stack;this.componentDidCatch(t.value,{componentStack:s!==null?s:""})}),n}function Mp(e,t,n){var r=e.pingCache;if(r===null){r=e.pingCache=new cb;var a=new Set;r.set(t,a)}else a=r.get(t),a===void 0&&(a=new Set,r.set(t,a));a.has(n)||(a.add(n),e=kb.bind(null,e,t,n),t.then(e,e))}function zp(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function $p(e,t,n,r,a){return e.mode&1?(e.flags|=65536,e.lanes=a,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(t=Vr(-1,1),t.tag=2,ha(n,t,1))),n.lanes|=1),e)}var db=Qr.ReactCurrentOwner,Fn=!1;function Pn(e,t,n,r){t.child=e===null?Km(t,null,n,r):Uo(t,e.child,n,r)}function Gp(e,t,n,r,a){n=n.render;var o=t.ref;return Ao(t,a),r=yf(e,t,n,r,o,a),n=vf(),e!==null&&!Fn?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Xr(e,t,a)):($t&&n&&af(t),t.flags|=1,Pn(e,t,r,a),t.child)}function Up(e,t,n,r,a){if(e===null){var o=n.type;return typeof o=="function"&&!_f(o)&&o.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(t.tag=15,t.type=o,bg(e,t,o,r,a)):(e=kl(n.type,null,r,t,t.mode,a),e.ref=t.ref,e.return=t,t.child=e)}if(o=e.child,!(e.lanes&a)){var s=o.memoizedProps;if(n=n.compare,n=n!==null?n:ei,n(s,r)&&e.ref===t.ref)return Xr(e,t,a)}return t.flags|=1,e=ya(o,r),e.ref=t.ref,e.return=t,t.child=e}function bg(e,t,n,r,a){if(e!==null){var o=e.memoizedProps;if(ei(o,r)&&e.ref===t.ref)if(Fn=!1,t.pendingProps=r=o,(e.lanes&a)!==0)e.flags&131072&&(Fn=!0);else return t.lanes=e.lanes,Xr(e,t,a)}return su(e,t,n,r,a)}function xg(e,t,n){var r=t.pendingProps,a=r.children,o=e!==null?e.memoizedState:null;if(r.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Pt(_o,Zn),Zn|=n;else{if(!(n&1073741824))return e=o!==null?o.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Pt(_o,Zn),Zn|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=o!==null?o.baseLanes:n,Pt(_o,Zn),Zn|=r}else o!==null?(r=o.baseLanes|n,t.memoizedState=null):r=n,Pt(_o,Zn),Zn|=r;return Pn(e,t,a,n),t.child}function Cg(e,t){var n=t.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function su(e,t,n,r,a){var o=Wn(n)?Va:Tn.current;return o=$o(t,o),Ao(t,a),n=yf(e,t,n,r,o,a),r=vf(),e!==null&&!Fn?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Xr(e,t,a)):($t&&r&&af(t),t.flags|=1,Pn(e,t,n,a),t.child)}function Fp(e,t,n,r,a){if(Wn(n)){var o=!0;Fl(t)}else o=!1;if(Ao(t,a),t.stateNode===null)xl(e,t),gg(t,n,r),au(t,n,r,a),r=!0;else if(e===null){var s=t.stateNode,l=t.memoizedProps;s.props=l;var c=s.context,d=n.contextType;typeof d=="object"&&d!==null?d=pr(d):(d=Wn(n)?Va:Tn.current,d=$o(t,d));var f=n.getDerivedStateFromProps,h=typeof f=="function"||typeof s.getSnapshotBeforeUpdate=="function";h||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(l!==r||c!==d)&&Lp(t,s,r,d),ra=!1;var v=t.memoizedState;s.state=v,Kl(t,r,s,a),c=t.memoizedState,l!==r||v!==c||Hn.current||ra?(typeof f=="function"&&(ru(t,n,f,r),c=t.memoizedState),(l=ra||Op(t,n,l,r,v,c,d))?(h||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount()),typeof s.componentDidMount=="function"&&(t.flags|=4194308)):(typeof s.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=c),s.props=r,s.state=c,s.context=d,r=l):(typeof s.componentDidMount=="function"&&(t.flags|=4194308),r=!1)}else{s=t.stateNode,qm(e,t),l=t.memoizedProps,d=t.type===t.elementType?l:wr(t.type,l),s.props=d,h=t.pendingProps,v=s.context,c=n.contextType,typeof c=="object"&&c!==null?c=pr(c):(c=Wn(n)?Va:Tn.current,c=$o(t,c));var w=n.getDerivedStateFromProps;(f=typeof w=="function"||typeof s.getSnapshotBeforeUpdate=="function")||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(l!==h||v!==c)&&Lp(t,s,r,c),ra=!1,v=t.memoizedState,s.state=v,Kl(t,r,s,a);var _=t.memoizedState;l!==h||v!==_||Hn.current||ra?(typeof w=="function"&&(ru(t,n,w,r),_=t.memoizedState),(d=ra||Op(t,n,d,r,v,_,c)||!1)?(f||typeof s.UNSAFE_componentWillUpdate!="function"&&typeof s.componentWillUpdate!="function"||(typeof s.componentWillUpdate=="function"&&s.componentWillUpdate(r,_,c),typeof s.UNSAFE_componentWillUpdate=="function"&&s.UNSAFE_componentWillUpdate(r,_,c)),typeof s.componentDidUpdate=="function"&&(t.flags|=4),typeof s.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof s.componentDidUpdate!="function"||l===e.memoizedProps&&v===e.memoizedState||(t.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&v===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=_),s.props=r,s.state=_,s.context=c,r=d):(typeof s.componentDidUpdate!="function"||l===e.memoizedProps&&v===e.memoizedState||(t.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&v===e.memoizedState||(t.flags|=1024),r=!1)}return iu(e,t,n,r,o,a)}function iu(e,t,n,r,a,o){Cg(e,t);var s=(t.flags&128)!==0;if(!r&&!s)return a&&Sp(t,n,!1),Xr(e,t,o);r=t.stateNode,db.current=t;var l=s&&typeof n.getDerivedStateFromError!="function"?null:r.render();return t.flags|=1,e!==null&&s?(t.child=Uo(t,e.child,null,o),t.child=Uo(t,null,l,o)):Pn(e,t,l,o),t.memoizedState=r.state,a&&Sp(t,n,!0),t.child}function wg(e){var t=e.stateNode;t.pendingContext?Ip(e,t.pendingContext,t.pendingContext!==t.context):t.context&&Ip(e,t.context,!1),pf(e,t.containerInfo)}function Bp(e,t,n,r,a){return Go(),sf(a),t.flags|=256,Pn(e,t,n,r),t.child}var lu={dehydrated:null,treeContext:null,retryLane:0};function cu(e){return{baseLanes:e,cachePool:null,transitions:null}}function kg(e,t,n){var r=t.pendingProps,a=Ft.current,o=!1,s=(t.flags&128)!==0,l;if((l=s)||(l=e!==null&&e.memoizedState===null?!1:(a&2)!==0),l?(o=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(a|=1),Pt(Ft,a&1),e===null)return tu(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(s=r.children,e=r.fallback,o?(r=t.mode,o=t.child,s={mode:"hidden",children:s},!(r&1)&&o!==null?(o.childLanes=0,o.pendingProps=s):o=Cc(s,r,0,null),e=Wa(e,r,n,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=cu(n),t.memoizedState=lu,e):Cf(t,s));if(a=e.memoizedState,a!==null&&(l=a.dehydrated,l!==null))return ub(e,t,s,r,l,a,n);if(o){o=r.fallback,s=t.mode,a=e.child,l=a.sibling;var c={mode:"hidden",children:r.children};return!(s&1)&&t.child!==a?(r=t.child,r.childLanes=0,r.pendingProps=c,t.deletions=null):(r=ya(a,c),r.subtreeFlags=a.subtreeFlags&14680064),l!==null?o=ya(l,o):(o=Wa(o,s,n,null),o.flags|=2),o.return=t,r.return=t,r.sibling=o,t.child=r,r=o,o=t.child,s=e.child.memoizedState,s=s===null?cu(n):{baseLanes:s.baseLanes|n,cachePool:null,transitions:s.transitions},o.memoizedState=s,o.childLanes=e.childLanes&~n,t.memoizedState=lu,r}return o=e.child,e=o.sibling,r=ya(o,{mode:"visible",children:r.children}),!(t.mode&1)&&(r.lanes=n),r.return=t,r.sibling=null,e!==null&&(n=t.deletions,n===null?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r}function Cf(e,t){return t=Cc({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function nl(e,t,n,r){return r!==null&&sf(r),Uo(t,e.child,null,n),e=Cf(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function ub(e,t,n,r,a,o,s){if(n)return t.flags&256?(t.flags&=-257,r=ld(Error(_e(422))),nl(e,t,s,r)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(o=r.fallback,a=t.mode,r=Cc({mode:"visible",children:r.children},a,0,null),o=Wa(o,a,s,null),o.flags|=2,r.return=t,o.return=t,r.sibling=o,t.child=r,t.mode&1&&Uo(t,e.child,null,s),t.child.memoizedState=cu(s),t.memoizedState=lu,o);if(!(t.mode&1))return nl(e,t,s,null);if(a.data==="$!"){if(r=a.nextSibling&&a.nextSibling.dataset,r)var l=r.dgst;return r=l,o=Error(_e(419)),r=ld(o,r,void 0),nl(e,t,s,r)}if(l=(s&e.childLanes)!==0,Fn||l){if(r=pn,r!==null){switch(s&-s){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}a=a&(r.suspendedLanes|s)?0:a,a!==0&&a!==o.retryLane&&(o.retryLane=a,Jr(e,a),Ir(r,e,a,-1))}return Sf(),r=ld(Error(_e(421))),nl(e,t,s,r)}return a.data==="$?"?(t.flags|=128,t.child=e.child,t=Tb.bind(null,e),a._reactRetry=t,null):(e=o.treeContext,Qn=pa(a.nextSibling),er=t,$t=!0,Tr=null,e!==null&&(cr[dr++]=Hr,cr[dr++]=Wr,cr[dr++]=Ka,Hr=e.id,Wr=e.overflow,Ka=t),t=Cf(t,r.children),t.flags|=4096,t)}function Hp(e,t,n){e.lanes|=t;var r=e.alternate;r!==null&&(r.lanes|=t),nu(e.return,t,n)}function cd(e,t,n,r,a){var o=e.memoizedState;o===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:a}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=n,o.tailMode=a)}function Tg(e,t,n){var r=t.pendingProps,a=r.revealOrder,o=r.tail;if(Pn(e,t,r.children,n),r=Ft.current,r&2)r=r&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Hp(e,n,t);else if(e.tag===19)Hp(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Pt(Ft,r),!(t.mode&1))t.memoizedState=null;else switch(a){case"forwards":for(n=t.child,a=null;n!==null;)e=n.alternate,e!==null&&Yl(e)===null&&(a=n),n=n.sibling;n=a,n===null?(a=t.child,t.child=null):(a=n.sibling,n.sibling=null),cd(t,!1,a,n,o);break;case"backwards":for(n=null,a=t.child,t.child=null;a!==null;){if(e=a.alternate,e!==null&&Yl(e)===null){t.child=a;break}e=a.sibling,a.sibling=n,n=a,a=e}cd(t,!0,n,null,o);break;case"together":cd(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function xl(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Xr(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),qa|=t.lanes,!(n&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(_e(153));if(t.child!==null){for(e=t.child,n=ya(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=ya(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function fb(e,t,n){switch(t.tag){case 3:wg(t),Go();break;case 5:Jm(t);break;case 1:Wn(t.type)&&Fl(t);break;case 4:pf(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,a=t.memoizedProps.value;Pt(Wl,r._currentValue),r._currentValue=a;break;case 13:if(r=t.memoizedState,r!==null)return r.dehydrated!==null?(Pt(Ft,Ft.current&1),t.flags|=128,null):n&t.child.childLanes?kg(e,t,n):(Pt(Ft,Ft.current&1),e=Xr(e,t,n),e!==null?e.sibling:null);Pt(Ft,Ft.current&1);break;case 19:if(r=(n&t.childLanes)!==0,e.flags&128){if(r)return Tg(e,t,n);t.flags|=128}if(a=t.memoizedState,a!==null&&(a.rendering=null,a.tail=null,a.lastEffect=null),Pt(Ft,Ft.current),r)break;return null;case 22:case 23:return t.lanes=0,xg(e,t,n)}return Xr(e,t,n)}var Eg,du,Ig,Sg;Eg=function(e,t){for(var n=t.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};du=function(){};Ig=function(e,t,n,r){var a=e.memoizedProps;if(a!==r){e=t.stateNode,Fa(zr.current);var o=null;switch(n){case"input":a=Pd(e,a),r=Pd(e,r),o=[];break;case"select":a=Ht({},a,{value:void 0}),r=Ht({},r,{value:void 0}),o=[];break;case"textarea":a=Od(e,a),r=Od(e,r),o=[];break;default:typeof a.onClick!="function"&&typeof r.onClick=="function"&&(e.onclick=Gl)}Md(n,r);var s;n=null;for(d in a)if(!r.hasOwnProperty(d)&&a.hasOwnProperty(d)&&a[d]!=null)if(d==="style"){var l=a[d];for(s in l)l.hasOwnProperty(s)&&(n||(n={}),n[s]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(Ks.hasOwnProperty(d)?o||(o=[]):(o=o||[]).push(d,null));for(d in r){var c=r[d];if(l=a!=null?a[d]:void 0,r.hasOwnProperty(d)&&c!==l&&(c!=null||l!=null))if(d==="style")if(l){for(s in l)!l.hasOwnProperty(s)||c&&c.hasOwnProperty(s)||(n||(n={}),n[s]="");for(s in c)c.hasOwnProperty(s)&&l[s]!==c[s]&&(n||(n={}),n[s]=c[s])}else n||(o||(o=[]),o.push(d,n)),n=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(o=o||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(o=o||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(Ks.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&Ot("scroll",e),o||l===c||(o=[])):(o=o||[]).push(d,c))}n&&(o=o||[]).push("style",n);var d=o;(t.updateQueue=d)&&(t.flags|=4)}};Sg=function(e,t,n,r){n!==r&&(t.flags|=4)};function ps(e,t){if(!$t)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:r.sibling=null}}function xn(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,r=0;if(t)for(var a=e.child;a!==null;)n|=a.lanes|a.childLanes,r|=a.subtreeFlags&14680064,r|=a.flags&14680064,a.return=e,a=a.sibling;else for(a=e.child;a!==null;)n|=a.lanes|a.childLanes,r|=a.subtreeFlags,r|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function pb(e,t,n){var r=t.pendingProps;switch(of(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return xn(t),null;case 1:return Wn(t.type)&&Ul(),xn(t),null;case 3:return r=t.stateNode,Fo(),Lt(Hn),Lt(Tn),mf(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(e===null||e.child===null)&&(el(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,Tr!==null&&(vu(Tr),Tr=null))),du(e,t),xn(t),null;case 5:hf(t);var a=Fa(oi.current);if(n=t.type,e!==null&&t.stateNode!=null)Ig(e,t,n,r,a),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(t.stateNode===null)throw Error(_e(166));return xn(t),null}if(e=Fa(zr.current),el(t)){r=t.stateNode,n=t.type;var o=t.memoizedProps;switch(r[Or]=t,r[ri]=o,e=(t.mode&1)!==0,n){case"dialog":Ot("cancel",r),Ot("close",r);break;case"iframe":case"object":case"embed":Ot("load",r);break;case"video":case"audio":for(a=0;a<ws.length;a++)Ot(ws[a],r);break;case"source":Ot("error",r);break;case"img":case"image":case"link":Ot("error",r),Ot("load",r);break;case"details":Ot("toggle",r);break;case"input":Qf(r,o),Ot("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},Ot("invalid",r);break;case"textarea":tp(r,o),Ot("invalid",r)}Md(n,o),a=null;for(var s in o)if(o.hasOwnProperty(s)){var l=o[s];s==="children"?typeof l=="string"?r.textContent!==l&&(o.suppressHydrationWarning!==!0&&Qi(r.textContent,l,e),a=["children",l]):typeof l=="number"&&r.textContent!==""+l&&(o.suppressHydrationWarning!==!0&&Qi(r.textContent,l,e),a=["children",""+l]):Ks.hasOwnProperty(s)&&l!=null&&s==="onScroll"&&Ot("scroll",r)}switch(n){case"input":Wi(r),ep(r,o,!0);break;case"textarea":Wi(r),np(r);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(r.onclick=Gl)}r=a,t.updateQueue=r,r!==null&&(t.flags|=4)}else{s=a.nodeType===9?a:a.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=tm(n)),e==="http://www.w3.org/1999/xhtml"?n==="script"?(e=s.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof r.is=="string"?e=s.createElement(n,{is:r.is}):(e=s.createElement(n),n==="select"&&(s=e,r.multiple?s.multiple=!0:r.size&&(s.size=r.size))):e=s.createElementNS(e,n),e[Or]=t,e[ri]=r,Eg(e,t,!1,!1),t.stateNode=e;e:{switch(s=zd(n,r),n){case"dialog":Ot("cancel",e),Ot("close",e),a=r;break;case"iframe":case"object":case"embed":Ot("load",e),a=r;break;case"video":case"audio":for(a=0;a<ws.length;a++)Ot(ws[a],e);a=r;break;case"source":Ot("error",e),a=r;break;case"img":case"image":case"link":Ot("error",e),Ot("load",e),a=r;break;case"details":Ot("toggle",e),a=r;break;case"input":Qf(e,r),a=Pd(e,r),Ot("invalid",e);break;case"option":a=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},a=Ht({},r,{value:void 0}),Ot("invalid",e);break;case"textarea":tp(e,r),a=Od(e,r),Ot("invalid",e);break;default:a=r}Md(n,a),l=a;for(o in l)if(l.hasOwnProperty(o)){var c=l[o];o==="style"?am(e,c):o==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&nm(e,c)):o==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&Ys(e,c):typeof c=="number"&&Ys(e,""+c):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(Ks.hasOwnProperty(o)?c!=null&&o==="onScroll"&&Ot("scroll",e):c!=null&&Hu(e,o,c,s))}switch(n){case"input":Wi(e),ep(e,r,!1);break;case"textarea":Wi(e),np(e);break;case"option":r.value!=null&&e.setAttribute("value",""+xa(r.value));break;case"select":e.multiple=!!r.multiple,o=r.value,o!=null?Ro(e,!!r.multiple,o,!1):r.defaultValue!=null&&Ro(e,!!r.multiple,r.defaultValue,!0);break;default:typeof a.onClick=="function"&&(e.onclick=Gl)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return xn(t),null;case 6:if(e&&t.stateNode!=null)Sg(e,t,e.memoizedProps,r);else{if(typeof r!="string"&&t.stateNode===null)throw Error(_e(166));if(n=Fa(oi.current),Fa(zr.current),el(t)){if(r=t.stateNode,n=t.memoizedProps,r[Or]=t,(o=r.nodeValue!==n)&&(e=er,e!==null))switch(e.tag){case 3:Qi(r.nodeValue,n,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Qi(r.nodeValue,n,(e.mode&1)!==0)}o&&(t.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Or]=t,t.stateNode=r}return xn(t),null;case 13:if(Lt(Ft),r=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if($t&&Qn!==null&&t.mode&1&&!(t.flags&128))Wm(),Go(),t.flags|=98560,o=!1;else if(o=el(t),r!==null&&r.dehydrated!==null){if(e===null){if(!o)throw Error(_e(318));if(o=t.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(_e(317));o[Or]=t}else Go(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;xn(t),o=!1}else Tr!==null&&(vu(Tr),Tr=null),o=!0;if(!o)return t.flags&65536?t:null}return t.flags&128?(t.lanes=n,t):(r=r!==null,r!==(e!==null&&e.memoizedState!==null)&&r&&(t.child.flags|=8192,t.mode&1&&(e===null||Ft.current&1?dn===0&&(dn=3):Sf())),t.updateQueue!==null&&(t.flags|=4),xn(t),null);case 4:return Fo(),du(e,t),e===null&&ti(t.stateNode.containerInfo),xn(t),null;case 10:return df(t.type._context),xn(t),null;case 17:return Wn(t.type)&&Ul(),xn(t),null;case 19:if(Lt(Ft),o=t.memoizedState,o===null)return xn(t),null;if(r=(t.flags&128)!==0,s=o.rendering,s===null)if(r)ps(o,!1);else{if(dn!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(s=Yl(e),s!==null){for(t.flags|=128,ps(o,!1),r=s.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;n!==null;)o=n,e=r,o.flags&=14680066,s=o.alternate,s===null?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=s.childLanes,o.lanes=s.lanes,o.child=s.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=s.memoizedProps,o.memoizedState=s.memoizedState,o.updateQueue=s.updateQueue,o.type=s.type,e=s.dependencies,o.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Pt(Ft,Ft.current&1|2),t.child}e=e.sibling}o.tail!==null&&Xt()>Ho&&(t.flags|=128,r=!0,ps(o,!1),t.lanes=4194304)}else{if(!r)if(e=Yl(s),e!==null){if(t.flags|=128,r=!0,n=e.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),ps(o,!0),o.tail===null&&o.tailMode==="hidden"&&!s.alternate&&!$t)return xn(t),null}else 2*Xt()-o.renderingStartTime>Ho&&n!==1073741824&&(t.flags|=128,r=!0,ps(o,!1),t.lanes=4194304);o.isBackwards?(s.sibling=t.child,t.child=s):(n=o.last,n!==null?n.sibling=s:t.child=s,o.last=s)}return o.tail!==null?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=Xt(),t.sibling=null,n=Ft.current,Pt(Ft,r?n&1|2:n&1),t):(xn(t),null);case 22:case 23:return If(),r=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==r&&(t.flags|=8192),r&&t.mode&1?Zn&1073741824&&(xn(t),t.subtreeFlags&6&&(t.flags|=8192)):xn(t),null;case 24:return null;case 25:return null}throw Error(_e(156,t.tag))}function hb(e,t){switch(of(t),t.tag){case 1:return Wn(t.type)&&Ul(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Fo(),Lt(Hn),Lt(Tn),mf(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return hf(t),null;case 13:if(Lt(Ft),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(_e(340));Go()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Lt(Ft),null;case 4:return Fo(),null;case 10:return df(t.type._context),null;case 22:case 23:return If(),null;case 24:return null;default:return null}}var rl=!1,kn=!1,mb=typeof WeakSet=="function"?WeakSet:Set,Be=null;function So(e,t){var n=e.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){qt(e,t,r)}else n.current=null}function uu(e,t,n){try{n()}catch(r){qt(e,t,r)}}var Wp=!1;function gb(e,t){if(Yd=Ml,e=Pm(),rf(e)){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{n=(n=e.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var a=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{n.nodeType,o.nodeType}catch{n=null;break e}var s=0,l=-1,c=-1,d=0,f=0,h=e,v=null;t:for(;;){for(var w;h!==n||a!==0&&h.nodeType!==3||(l=s+a),h!==o||r!==0&&h.nodeType!==3||(c=s+r),h.nodeType===3&&(s+=h.nodeValue.length),(w=h.firstChild)!==null;)v=h,h=w;for(;;){if(h===e)break t;if(v===n&&++d===a&&(l=s),v===o&&++f===r&&(c=s),(w=h.nextSibling)!==null)break;h=v,v=h.parentNode}h=w}n=l===-1||c===-1?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(qd={focusedElem:e,selectionRange:n},Ml=!1,Be=t;Be!==null;)if(t=Be,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Be=e;else for(;Be!==null;){t=Be;try{var _=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(_!==null){var C=_.memoizedProps,D=_.memoizedState,x=t.stateNode,y=x.getSnapshotBeforeUpdate(t.elementType===t.type?C:wr(t.type,C),D);x.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var k=t.stateNode.containerInfo;k.nodeType===1?k.textContent="":k.nodeType===9&&k.documentElement&&k.removeChild(k.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(_e(163))}}catch(j){qt(t,t.return,j)}if(e=t.sibling,e!==null){e.return=t.return,Be=e;break}Be=t.return}return _=Wp,Wp=!1,_}function Ns(e,t,n){var r=t.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var a=r=r.next;do{if((a.tag&e)===e){var o=a.destroy;a.destroy=void 0,o!==void 0&&uu(t,n,o)}a=a.next}while(a!==r)}}function bc(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function fu(e){var t=e.ref;if(t!==null){var n=e.stateNode;switch(e.tag){case 5:e=n;break;default:e=n}typeof t=="function"?t(e):t.current=e}}function _g(e){var t=e.alternate;t!==null&&(e.alternate=null,_g(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Or],delete t[ri],delete t[Zd],delete t[Zv],delete t[Qv])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function Dg(e){return e.tag===5||e.tag===3||e.tag===4}function Vp(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Dg(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function pu(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.nodeType===8?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(n.nodeType===8?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=Gl));else if(r!==4&&(e=e.child,e!==null))for(pu(e,t,n),e=e.sibling;e!==null;)pu(e,t,n),e=e.sibling}function hu(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(r!==4&&(e=e.child,e!==null))for(hu(e,t,n),e=e.sibling;e!==null;)hu(e,t,n),e=e.sibling}var mn=null,kr=!1;function ta(e,t,n){for(n=n.child;n!==null;)Rg(e,t,n),n=n.sibling}function Rg(e,t,n){if(Mr&&typeof Mr.onCommitFiberUnmount=="function")try{Mr.onCommitFiberUnmount(uc,n)}catch{}switch(n.tag){case 5:kn||So(n,t);case 6:var r=mn,a=kr;mn=null,ta(e,t,n),mn=r,kr=a,mn!==null&&(kr?(e=mn,n=n.stateNode,e.nodeType===8?e.parentNode.removeChild(n):e.removeChild(n)):mn.removeChild(n.stateNode));break;case 18:mn!==null&&(kr?(e=mn,n=n.stateNode,e.nodeType===8?nd(e.parentNode,n):e.nodeType===1&&nd(e,n),Zs(e)):nd(mn,n.stateNode));break;case 4:r=mn,a=kr,mn=n.stateNode.containerInfo,kr=!0,ta(e,t,n),mn=r,kr=a;break;case 0:case 11:case 14:case 15:if(!kn&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){a=r=r.next;do{var o=a,s=o.destroy;o=o.tag,s!==void 0&&(o&2||o&4)&&uu(n,t,s),a=a.next}while(a!==r)}ta(e,t,n);break;case 1:if(!kn&&(So(n,t),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(l){qt(n,t,l)}ta(e,t,n);break;case 21:ta(e,t,n);break;case 22:n.mode&1?(kn=(r=kn)||n.memoizedState!==null,ta(e,t,n),kn=r):ta(e,t,n);break;default:ta(e,t,n)}}function Kp(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new mb),t.forEach(function(r){var a=Eb.bind(null,e,r);n.has(r)||(n.add(r),r.then(a,a))})}}function xr(e,t){var n=t.deletions;if(n!==null)for(var r=0;r<n.length;r++){var a=n[r];try{var o=e,s=t,l=s;e:for(;l!==null;){switch(l.tag){case 5:mn=l.stateNode,kr=!1;break e;case 3:mn=l.stateNode.containerInfo,kr=!0;break e;case 4:mn=l.stateNode.containerInfo,kr=!0;break e}l=l.return}if(mn===null)throw Error(_e(160));Rg(o,s,a),mn=null,kr=!1;var c=a.alternate;c!==null&&(c.return=null),a.return=null}catch(d){qt(a,t,d)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)jg(t,e),t=t.sibling}function jg(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(xr(t,e),Pr(e),r&4){try{Ns(3,e,e.return),bc(3,e)}catch(C){qt(e,e.return,C)}try{Ns(5,e,e.return)}catch(C){qt(e,e.return,C)}}break;case 1:xr(t,e),Pr(e),r&512&&n!==null&&So(n,n.return);break;case 5:if(xr(t,e),Pr(e),r&512&&n!==null&&So(n,n.return),e.flags&32){var a=e.stateNode;try{Ys(a,"")}catch(C){qt(e,e.return,C)}}if(r&4&&(a=e.stateNode,a!=null)){var o=e.memoizedProps,s=n!==null?n.memoizedProps:o,l=e.type,c=e.updateQueue;if(e.updateQueue=null,c!==null)try{l==="input"&&o.type==="radio"&&o.name!=null&&Qh(a,o),zd(l,s);var d=zd(l,o);for(s=0;s<c.length;s+=2){var f=c[s],h=c[s+1];f==="style"?am(a,h):f==="dangerouslySetInnerHTML"?nm(a,h):f==="children"?Ys(a,h):Hu(a,f,h,d)}switch(l){case"input":Nd(a,o);break;case"textarea":em(a,o);break;case"select":var v=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!o.multiple;var w=o.value;w!=null?Ro(a,!!o.multiple,w,!1):v!==!!o.multiple&&(o.defaultValue!=null?Ro(a,!!o.multiple,o.defaultValue,!0):Ro(a,!!o.multiple,o.multiple?[]:"",!1))}a[ri]=o}catch(C){qt(e,e.return,C)}}break;case 6:if(xr(t,e),Pr(e),r&4){if(e.stateNode===null)throw Error(_e(162));a=e.stateNode,o=e.memoizedProps;try{a.nodeValue=o}catch(C){qt(e,e.return,C)}}break;case 3:if(xr(t,e),Pr(e),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Zs(t.containerInfo)}catch(C){qt(e,e.return,C)}break;case 4:xr(t,e),Pr(e);break;case 13:xr(t,e),Pr(e),a=e.child,a.flags&8192&&(o=a.memoizedState!==null,a.stateNode.isHidden=o,!o||a.alternate!==null&&a.alternate.memoizedState!==null||(Tf=Xt())),r&4&&Kp(e);break;case 22:if(f=n!==null&&n.memoizedState!==null,e.mode&1?(kn=(d=kn)||f,xr(t,e),kn=d):xr(t,e),Pr(e),r&8192){if(d=e.memoizedState!==null,(e.stateNode.isHidden=d)&&!f&&e.mode&1)for(Be=e,f=e.child;f!==null;){for(h=Be=f;Be!==null;){switch(v=Be,w=v.child,v.tag){case 0:case 11:case 14:case 15:Ns(4,v,v.return);break;case 1:So(v,v.return);var _=v.stateNode;if(typeof _.componentWillUnmount=="function"){r=v,n=v.return;try{t=r,_.props=t.memoizedProps,_.state=t.memoizedState,_.componentWillUnmount()}catch(C){qt(r,n,C)}}break;case 5:So(v,v.return);break;case 22:if(v.memoizedState!==null){qp(h);continue}}w!==null?(w.return=v,Be=w):qp(h)}f=f.sibling}e:for(f=null,h=e;;){if(h.tag===5){if(f===null){f=h;try{a=h.stateNode,d?(o=a.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(l=h.stateNode,c=h.memoizedProps.style,s=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=rm("display",s))}catch(C){qt(e,e.return,C)}}}else if(h.tag===6){if(f===null)try{h.stateNode.nodeValue=d?"":h.memoizedProps}catch(C){qt(e,e.return,C)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===e)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;h.sibling===null;){if(h.return===null||h.return===e)break e;f===h&&(f=null),h=h.return}f===h&&(f=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:xr(t,e),Pr(e),r&4&&Kp(e);break;case 21:break;default:xr(t,e),Pr(e)}}function Pr(e){var t=e.flags;if(t&2){try{e:{for(var n=e.return;n!==null;){if(Dg(n)){var r=n;break e}n=n.return}throw Error(_e(160))}switch(r.tag){case 5:var a=r.stateNode;r.flags&32&&(Ys(a,""),r.flags&=-33);var o=Vp(e);hu(e,o,a);break;case 3:case 4:var s=r.stateNode.containerInfo,l=Vp(e);pu(e,l,s);break;default:throw Error(_e(161))}}catch(c){qt(e,e.return,c)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function yb(e,t,n){Be=e,Pg(e)}function Pg(e,t,n){for(var r=(e.mode&1)!==0;Be!==null;){var a=Be,o=a.child;if(a.tag===22&&r){var s=a.memoizedState!==null||rl;if(!s){var l=a.alternate,c=l!==null&&l.memoizedState!==null||kn;l=rl;var d=kn;if(rl=s,(kn=c)&&!d)for(Be=a;Be!==null;)s=Be,c=s.child,s.tag===22&&s.memoizedState!==null?Jp(a):c!==null?(c.return=s,Be=c):Jp(a);for(;o!==null;)Be=o,Pg(o),o=o.sibling;Be=a,rl=l,kn=d}Yp(e)}else a.subtreeFlags&8772&&o!==null?(o.return=a,Be=o):Yp(e)}}function Yp(e){for(;Be!==null;){var t=Be;if(t.flags&8772){var n=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:kn||bc(5,t);break;case 1:var r=t.stateNode;if(t.flags&4&&!kn)if(n===null)r.componentDidMount();else{var a=t.elementType===t.type?n.memoizedProps:wr(t.type,n.memoizedProps);r.componentDidUpdate(a,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;o!==null&&Pp(t,o,r);break;case 3:var s=t.updateQueue;if(s!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}Pp(t,s,n)}break;case 5:var l=t.stateNode;if(n===null&&t.flags&4){n=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var d=t.alternate;if(d!==null){var f=d.memoizedState;if(f!==null){var h=f.dehydrated;h!==null&&Zs(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(_e(163))}kn||t.flags&512&&fu(t)}catch(v){qt(t,t.return,v)}}if(t===e){Be=null;break}if(n=t.sibling,n!==null){n.return=t.return,Be=n;break}Be=t.return}}function qp(e){for(;Be!==null;){var t=Be;if(t===e){Be=null;break}var n=t.sibling;if(n!==null){n.return=t.return,Be=n;break}Be=t.return}}function Jp(e){for(;Be!==null;){var t=Be;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{bc(4,t)}catch(c){qt(t,n,c)}break;case 1:var r=t.stateNode;if(typeof r.componentDidMount=="function"){var a=t.return;try{r.componentDidMount()}catch(c){qt(t,a,c)}}var o=t.return;try{fu(t)}catch(c){qt(t,o,c)}break;case 5:var s=t.return;try{fu(t)}catch(c){qt(t,s,c)}}}catch(c){qt(t,t.return,c)}if(t===e){Be=null;break}var l=t.sibling;if(l!==null){l.return=t.return,Be=l;break}Be=t.return}}var vb=Math.ceil,Xl=Qr.ReactCurrentDispatcher,wf=Qr.ReactCurrentOwner,fr=Qr.ReactCurrentBatchConfig,Tt=0,pn=null,nn=null,gn=0,Zn=0,_o=ka(0),dn=0,ci=null,qa=0,xc=0,kf=0,As=null,Un=null,Tf=0,Ho=1/0,Fr=null,Zl=!1,mu=null,ma=null,al=!1,ia=null,Ql=0,Os=0,gu=null,Cl=-1,wl=0;function Nn(){return Tt&6?Xt():Cl!==-1?Cl:Cl=Xt()}function ga(e){return e.mode&1?Tt&2&&gn!==0?gn&-gn:tb.transition!==null?(wl===0&&(wl=gm()),wl):(e=St,e!==0||(e=window.event,e=e===void 0?16:km(e.type)),e):1}function Ir(e,t,n,r){if(50<Os)throw Os=0,gu=null,Error(_e(185));yi(e,n,r),(!(Tt&2)||e!==pn)&&(e===pn&&(!(Tt&2)&&(xc|=n),dn===4&&oa(e,gn)),Vn(e,r),n===1&&Tt===0&&!(t.mode&1)&&(Ho=Xt()+500,gc&&Ta()))}function Vn(e,t){var n=e.callbackNode;tv(e,t);var r=Ll(e,e===pn?gn:0);if(r===0)n!==null&&op(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(n!=null&&op(n),t===1)e.tag===0?eb(Xp.bind(null,e)):Fm(Xp.bind(null,e)),Jv(function(){!(Tt&6)&&Ta()}),n=null;else{switch(ym(r)){case 1:n=qu;break;case 4:n=hm;break;case 16:n=Ol;break;case 536870912:n=mm;break;default:n=Ol}n=Gg(n,Ng.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function Ng(e,t){if(Cl=-1,wl=0,Tt&6)throw Error(_e(327));var n=e.callbackNode;if(Oo()&&e.callbackNode!==n)return null;var r=Ll(e,e===pn?gn:0);if(r===0)return null;if(r&30||r&e.expiredLanes||t)t=ec(e,r);else{t=r;var a=Tt;Tt|=2;var o=Og();(pn!==e||gn!==t)&&(Fr=null,Ho=Xt()+500,Ha(e,t));do try{Cb();break}catch(l){Ag(e,l)}while(!0);cf(),Xl.current=o,Tt=a,nn!==null?t=0:(pn=null,gn=0,t=dn)}if(t!==0){if(t===2&&(a=Bd(e),a!==0&&(r=a,t=yu(e,a))),t===1)throw n=ci,Ha(e,0),oa(e,r),Vn(e,Xt()),n;if(t===6)oa(e,r);else{if(a=e.current.alternate,!(r&30)&&!bb(a)&&(t=ec(e,r),t===2&&(o=Bd(e),o!==0&&(r=o,t=yu(e,o))),t===1))throw n=ci,Ha(e,0),oa(e,r),Vn(e,Xt()),n;switch(e.finishedWork=a,e.finishedLanes=r,t){case 0:case 1:throw Error(_e(345));case 2:Ma(e,Un,Fr);break;case 3:if(oa(e,r),(r&130023424)===r&&(t=Tf+500-Xt(),10<t)){if(Ll(e,0)!==0)break;if(a=e.suspendedLanes,(a&r)!==r){Nn(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=Xd(Ma.bind(null,e,Un,Fr),t);break}Ma(e,Un,Fr);break;case 4:if(oa(e,r),(r&4194240)===r)break;for(t=e.eventTimes,a=-1;0<r;){var s=31-Er(r);o=1<<s,s=t[s],s>a&&(a=s),r&=~o}if(r=a,r=Xt()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*vb(r/1960))-r,10<r){e.timeoutHandle=Xd(Ma.bind(null,e,Un,Fr),r);break}Ma(e,Un,Fr);break;case 5:Ma(e,Un,Fr);break;default:throw Error(_e(329))}}}return Vn(e,Xt()),e.callbackNode===n?Ng.bind(null,e):null}function yu(e,t){var n=As;return e.current.memoizedState.isDehydrated&&(Ha(e,t).flags|=256),e=ec(e,t),e!==2&&(t=Un,Un=n,t!==null&&vu(t)),e}function vu(e){Un===null?Un=e:Un.push.apply(Un,e)}function bb(e){for(var t=e;;){if(t.flags&16384){var n=t.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var a=n[r],o=a.getSnapshot;a=a.value;try{if(!Sr(o(),a))return!1}catch{return!1}}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function oa(e,t){for(t&=~kf,t&=~xc,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-Er(t),r=1<<n;e[n]=-1,t&=~r}}function Xp(e){if(Tt&6)throw Error(_e(327));Oo();var t=Ll(e,0);if(!(t&1))return Vn(e,Xt()),null;var n=ec(e,t);if(e.tag!==0&&n===2){var r=Bd(e);r!==0&&(t=r,n=yu(e,r))}if(n===1)throw n=ci,Ha(e,0),oa(e,t),Vn(e,Xt()),n;if(n===6)throw Error(_e(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Ma(e,Un,Fr),Vn(e,Xt()),null}function Ef(e,t){var n=Tt;Tt|=1;try{return e(t)}finally{Tt=n,Tt===0&&(Ho=Xt()+500,gc&&Ta())}}function Ja(e){ia!==null&&ia.tag===0&&!(Tt&6)&&Oo();var t=Tt;Tt|=1;var n=fr.transition,r=St;try{if(fr.transition=null,St=1,e)return e()}finally{St=r,fr.transition=n,Tt=t,!(Tt&6)&&Ta()}}function If(){Zn=_o.current,Lt(_o)}function Ha(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,qv(n)),nn!==null)for(n=nn.return;n!==null;){var r=n;switch(of(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Ul();break;case 3:Fo(),Lt(Hn),Lt(Tn),mf();break;case 5:hf(r);break;case 4:Fo();break;case 13:Lt(Ft);break;case 19:Lt(Ft);break;case 10:df(r.type._context);break;case 22:case 23:If()}n=n.return}if(pn=e,nn=e=ya(e.current,null),gn=Zn=t,dn=0,ci=null,kf=xc=qa=0,Un=As=null,Ua!==null){for(t=0;t<Ua.length;t++)if(n=Ua[t],r=n.interleaved,r!==null){n.interleaved=null;var a=r.next,o=n.pending;if(o!==null){var s=o.next;o.next=a,r.next=s}n.pending=r}Ua=null}return e}function Ag(e,t){do{var n=nn;try{if(cf(),vl.current=Jl,ql){for(var r=Bt.memoizedState;r!==null;){var a=r.queue;a!==null&&(a.pending=null),r=r.next}ql=!1}if(Ya=0,fn=cn=Bt=null,Ps=!1,si=0,wf.current=null,n===null||n.return===null){dn=1,ci=t,nn=null;break}e:{var o=e,s=n.return,l=n,c=t;if(t=gn,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,f=l,h=f.tag;if(!(f.mode&1)&&(h===0||h===11||h===15)){var v=f.alternate;v?(f.updateQueue=v.updateQueue,f.memoizedState=v.memoizedState,f.lanes=v.lanes):(f.updateQueue=null,f.memoizedState=null)}var w=zp(s);if(w!==null){w.flags&=-257,$p(w,s,l,o,t),w.mode&1&&Mp(o,d,t),t=w,c=d;var _=t.updateQueue;if(_===null){var C=new Set;C.add(c),t.updateQueue=C}else _.add(c);break e}else{if(!(t&1)){Mp(o,d,t),Sf();break e}c=Error(_e(426))}}else if($t&&l.mode&1){var D=zp(s);if(D!==null){!(D.flags&65536)&&(D.flags|=256),$p(D,s,l,o,t),sf(Bo(c,l));break e}}o=c=Bo(c,l),dn!==4&&(dn=2),As===null?As=[o]:As.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t;var x=yg(o,c,t);jp(o,x);break e;case 1:l=c;var y=o.type,k=o.stateNode;if(!(o.flags&128)&&(typeof y.getDerivedStateFromError=="function"||k!==null&&typeof k.componentDidCatch=="function"&&(ma===null||!ma.has(k)))){o.flags|=65536,t&=-t,o.lanes|=t;var j=vg(o,l,t);jp(o,j);break e}}o=o.return}while(o!==null)}Mg(n)}catch($){t=$,nn===n&&n!==null&&(nn=n=n.return);continue}break}while(!0)}function Og(){var e=Xl.current;return Xl.current=Jl,e===null?Jl:e}function Sf(){(dn===0||dn===3||dn===2)&&(dn=4),pn===null||!(qa&268435455)&&!(xc&268435455)||oa(pn,gn)}function ec(e,t){var n=Tt;Tt|=2;var r=Og();(pn!==e||gn!==t)&&(Fr=null,Ha(e,t));do try{xb();break}catch(a){Ag(e,a)}while(!0);if(cf(),Tt=n,Xl.current=r,nn!==null)throw Error(_e(261));return pn=null,gn=0,dn}function xb(){for(;nn!==null;)Lg(nn)}function Cb(){for(;nn!==null&&!V0();)Lg(nn)}function Lg(e){var t=$g(e.alternate,e,Zn);e.memoizedProps=e.pendingProps,t===null?Mg(e):nn=t,wf.current=null}function Mg(e){var t=e;do{var n=t.alternate;if(e=t.return,t.flags&32768){if(n=hb(n,t),n!==null){n.flags&=32767,nn=n;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{dn=6,nn=null;return}}else if(n=pb(n,t,Zn),n!==null){nn=n;return}if(t=t.sibling,t!==null){nn=t;return}nn=t=e}while(t!==null);dn===0&&(dn=5)}function Ma(e,t,n){var r=St,a=fr.transition;try{fr.transition=null,St=1,wb(e,t,n,r)}finally{fr.transition=a,St=r}return null}function wb(e,t,n,r){do Oo();while(ia!==null);if(Tt&6)throw Error(_e(327));n=e.finishedWork;var a=e.finishedLanes;if(n===null)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(_e(177));e.callbackNode=null,e.callbackPriority=0;var o=n.lanes|n.childLanes;if(nv(e,o),e===pn&&(nn=pn=null,gn=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||al||(al=!0,Gg(Ol,function(){return Oo(),null})),o=(n.flags&15990)!==0,n.subtreeFlags&15990||o){o=fr.transition,fr.transition=null;var s=St;St=1;var l=Tt;Tt|=4,wf.current=null,gb(e,n),jg(n,e),Fv(qd),Ml=!!Yd,qd=Yd=null,e.current=n,yb(n),K0(),Tt=l,St=s,fr.transition=o}else e.current=n;if(al&&(al=!1,ia=e,Ql=a),o=e.pendingLanes,o===0&&(ma=null),J0(n.stateNode),Vn(e,Xt()),t!==null)for(r=e.onRecoverableError,n=0;n<t.length;n++)a=t[n],r(a.value,{componentStack:a.stack,digest:a.digest});if(Zl)throw Zl=!1,e=mu,mu=null,e;return Ql&1&&e.tag!==0&&Oo(),o=e.pendingLanes,o&1?e===gu?Os++:(Os=0,gu=e):Os=0,Ta(),null}function Oo(){if(ia!==null){var e=ym(Ql),t=fr.transition,n=St;try{if(fr.transition=null,St=16>e?16:e,ia===null)var r=!1;else{if(e=ia,ia=null,Ql=0,Tt&6)throw Error(_e(331));var a=Tt;for(Tt|=4,Be=e.current;Be!==null;){var o=Be,s=o.child;if(Be.flags&16){var l=o.deletions;if(l!==null){for(var c=0;c<l.length;c++){var d=l[c];for(Be=d;Be!==null;){var f=Be;switch(f.tag){case 0:case 11:case 15:Ns(8,f,o)}var h=f.child;if(h!==null)h.return=f,Be=h;else for(;Be!==null;){f=Be;var v=f.sibling,w=f.return;if(_g(f),f===d){Be=null;break}if(v!==null){v.return=w,Be=v;break}Be=w}}}var _=o.alternate;if(_!==null){var C=_.child;if(C!==null){_.child=null;do{var D=C.sibling;C.sibling=null,C=D}while(C!==null)}}Be=o}}if(o.subtreeFlags&2064&&s!==null)s.return=o,Be=s;else e:for(;Be!==null;){if(o=Be,o.flags&2048)switch(o.tag){case 0:case 11:case 15:Ns(9,o,o.return)}var x=o.sibling;if(x!==null){x.return=o.return,Be=x;break e}Be=o.return}}var y=e.current;for(Be=y;Be!==null;){s=Be;var k=s.child;if(s.subtreeFlags&2064&&k!==null)k.return=s,Be=k;else e:for(s=y;Be!==null;){if(l=Be,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:bc(9,l)}}catch($){qt(l,l.return,$)}if(l===s){Be=null;break e}var j=l.sibling;if(j!==null){j.return=l.return,Be=j;break e}Be=l.return}}if(Tt=a,Ta(),Mr&&typeof Mr.onPostCommitFiberRoot=="function")try{Mr.onPostCommitFiberRoot(uc,e)}catch{}r=!0}return r}finally{St=n,fr.transition=t}}return!1}function Zp(e,t,n){t=Bo(n,t),t=yg(e,t,1),e=ha(e,t,1),t=Nn(),e!==null&&(yi(e,1,t),Vn(e,t))}function qt(e,t,n){if(e.tag===3)Zp(e,e,n);else for(;t!==null;){if(t.tag===3){Zp(t,e,n);break}else if(t.tag===1){var r=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(ma===null||!ma.has(r))){e=Bo(n,e),e=vg(t,e,1),t=ha(t,e,1),e=Nn(),t!==null&&(yi(t,1,e),Vn(t,e));break}}t=t.return}}function kb(e,t,n){var r=e.pingCache;r!==null&&r.delete(t),t=Nn(),e.pingedLanes|=e.suspendedLanes&n,pn===e&&(gn&n)===n&&(dn===4||dn===3&&(gn&130023424)===gn&&500>Xt()-Tf?Ha(e,0):kf|=n),Vn(e,t)}function zg(e,t){t===0&&(e.mode&1?(t=Yi,Yi<<=1,!(Yi&130023424)&&(Yi=4194304)):t=1);var n=Nn();e=Jr(e,t),e!==null&&(yi(e,t,n),Vn(e,n))}function Tb(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),zg(e,n)}function Eb(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,a=e.memoizedState;a!==null&&(n=a.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(_e(314))}r!==null&&r.delete(t),zg(e,n)}var $g;$g=function(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps||Hn.current)Fn=!0;else{if(!(e.lanes&n)&&!(t.flags&128))return Fn=!1,fb(e,t,n);Fn=!!(e.flags&131072)}else Fn=!1,$t&&t.flags&1048576&&Bm(t,Hl,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;xl(e,t),e=t.pendingProps;var a=$o(t,Tn.current);Ao(t,n),a=yf(null,t,r,e,a,n);var o=vf();return t.flags|=1,typeof a=="object"&&a!==null&&typeof a.render=="function"&&a.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Wn(r)?(o=!0,Fl(t)):o=!1,t.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,ff(t),a.updater=vc,t.stateNode=a,a._reactInternals=t,au(t,r,e,n),t=iu(null,t,r,!0,o,n)):(t.tag=0,$t&&o&&af(t),Pn(null,t,a,n),t=t.child),t;case 16:r=t.elementType;e:{switch(xl(e,t),e=t.pendingProps,a=r._init,r=a(r._payload),t.type=r,a=t.tag=Sb(r),e=wr(r,e),a){case 0:t=su(null,t,r,e,n);break e;case 1:t=Fp(null,t,r,e,n);break e;case 11:t=Gp(null,t,r,e,n);break e;case 14:t=Up(null,t,r,wr(r.type,e),n);break e}throw Error(_e(306,r,""))}return t;case 0:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:wr(r,a),su(e,t,r,a,n);case 1:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:wr(r,a),Fp(e,t,r,a,n);case 3:e:{if(wg(t),e===null)throw Error(_e(387));r=t.pendingProps,o=t.memoizedState,a=o.element,qm(e,t),Kl(t,r,null,n);var s=t.memoizedState;if(r=s.element,o.isDehydrated)if(o={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=o,t.memoizedState=o,t.flags&256){a=Bo(Error(_e(423)),t),t=Bp(e,t,r,n,a);break e}else if(r!==a){a=Bo(Error(_e(424)),t),t=Bp(e,t,r,n,a);break e}else for(Qn=pa(t.stateNode.containerInfo.firstChild),er=t,$t=!0,Tr=null,n=Km(t,null,r,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Go(),r===a){t=Xr(e,t,n);break e}Pn(e,t,r,n)}t=t.child}return t;case 5:return Jm(t),e===null&&tu(t),r=t.type,a=t.pendingProps,o=e!==null?e.memoizedProps:null,s=a.children,Jd(r,a)?s=null:o!==null&&Jd(r,o)&&(t.flags|=32),Cg(e,t),Pn(e,t,s,n),t.child;case 6:return e===null&&tu(t),null;case 13:return kg(e,t,n);case 4:return pf(t,t.stateNode.containerInfo),r=t.pendingProps,e===null?t.child=Uo(t,null,r,n):Pn(e,t,r,n),t.child;case 11:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:wr(r,a),Gp(e,t,r,a,n);case 7:return Pn(e,t,t.pendingProps,n),t.child;case 8:return Pn(e,t,t.pendingProps.children,n),t.child;case 12:return Pn(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,a=t.pendingProps,o=t.memoizedProps,s=a.value,Pt(Wl,r._currentValue),r._currentValue=s,o!==null)if(Sr(o.value,s)){if(o.children===a.children&&!Hn.current){t=Xr(e,t,n);break e}}else for(o=t.child,o!==null&&(o.return=t);o!==null;){var l=o.dependencies;if(l!==null){s=o.child;for(var c=l.firstContext;c!==null;){if(c.context===r){if(o.tag===1){c=Vr(-1,n&-n),c.tag=2;var d=o.updateQueue;if(d!==null){d=d.shared;var f=d.pending;f===null?c.next=c:(c.next=f.next,f.next=c),d.pending=c}}o.lanes|=n,c=o.alternate,c!==null&&(c.lanes|=n),nu(o.return,n,t),l.lanes|=n;break}c=c.next}}else if(o.tag===10)s=o.type===t.type?null:o.child;else if(o.tag===18){if(s=o.return,s===null)throw Error(_e(341));s.lanes|=n,l=s.alternate,l!==null&&(l.lanes|=n),nu(s,n,t),s=o.sibling}else s=o.child;if(s!==null)s.return=o;else for(s=o;s!==null;){if(s===t){s=null;break}if(o=s.sibling,o!==null){o.return=s.return,s=o;break}s=s.return}o=s}Pn(e,t,a.children,n),t=t.child}return t;case 9:return a=t.type,r=t.pendingProps.children,Ao(t,n),a=pr(a),r=r(a),t.flags|=1,Pn(e,t,r,n),t.child;case 14:return r=t.type,a=wr(r,t.pendingProps),a=wr(r.type,a),Up(e,t,r,a,n);case 15:return bg(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:wr(r,a),xl(e,t),t.tag=1,Wn(r)?(e=!0,Fl(t)):e=!1,Ao(t,n),gg(t,r,a),au(t,r,a,n),iu(null,t,r,!0,e,n);case 19:return Tg(e,t,n);case 22:return xg(e,t,n)}throw Error(_e(156,t.tag))};function Gg(e,t){return pm(e,t)}function Ib(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ur(e,t,n,r){return new Ib(e,t,n,r)}function _f(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Sb(e){if(typeof e=="function")return _f(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Vu)return 11;if(e===Ku)return 14}return 2}function ya(e,t){var n=e.alternate;return n===null?(n=ur(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&14680064,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function kl(e,t,n,r,a,o){var s=2;if(r=e,typeof e=="function")_f(e)&&(s=1);else if(typeof e=="string")s=5;else e:switch(e){case vo:return Wa(n.children,a,o,t);case Wu:s=8,a|=8;break;case _d:return e=ur(12,n,t,a|2),e.elementType=_d,e.lanes=o,e;case Dd:return e=ur(13,n,t,a),e.elementType=Dd,e.lanes=o,e;case Rd:return e=ur(19,n,t,a),e.elementType=Rd,e.lanes=o,e;case Jh:return Cc(n,a,o,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case Yh:s=10;break e;case qh:s=9;break e;case Vu:s=11;break e;case Ku:s=14;break e;case na:s=16,r=null;break e}throw Error(_e(130,e==null?e:typeof e,""))}return t=ur(s,n,t,a),t.elementType=e,t.type=r,t.lanes=o,t}function Wa(e,t,n,r){return e=ur(7,e,r,t),e.lanes=n,e}function Cc(e,t,n,r){return e=ur(22,e,r,t),e.elementType=Jh,e.lanes=n,e.stateNode={isHidden:!1},e}function dd(e,t,n){return e=ur(6,e,null,t),e.lanes=n,e}function ud(e,t,n){return t=ur(4,e.children!==null?e.children:[],e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function _b(e,t,n,r,a){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Wc(0),this.expirationTimes=Wc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Wc(0),this.identifierPrefix=r,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function Df(e,t,n,r,a,o,s,l,c){return e=new _b(e,t,n,l,c),t===1?(t=1,o===!0&&(t|=8)):t=0,o=ur(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},ff(o),e}function Db(e,t,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:yo,key:r==null?null:""+r,children:e,containerInfo:t,implementation:n}}function Ug(e){if(!e)return Ca;e=e._reactInternals;e:{if(Qa(e)!==e||e.tag!==1)throw Error(_e(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Wn(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(_e(171))}if(e.tag===1){var n=e.type;if(Wn(n))return Um(e,n,t)}return t}function Fg(e,t,n,r,a,o,s,l,c){return e=Df(n,r,!0,e,a,o,s,l,c),e.context=Ug(null),n=e.current,r=Nn(),a=ga(n),o=Vr(r,a),o.callback=t??null,ha(n,o,a),e.current.lanes=a,yi(e,a,r),Vn(e,r),e}function wc(e,t,n,r){var a=t.current,o=Nn(),s=ga(a);return n=Ug(n),t.context===null?t.context=n:t.pendingContext=n,t=Vr(o,s),t.payload={element:e},r=r===void 0?null:r,r!==null&&(t.callback=r),e=ha(a,t,s),e!==null&&(Ir(e,a,s,o),yl(e,a,s)),s}function tc(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function Qp(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function Rf(e,t){Qp(e,t),(e=e.alternate)&&Qp(e,t)}function Rb(){return null}var Bg=typeof reportError=="function"?reportError:function(e){console.error(e)};function jf(e){this._internalRoot=e}kc.prototype.render=jf.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(_e(409));wc(e,t,null,null)};kc.prototype.unmount=jf.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Ja(function(){wc(null,e,null,null)}),t[qr]=null}};function kc(e){this._internalRoot=e}kc.prototype.unstable_scheduleHydration=function(e){if(e){var t=xm();e={blockedOn:null,target:e,priority:t};for(var n=0;n<aa.length&&t!==0&&t<aa[n].priority;n++);aa.splice(n,0,e),n===0&&wm(e)}};function Pf(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function Tc(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function eh(){}function jb(e,t,n,r,a){if(a){if(typeof r=="function"){var o=r;r=function(){var d=tc(s);o.call(d)}}var s=Fg(t,r,e,0,null,!1,!1,"",eh);return e._reactRootContainer=s,e[qr]=s.current,ti(e.nodeType===8?e.parentNode:e),Ja(),s}for(;a=e.lastChild;)e.removeChild(a);if(typeof r=="function"){var l=r;r=function(){var d=tc(c);l.call(d)}}var c=Df(e,0,!1,null,null,!1,!1,"",eh);return e._reactRootContainer=c,e[qr]=c.current,ti(e.nodeType===8?e.parentNode:e),Ja(function(){wc(t,c,n,r)}),c}function Ec(e,t,n,r,a){var o=n._reactRootContainer;if(o){var s=o;if(typeof a=="function"){var l=a;a=function(){var c=tc(s);l.call(c)}}wc(t,s,e,a)}else s=jb(n,t,e,a,r);return tc(s)}vm=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=Cs(t.pendingLanes);n!==0&&(Ju(t,n|1),Vn(t,Xt()),!(Tt&6)&&(Ho=Xt()+500,Ta()))}break;case 13:Ja(function(){var r=Jr(e,1);if(r!==null){var a=Nn();Ir(r,e,1,a)}}),Rf(e,1)}};Xu=function(e){if(e.tag===13){var t=Jr(e,134217728);if(t!==null){var n=Nn();Ir(t,e,134217728,n)}Rf(e,134217728)}};bm=function(e){if(e.tag===13){var t=ga(e),n=Jr(e,t);if(n!==null){var r=Nn();Ir(n,e,t,r)}Rf(e,t)}};xm=function(){return St};Cm=function(e,t){var n=St;try{return St=e,t()}finally{St=n}};Gd=function(e,t,n){switch(t){case"input":if(Nd(e,n),t=n.name,n.type==="radio"&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var a=mc(r);if(!a)throw Error(_e(90));Zh(r),Nd(r,a)}}}break;case"textarea":em(e,n);break;case"select":t=n.value,t!=null&&Ro(e,!!n.multiple,t,!1)}};im=Ef;lm=Ja;var Pb={usingClientEntryPoint:!1,Events:[bi,wo,mc,om,sm,Ef]},hs={findFiberByHostInstance:Ga,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Nb={bundleType:hs.bundleType,version:hs.version,rendererPackageName:hs.rendererPackageName,rendererConfig:hs.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Qr.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=um(e),e===null?null:e.stateNode},findFiberByHostInstance:hs.findFiberByHostInstance||Rb,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ol=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ol.isDisabled&&ol.supportsFiber)try{uc=ol.inject(Nb),Mr=ol}catch{}}nr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Pb;nr.createPortal=function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Pf(t))throw Error(_e(200));return Db(e,t,null,n)};nr.createRoot=function(e,t){if(!Pf(e))throw Error(_e(299));var n=!1,r="",a=Bg;return t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),t=Df(e,1,!1,null,null,n,!1,r,a),e[qr]=t.current,ti(e.nodeType===8?e.parentNode:e),new jf(t)};nr.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(_e(188)):(e=Object.keys(e).join(","),Error(_e(268,e)));return e=um(t),e=e===null?null:e.stateNode,e};nr.flushSync=function(e){return Ja(e)};nr.hydrate=function(e,t,n){if(!Tc(t))throw Error(_e(200));return Ec(null,e,t,!0,n)};nr.hydrateRoot=function(e,t,n){if(!Pf(e))throw Error(_e(405));var r=n!=null&&n.hydratedSources||null,a=!1,o="",s=Bg;if(n!=null&&(n.unstable_strictMode===!0&&(a=!0),n.identifierPrefix!==void 0&&(o=n.identifierPrefix),n.onRecoverableError!==void 0&&(s=n.onRecoverableError)),t=Fg(t,null,e,1,n??null,a,!1,o,s),e[qr]=t.current,ti(e),r)for(e=0;e<r.length;e++)n=r[e],a=n._getVersion,a=a(n._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[n,a]:t.mutableSourceEagerHydrationData.push(n,a);return new kc(t)};nr.render=function(e,t,n){if(!Tc(t))throw Error(_e(200));return Ec(null,e,t,!1,n)};nr.unmountComponentAtNode=function(e){if(!Tc(e))throw Error(_e(40));return e._reactRootContainer?(Ja(function(){Ec(null,null,e,!1,function(){e._reactRootContainer=null,e[qr]=null})}),!0):!1};nr.unstable_batchedUpdates=Ef;nr.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Tc(n))throw Error(_e(200));if(e==null||e._reactInternals===void 0)throw Error(_e(38));return Ec(e,t,n,!1,r)};nr.version="18.3.1-next-f1338f8080-20240426";function Hg(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Hg)}catch(e){console.error(e)}}Hg(),Hh.exports=nr;var Nf=Hh.exports,th=Nf;Id.createRoot=th.createRoot,Id.hydrateRoot=th.hydrateRoot;const Ab=({effect:e,onComplete:t})=>{const[n,r]=m.useState(0);m.useEffect(()=>{const s=Date.now(),l=1e3,c=()=>{const f=Date.now()-s;r(f),f<l?requestAnimationFrame(c):t&&t()};requestAnimationFrame(c)},[e.timestamp,t]);const a=[{id:1,startTime:0},{id:2,startTime:250},{id:3,startTime:500}],o=s=>{const l=n-s.startTime;if(l<0)return null;const d=Math.min(l/500,1),f=1+d*.15;return{opacity:1-d,scale:f,borderWidth:2}};return i.jsx("div",{className:"target-selection-effect",style:{position:"absolute",top:0,left:0,right:0,bottom:0,pointerEvents:"none",zIndex:100},children:a.map(s=>{const l=o(s);return l?i.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,borderRadius:"8px",border:`${l.borderWidth}px solid rgba(255, 255, 255, ${l.opacity})`,transform:`scale(${l.scale})`,transformOrigin:"center",opacity:l.opacity}},s.id):null})})};var it=(e=>(e.SynchroTech="SynchroTech",e.Hoods="Hoods",e.Optimates="Optimates",e.Fusion="Fusion",e.Command="Command",e.Tokens="Tokens",e.Custom="Custom",e.Neutral="Neutral",e.Random="Random",e))(it||{}),Kr=(e=>(e.FreeForAll="FFA",e.TwoVTwo="2v2",e.ThreeVOne="3v1",e))(Kr||{});const Ob={ipDeptAgent:{name:"IP Dept Agent",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1763253319/SYN_IP_DEPT_AGENT_mhwphu.png",fallbackImage:"/images/cards/SYN_IP_DEPT_AGENT.png",power:2,ability:`Deploy: Place 2 Stun tokens on a card with your Exploit token.
Commit (requires Support): Discard a card from an opponent's hand that is revealed to you.`,flavorText:`- "You've violated copyright. Open the door. We have a search warrant."`,types:["Unit","SynchroTech"],faction:"SynchroTech",allowedPanels:["DECK_BUILDER"]},tacticalAgent:{name:"Tactical Agent",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1763253342/SYN_TACTICAL_AGENT_xbb7i0.png",fallbackImage:"/images/cards/SYN_TACTICAL_AGENT.png",power:3,ability:`Deploy: Place an Aim token on a card with your Threat.
Setup: Destroy a card with your Aim token.`,flavorText:'- "Nobody move! SynchroTech Security Service!"',types:["Unit","SynchroTech"],faction:"SynchroTech",allowedPanels:["DECK_BUILDER"]},patrolAgent:{name:"Patrol Agent",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1763253325/SYN_PATROL_AGENT_ioetlu.png",fallbackImage:"/images/cards/SYN_PATROL_AGENT.png",power:2,ability:`Setup: Move to an empty cell in its line.
Commit: Place a Stun token on an adjacent opponent card with your Threat.`,flavorText:"They say the city never sleeps. We make sure it doesn't even blink.",types:["Unit","SynchroTech"],faction:"SynchroTech",allowedPanels:["DECK_BUILDER"]},riotAgent:{name:"Riot Agent",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1763253337/SYN_RIOT_AGENT_jurf4t.png",fallbackImage:"/images/cards/SYN_RIOT_AGENT.png",power:3,ability:`Deploy: Push an adjacent opponent card 1 cell; you may move into its former cell.
Commit: Place a Stun token on an adjacent opponent card with your Threat.`,flavorText:'- "Citizens, disperse! This meeting is unauthorized by SynchroTech."',types:["Unit","SynchroTech"],faction:"SynchroTech",allowedPanels:["DECK_BUILDER"]},threatAnalyst:{name:"Threat Analyst",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1763253338/SYN_THREAT_ANALYST_sqnpgw.png",fallbackImage:"/images/cards/SYN_THREAT_ANALYST.png",power:2,ability:`Deploy: Place an Exploit token on any card.
Commit (requires Support): Reveal 1 card from an opponent's hand for each of your Exploit tokens on the battlefield.`,flavorText:"",types:["Unit","SynchroTech"],faction:"SynchroTech",allowedPanels:["DECK_BUILDER"]},mrPearlDoF:{name:"Mr. Pearl, Director of BioSynch",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1764678622/Mr._Pearl_Director_of_BioSynch_mo0cil.png",fallbackImage:"/images/cards/SYN_IP_DEPT_AGENT.png",power:1,ability:`Pass: Your other units in lines get +1 power.
Deploy: Search your deck for a unit card, put it into your hand, then shuffle.`,flavorText:"Efficiency is the only metric that matters.",types:["Unit","Hero","SynchroTech"],faction:"SynchroTech",allowedPanels:["DECK_BUILDER"]},recklessProvocateur:{name:"Reckless Provocateur",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1763253315/HOO_RECKLESS_PROVOCATEUR_hi7a9z.png",fallbackImage:"/images/cards/HOO_RECKLESS_PROVOCATEUR.png",power:3,ability:`Deploy: Swap places with an adjacent card.
Commit: Move all tokens from a chosen allied card onto this card.`,flavorText:'- "Patience is a weapon. Vengeance is an art."',types:["Unit","Hoods"],faction:"Hoods",allowedPanels:["DECK_BUILDER"]},dataLiberator:{name:"Data Liberator",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1763253317/HOO_DATA_LIBERATOR_lbtqa2.png",fallbackImage:"/images/cards/HOO_DATA_LIBERATOR.png",power:2,ability:`Pass (requires Support): Cards with your Exploit tokens score Points for you.
Deploy: Place an Exploit token on any card.`,flavorText:`- "Information doesn't want to be free. It needs to be."`,types:["Unit","Hoods"],faction:"Hoods",allowedPanels:["DECK_BUILDER"]},cautiousAvenger:{name:"Cautious Avenger",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1763253309/HOO_CAUTIOUS_AVENGER_x4g4g3.png",fallbackImage:"/images/cards/HOO_CAUTIOUS_AVENGER.png",power:2,ability:`Deploy: Place an Aim token on a card within 2 cells.
Setup (requires Support): Destroy a card with your Aim token.`,flavorText:'- "Patience is a weapon. Vengeance is an art."',types:["Unit","Hoods"],faction:"Hoods",allowedPanels:["DECK_BUILDER"]},vigilantSpotter:{name:"Vigilant Spotter",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1763253311/HOO_VIGILANT_SPOTTER_eiephm.png",fallbackImage:"/images/cards/HOO_VIGILANT_SPOTTER.png",power:1,ability:`Pass (requires Support): When a revealed card of the opponent enters the battlefield, gain 2 points.
Commit: Reveal 1 card from an opponent's hand.`,flavorText:'- "Patience is a weapon. Vengeance is an art."',types:["Unit","Hoods"],faction:"Hoods",allowedPanels:["DECK_BUILDER"]},inventiveMaker:{name:"Inventive Maker",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1763253313/HOO_INVENTIVE_MAKER_uzrbg1.png",fallbackImage:"/images/cards/HOO_INVENTIVE_MAKER.png",power:1,ability:`Deploy: Create a Recon Drone token in an adjacent empty cell.
Setup (requires Support): Return a Device card from your discard pile to your hand.`,flavorText:'- "Patience is a weapon. Vengeance is an art."',types:["Unit","Hoods"],faction:"Hoods",allowedPanels:["DECK_BUILDER"]},finnMW:{name:"Finn, Most Wanted",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1764637482/Finn_nehk0r.png",fallbackImage:"/images/cards/HOO_RECKLESS_PROVOCATEUR.png",power:2,ability:`Setup: Move any one of your cards 1 or 2 cells.
Commit: Gain 1 point for each card that is revealed to you in opponents' hands or on the battlefield.`,flavorText:"Catch me if you can. Spoiler: You can't.",types:["Unit","Hero","Hoods"],faction:"Hoods",allowedPanels:["DECK_BUILDER"]},faber:{name:"Faber",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1763253324/OPT_FABER_d7uxew.png",fallbackImage:"/images/cards/OPT_FABER.png",power:1,ability:"Deploy: Discard 1 card from your hand  Create a Walking Turret token in an adjacent empty cell.",flavorText:"In the gilded halls of the Optimates, even the tools of war are works of art.",types:["Unit","Optimates"],faction:"Optimates",allowedPanels:["DECK_BUILDER"]},censor:{name:"Censor",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1763253321/OPT_CENSOR_wtxtc2.png",fallbackImage:"/images/cards/OPT_CENSOR.png",power:2,ability:`Deploy: Place an Exploit token on any card.
Commit (requires Support): Replace your Exploit token on a card with a Stun token.`,flavorText:"In the gilded halls of the Optimates, even the tools of war are works of art.",types:["Unit","Optimates"],faction:"Optimates",allowedPanels:["DECK_BUILDER"]},princeps:{name:"Princeps",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1763253332/OPT_PRINCEPS_w3o5lq.png",fallbackImage:"/images/cards/OPT_PRINCEPS.png",power:3,ability:`Deploy: Gain a Shield token. Place an Aim token on a card in its line.
Setup: Destroy a card with your Aim token.`,flavorText:"Order is not requested. It is imposed.",types:["Unit","Optimates"],faction:"Optimates",allowedPanels:["DECK_BUILDER"]},immunis:{name:"Immunis",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1763253327/OPT_IMMUNIS_bjlncl.png",fallbackImage:"/images/cards/OPT_IMMUNIS.png",power:1,ability:`Deploy (requires Support): Return an Optimates card from your discard pile to an adjacent empty cell with a Resurrection token.
At the end of the phase, replace that Resurrection token with 2 Stun tokens.`,flavorText:"In the gilded halls of the Optimates, even the tools of war are works of art.",types:["Unit","Optimates"],faction:"Optimates",allowedPanels:["DECK_BUILDER"]},centurion:{name:"Centurion",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1763253330/OPT_CENTURION_aaushl.png",fallbackImage:"/images/cards/OPT_CENTURION.png",power:2,ability:"Commit: Sacrifice an allied unit  All allied cards in that unit's lines get +1 power.",flavorText:"In the gilded halls of the Optimates, even the tools of war are works of art.",types:["Unit","Optimates"],faction:"Optimates",allowedPanels:["DECK_BUILDER"]},luciusTheImmortal:{name:"Lucius, The Immortal",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1764678954/Lucius_The_Immortal_z0lemw.png",fallbackImage:"/images/cards/OPT_PRINCEPS.png",power:2,ability:`Pass: Immunity to Stun. If exited from discard, gets +2 power.
Setup: Discard a card  Find a command card in your deck. Put it into your hand and shuffle.`,flavorText:"Death implies a cessation of function. I have simply optimized it.",types:["Unit","Hero","Optimates"],faction:"Optimates",allowedPanels:["DECK_BUILDER"]},codeKeeper:{name:"Code Keeper",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1763253298/FUS_CODE_KEEPER_qotsym.png",fallbackImage:"/images/cards/FUS_CODE_KEEPER.png",power:2,ability:`Deploy: Place 1 Exploit token on each opponent card in lines with any Threat.
Commit (requires Support): Move an opponent card with your Exploit token 1 cell.`,flavorText:"The Signal is truth. All else is noise.",types:["Unit","Fusion"],faction:"Fusion",allowedPanels:["DECK_BUILDER"]},devoutSynthetic:{name:"Devout Synthetic",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1763253305/FUS_DEVOUT_SYNTHETIC_bavg9k.png",fallbackImage:"/images/cards/FUS_DEVOUT_SYNTHETIC.png",power:3,ability:`Deploy: Push an adjacent opponent card 1 cell; you may move into its former cell.
Setup: Destroy an adjacent opponent card with a Threat or Stun token.`,flavorText:"Flesh is a bug. The Signal is the patch.",types:["Unit","Fusion"],faction:"Fusion",allowedPanels:["DECK_BUILDER"]},unwaveringIntegrator:{name:"Unwavering Integrator",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1763253303/FUS_UNWAVERING_INTEGRATOR_emret1.png",fallbackImage:"/images/cards/FUS_UNWAVERING_INTEGRATOR.png",power:1,ability:`Deploy: Place an Exploit token on any card.
Setup (requires Support): Gain 1 point for each of your Exploit tokens in a chosen line.`,flavorText:"The Signal is truth. All else is noise.",types:["Unit","Fusion"],faction:"Fusion",allowedPanels:["DECK_BUILDER"]},signalProphet:{name:"Signal Prophet",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1763253299/FUS_SIGNAL_PROPHET_nzd7w3.png",fallbackImage:"/images/cards/FUS_SIGNAL_PROPHET.png",power:2,ability:`Deploy: Place 1 Exploit token on each of your cards with Support in lines.
Commit (requires Support): Move one of your cards with an Exploit token 1 cell.`,flavorText:"The Signal is truth. All else is noise.",types:["Unit","Fusion"],faction:"Fusion",allowedPanels:["DECK_BUILDER"]},zealousMissionary:{name:"Zealous Missionary",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1763253301/FUS_ZEALOUS_MISSIONARY_mfv9xl.png",fallbackImage:"/images/cards/FUS_ZEALOUS_MISSIONARY.png",power:1,ability:`Deploy: Place an Exploit token on any card.
Commit (requires Support): Give -1 power to a card with your Exploit token.`,flavorText:"The Signal is truth. All else is noise.",types:["Unit","Fusion"],faction:"Fusion",allowedPanels:["DECK_BUILDER"]},reverendOfTheChoir:{name:"Reverend of The Choir",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1764678937/Reverend_of_The_Choir_vts8im.png",fallbackImage:"/images/cards/FUS_SIGNAL_PROPHET.png",power:2,ability:`Setup (requires Support): Gain 1 point for each of your Exploit tokens on the battlefield.
Deploy: Double the number of Exploit tokens on any one card.`,flavorText:"The hum of the servers is a hymn to the initiated.",types:["Unit","Hero","Fusion","Device"],faction:"Fusion",allowedPanels:["DECK_BUILDER"]},overwatch:{name:"Overwatch",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1763253291/CMD_OVERWATCH_hrba9x.png",fallbackImage:"/images/cards/CMD_OVERWATCH.png",power:0,ability:` Place 1 Aim token on any card. Reveal 1 card from an opponent's hand for each of your Aim tokens on the battlefield.
 Place 1 Aim token on any card. Draw 1 card for each of your Aim tokens on the battlefield.`,types:["Command"],faction:"Command",allowedPanels:["DECK_BUILDER"]},tacticalManeuver:{name:"Tactical Maneuver",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1763253296/CMD_REPOSITIONING_m7k4kf.png",fallbackImage:"/images/cards/CMD_REPOSITIONING.png",power:0,ability:` Move one of your units to an empty cell in its line. Draw cards equal to that unit's power.
 Move one of your units to an empty cell in its line. Gain points equal to that unit's power.`,types:["Command"],faction:"Command",allowedPanels:["DECK_BUILDER"]},inspiration:{name:"Inspiration",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1763260942/CMD_INSPIRATION_nxifhu.png",fallbackImage:"/images/cards/CMD_INSPIRATION.png",power:0,ability:` Remove any number of tokens from one of your units. Draw 1 card for each token removed.
 Remove any number of tokens from one of your units. Gain 1 point for each token removed.`,types:["Command"],faction:"Command",allowedPanels:["DECK_BUILDER"]},dataInterception:{name:"Data Interception",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1763253290/CMD_DATA_INTERCEPTION_ks4lcv.png",fallbackImage:"/images/cards/CMD_DATA_INTERCEPTION.png",power:0,ability:` Place 1 Exploit token on any card. Reveal 1 card from an opponent's hand for each of your Exploit tokens on the battlefield.
 Place 1 Exploit token on any card. Move a unit with your Exploit token 1 or 2 cells.`,types:["Command"],faction:"Command",allowedPanels:["DECK_BUILDER"]},falseOrders:{name:"False Orders",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1763640484/CMD_FALSE_ORDERS_ghi01y.png",fallbackImage:"/images/cards/CMD_DATA_INTERCEPTION.png",power:0,ability:` Place 1 Exploit token on an opponent's card. Move that opponent unit with your Exploit token 1 or 2 cells. Reveal up to 2 cards from that opponent's hand.
 Place 1 Exploit token on an opponent's card. Move that opponent unit with your Exploit token 1 or 2 cells. Place 2 Stun tokens on it.`,types:["Command"],faction:"Command",allowedPanels:["DECK_BUILDER"]},experimentalStimulants:{name:"Experimental Stimulants",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1764507610/Experimental_Stimulants_x8ns1g.png",fallbackImage:"/images/cards/CMD_MOBILIZATION.png",power:0,ability:` A unit you control on the battlefield may activate its Deploy ability one additional time.
 Move one of your units to an empty cell in its line.`,types:["Command"],faction:"Command",allowedPanels:["DECK_BUILDER"]},logisticsChain:{name:"Logistics Chain",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1764507610/Logistics_Chain_d4irtq.png",fallbackImage:"/images/cards/CMD_MOBILIZATION.png",power:0,ability:` Score points in a diagonal. Gain +1 point for each of your cards with Support in that diagonal.
 Score points in a diagonal. Draw 1 card for each of your cards with Support in that diagonal.`,types:["Command"],faction:"Command",allowedPanels:["DECK_BUILDER"]},quickResponseTeam:{name:"Quick Response Team",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1764507609/Quick_Response_Team_rw2cut.png",fallbackImage:"/images/cards/CMD_MOBILIZATION.png",power:0,ability:` Play a unit from your hand into an empty cell.
 Search your deck for a unit card and put it into your hand. Then shuffle your deck.`,types:["Command"],faction:"Command",allowedPanels:["DECK_BUILDER"]},temporaryShelter:{name:"Temporary Shelter",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1764507610/Temporary_Shelter_o0embx.png",fallbackImage:"/images/cards/CMD_MOBILIZATION.png",power:0,ability:` Place 1 Shield token on one of your cards. Remove all Aim tokens from that card.
 Place 1 Shield token on one of your cards. Move that card 1 or 2 cells.`,types:["Command"],faction:"Command",allowedPanels:["DECK_BUILDER"]},enhancedInterrogation:{name:"Enhanced Interrogation",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1764507610/Enhanced_Interrogation_suzvxe.png",fallbackImage:"/images/cards/CMD_MOBILIZATION.png",power:0,ability:` Place 1 Aim token on any card. Reveal 1 card from an opponent's hand for each of your Aim tokens on the battlefield.
 Place 1 Aim token on any card. Move any card with your Aim token 1 or 2 cells.`,types:["Command"],faction:"Command",allowedPanels:["DECK_BUILDER"]},mobilization1:{name:"Line Breach",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1763894862/line_ocsoyj.png",fallbackImage:"/images/cards/CMD_MOBILIZATION.png",power:0,ability:"Gain points in a chosen line of the battlefield.",types:["Command"],faction:"Command",allowedPanels:[]},abrGawain:{name:'ABR "Gawain"',imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1764626980/Autonomous_Battle_Robot_Gawain_uoyjm5.png",fallbackImage:"/images/cards/FUS_DEVOUT_SYNTHETIC.png",power:4,ability:`Deploy: Gain a Shield token. Place an Aim token on a card in its line.
Setup: Destroy a card with your Aim token.`,flavorText:"Protocol initiated. Threat assessment: Extreme.",types:["Unit","Device","Rarity"],faction:"Neutral",allowedPanels:["DECK_BUILDER"]},reclaimedGawain:{name:'Reclaimed "Gawain"',imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1764622845/Reclaimed_Gawain_sg6257.png",fallbackImage:"/images/cards/FUS_DEVOUT_SYNTHETIC.png",power:4,ability:`Deploy: Gain a Shield token. Push an adjacent opponent card 1 cell; you may move into its former cell.
Setup: Destroy an adjacent opponent card with Threat or Stun.`,flavorText:"Once a knight of the system, now a ghost in the machine.",types:["Unit","Device","Rarity"],faction:"Neutral",allowedPanels:["DECK_BUILDER"]},secretInformant:{name:"Secret Informant",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1764767153/Secret_informant_eb0nkm.png",fallbackImage:"/images/cards/SYN_THREAT_ANALYST.png",power:1,ability:"Deploy: Look at the top 3 cards of any deck. Put any number of them on the bottom of that deck. Draw 1 card.",flavorText:"Knowledge is power. And leverage.",types:["Unit"],faction:"Neutral",allowedPanels:["DECK_BUILDER"]},FalkPD:{name:"Michael Falk, Private Detective",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1764623710/Michael_Falk_wcxjnp.png",fallbackImage:"/images/cards/HOO_VIGILANT_SPOTTER.png",power:3,ability:`Deploy: Find any card in your deck. Put it into your hand and shuffle.
Commit: Reveal 1 card from an opponent's hand.`,flavorText:"He finds things. Sometimes things that should stay lost.",types:["Unit","Hero"],faction:"Neutral",allowedPanels:["DECK_BUILDER"]},edithByron:{name:"Edith Byron, Extreme Engineer",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1764623710/Edith_Byron_v6691r.png",fallbackImage:"/images/cards/HOO_INVENTIVE_MAKER.png",power:3,ability:`Setup: Move to an empty cell in a line.
Deploy: Gain a Shield token. Create a Recon Drone token in an adjacent empty cell.`,flavorText:"Building the future, one explosion at a time.",types:["Unit","Hero"],faction:"Neutral",allowedPanels:["DECK_BUILDER"]},pinkunonekoSV:{name:"Pinkunoneko, Street Vigilante",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1764622844/Pinkunoneko_nhmjfv.png",fallbackImage:"/images/cards/SYN_RIOT_AGENT.png",power:3,ability:`Deploy: Place a Stun token on an adjacent opponent card.
Setup: Destroy an adjacent opponent card with Threat or Stun.`,flavorText:"Neon claws in the dark alley.",types:["Unit","Hero"],faction:"Neutral",allowedPanels:["DECK_BUILDER"]},EleftheriaMD:{name:'Maria "Eleftheria" Damanaki',imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1764622845/Maria_Eleftheria_Damanaki_bmx6xv.png",fallbackImage:"/images/cards/SYN_TACTICAL_AGENT.png",power:3,ability:`Deploy: Place an Aim token on any card.
Setup: Destroy a card with your Aim token.`,flavorText:"Freedom has a price. She collects it.",types:["Unit","Hero"],faction:"Neutral",allowedPanels:["DECK_BUILDER"]},ziusIJ:{name:"Zius, Independent Journalist",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1764622844/Zius_cwd92f.png",fallbackImage:"/images/cards/FUS_UNWAVERING_INTEGRATOR.png",power:2,ability:`Deploy: Place an Exploit token on any card.
Setup (requires Support): Place an Exploit token on any card. Gain 1 point for each of your Exploit tokens in that card's line.`,flavorText:"The truth is out there, and he's streaming it live.",types:["Unit","Hero"],faction:"Neutral",allowedPanels:["DECK_BUILDER"]}},Lb={reconDrone:{baseId:"reconDrone",name:"Recon Drone",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1763253333/TKN_RECON_DRONE_esfknf.png",fallbackImage:"/images/cards/TKN_RECON_DRONE.png",power:1,ability:`Setup: Move to any cell on the battlefield.
Commit: Choose an opponent card in an adjacent cell. Reveal 1 card from that opponent's hand.`,flavorText:"SynchroTech has created lightweight drones to patrol the streets, but the Hoods have other plans for them.",color:"bg-gray-400",types:["Unit","Device"],allowedPanels:["TOKEN_PANEL"]},walkingTurret:{baseId:"walkingTurret",name:"Walking Turret",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1763253307/TKN_WALKING_TURRET_uq6owm.png",fallbackImage:"/images/cards/TKN_WALKING_TURRET.png",power:2,ability:`Deploy: Place an Aim token on a card in its line.
Setup: Give -1 power to a card with an Aim token.`,flavorText:"This military monster clearly has no place on the city streets.",color:"bg-gray-400",types:["Unit","Optimates","Device"],allowedPanels:["TOKEN_PANEL"]}},Mb={Aim:{name:"Aim",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1763478810/Aim_dcct45.png",description:`This counter has no effect on its own, but it can modify the abilities of cards.
This card is easier to destroy.`,sortOrder:1,allowedPanels:["COUNTER_PANEL"],allowedTargets:["board"]},Exploit:{name:"Exploit",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1763478810/Exploit_foomty.png",description:`This counter has no effect on its own, but it can modify the abilities of cards.
Hacker and programmer cards will have a greater effect on this card.`,sortOrder:2,allowedPanels:["COUNTER_PANEL"],allowedTargets:["board"]},LastPlayed:{name:"LastPlayed",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1763478810/LastPlayed_bfkbwb.png",description:"This card was last played by its owner.",sortOrder:99,allowedPanels:[],allowedTargets:["board"]},Revealed:{name:"Revealed",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1763478811/Revealed_w1gbe7.png",description:"This card's face is visible to the owner of the counter revealed. Can be placed on cards in hand.",sortOrder:7,allowedPanels:["COUNTER_PANEL"],allowedTargets:["board","hand"]},Stun:{name:"Stun",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1763478811/Stun_cwqroz.png",description:`A stunned card cannot activate abilities or gain points. Its owner's effects cannot move it, but opponent effects can.
Remove 1 stun counter from the card after the Scoring Phase.`,sortOrder:4,allowedPanels:["COUNTER_PANEL"],allowedTargets:["board"]},Shield:{name:"Shield",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1763478810/Shield_z9sjr1.png",description:"If an effect attempts to destroy this card, remove 1 shield counter from it instead.",sortOrder:3,allowedPanels:["COUNTER_PANEL"],allowedTargets:["board"]},Support:{name:"Support",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1763478809/Support_ui9qpl.png",description:`This counter has no effect on its own, but it can modify the abilities of cards.
This card is adjacent to its ally.`,sortOrder:5,allowedPanels:[],allowedTargets:["board"]},Threat:{name:"Threat",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1763478809/Threat_i1pbko.png",description:`This counter has no effect on its own, but it can modify the abilities of cards.
This card is surrounded and pinned to the edge of the battlefield by an opponent's cards.`,sortOrder:6,allowedPanels:[],allowedTargets:["board"]},Resurrected:{name:"Resurrected",imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1768321040/Resurrected_tscgk9.png",description:"This unit recently returned from the discard pile. It will become Stunned at the start of the next phase.",sortOrder:8,allowedPanels:["COUNTER_PANEL"],allowedTargets:["board","hand"]},"Power+":{name:"Power+",imageUrl:"",description:"Increases the power of the card by 1.",sortOrder:10,allowedPanels:[],allowedTargets:["board","hand","deck","discard"]},"Power-":{name:"Power-",imageUrl:"",description:"Decreases the power of the card by 1.",sortOrder:11,allowedPanels:[],allowedTargets:["board","hand","deck","discard"]}},zb=[{id:"SynchroTech",name:"SynchroTech",isSelectable:!0,cards:[{cardId:"mrPearlDoF",quantity:1},{cardId:"EleftheriaMD",quantity:1},{cardId:"abrGawain",quantity:1},{cardId:"secretInformant",quantity:2},{cardId:"ipDeptAgent",quantity:3},{cardId:"tacticalAgent",quantity:3},{cardId:"patrolAgent",quantity:3},{cardId:"riotAgent",quantity:3},{cardId:"threatAnalyst",quantity:3},{cardId:"overwatch",quantity:1},{cardId:"tacticalManeuver",quantity:1},{cardId:"inspiration",quantity:1},{cardId:"dataInterception",quantity:1},{cardId:"falseOrders",quantity:1},{cardId:"experimentalStimulants",quantity:1},{cardId:"logisticsChain",quantity:1},{cardId:"quickResponseTeam",quantity:1},{cardId:"temporaryShelter",quantity:1},{cardId:"enhancedInterrogation",quantity:1}]},{id:"Hoods",name:"Hoods",isSelectable:!0,cards:[{cardId:"finnMW",quantity:1},{cardId:"pinkunonekoSV",quantity:1},{cardId:"reclaimedGawain",quantity:1},{cardId:"secretInformant",quantity:2},{cardId:"recklessProvocateur",quantity:3},{cardId:"dataLiberator",quantity:3},{cardId:"cautiousAvenger",quantity:3},{cardId:"vigilantSpotter",quantity:3},{cardId:"inventiveMaker",quantity:3},{cardId:"overwatch",quantity:1},{cardId:"tacticalManeuver",quantity:1},{cardId:"inspiration",quantity:1},{cardId:"dataInterception",quantity:1},{cardId:"falseOrders",quantity:1},{cardId:"experimentalStimulants",quantity:1},{cardId:"logisticsChain",quantity:1},{cardId:"quickResponseTeam",quantity:1},{cardId:"temporaryShelter",quantity:1},{cardId:"enhancedInterrogation",quantity:1}]},{id:"Optimates",name:"Optimates",isSelectable:!0,cards:[{cardId:"luciusTheImmortal",quantity:1},{cardId:"edithByron",quantity:1},{cardId:"abrGawain",quantity:1},{cardId:"secretInformant",quantity:2},{cardId:"faber",quantity:3},{cardId:"censor",quantity:3},{cardId:"princeps",quantity:3},{cardId:"immunis",quantity:3},{cardId:"centurion",quantity:3},{cardId:"overwatch",quantity:1},{cardId:"tacticalManeuver",quantity:1},{cardId:"inspiration",quantity:1},{cardId:"dataInterception",quantity:1},{cardId:"falseOrders",quantity:1},{cardId:"experimentalStimulants",quantity:1},{cardId:"logisticsChain",quantity:1},{cardId:"quickResponseTeam",quantity:1},{cardId:"temporaryShelter",quantity:1},{cardId:"enhancedInterrogation",quantity:1}]},{id:"Fusion",name:"Fusion",isSelectable:!0,cards:[{cardId:"reverendOfTheChoir",quantity:1},{cardId:"ziusIJ",quantity:1},{cardId:"reclaimedGawain",quantity:1},{cardId:"secretInformant",quantity:2},{cardId:"devoutSynthetic",quantity:3},{cardId:"unwaveringIntegrator",quantity:3},{cardId:"signalProphet",quantity:3},{cardId:"zealousMissionary",quantity:3},{cardId:"codeKeeper",quantity:3},{cardId:"overwatch",quantity:1},{cardId:"tacticalManeuver",quantity:1},{cardId:"inspiration",quantity:1},{cardId:"dataInterception",quantity:1},{cardId:"falseOrders",quantity:1},{cardId:"experimentalStimulants",quantity:1},{cardId:"logisticsChain",quantity:1},{cardId:"quickResponseTeam",quantity:1},{cardId:"temporaryShelter",quantity:1},{cardId:"enhancedInterrogation",quantity:1}]}],fd={cardDatabase:Ob,tokenDatabase:Lb,countersDatabase:Mb,deckFiles:zb};let nh=null,Xa=new Map,bu=new Map,Ls={},nc=[],xu={};const Wg=new Set(["overwatch","repositioning","tacticalManeuver","mobilization","inspiration","dataInterception","falseOrders","experimentalStimulants","logisticsChain","quickResponseTeam","temporaryShelter","enhancedInterrogation"]);async function $b(){try{let e;if(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")try{const n=await fetch("/api/content/database");if(n.ok){const r=await n.json(),a=r.cards.map(([s,l])=>[s,l]),o=r.tokens.map(([s,l])=>[s,l]);e={cardDatabase:Object.fromEntries(a),tokenDatabase:Object.fromEntries(o),countersDatabase:Object.fromEntries(r.counters),deckFiles:r.deckFiles}}else e=fd}catch{e=fd}else e=fd;nh=e,Xa=new Map(Object.entries(e.cardDatabase)),bu=new Map(Object.entries(e.tokenDatabase)),Ls=e.countersDatabase,nc=e.deckFiles;try{localStorage.setItem("counters_database",JSON.stringify(Ls)),localStorage.setItem("counters_timestamp",Date.now().toString())}catch(n){console.warn("Could not save counters database to localStorage:",n)}lr=nh,Vg=Xa,Kg=bu,Zr=Ls,Cu=nc,xu=Gb(),Yg=xu}catch(e){throw console.error("Failed to load content database:",e),e}}function Gb(){const e={};for(const t of nc){const n=[];for(const r of t.cards){const a=Xa.get(r.cardId);if(!a){console.warn(`Card definition not found for ID: ${r.cardId} in deck: ${t.name}`);continue}const o=Wg.has(r.cardId);for(let s=0;s<r.quantity;s++){const c=r.cardId.replace(/-/g,"--DASH--").toUpperCase();o?n.push({...a,deck:it.Command,id:`CMD_${c}_${s+1}`,baseId:r.cardId,faction:a.faction||"Command"}):n.push({...a,deck:t.id,id:`${t.id.substring(0,3).toUpperCase()}_${c}_${s+1}`,baseId:r.cardId,faction:a.faction||t.id})}}e[t.id]=n}return e[it.Tokens]=Array.from(bu.entries()).map(([t,n])=>{const r=n.types?[...n.types]:[];return{id:`TKN_${n.name.toUpperCase().replace(/\s/g,"_")}`,baseId:t,deck:it.Tokens,name:n.name,imageUrl:n.imageUrl,fallbackImage:n.fallbackImage,power:n.power,ability:n.ability,color:n.color,types:r,flavorText:n.flavorText,faction:"Tokens"}}),e}let lr=null,Vg=new Map,Kg=new Map,Zr={};try{const e=localStorage.getItem("counters_database");e&&(Ls=JSON.parse(e),Zr=Ls)}catch{}let Cu=[],Yg={};const Tl=Wg,Ub=()=>nc.filter(e=>e.isSelectable);function Wo(e){return Xa.get(e)}function pd(e){return Array.from(Xa.values()).find(t=>t.name===e)}function qg(){return Array.from(Xa.entries()).map(([e,t])=>({id:e,card:t}))}function wu(){return Xa}function ku(){return xu}const Tu=4,rh={FIRST_PLAYER:"https://res.cloudinary.com/dxxh6meej/image/upload/v1763478810/LastPlayed_bfkbwb.png",ROUND_WIN_MEDAL:"https://res.cloudinary.com/dxxh6meej/image/upload/v1764252181/medal_rgbw8d.png"},Eu={[it.SynchroTech]:{prefix:"SYN",color:"border-cyan-400"},[it.Hoods]:{prefix:"HOO",color:"border-purple-500"},[it.Optimates]:{prefix:"OPT",color:"border-red-500"},[it.Fusion]:{prefix:"FUS",color:"border-green-400"},[it.Command]:{prefix:"CMD",color:"border-yellow-500"},[it.Tokens]:{prefix:"TKN",color:"border-gray-400"},[it.Custom]:{prefix:"CUS",color:"border-purple-400"},[it.Neutral]:{prefix:"NEU",color:"border-gray-400"},[it.Random]:{prefix:"RND",color:"border-gray-400"}},Kn={blue:{bg:"bg-blue-600",border:"border-blue-600",outline:"outline-blue-600",glow:"shadow-[0_0_15px_#2563eb]"},purple:{bg:"bg-purple-600",border:"border-purple-600",outline:"outline-purple-600",glow:"shadow-[0_0_15px_#9333ea]"},red:{bg:"bg-red-600",border:"border-red-600",outline:"outline-red-600",glow:"shadow-[0_0_15px_#dc2626]"},green:{bg:"bg-green-600",border:"border-green-600",outline:"outline-green-600",glow:"shadow-[0_0_15px_#16a34a]"},yellow:{bg:"bg-yellow-500",border:"border-yellow-500",outline:"outline-yellow-500",glow:"shadow-[0_0_15px_#eab308]"},orange:{bg:"bg-orange-500",border:"border-orange-500",outline:"outline-orange-500",glow:"shadow-[0_0_15px_#f97316]"},pink:{bg:"bg-pink-500",border:"border-pink-500",outline:"outline-pink-500",glow:"shadow-[0_0_15px_#ec4899]"},brown:{bg:"bg-[#8B4513]",border:"border-[#8B4513]",outline:"outline-[#8B4513]",glow:"shadow-[0_0_15px_#8B4513]"}},rc={blue:{r:37,g:99,b:235},purple:{r:147,g:51,b:234},red:{r:220,g:38,b:38},green:{r:22,g:163,b:74},yellow:{r:234,g:179,b:8},orange:{r:249,g:115,b:22},pink:{r:236,g:72,b:153},brown:{r:139,g:69,b:19}},ah={blue:"text-blue-400 drop-shadow-[0_0_4px_rgba(59,130,246,0.8)]",purple:"text-purple-400 drop-shadow-[0_0_4px_rgba(168,85,247,0.8)]",red:"text-red-500 drop-shadow-[0_0_4px_rgba(239,68,68,0.8)]",green:"text-green-400 drop-shadow-[0_0_4px_rgba(34,197,94,0.8)]",yellow:"text-yellow-400 drop-shadow-[0_0_4px_rgba(234,179,8,0.8)]",orange:"text-orange-400 drop-shadow-[0_0_4px_rgba(249,115,22,0.8)]",pink:"text-pink-400 drop-shadow-[0_0_4px_rgba(236,72,153,0.8)]",brown:"text-[#A0522D] drop-shadow-[0_0_4px_rgba(139,69,19,0.8)]"},sl=["blue","purple","red","green","yellow","orange","pink","brown"],Fb=["Setup","Main","Commit","Scoring"],il=()=>Object.fromEntries(Object.entries(Zr).map(([e,t])=>[e,t.imageUrl])),Vo=new Proxy({},{get(e,t){return il()[t]},ownKeys(){return Object.keys(il())},has(e,t){return t in il()},getOwnPropertyDescriptor(e,t){const n=il()[t];return n!==void 0?{enumerable:!0,configurable:!0,value:n}:void 0}}),ll=()=>Object.fromEntries(Object.entries(Zr).map(([e,t])=>[e,t.description])),ac=new Proxy({},{get(e,t){return ll()[t]},ownKeys(){return Object.keys(ll())},has(e,t){return t in ll()},getOwnPropertyDescriptor(e,t){const n=ll()[t];return n!==void 0?{enumerable:!0,configurable:!0,value:n}:void 0}}),Jg=()=>Object.entries(Zr).filter(([,e])=>!e.allowedPanels||e.allowedPanels.includes("COUNTER_PANEL")).sort(([,e],[,t])=>e.sortOrder-t.sortOrder).map(([e,t])=>({type:e,label:t.name}));Jg();const Bb=(e,t)=>{const n={bold:["deploy","setup","commit","support","pass","pas"],italic:["threat","aim","exploit","stun","shield","gain","point","points","reveal","move","draw","push","sacrifice","discard"]};return e.split(/(\s+|[.,:()])/).map((a,o)=>{if(!a)return null;const s=a.replace(/[.,:()]/g,"").toLowerCase(),l=n.bold.find(d=>d.toLowerCase()===s),c=n.italic.find(d=>d.toLowerCase()===s);if(l){const d=t[l]||a;return ca.createElement("strong",{key:o,className:"text-white"},d)}if(c){const d=t[c]||a;return ca.createElement("em",{key:o,className:"text-white italic font-semibold"},d)}return a})},Af=(e,t)=>e?e.split(`
`).map((n,r)=>{const a=[];return r>0&&a.push(ca.createElement("br",{key:`br-${r}`})),a.push(...Bb(n,t)),ca.createElement(ca.Fragment,{key:r},...a.filter(Boolean))}):"",Hb={abilityKeywords:{deploy:"",setup:"",commit:"",support:"",threat:"",pass:"",aim:"",exploit:"",stun:"",shield:"",gain:"",point:"",points:"",reveal:"",move:"",draw:"",push:"",sacrifice:"",discard:""},cardTypes:{unit:"",command:"",hero:"",rarity:"",structure:"",gear:"",event:"",attachment:""},ui:{startGame:" ",joinGame:"",deckBuilding:" ",rules:"  ",settings:"",language:"",serverAddress:" ",saveApply:"",cancel:"",close:"",tokens:"",counters:"",phase:"",scoring:"...",autoAbility:"-",autoDraw:"-",newGame:" ",resetGame:" ",exit:"",surrender:"",mode:"",size:"",dummies:"",spectatorMode:" ",spectatorMsg:"   .",readyCheck:" ?",imReady:" ",waiting:"...",cancelStart:"",assignTeams:" ",confirmTeams:"  ",unassigned:"",team:"",deck:"",discard:"",showcase:"",customDeck:" ",loadDeck:"",clear:"",save:"",filter:"",currentDeck:" ",emptyDeck:"  .",clickToAdd:"   ,   .",view:"",play:"",playFaceDown:"  ",toHand:" ",toDiscard:" ",revealToAll:" ",requestReveal:" ",flipUp:"",flipDown:" ",connected:"",disconnected:"",hiddenGameTooltip:"      ''",gameOver:" ",roundComplete:" ",complete:"",winner:"",roundWinner:" ",move:"",moveToBottom:" ",selectCard:" ",deckView:"",topDeckView:" ",discardView:"",selectFromDeck:"   ",selectFromDiscard:"   ",power:"",owner:"",noDescription:" ",comingSoon:"",revealed:"",connecting:"...",reconnecting:"...",reconnectingDescription:"  ...",pleaseWait:", ...",doNotClose:"      ",error:"",loading:"...",create:"",createGame:" ",gameCode:" ",playerName:" ",join:"",back:"",customGame:" ",privateGame:" ",publicGame:" ",freeForAll:"   ",teamBattle:" ",startingPlayer:" ",turn:"",round:"",score:"",hand:"",announced:"",effects:"",status:"",deploy:"",ability:"",recover:"",resurrect:"",destroy:"",returnToHand:"  ",shuffle:"",drawCard:" ",drawStartingHand:"   (6)",viewTopCards:"  ",highlight:"",highlightCell:" ",highlightRow:" ",highlightColumn:" ",emptyHand:" ",hidden:"",newAvalon:"New Avalon",cards:"",scorePoints:"",toWinRound:"   .",checkedAtFirstPlayer:"     .",roundVictoryCondition:"   ",reach:"",ffa:"FFA",team2v2:"2v2",team3v1:"3v1",drawCards:" ",activeGames:" ",noActiveGames:"   .",createOne:"    ?",orJoinWithCode:"   ",enterGameId:" ID ",dragToReorder:"   .",rightClickForActions:"   .",deckEmpty:" .",done:"",remove:"",toDeckTop:" ",toDeckBottom:" ",storyMode:" ",puzzles:"",changeColor:" ",firstPlayer:" ",activePlayer:" ",clearSearch:" ",resetPowerFilter:"  ",clearTypes:" ",resetFaction:" ",removeOne:" ",waitingForOthers:"  ",deckNamePlaceholder:" ",searchPlaceholder:" ...",myCustomDeck:" ",untitledDeck:" ",max1RarityHero:" 1 (/)",max2Command:" 2 ()",finalRoundMaxTurns:" !  10 .",max5Rounds:" 5 .",noTarget:" ",confirmClearDeck:" ,     ?",selectCardFromDeck:"   ",selectCardFromDiscard:"   ",languageDisabled:"     .",autoAbilitiesTooltip:"-:    ",autoDrawTooltip:"-:     (6     +    Setup)",endedOnTurn:"  ",nextRound:":",victoryCondition:" :",win2RoundsMatch:"*   2 ,   . ",max5RoundsInfo:" 5 .",matchComplete:" ",thankYouPlaying:"    New Avalon: Skirmish.",returnToMenu:"  ",continueGame:"  ",startRound:" ",youLabel:"()",readyToStart:" ?",gameWillBegin:" ,     .        .",dragCardsReorder:"    .  ,      .",dragOutsideAnotherZone:" ,      .",ready:"",dragOutsideToMove:" ,      .",empty:"",dragOutsideToPlaceToken:" ,     .",holdRightClickViewHints:"      ",gameSettings:" ",invitePlayer:"Invite Player",hiddenGame:"",private:"",public:"",copyInviteLink:"  ",copyGameLink:"   ",copied:"!",inviteLinkDesc:"  .    .",copyGameLinkDesc:"  ,        .",on:"",off:"",copy:"",dummyPlayers:"",gridSize:" ",autoAbilities:"-",gameMode:" ","2v2":"2v2","3v1":"3v1",reconnect:"",hideDummyCards:"  ",hideDummyCardsTooltip:"    -,    ",clearCache:" ",clearCacheDesc:"      ",cacheCleared:" ! ...",saveJson:" JSON",saveText:" ",loadTextDeck:". ",cannotSaveEmptyDeck:"   .",failedToParseDeckFile:"    .",webrtcMode:" WebRTC",webrtcModeDesc:"        (  )",peerToPeer:"Peer-to-Peer",directConnection:"   ",hostGame:" ",hostGameDesc:"   WebRTC -    ",copyHostLink:"  ",hostLinkCopied:"  !",joinAsGuest:"   (P2P)",enterHostId:" Host ID  ",invalidHostId:" Host ID",connectingToHost:"  ...",connectedToHost:"  ",hostDisconnected:" ",guestDisconnected:" ",guestConnected:" "},rules:{title:'  "New Avalon: Skirmish"',conceptTitle:"I.  ",conceptText:`**   :** New Avalon: Skirmish      ,      -.      ,            .

**:**         ,      .        (),       .`,winConditionTitle:"II.  ",winConditionText:`**   :**    2   . ,   2   ,   .
**   :**         2    ,     .

**    (   ):**  ,            (),    5- .
** :**    5     .     ,   5-       .

** :**
-  1: 20   ().
-  2: 30   ().
-  3  :    +10     (,  3  40 ).

**    :**    ,   ,         .
**   :**               ,     .`,fieldTitle:"III.    ",fieldText:`**  ():**     ,        .
** :**
- 2 :  5x5 .
- 3 :  6x6 .
- 4 :  7x7 .

** :**
- **:**       .      (Scoring).
- **:**         ().    ,      .

**:**       ,   :
- ** (Units):**   ,   (Power)  .      .
- ** (Commands):**   . ,   (   "2  3 ")    .

** :**
- ** (Hand):** ,   .
- ** (Discard):** ,       .
- ** (Showcase/Announced):**  ,       .`,setupTitle:"IV.   ()",setupText:`** :**              (  30 ).
**:**    .

** :**    6    ,   .
**  :**      .

**:**   ,    (6 ),    1                 .

**  :**        (,  ).
**:**   ,    .          Setup.`,abilitiesTitle:"V.  ",abilitiesText:`** :**
- **Deploy:**    ,         .
- **Setup:**      Setup    (  ),         .
- **Commit:**      Commit   ,         .
- ** ():**   ,        .

**  ():**
   ,   (, **Support  Deploy:** ...).
-   "   ".
-      (,   Support)     ,  ** ** .

** :**
- **Stun:**   (  Stun) ** **   ( Deploy,  ,  ).
- **Face-down:** ,   ,   .
- **:**    ( ),  ****   ,    .    ,    ().`,statusesTitle:"VI.   ()",statusesText:`          .    Stun         .

** (Support):**    Support,        (   )   .
** Stun/Support:** ,   Stun,     Support   .
**:**  Support       ,   Support  [].

** (Threat):**    Threat,      ,   .
** :**  Threat      :
1. **:**          (    ).
2. **:**               .
** Stun/Threat:** ,   Stun,     Threat   .
**:**   Threat         .`,countersTitle:"VII.  (Counters)",countersText:`    ,   .       ,         .

** (Stun):**
- **:**   Stun       Scoring,             (    ).
- **:**    Commit        1  Stun.

** (Shield):**
- **:**     (Destroy)  ,   ,       1  .    .

** (Revealed)    (Face-down):**
- **Revealed:**  -      .
- ** Face-down:** ,    (Face-down),        0 .      Revealed,   ()   ,     Face-down     (, ).

**  (Aim, Exploit):**
- **Aim ()  Exploit ():**         (,   ).        .

**  (Last Played):**
- **:**  ,    ,         .    ,        (Scoring).`,turnTitle:"VIII.    ",turnText:`     .        .        :

**1.  Setup ():**
- ** :**    1     .
- **:**          **Setup:**.
**:**          .

**2.  Main ( / ):**
- ** :**        :
  -    (**Deploy:**)       .      Deploy: .
  -     .
  - .
** :**            ,     .

**3.  Commit ( / ):**
- **:**          **Commit:**.
- ** Stun:**            1  Stun.
**:**           .

**4.  Scoring ( ):**
- ** :**       (  ),        **Last Played**.
- **:**         ,        .`,mechanicsTitle:"IX.     ",mechanicsText:`**Stun   :**
- **:**    Stun   Face-down  0    Scoring,      ,      ,   (, Spotter).

**  Last Played:**
- **:**     Last Played    (,   /)   Scoring,        (,   Last Played   ).
- **:**    Last Played    ,        Scoring.
- **:**          Last Played,            .

**  (Push, Swap):**
- **Push ():**        .   ( ),         .      .
- **Swap ():**     ,     .

** (Resurrect):**
- ** "":** ,       (),    **Resurrected**   Deploy.     (  )   ,      Stun.`,creditsTitle:"X.  ",creditsText:`**:**  

** :**
Google AI Studio, Claude Code, Gemini, ChatGPT

** :**
-  
-  
-  
-  

       [Telegram](https://t.me/NeurohoretApp)  [Discord](https://discord.gg/U5zKADsZZY).
       [DonationAlerts](https://www.donationalerts.com/r/anahoret)  [Patreon](https://www.patreon.com/AnchoriteComics).`},counters:{Aim:{name:"",description:`       ,     .
   .`},Exploit:{name:"",description:`       ,     .
          .`},LastPlayed:{name:"",description:"      ."},Revealed:{name:"",description:"      revealed.      ."},Stun:{name:"",description:`        .       ,    .
 1         (Scoring).`},Shield:{name:"",description:"     ,      1  ."},Support:{name:"",description:`       ,     .
     .`},Threat:{name:"",description:`       ,     .
         .`},"Power+":{name:"+",description:"    1."},"Power-":{name:"-",description:"    1."},Resurrected:{name:"",description:"     .       ."}},deckNames:{SynchroTech:"",Hoods:"",Optimates:"",Fusion:""},cards:{ipDeptAgent:{name:"  IP",ability:`Deploy:  2        .
Commit ( ):       .`,flavorText:'- "   .  .     ."'},tacticalAgent:{name:" ",ability:`Deploy:        .
Setup:      .`,flavorText:'- "  !   SynchroTech!"'},patrolAgent:{name:" ",ability:`Setup:     .
Commit:          .`,flavorText:",    .  ,     ."},riotAgent:{name:" ",ability:`Deploy:      1      .
Commit:          .`,flavorText:'- ", !     SynchroTech."'},threatAnalyst:{name:" ",ability:`Deploy:      .
Commit ( ):             .`,flavorText:""},recklessProvocateur:{name:" ",ability:`Deploy:     .
Commit:          .`,flavorText:'- "   .    ."'},dataLiberator:{name:" ",ability:`Pass ( ):        .
Deploy:      .`,flavorText:'- "    .   ."'},cautiousAvenger:{name:" ",ability:`Deploy:        2 .
Setup ( ):      .`,flavorText:'- "   .    ."'},vigilantSpotter:{name:" ",ability:`Pass ( ):   (Revealed)     ,  2 .
Commit:  1    .`,flavorText:'- "   .    ."'},inventiveMaker:{name:" ",ability:`Deploy:   -    .
Setup ( ):       .`,flavorText:'- "   .    ."'},faber:{name:"",ability:"Deploy:  1             .",flavorText:"         ."},censor:{name:"",ability:`Deploy:      .
Commit ( ):       .`,flavorText:"         ."},princeps:{name:"",ability:`Deploy:   .        .
Setup:      .`,flavorText:"  .  ."},immunis:{name:"",ability:`Deploy ( ):             .
       2  .`,flavorText:"         ."},centurion:{name:"",ability:"Commit:            +1  .",flavorText:"         ."},codeKeeper:{name:" ",ability:`Deploy:   1           .
Commit ( ):         1 .`,flavorText:"   .    ."},devoutSynthetic:{name:" ",ability:`Deploy:      1      .
Setup:        .`,flavorText:"   .    ."},unwaveringIntegrator:{name:" ",ability:`Deploy:      .
Setup ( ):  1         .`,flavorText:"   .    ."},signalProphet:{name:" ",ability:`Deploy:   1          .
Commit ( ):        1 .`,flavorText:"   .    ."},zealousMissionary:{name:" ",ability:`Deploy:      .
Commit ( ):  -1       .`,flavorText:"   .    ."},overwatch:{name:"",ability:`  1     .  1            .
  1     .  1         .`},tacticalManeuver:{name:" ",ability:`         .   ,    .
         .   ,    .`},inspiration:{name:"",ability:`       .  1     .
       .  1     .`},dataInterception:{name:" ",ability:`  1     .  1            .
  1     .        1  2 .`},falseOrders:{name:" ",ability:`  1     .         1  2 .   2     .
  1     .         1  2 .    2  .`},experimentalStimulants:{name:" ",ability:`            Deploy   .
         .`},logisticsChain:{name:" ",ability:`    .  +1          .
    .  1          .`},quickResponseTeam:{name:"  ",ability:`       .
          .  .`},temporaryShelter:{name:" ",ability:`  1     .       .
  1     .     1  2 .`},enhancedInterrogation:{name:" ",ability:`  1     .  1            .
  1     .         1  2 .`},mobilization1:{name:" ",ability:"      ."},mobilization2:{name:" ",ability:"   4   ."},mobilization3:{name:" ",ability:"    ."},reconDrone:{name:"",ability:`Setup:      .
Commit:      .      .`,flavorText:"SynchroTech      ,   Hoods    ."},walkingTurret:{name:" ",ability:`Deploy:        .
Setup:  -1      .`,flavorText:"        ."},reclaimedGawain:{name:' ""',ability:`Deploy:   .      1      .
Setup:        .`,flavorText:"-  ,    ."},FalkPD:{name:" ,  ",ability:`Deploy:      .        .
Commit:   .`,flavorText:"  .  ,    ."},edithByron:{name:" ,  ",ability:`Setup:     .
Deploy:   .   -    .`,flavorText:" ,    ."},pinkunonekoSV:{name:",  ",ability:`Deploy:       .
Setup:        .`,flavorText:"    ."},EleftheriaMD:{name:' "" ',ability:`Deploy:      .
Setup:      .`,flavorText:"   .   ."},ziusIJ:{name:",  ",ability:`Deploy:      .
Setup ( ):         1         .`,flavorText:" - ,     ."},abrGawain:{name:' ""',ability:`Deploy:   .        .
Setup:      .`,flavorText:" .  : ."},reverendOfTheChoir:{name:" ",ability:`Setup ( ):  1         .
Deploy:       .`,flavorText:"      ."},mrPearlDoF:{name:" ,  Bio-Synch",ability:`Pass:       +1  .
Deploy:      .        .`,flavorText:"   ,   ."},finnMW:{name:",  ",ability:`Setup:      1  2 .
Commit:  1        .`,flavorText:" ,  . :   ."},luciusTheImmortal:{name:", ",ability:`Pass:   .    ,  +2  .
Setup:         .        .`,flavorText:"   .    ."},secretInformant:{name:" ",ability:"Deploy:  3    .        .  1 .",flavorText:" - .   ."}}},Wb={abilityKeywords:{deploy:"Deploy",setup:"Setup",commit:"Commit",support:"Podrka",threat:"Pretnja",pass:"Pass",aim:"Nianjenje",exploit:"Exploit",stun:"Ogluenje",shield:"tit",gain:"Dobij",point:"Bod",points:"Bodova",reveal:"Otkrij",move:"Pomeri",draw:"Vuci",push:"Gurni",sacrifice:"rtvuj",discard:"Baci"},cardTypes:{unit:"Jedinica",command:"Komanda",hero:"Heroj",rarity:"Retkost",structure:"Struktura",gear:"Oprema",event:"Dogaaj",attachment:"Dodatak"},ui:{startGame:"Zaponi igru",joinGame:"Pridrui se",deckBuilding:"Graditelj pila",rules:"Pravila i uputstvo",settings:"Podeavanja",language:"Jezik",serverAddress:"Adresa servera",saveApply:"Sauvaj",cancel:"Otkai",close:"Zatvori",tokens:"Tokeni",counters:"Brojai",phase:"Faza",scoring:"BODOVANJE...",autoAbility:"Auto-sposobnost",autoDraw:"Auto-drovanje",newGame:"Nova igra",resetGame:"Poniti igru",exit:"Izlaz",surrender:"Predaj se",mode:"Reim",size:"Veliina",dummies:"Lutke",spectatorMode:"Reim posmatraa",spectatorMsg:"Posmatrate igru.",readyCheck:"Spremni za poetak?",imReady:"Spreman sam",waiting:"ekanje...",cancelStart:"Otkai poetak",assignTeams:"Dodeli timove",confirmTeams:"Potvrdi timove i zaponi",unassigned:"Nedodeljene igrae",team:"Tim",deck:"PIL",discard:"BAENI",showcase:"Izlog",customDeck:"Prilagoeni pil",loadDeck:"Uitaj",clear:"Obrii",save:"Sauvaj",filter:"Filter",currentDeck:"Trenutni pil",emptyDeck:"Va pil je prazan.",clickToAdd:"Kliknite na karte sa leve strane da biste ih dodali.",view:"Pogledaj",play:"Igraj",playFaceDown:"Igraj zatvoreno",toHand:"U ruku",toDiscard:"U baene",revealToAll:"Otkrij svima",requestReveal:"Zatrai otkrivanje",flipUp:"Okreni licem nagore",flipDown:"Okreni licem nadole",connected:"Povezano",disconnected:"Prekinuta veza",hiddenGameTooltip:"Skrivene igre se ne pojavljuju na listi 'Pridrui se'",gameOver:"Kraj igre",roundComplete:"Runda zavrena",complete:"Zavrena",winner:"Pobednik",roundWinner:"Pobednik runde",move:"Pomeri",moveToBottom:"Pomeri na dno",selectCard:"Izaberi kartu",deckView:"pil",topDeckView:"Vrh pila",discardView:"Baene karte",selectFromDeck:"Izaberi kartu iz pila",selectFromDiscard:"Izaberi kartu iz baenih",power:"Snaga",owner:"Vlasnik",noDescription:"Nema opisa",comingSoon:"Uskoro",revealed:"Otkriveno",connecting:"Povezivanje...",reconnecting:"Ponovno povezivanje...",reconnectingDescription:"Pokuaj obnove konekciju...",pleaseWait:"Molim sa saekajte...",doNotClose:"Ne zatvaraj ovaj prozor dok se ponovo povezujete",error:"Greka",loading:"Uitavanje...",create:"Kreiraj",createGame:"Kreiraj igru",gameCode:"Kod igre",playerName:"Ime igraa",join:"Pridrui se",back:"Nazad",customGame:"Prilagoena igra",privateGame:"Privatna igra",publicGame:"Javna igra",freeForAll:"Svi protiv svih",teamBattle:"Timska borba",startingPlayer:"Poetni igra",turn:"Potez",round:"Runda",score:"Rezultat",hand:"RUKA",announced:"NAJAVLJENO",effects:"Efekti",status:"Status",deploy:"Razmesti",ability:"Sposobnost",recover:"Oporavi",resurrect:"Vaskrsi",destroy:"Uniti",returnToHand:"Vrati u ruku",shuffle:"Promeaj",drawCard:"Vuci kartu",drawStartingHand:"Vuci poetnu ruku (6)",viewTopCards:"Pogledaj gornje karte",highlight:"Istakni",highlightCell:"Istakni eliju",highlightRow:"Istakni red",highlightColumn:"Istakni kolonu",emptyHand:"Isprazni ruku",hidden:"Skriveno",newAvalon:"New Avalon",cards:"Karata",scorePoints:"bodova",toWinRound:"za pobedu u rundi.",checkedAtFirstPlayer:"Proverava se u fazi postavljanja prvog igraa.",roundVictoryCondition:"Uslov pobede u rundi",reach:"Dostigni",ffa:"Svi protiv svih",team2v2:"2 protiv 2",team3v1:"3 protiv 1",drawCards:"Vuci karte",activeGames:"Aktivne igre",noActiveGames:"Nema aktivnih igara.",createOne:"Zato ne biste kreirali jednu?",orJoinWithCode:"Ili se pridruite kodom",enterGameId:"Unesite ID igre",dragToReorder:"Prevucite za reanje.",rightClickForActions:"Desni klik za radnje.",deckEmpty:"pil je prazan.",done:"Gotovo",remove:"Ukloni",toDeckTop:"Na vrh pila",toDeckBottom:"Na dno pila",storyMode:"Reim prie",puzzles:"Slagalice",changeColor:"Promeni boju",firstPlayer:"Prvi igra",activePlayer:"Aktivan igra",clearSearch:"Obrii pretragu",resetPowerFilter:"Resetuj filter snage",clearTypes:"Obrii tipove",resetFaction:"Resetuj frakciju",removeOne:"Ukloni jednu",waitingForOthers:"ekanje na ostale...",deckNamePlaceholder:"Naziv pila",searchPlaceholder:"Pretraga...",myCustomDeck:"Moj prilagoeni pil",untitledDeck:"Bezimeni pil",max1RarityHero:"Maksimum 1 (Retkost/Heroj)",max2Command:"Maksimum 2 (Komanda)",finalRoundMaxTurns:"Konana runda! Maksimum 10 poteza.",max5Rounds:"Maksimum 5 rundi.",selectCardFromDeck:"Izaberi kartu iz pila",selectCardFromDiscard:"Izaberi kartu iz baenih",noTarget:"Nema cilja",confirmClearDeck:"Da li ste sigurni da elite da obriete trenutni pil?",languageDisabled:"Izbor jezika je trenutno onemoguen.",autoAbilitiesTooltip:"Auto-sposobnosti: Omoguite automatsku aktivaciju sposobnosti",autoDrawTooltip:"Auto-deljenje: Omoguite automatsko deljenje karata (6 karata u poetnoj ruci + deljenje u Setup fazi)",endedOnTurn:"Zavreno u potezu",nextRound:"Sledee:",victoryCondition:"Uslov pobede:",win2RoundsMatch:"* Pobedite u 2 rund da biste osvojili me. ",max5RoundsInfo:"Maksimum 5 rundi.",matchComplete:"Me zavren",thankYouPlaying:"Hvala to ste igrali New Avalon: Skirmish.",returnToMenu:"Povratak u meni",continueGame:"Prikai bojite",startRound:"Zaponi rundu",youLabel:"(Vi)",readyToStart:"Spremni za poetak?",gameWillBegin:"Igra e poeti kada svi igrai budu spremni. I dalje moete promeniti ime i pil.",dragCardsReorder:"Prevucite karte za reanje. Prevucite napolje da biste premestili kartu u drugu zonu.",dragOutsideAnotherZone:"Prevucite napolje da biste premestili kartu u drugu zonu.",ready:"Spreman",dragOutsideToMove:"Prevucite napolje da biste premestili kartu u drugu zonu.",empty:"Prazno",dragOutsideToPlaceToken:"Prevucite napolje da biste postavili token na tablu.",holdRightClickViewHints:"Drite desni taster za prikaz saveta",gameSettings:"Podeavanja igre",invitePlayer:"Pozovi Igraa",hiddenGame:"Privatnost",private:"Privatna",public:"Javna",copyInviteLink:"Kopiraj link za pozivnicu",copyGameLink:"Kopiraj link na igru",copied:"Kopirano!",inviteLinkDesc:"Poaljite link prijatelju. Adresa servera e se podesiti automatski.",copyGameLinkDesc:"Podelite se ovim linkom kako biste prijatelji mogli da se pridrue sa podeenim podeavanjima servera.",copy:"Kopiraj",on:"UKLJ",off:"ISKLJ",dummyPlayers:"Botovi",gridSize:"Veliina polja",autoAbilities:"Auto-sposobnosti",gameMode:"Reim igre","2v2":"2v2","3v1":"3v1",reconnect:"Povei ponovo",hideDummyCards:"Sakri karte botova",hideDummyCardsTooltip:"Sakrij karte u rukama bot-igraa kao kod pravih igraa",clearCache:"Obrii ke",clearCacheDesc:"Obrii sve sauvane podatke i ponovo uitaj stranicu",cacheCleared:"Ke obrisan! Ponovno uitavanje...",saveJson:"Sauvaj JSON",saveText:"Sauvaj tekst",loadTextDeck:"Uitaj tekst",cannotSaveEmptyDeck:"Ne moete sauvati prazan pil.",failedToParseDeckFile:"Nije uspelo ralanjivanje datoteke pila.",webrtcMode:"WebRTC Reim",webrtcModeDesc:"Omoguite direktnu vezu izmeu igraa bez centralnog servera (Domain deluje kao server)",peerToPeer:"Peer-to-Peer",directConnection:"Direktna veza izmeu pregledaa",hostGame:"Domain igre",hostGameDesc:"Domain igre putem WebRTC - centralni server nije potreban",copyHostLink:"Kopiraj vezu domaina",hostLinkCopied:"Veza domaina kopirana!",joinAsGuest:"Pridrui se igri (P2P)",enterHostId:"Unesite Host ID ili vezu",invalidHostId:"Nevaei Host ID",connectingToHost:"Povezivanje na domaina...",connectedToHost:"Povezano sa domainom",hostDisconnected:"Domain se odjavio",guestDisconnected:"Gost se odjavio",guestConnected:"Gost povezan"},rules:{title:'Pravila igre "New Avalon: Skirmish"',conceptTitle:"I. Osnovni Koncept",conceptText:`**anr i uloga igraa:** New Avalon: Skirmish je dinamika taktika kartaka igra koja se odvija na ogranienom mreastom polju. Igrai preuzimaju uloge voa frakcija, rasporeujui Jedinice i Komande kako bi preuzeli kontrolu nad kljunim linijama bojita.

**Objanjenje:** Igra se fokusira na pozicionu kontrolu i vreme aktiviranja sposobnosti, a ne samo na direktan napad. Pobeda se postie ostvarivanjem Poena Za Pobedu (PZP), koji se baziraju na snazi jedinica u izabranim linijama.`,winConditionTitle:"II. Uslovi za pobedu",winConditionText:`**Uslovi za pobedu u meu:** Me se igra do 2 pobede u rundama. Igra koji prvi ostvari 2 pobede u rundama, odmah pobeduje me.
**Objanjenje nereenog:** ako se po zavretku bilo koje runde vie igraa istovremeno domogne 2 pobede u rundama, svi se proglaavaju pobednicima mea.

**Uslovi za pobedu u rundi (Pragovi i ogranienje poteza):** Runda se zavrava im jedan ili vie igraa dostigne prag Poena Za Pobedu (PZP) ili nakon zavretka 5. poteza.
**Ogranienje poteza:** Svaka runda je ograniena na 5 potpunih poteza za svakog igraa. Ako prag PZP nije dostignut, na kraju 5. poteza vri se konano bodovanje i odreivanje pobednika.

**Vrednosti praga:**
- Runda 1: 20 Poena Za Pobedu (PZP).
- Runda 2: 30 Poena Za Pobedu (PZP).
- Runda 3 i dalje: Prag se poveava za +10 PZP u odnosu na prethodnu rundu (npr. Runda 3  40 PZP).

**Odreivanje pobednika rund i nereeno:** Pobednik rund je igra koji je dostigao prag vrednost ili igra sa najveim brojem PZP posle ogranienja poteza.
**Objanjenje nereenog u rundi:** Ako se po zavretku rund dva ili vie igraa imaju isti i najvei broj poena, svi se proglaavaju pobednicima rund.`,fieldTitle:"III. Bojite i komponente",fieldText:`**Bojite (Mrea):** Igra se odvija na kvadratnoj mrei ija se veliina menja u zavisnosti od ukupnog broja uesnika.
**Objanjenje veliina:**
- 2 igraa: Polje 5x5 elija.
- 3 igraa: Polje 6x6 elija.
- 4 igraa: Polje 7x7 elija.

**Odreivanje pozicija:**
- **Linija:** To je ceo horizontalni red ili vertikalna kolona. Koristi se za mehaniku bodovanja (Scoring).
- **Susedstvo:** elije se smatraju susednim samo horizontalno i vertikalno (ortogonalno). Dijagonalno susedstvo se ne uzima u obzir, osim ako je u karti drugaije navedeno.

**Karte:** U igri se koriste dva glavna tipa karata koje se igraju iz Ruke:
- **Jedinice (Units):** Osnovne borbene jedinice koje poseduju Snagu (Power) i Sposobnosti. Ostaju na bojitu do unitenja.
- **Komande (Commands):** Karte trenutnog dejstva. Igraju se, izvre efekat (esto nudei izbor "2 od 3 opcije") i odlaze u Baene.

**Zone za igru:**
- **Ruka (Hand):** Karte skrivene od protivnika.
- **Baene (Discard):** Zona u koju odlaze unitene Jedinice i odigrane Komande.
- **Izlog (Showcase/Announced):** Privremena zona u koju se stavlja karta Komande pre njenog igranja.`,setupTitle:"IV. Poetak igre (Postavljanje)",setupText:`**Formiranje pila:** Pre poetka mea svaki igra bira frakciju ili sastavlja pil prema pravilima izgradnje (najmanje 30 karata).
**Objanjenje:** KArte u pilu se promeaju.

**Poetna ruka:** Svaki igra vue 6 karata iz svog pila, formirajui poetnu ruku.
**Objanjenje skrivene informacije:** KArte u ruci su skrivene od protivnika.

**Mulingan:** Na poetku igre, nakon to dobije poetnu ruku (6 karata), igra ima pravo 1 put da promea bilo koji broj karata iz ruku nazad u pil i vue isti broj novih karata sa vrha.

**Odreivanje prvog igraa:** Odredite prvog aktivnog igraa bilo kojim pogodnim nainom (npr. bacanjem novia).
**Objanjenje:** Igra se vidi naizmenino, poevi od prvog igraa. Prvi igra zapoinje svoj prvi potez odmah sa Faze Setup.`,abilitiesTitle:"V. Sposobnosti karata",abilitiesText:`**Tipovi sposobnosti:**
- **Deploy:** Aktivira se automatski i odmah kada se karta stavlja iz ruke na polje otvoreno.
- **Setup:** Aktivira se automatski na poetku Faze Setup svakog vaeg poteza (pre vuenja karte), ako karta ve lei na polju licem nagore.
- **Commit:** Aktivira se automatski na poetku Faze Commit svakog vaeg poteza, ako karta ve lei na polju licem nagore.
- **Pas (Pasivna):** Efekat deluje trajno dok je karta na polju u otvorenom stanju.

**Uslovi izvrenja ():**
Mnoge sposobnosti imaju zahtev oznaen strelicom (npr. **Support  Deploy:** ...).
- To znai "PROVERA USLOVA  EFEKAT".
- Ako uslov levo od strelice (npr. prisustvo statusa Support) nije ispunjen u momentu aktiviranja, sposobnost **se ne aktivira** uopte.

**Vana pravila:**
- **Stun:** Ogluene karte (sa etonom Stun) **ne aktiviraju** svoje sposobnosti (ni Deploy, ni fazne, ni pasivne).
- **Face-down:** KArte koje lee licem nadole nemaju sposobnosti.
- **Obaveznost:** Ako se sposobnost aktivirala (uslovi su ispunjeni), vi **obavezni** da primenite njen efekat ako postoje legalne mete. Ako legalne mete nema, sposobnost se primenjuje uzalud (gori).`,statusesTitle:"VI. Dinamiki statusi (Pozicioniranje)",statusesText:`Dinamiki statusi se raunaju automatski i kontinuirano pri bilo kojoj promeni na tabli. Jedinice sa statusom Stun ne mogu davati ili uestvovati u proraunu ovih statusa.

**Podrka (Support):** Jedinica ima status Support ako se u bar jednoj susednoj eliji (horizontalno ili vertikalno) nalazi saveznika jedinica.
**Objanjenje Stun/Support:** Jedinica sa etonom Stun se ne uzima u obzir pri proraunu Support za susedne saveznike.
**Vrednost:** Prisustvo Support je uslov za aktiviranje mnogih monih sposobnosti, oznaenih sintaksom Support  [Efekat].

**Pretnja (Threat):** Jedinica dobija status Threat ako se nalazi u opasnoj poziciji, stvorenoj neprijateljskim jedinicama.
**Objanjenje uslova:** Status Threat se dodeljuje u jednoj od dve situacije:
1. **Kleta:** Jedinica je zakaena kartama jednog protivnika sa bilo koje dve strane (dve susedne ili dve suprotnje).
2. **Pritisak:** Jedinica se nalazi na ivici bojita i ima bar jednu kartu protivnika za susedom.
**Objanjenje Stun/Threat:** Jedinica sa etonom Stun se ne uzima u obzir pri proraunu Threat za susedne neprijatelje.
**Vrednost:** Jedinice pod Threat su ranjive mete za mone sposobnosti kontrole i unitenja.`,countersTitle:"VII. etoni (Counters)",countersText:`etoni su trajni markeri koji se nameu sposobnostima karata. Ostaju na jedinici dok se ne skinu ili dok jedinica ne bude unitena.

**Ogluenje (Stun):**
- **Efekat:** Jedinica sa Stun donosi 0 Poena Za Pobedu u fazi Scoring, ne moe da aktivira svoje sposobnosti i ne moe biti pomerena od strane svog vlasnika (ali moe biti pomerena od strane protivnika).
- **Skidanje:** Na kraju faze Commit sa svake jedinice aktivnog igraa automatski se skida 1 eton Stun.

**tit (Shield):**
- **Efekat:** Ako sposobnost pokua da uniti (Destroy) ovu jedinicu, efekat unitenja se spreava, a sa jedinice se umesto toga skida 1 eton tita. Jedinica ostaje na polju.

**Otkriveno (Revealed) i Skrivene karte (Face-down):**
- **Revealed:** Omoguava igrau-vlasniku etona da vidi skrivenu informaciju o karti.
- **Objanjenje Face-down:** Karta odigrana licem nadole (Face-down) nema Snagu ni Sposobnosti i donosi 0 poena. Ako takva karta dobije eton Revealed, njene informacije (lice) postaju vidljive protivniku, ali karta se i dalje smatra Face-down za sve svrhe igre (snaga, sposobnosti).

**Specijalni etoni (Aim, Exploit):**
- **Aim (Nianjenje) i Exploit (Iskorienost):** Ovi etoni su markeri za interakciju frakcijskih sposobnosti (npr. snajperi ili hakeri). Sami po sebi nemaju igraki efekat.

**Poslednja odigrana (Last Played):**
- **Efekat:** Privremeni status koji se automatski dodeljuje karti koju je poslednji odigrao na polje aktivni igra u tekuem potezu. Ovaj status odreuje liniju koju igra mora da izabere za bodovanje (Scoring).`,turnTitle:"VIII. Struktura poteza i vreme",turnText:`Potez se prenosi s igraa na igraa. Sposobnosti karata se aktiviraju samo u potezu njihovog vlasnika. Potez aktivnog igraa sastoji se od etiri sekvencijalne faze:

**1. Faza Setup (Postavljanje):**
- **Vuenje karte:** Aktivni igra vue 1 kartu iz pila u ruku.
- **Sposobnosti:** Aktiviraju se sposobnosti svih karata na polju sa kljunom rei **Setup:**.
**Objanjenje:** Ova faza je namenjena dopuni ruke i poetnom pozicioniranju jedinica.

**2. Faza Main (Delovanje / Razmetanje):**
- **Glavno delovanje:** Aktivni igra moe da izvri jedno od sledeih dejstava:
  - Odigra kartu Jedinice (**Deploy:**) iz ruku na bilo koju slobodnu eliju polja. Pri tome se odmah aktivira njena Deploy: sposobnost.
  - Odigra kartu Komande iz ruke.
  - Pasira.
**Objanjenje Komandi:** KArte Komandi se moe igrati u bilo kojem broju u ovoj fazi  pre, posle ili izmeu razmetanja jedinica.

**3. Faza Commit (Zavravanje / Uvrivanje):**
- **Sposobnosti:** Aktiviraju se sposobnosti svih karata na polju sa kljunom rei **Commit:**.
- **Skidanje Stun:** Na kraju ove faze sa svake jedinice aktivnog igraa automatski se skida 1 eton Stun.
**Objanjenje:** Faza se koristi za primenu efekata kontrole i dobijanje resursa pre bodovanja.

**4. Faza Scoring (Bodovanje):**
- **Ibor linije:** Aktivni igra mora da izabere jednu Liniju (Red ili Kolonu) koja prolazi kroz njegovu kartu sa statusom **Last Played**.
- **Proraun:** Sabira se Snaga svih jedinica aktivnog igraa u izabranoj liniji i dobijeni zbir dodaje se ukupnom rezultatu igraa.`,mechanicsTitle:"IX. Reavanje konflikata i kljune mehanike",mechanicsText:`**Stun i bodovanje:**
- **Efekat:** Jedinica sa statusom Stun ili koja lei Face-down donosi 0 poena u fazi Scoring, nezavisno od njene osnovne Snage, stalnih modifikatora snage ili pasivnih sposobnosti koje donose poene (npr. Spotter).

**Prenoenje statusa Last Played:**
- **Unitenje:** Ako karta sa statusom Last Played napusti bojite (unitena, vraena u ruku/pil) pre Faze Scoring, status se prenosi na prethodnu odigranu kartu ovog igraa (onu koja je bila Last Played u prolom potezu).
- **Pomeranje:** Ako se karta sa Last Played pomera na drugu eliju, igra bira njene nove linije u Fazi Scoring.
- **Odsustvo:** Ako igra nema nijednu kartu sa statusom Last Played, igra ne moe da izabere liniju i ne dobija poene u ovom potezu.

**Pomeranje jedinica (Push, Swap):**
- **Push (Guranje):** Jedinica forsira drugu kartu da se pomera za susednu eliju. Guranje se blokira (ne deava se) ako se meti nalazi zauzeta elija ili ivica polja. Ostali efekti sposobnosti se primenjuju na metu.
- **Swap (Zamena):** Omoguava dvema kartama da zamene mesta, ak i ako su obe elije zauzete.

**Vaskrsenje (Resurrect):**
- **Mehanika "izgaranja":** Karta vraena na bojite iz Baenih (vaskrsnuta) odmah dobija status **Resurrected** u momentu Deploya. Na poetku sledee faze (pri promeni faza) ovaj status se skida i karta dobija dva etona Stun.`,creditsTitle:"X. Autori igre",creditsText:`**Autor:** Nikita Anahoret

**Koriene neuronske mree:**
Google AI Studio, Claude Code, Gemini, ChatGPT

**Posebna zahvalnost:**
- Vasilisa Versus
- Kirill Tomauk
- Andrej Markosov
- Mitya epelin

Za sva pitanja i predloge piite na [Telegram](https://t.me/NeurohoretApp) ili [Discord](https://discord.gg/U5zKADsZZY).
Podrite razvoj igre i autore moete kroz [DonationAlerts](https://www.donationalerts.com/r/anahoret) i [Patreon](https://www.patreon.com/AnchoriteComics).`},counters:{Aim:{name:"Nianjenje",description:`Ovaj eton sam po sebi nema efekta, ali moe da menja sposobnosti karata.
Ovu kartu je lake unititi.`},Exploit:{name:"Exploit",description:`Ovaj eton sam po sebi nema efekta, ali moe da menja sposobnosti karata.
Karte hakera i programera e imati vei efekat na ovu kartu.`},LastPlayed:{name:"PoslednjaOdigrana",description:"Ova karta je odigrana poslednja od strane svog vlasnika."},Revealed:{name:"Otkriveno",description:"Lice ove karte je vidljivo vlasniku etona revealed. Moe se stavljati na karte u ruci."},Stun:{name:"Ogluenje",description:`Ogluena karta ne moe da aktivira sposobnosti ili donosi poene. Efekti njenog vlasnika je ne mogu da pomeraju, ali efekti protivnika mogu.
Skinite 1 eton ogluenja sa karte posle faze bodovanja (Scoring).`},Shield:{name:"tit",description:"Ako efekat pokua da uniti ovu kartu, umesto toga skinite sa nje 1 eton tita."},Support:{name:"Podrka",description:`Ovaj eton sam po sebi nema efekta, ali moe da menja sposobnosti karata.
Ova karta se nalazi pored saveznika.`},Threat:{name:"Pretnja",description:`Ovaj eton sam po sebi nema efekta, ali moe da menja sposobnosti karata.
Ova karta je okruena i pritisnuta na ivicu polja kartama protivnika.`},"Power+":{name:"Snaga+",description:"Poveava snagu karte za 1."},"Power-":{name:"Snaga-",description:"Smanjuje snagu karte za 1."},Resurrected:{name:"Vaskrsnut",description:"Ova jedinica se nedavno vratila iz baenih. Bie ogluena na poetku sledee faze."}},deckNames:{SynchroTech:"SynchroTech",Hoods:"Kapuljae",Optimates:"Optimati",Fusion:"Fuzija"},cards:{ipDeptAgent:{name:"Agent IP Odeljenja",ability:`Deploy: Pometa 2 etona Oglunja na kartu s vaim etonom Eksploita.
Commit (zahteva Podrku): Odbacuje iz ruke oponenta vama otkrivenu kartu.`,flavorText:'- "Krili ste autorska prava. Otvorite vrata. Imamo nalog za pretragu."'},tacticalAgent:{name:"Taktiki Agent",ability:`Deploy: Pometa eton Pricela na kartu s vaom Ugrozom.
Setup: Unitava kartu s vaim etonom Pricela.`,flavorText:'- "Neko se ne kree! Bezbednosna sluba SynchroTech!"'},patrolAgent:{name:"Patrolni Agent",ability:`Setup: Pomera se u slobodnu jiju linije.
Commit: Pometa eton Oglunja na susednu kartu oponenta s vaom Ugrozom.`,flavorText:"Kau da grad nikada ne spava. Mi pazimo da ak ni ne trepe."},riotAgent:{name:"Agent za Suzbijanje Nereda",ability:`Deploy: Gura susednu kartu oponenta za 1 polje i moe zauzeti njeno mesto.
Commit: Pometa eton Oglunja na susednu kartu oponenta s vaom Ugrozom.`,flavorText:'- "Graani, raziite se! Ovaj skup nije odobren od strane SynchroTech."'},threatAnalyst:{name:"Analitiar Pretnji",ability:`Deploy: Pometa eton Eksploita na bilo koju kartu.
Commit (zahteva Podrku): Otkriva kartu u ruci oponenta za svaki va eton Eksploita na bojnom polju.`,flavorText:""},recklessProvocateur:{name:"Nemarni Provokator",ability:`Deploy: Menja se mestima sa susednom kartom.
Commit: Pomera sve etone sa odabrane saveznike karte na ovu kartu.`,flavorText:'- "Strpljenje je oruje. Osveta je umetnost."'},dataLiberator:{name:"Oslobodilac Podataka",ability:`Pass (zahteva Podrku): Karte s vaim etonima Eksploita donose vam poene.
Deploy: Pometa eton Eksploita na bilo koju kartu.`,flavorText:'- "Informacija ne eli da bude slobodna. Ona mora biti."'},cautiousAvenger:{name:"Oprezni Osveta",ability:`Deploy: Pometa eton Pricela na kartu u dometu od 2 polja.
Setup (zahteva Podrku): Unitava kartu s vaim etonom Pricela.`,flavorText:'- "Strpljenje je oruje. Osveta je umetnost."'},vigilantSpotter:{name:"Bedni Nadzornik",ability:`Pass (zahteva Podrku): Kada otkrivena (Revealed) karta protivnika izae na polje, dobij 2 boda.
Commit: Otkrij 1 kartu iz ruke protivnika.`,flavorText:'- "Strpljenje je oruje. Osveta je umetnost."'},inventiveMaker:{name:"Izumitelj Kreator",ability:`Deploy: Stvara token Dron-Razvednik u susednom praznom polju.
Setup (zahteva Podrku): Vraa kartu Devajsa iz odbaenih karata u ruku.`,flavorText:'- "Strpljenje je oruje. Osveta je umetnost."'},finnMW:{name:"Fin, Najtraeniji",ability:`Setup: Pomera bilo koju vau kartu za 1 ili 2 polja.
Commit: Za svaku vama otkrivenu kartu u rukama oponenata ili na bojnom polju dobijate 1 poen.`,flavorText:"Uhvati me ako moe. Spoiler: Ne moe."},faber:{name:"Faber",ability:"Deploy: Odbacite 1 kartu iz svoje ruke  Stvara token etajua Turel u susednom praznom polju.",flavorText:"U pozlaenim dvoranama Optimata ak i alati ratovanja su umetnika dela."},censor:{name:"Cenzor",ability:`Deploy: Pometa eton Eksploita na bilo koju kartu.
Commit (zahteva Podrku): Zamenjuje va eton Eksploita etonom Oglunja.`,flavorText:"U pozlaenim dvoranama Optimata ak i alati ratovanja su umetnika dela."},princeps:{name:"Princeps",ability:`Deploy: Dobija eton tita. Pometa eton Pricela na kartu u svojoj liniji.
Setup: Unitava kartu s vaim etonom Pricela.`,flavorText:"Red se ne trai. On se nametne."},immunis:{name:"Immunis",ability:`Deploy (zahteva Podrku): Vraa kartu Optimata iz vaih odbaenih karata u susedno prazno polje sa etonom Vaskrsenja.
Na kraju faze eton Vaskrsenja zamenjuje se sa 2 etona Oglunja.`,flavorText:"U pozlaenim dvoranama Optimata ak i alati ratovanja su umetnika dela."},centurion:{name:"Centurion",ability:"Commit: rtvujte saveznikog junita  Sve saveznike karte u njegovim linijama dobijaju +1 na snagu.",flavorText:"U pozlaenim dvoranama Optimata ak i alati ratovanja su umetnika dela."},codeKeeper:{name:"uvar Koda",ability:`Deploy: Pometa po 1 eton Eksploita na sve karte oponenata u linijama s bilo kojom Ugrozom.
Commit (zahteva Podrku): Pomera kartu oponenta s vaim etonom Eksploita za 1 polje.`,flavorText:"Signal je istina. Sve ostalo je um."},devoutSynthetic:{name:"Poboni Sintetiar",ability:`Deploy: Gura susednu kartu oponenta za 1 polje i moe zauzeti njeno mesto.
Setup: Unitava susednu kartu oponenta s Ugrozom ili Oglunjem.`,flavorText:"Telo je bag. Signal je zakrpa."},unwaveringIntegrator:{name:"Nepokolebljivi Integrator",ability:`Deploy: Pometa eton Eksploita na bilo koju kartu.
Setup (zahteva Podrku): Dobija 1 poen za svaki va eton Eksploita u izabranoj liniji.`,flavorText:"Signal je istina. Sve ostalo je um."},signalProphet:{name:"Prorok Signala",ability:`Deploy: Pometa po 1 eton Eksploita na sve svoje karte s Podrkom u linijama.
Commit (zahteva Podrku): Pomera svoju kartu sa etonom Eksploita za 1 polje.`,flavorText:"Signal je istina. Sve ostalo je um."},zealousMissionary:{name:"Revni Misionar",ability:`Deploy: Pometa eton Eksploita na bilo koju kartu.
Commit (zahteva Podrku): Daje -1 na snagu karti s vaim etonom Eksploita.`,flavorText:"Signal je istina. Sve ostalo je um."},overwatch:{name:"Nadzor",ability:` Postavi 1 eton Pricela na bilo koju kartu. Otkrij 1 kartu iz ruke oponenta za svaki tvoj eton Pricela na bojitu.
 Postavi 1 eton Pricela na bilo koju kartu. Vuci 1 kartu za svaki tvoj eton Pricela na bojitu.`},tacticalManeuver:{name:"Taktiki Manevar",ability:` Pomeri tvoju jedinicu u praznu eliju u njenoj liniji. Vuci broj karata jednak snazi premetene jedinice.
 Pomeri tvoju jedinicu u praznu eliju u njenoj liniji. Dobij broj poena jednak snazi premetene jedinice.`},inspiration:{name:"Inspiracija",ability:` Ukloni bilo koji broj etona sa tvoje jedinice. Vuci 1 kartu za svaki uklonjeni eton.
 Ukloni bilo koji broj etona sa tvoje jedinice. Dobij 1 poen za svaki uklonjeni eton.`},dataInterception:{name:"Presretanje Podataka",ability:` Postavi 1 eton Eksploita na bilo koju kartu. Otkrij 1 kartu u ruci oponenta za svaki tvoj eton Eksploita na bojitu.
 Postavi 1 eton Eksploita na bilo koju kartu. Pomeri jedinicu sa tvojim etonom Eksploita za 1 ili 2 polja.`},falseOrders:{name:"Lani Naredbe",ability:` Postavi 1 eton Eksploita na kartu oponenta. Pomeri jedinicu oponenta sa tvojim etonom Eksploita za 1 ili 2 polja. Otkrij do 2 karata u ruci tog oponenta.
 Postavi 1 eton Eksploita na kartu oponenta. Pomeri jedinicu oponenta sa tvojim etonom Eksploita za 1 ili 2 polja. Postavi 2 etona Oglunja na nju.`},experimentalStimulants:{name:"Eksperimentalni Stimulatori",ability:` Jednica pod tvojom kontrolom na bojitu moe aktivirati svoju Deploy sposobnost jo jednom.
 Pomeri tvoju jedinicu u praznu eliju u njenoj liniji.`},logisticsChain:{name:"Lanac Logistike",ability:` Dobij poene u dijagonali. Dobij +1 poen za svaku tvoju kartu sa Podrkom u toj dijagonali.
 Dobij poene u dijagonali. Vuci 1 kartu za svaku tvoju kartu sa Podrkom u toj dijagonali.`},quickResponseTeam:{name:"Tim za Brzo Reagovanje",ability:` Odigraj jedinicu iz ruke u prazno polje.
 Pronai kartu jedinice u pilu i stavi je u ruku. Promeaj pil.`},temporaryShelter:{name:"Privremeno Sklonite",ability:` Postavi 1 eton tita na tvoju kartu. Ukloni sve etone Pricela sa te karte.
 Postavi 1 eton tita na tvoju kartu. Pomeri tu kartu za 1 ili 2 polja.`},enhancedInterrogation:{name:"Pojaano Ispitivanje",ability:` Postavi 1 eton Pricela na bilo koju kartu. Otkrij 1 kartu iz ruke oponenta za svaki tvoj eton Pricela na bojitu.
 Postavi 1 eton Pricela na bilo koju kartu. Pomeri bilo koju kartu sa tvojim etonom Pricela za 1 ili 2 polja.`},mobilization1:{name:"Probijanje Linije",ability:"Dobij poene u izabranoj liniji bojita."},mobilization2:{name:"Osvojavanje Sektora",ability:"Dobij poene od 4 susednih saveznikih karata."},mobilization3:{name:"Proboj Dijagonale",ability:"Dobij poene u izabranoj dijagonali bojita."},reconDrone:{name:"Izvidniki Dron",ability:`Setup: Pomera se u bilo koje polje bojnog polja.
Commit: Izaberite kartu oponenta u susednom polju. Otkrivajte kartu u ruci tog oponenta.`,flavorText:"SynchroTech je kreirao lake dronove za patrolu ulica, ali Hoodsi imaju druge planove."},walkingTurret:{name:"etajua Turel",ability:`Deploy: Pometa eton Pricela na kartu u svojoj liniji.
Setup: Daje -1 na snagu karti sa etonom Pricela.`,flavorText:"Ovom ratnoj udovitu oigledno nije mesto na gradskim ulicama."},reclaimedGawain:{name:'Povraeni "Gawain"',ability:`Deploy: Dobija eton tita. Gura susednu kartu oponenta za 1 polje i moe zauzeti njeno mesto.
Setup: Unitava susednu kartu oponenta s Ugrozom ili Oglunjem.`,flavorText:"Nekada vite sistema, sada duh u maini."},FalkPD:{name:"Majkl Folk, Privatni Detektiv",ability:`Deploy: Nalazi u vaem pilu bilo koju kartu. Stavite je u svoju ruku i promieajte pil.
Commit: Otkriva kartu protivnika.`,flavorText:"On pronalazi stvari. Ponekad stvari koje treba da ostanu izgubljene."},edithByron:{name:"Edit Bajron, Ekstremni Inenjer",ability:`Setup: Pomera se u slobodno polje u liniji.
Deploy: Dobija eton tita. Stvara token Dron-Razvednik u susednom praznom polju.`,flavorText:"Gradi budunost, jedna eksplozija za drugom."},pinkunonekoSV:{name:"Pinkunoneko, Ulini uvar",ability:`Deploy: Pometa eton Oglunja na susednu kartu oponenta.
Setup: Unitava susednu kartu oponenta s Ugrozom ili Oglunjem.`,flavorText:"Neonske kande u mranoj ulici."},EleftheriaMD:{name:'Marija "Elefterija" Damanaki',ability:`Deploy: Pometa eton Pricela na bilo koju kartu.
Setup: Unitava kartu s vaim etonom Pricela.`,flavorText:"Sloboda ima cenu. Ona naplauje."},ziusIJ:{name:"Zius, Nezavisni Novinar",ability:`Deploy: Pometa eton Eksploita na bilo koju kartu.
Setup (zahteva Podrku): Pometa eton Eksploita na bilo koju kartu i dobija 1 poen za svaki eton Eksploita u liniji te karte.`,flavorText:"Istina je negde u blizini, i on emituje direktni prenos."},abrGawain:{name:'ABR "Gawain"',ability:`Deploy: Dobija eton tita. Pometa eton Pricela na kartu u svojoj liniji.
Setup: Unitava kartu s vaim etonom Pricela.`,flavorText:"Protokol iniciran. Procena pretnje: Ekstremna."},reverendOfTheChoir:{name:"asni Hor",ability:`Setup (zahteva Podrku): Dobija 1 poen za svaki va eton Eksploita na bojnom polju.
Deploy: Udvostruuje broj etona Eksploita na bilo kojoj karti.`,flavorText:"Huanje servera je himna za posveene."},mrPearlDoF:{name:"Gospodin Perl, Direktor BioSincha",ability:`Pass: Drugi vai juniti u linijama dobijaju +1 na snagu.
Deploy: Nalazi u vaem pilu kartu junita. Stavite kartu u svoju ruku i promieajte pil.`,flavorText:"Efikasnost je jedina metrika koja ima znaaj."},luciusTheImmortal:{name:"Lucije, Besmrtni",ability:`Pass: Imunitet na Oglunje. Ako je izaao iz odbaenih karata, dobija +2 na snagu.
Setup: Odbacite kartu  Naite u svom pilu kartu tima. Stavite je u svoju ruku i promieajte pil.`,flavorText:"Smrt podrazumeva prestanak funkcija. Ja sam samo optimizovao to."},secretInformant:{name:"Sikrt Informant",ability:"Deploy: Gleda 3 gornje karte bilo kog pila. Stavite bilo koji broj njih na dno pila. Uzmite 1 kartu.",flavorText:"Znanje je snaga. I sredstvo pritiska."}}},Vb={startGame:"Start Game",joinGame:"Join Game",deckBuilding:"Deck Building",rules:"Rules & Tutorial",settings:"Settings",language:"Language",serverAddress:"Server Address",saveApply:"Save & Apply",cancel:"Cancel",close:"Close",tokens:"Tokens",counters:"Counters",phase:"Phase",scoring:"SCORING...",autoAbility:"Auto-Ability",autoDraw:"Auto-Draw",newGame:"New Game",resetGame:"Reset Game",exit:"Exit",surrender:"Surrender",mode:"Mode",size:"Size",dummies:"Dummies",spectatorMode:"Spectator Mode",spectatorMsg:"You are watching the game.",readyCheck:"Ready to Start?",imReady:"I'm Ready",waiting:"Waiting...",cancelStart:"Cancel Start",assignTeams:"Assign Teams",confirmTeams:"Confirm Teams & Start",unassigned:"Unassigned Players",team:"Team",deck:"DECK",discard:"DISCARD",showcase:"Showcase",customDeck:"Custom Deck",loadDeck:"Load",clear:"Clear",save:"Save",filter:"Filter",currentDeck:"Current Deck",emptyDeck:"Your deck is empty.",clickToAdd:"Click cards on the left to add them.",view:"View",play:"Play",playFaceDown:"Play Face Down",toHand:"To Hand",toDiscard:"To Discard",revealToAll:"Reveal to All",requestReveal:"Request Reveal",flipUp:"Flip Face Up",flipDown:"Flip Face Down",connected:"Connected",disconnected:"Disconnected",hiddenGameTooltip:"Hidden games do not appear in the 'Join Game' list",gameOver:"Game Over",roundComplete:"Round Complete",complete:"Complete",winner:"Winner",roundWinner:"Round Winner",move:"Move",moveToBottom:"Move to Bottom",selectCard:"Select Card",deckView:"Deck",topDeckView:"Top Deck",discardView:"Discard Pile",selectFromDeck:"Select Card from Deck",selectFromDiscard:"Select Card from Discard",power:"Power",owner:"Owner",noDescription:"No description available",comingSoon:"Coming Soon",revealed:"Revealed",connecting:"Connecting...",reconnecting:"Reconnecting...",reconnectingDescription:"Attempting to restore connection...",pleaseWait:"Please wait...",doNotClose:"Do not close this window while reconnecting",error:"Error",loading:"Loading...",create:"Create",createGame:"Create Game",gameCode:"Game Code",playerName:"Player Name",join:"Join",back:"Back",customGame:"Custom Game",privateGame:"Private Game",publicGame:"Public Game",freeForAll:"Free For All",teamBattle:"Team Battle",startingPlayer:"Starting Player",turn:"Turn",round:"Round",score:"Score",hand:"HAND",announced:"ANNOUNCED",effects:"Effects",status:"Status",deploy:"Deploy",ability:"Ability",recover:"Recover",resurrect:"Resurrect",destroy:"Destroy",returnToHand:"Return to Hand",shuffle:"Shuffle",drawCard:"Draw Card",drawStartingHand:"Draw Starting Hand (6)",viewTopCards:"View Top Cards",highlight:"Highlight",highlightCell:"Highlight Cell",highlightRow:"Highlight Row",highlightColumn:"Highlight Column",emptyHand:"Empty Hand",hidden:"Hidden",newAvalon:"New Avalon",cards:"Cards",scorePoints:"points",toWinRound:"to win round.",checkedAtFirstPlayer:"Checked at First Player's Setup Phase.",roundVictoryCondition:"Round Victory Condition",reach:"Reach",ffa:"FFA",team2v2:"2v2",team3v1:"3v1",drawCards:"Draw Card",activeGames:"Active Games",noActiveGames:"No active games found.",createOne:"Why not create one?",orJoinWithCode:"Or Join with Code",enterGameId:"Enter Game ID",dragToReorder:"Drag to reorder.",rightClickForActions:"Right click for actions.",deckEmpty:"Deck is empty.",done:"Done",remove:"Remove",toDeckTop:"To Deck Top",toDeckBottom:"To Deck Bottom",storyMode:"Story Mode",puzzles:"Puzzles",changeColor:"Change Color",firstPlayer:"First Player",activePlayer:"Active Player",clearSearch:"Clear Search",resetPowerFilter:"Reset Power Filter",clearTypes:"Clear Types",resetFaction:"Reset Faction",removeOne:"Remove one",waitingForOthers:"Waiting for others...",deckNamePlaceholder:"Deck Name",searchPlaceholder:"Search...",myCustomDeck:"My Custom Deck",untitledDeck:"Untitled Deck",max1RarityHero:"Max 1 (Rarity/Hero)",max2Command:"Max 2 (Command)",finalRoundMaxTurns:"Final Round! Max 10 Turns.",max5Rounds:"Max 5 Rounds.",selectCardFromDeck:"Select Card from Deck",selectCardFromDiscard:"Select Card from Discard",noTarget:"No Target",confirmClearDeck:"Are you sure you want to clear the current deck?",languageDisabled:"Language selection is currently disabled.",autoAbilitiesTooltip:"Auto-Abilities: Enable automatic ability activation",autoDrawTooltip:"Auto-Draw: Enable automatic card drawing (6 card starting hand + draw at Setup phase)",endedOnTurn:"Ended on Turn",nextRound:"Next:",victoryCondition:"Victory Condition:",win2RoundsMatch:"* Win 2 rounds to win the match. ",max5RoundsInfo:"Max 5 Rounds.",matchComplete:"Match Complete",thankYouPlaying:"Thank you for playing New Avalon: Skirmish.",returnToMenu:"Return to Menu",continueGame:"View Battlefield",startRound:"Start Round",youLabel:"(You)",readyToStart:"Ready to Start?",gameWillBegin:"The game will begin once all players are ready. You can still change your name and deck.",dragCardsReorder:"Drag cards to reorder. Drag outside to move card to another zone.",dragOutsideAnotherZone:"Drag outside to move card to another zone.",ready:"Ready",dragOutsideToMove:"Drag outside to move card to another zone.",empty:"Empty",dragOutsideToPlaceToken:"Drag outside to place token on the board.",holdRightClickViewHints:"Hold right click to view hints",gameSettings:"Game Settings",invitePlayer:"Invite Player",hiddenGame:"Privacy",private:"Private",public:"Public",copyInviteLink:"Copy invite link",copyGameLink:"Copy Game Link",copied:"Copied!",inviteLinkDesc:"Send link to a friend. Server address will configure automatically.",copyGameLinkDesc:"Share this link so friends can join with your server settings pre-configured.",on:"ON",off:"OFF",dummyPlayers:"Dummies",gridSize:"Grid Size",autoAbilities:"Auto Abilities",gameMode:"Game Mode","2v2":"2v2","3v1":"3v1",copy:"Copy",reconnect:"Reconnect",hideDummyCards:"Hide Dummy Cards",hideDummyCardsTooltip:"Hide cards in dummy players hands like real players",clearCache:"Clear Cache",clearCacheDesc:"Clear all saved data and reload the page",cacheCleared:"Cache cleared! Reloading...",saveJson:"Save JSON",saveText:"Save Text",loadTextDeck:"Load Text",cannotSaveEmptyDeck:"Cannot save an empty deck.",failedToParseDeckFile:"Failed to parse deck file.",webrtcMode:"WebRTC Mode",webrtcModeDesc:"Enable peer-to-peer connection to play without a central server (Host acts as server)",peerToPeer:"Peer-to-Peer",directConnection:"Direct connection between browsers",hostGame:"Host Game",hostGameDesc:"Host a game using WebRTC - no central server needed",copyHostLink:"Copy Host Link",hostLinkCopied:"Host link copied!",joinAsGuest:"Join Game (P2P)",enterHostId:"Enter Host ID or link",invalidHostId:"Invalid Host ID",connectingToHost:"Connecting to host...",connectedToHost:"Connected to host",hostDisconnected:"Host disconnected",guestDisconnected:"Guest disconnected",guestConnected:"Guest connected"},Kb={title:"New Avalon: Skirmish Game Rules",conceptTitle:"I. Basic Concept",conceptText:`**Genre and Player Role:** New Avalon: Skirmish is a dynamic tactical card game played on a limited grid field. Players take on the roles of faction leaders, deploying Units and Commands to capture control over key battle lines.

**Explanation:** The game focuses on positional control and ability activation timing, not just direct attacks. Victory is achieved by earning Victory Points (VP), based on the strength of units in selected lines.`,winConditionTitle:"II. Victory Conditions",winConditionText:`**Match Victory Conditions:** The match is played to 2 round wins. The first player to achieve 2 round wins immediately wins the match.
**Draw Explanation:** If, at the end of any round, multiple players simultaneously reach 2 round wins, all are declared match winners.

**Round Victory Conditions (Thresholds and Turn Limit):** A round ends as soon as one or more players reach the Victory Point (VP) threshold or after completion of turn 5.
**Turn Limit:** Each round is limited to 5 full turns per player. If the VP threshold is not reached, final scoring occurs at the end of turn 5.

**Threshold Values:**
- Round 1: 20 Victory Points (VP).
- Round 2: 30 Victory Points (VP).
- Round 3 onwards: Threshold increases by +10 VP relative to previous round (e.g., Round 3  40 VP).

**Determining Round Winner and Draw:** The round winner is the player who reached the threshold value or the player with the most VPs after the turn limit.
**Round Draw Explanation:** If, at the end of the round, two or more players have the same and highest point total, all are declared round winners.`,fieldTitle:"III. Battlefield and Components",fieldText:`**Battlefield (Grid):** The game is played on a square grid whose size changes based on total participants.
**Size Explanation:**
- 2 players: 5x5 cell field.
- 3 players: 6x6 cell field.
- 4 players: 7x7 cell field.

**Position Determination:**
- **Line:** An entire horizontal row or vertical column. Used for scoring mechanics.
- **Adjacency:** Cells are considered adjacent only horizontally and vertically (orthogonally). Diagonal adjacency is not considered unless otherwise stated on a card.

**Cards:** The game uses two main card types played from Hand:
- **Units:** Basic combat units with Power and Abilities. Remain on battlefield until destroyed.
- **Commands:** Instant action cards. Played, execute effect (often offering "2 of 3 options"), and go to Discard.

**Play Zones:**
- **Hand:** Cards hidden from opponents.
- **Discard:** Zone where destroyed Units and played Commands go.
- **Showcase (Announced):** Temporary zone where a Command card is placed before being played.`,setupTitle:"IV. Game Start (Setup)",setupText:`**Deck Formation:** Before match start, each player chooses a faction or builds a deck according to building rules (minimum 30 cards).
**Explanation:** Cards in deck are shuffled.

**Starting Hand:** Each player draws 6 cards from their deck, forming the starting hand.
**Hidden Information Explanation:** Cards in hand are hidden from opponents.

**Mulligan:** At game start, after receiving starting hand (6 cards), player has the right to shuffle any number of cards from hand back into deck and draw same number of new cards from top.

**Determining First Player:** Determine first active player by any convenient method (e.g., coin toss).
**Explanation:** Play proceeds alternately, starting with first player. First player begins their first turn immediately with Setup Phase.`,abilitiesTitle:"V. Card Abilities",abilitiesText:`**Ability Types:**
- **Deploy:** Activates automatically and immediately when card is placed from hand onto field face-up.
- **Setup:** Activates automatically at start of Setup Phase of each of your turns (before drawing), if card already lies on field face-up.
- **Commit:** Activates automatically at start of Commit Phase of each of your turns, if card already lies on field face-up.
- **Pass (Passive):** Effect applies continuously while card is on field in face-up state.

**Execution Conditions ():**
Many abilities have requirement marked by arrow (e.g., **Support  Deploy:** ...).
- This means "CONDITION CHECK  EFFECT".
- If condition left of arrow (e.g., presence of Support status) is not met at activation time, ability **does not activate** at all.

**Important Rules:**
- **Stun:** Stunned cards (with Stun token) **do not activate** their abilities (neither Deploy, nor phase, nor passive).
- **Face-down:** Cards lying face-down have no abilities.
- **Obligation:** If ability activated (conditions met), you **must** apply its effect if legal targets exist. If no legal targets, ability applies fruitlessly (burns).`,statusesTitle:"VI. Dynamic Statuses (Positioning)",statusesText:`Dynamic statuses are calculated automatically and continuously upon any board change. Units with Stun status cannot give or participate in calculation of these statuses.

**Support:** Unit has Support status if in at least one adjacent cell (horizontally or vertically) there is an allied unit.
**Stun/Support Explanation:** Unit with Stun token is not considered in Support calculation for adjacent allies.
**Value:** Presence of Support is condition for activating many powerful abilities, marked by syntax Support  [Effect].

**Threat:** Unit gains Threat status if located in dangerous position created by enemy units.
**Condition Explanation:** Threat status is assigned in one of two situations:
1. **Pincers:** Unit is caught by cards of one opponent from any two sides (two adjacent or two opposite).
2. **Pressure:** Unit is on battlefield edge and has at least one opponent card adjacent.
**Stun/Threat Explanation:** Unit with Stun token is not considered in Threat calculation for adjacent enemies.
**Value:** Units under Threat are vulnerable targets for powerful control and destruction abilities.`,countersTitle:"VII. Tokens (Counters)",countersText:`Tokens are permanent markers placed by card abilities. Remain on unit until removed or unit destroyed.

**Stun:**
- **Effect:** Unit with Stun gives 0 Victory Points in scoring phase, cannot activate its abilities and cannot be moved by its owner (but can be moved by opponents).
- **Removal:** At end of Commit phase, 1 Stun token is automatically removed from each unit of active player.

**Shield:**
- **Effect:** If ability attempts to Destroy this unit, destruction effect is prevented, and 1 Shield token is removed from unit instead. Unit remains on field.

**Revealed and Face-down Cards:**
- **Revealed:** Enables token owner to see hidden card information.
- **Face-down Explanation:** Card played face-down has no Power or Abilities and gives 0 points. If such card receives Revealed token, its information (face) becomes visible to opponent, but card is still considered face-down for all game purposes (power, abilities).

**Special Tokens (Aim, Exploit):**
- **Aim and Exploit:** These tokens are markers for faction ability interaction (e.g., snipers or hackers). Have no gameplay effect by themselves.

**Last Played:**
- **Effect:** Temporary status automatically assigned to card last played onto field by active player in current turn. This status determines line player must choose for scoring.`,turnTitle:"VIII. Turn Structure and Timing",turnText:`Turn passes from player to player. Card abilities activate only in their owner's turn. Active player's turn consists of four sequential phases:

**1. Setup Phase:**
- **Draw:** Active player draws 1 card from deck into hand.
- **Abilities:** Activate abilities of all cards on field with keyword **Setup:**.
**Explanation:** This phase is for hand replenishment and initial unit positioning.

**2. Main Phase (Action/Deployment):**
- **Main Action:** Active player may perform one of following actions:
  - Play Unit card (**Deploy:**) from hand onto any free field cell. Immediately activates its Deploy: ability.
  - Play Command card from hand.
  - Pass.
**Command Explanation:** Command cards can be played in any number during this phase  before, after, or between unit deployments.

**3. Commit Phase (Finalization):**
- **Abilities:** Activate abilities of all cards on field with keyword **Commit:**.
- **Stun Removal:** At end of this phase, 1 Stun token is automatically removed from each unit of active player.
**Explanation:** Phase used for applying control effects and gaining resources before scoring.

**4. Scoring Phase:**
- **Line Selection:** Active player must choose one Line (Row or Column) passing through their card with **Last Played** status.
- **Calculation:** Sum Power of all active player's units in selected line and add total to player's overall score.`,mechanicsTitle:"IX. Conflict Resolution and Key Mechanics",mechanicsText:`**Stun and Scoring:**
- **Effect:** Unit with Stun status or lying Face-down gives 0 points in scoring phase, regardless of its base Power, permanent power modifiers, or passive abilities that give points (e.g., Spotter).

**Last Played Status Transfer:**
- **Destruction:** If card with Last Played status leaves battlefield (destroyed, returned to hand/deck) before Scoring Phase, status transfers to previous played card of this player (the one that was Last Played in previous turn).
- **Movement:** If card with Last Played moves to another cell, player chooses its new lines in Scoring Phase.
- **Absence:** If player has no card with Last Played status, player cannot choose line and gets no points this turn.

**Unit Movement (Push, Swap):**
- **Push:** Unit forces another card to move to adjacent cell. Push is blocked (does not happen) if target cell is occupied or field edge. Other ability effects apply to target.
- **Swap:** Enables two cards to exchange places, even if both cells are occupied.

**Resurrection:**
- **"Burning" Mechanic:** Card returned to battlefield from Discard (resurrected) immediately gains **Resurrected** status at moment of Deploy. At start of next phase (on phase change) this status is removed and card receives two Stun tokens.`,creditsTitle:"X. Game Authors",creditsText:`**Author:** Nikita Anahoret

**AI Used:**
Google AI Studio, Claude Code, Gemini, ChatGPT

**Special Thanks:**
- Vasilisa Versus
- Kirill Tomashchuk
- Andrey Markosov
- Mitya Shepelin

For questions and suggestions write on [Telegram](https://t.me/NeurohoretApp) or [Discord](https://discord.gg/U5zKADsZZY).
You can support game development and authors through [DonationAlerts](https://www.donationalerts.com/r/anahoret) and [Patreon](https://www.patreon.com/AnchoriteComics).`},Of={};Vg.forEach((e,t)=>{Of[t]={name:e.name,ability:e.ability,flavorText:e.flavorText}});Kg.forEach((e,t)=>{Of[t]={name:e.name,ability:e.ability,flavorText:e.flavorText}});const Xg={};Object.entries(Zr).forEach(([e,t])=>{Xg[e]={name:t.name,description:t.description}});const Yb={deploy:"Deploy",setup:"Setup",commit:"Commit",support:"Support",threat:"Threat",pass:"Pass",aim:"Aim",exploit:"Exploit",stun:"Stun",shield:"Shield",gain:"Gain",point:"Point",points:"Points",reveal:"Reveal",move:"Move",draw:"Draw",push:"Push",sacrifice:"Sacrifice",discard:"Discard"},qb={unit:"Unit",command:"Command",hero:"Hero",rarity:"Rarity",structure:"Structure",gear:"Gear",event:"Event",attachment:"Attachment"},Jb={SynchroTech:"SynchroTech",Hoods:"Hoods",Optimates:"Optimates",Fusion:"Fusion"},ir={abilityKeywords:Yb,cardTypes:qb,ui:Vb,rules:Kb,cards:Of,counters:Xg,deckNames:Jb},Xn={en:ir,ru:Hb,sr:Wb,de:ir,fr:ir,it:ir,pt:ir,zh:ir,hi:ir,es:ir,ar:ir,uk:ir,be:ir,tt:ir},Xb=["en","ru","sr"],Zb={en:"English",ru:"",de:"Deutsch",fr:"Franais",it:"Italiano",pt:"Portugus",zh:"",hi:"",es:"Espaol",ar:"",uk:"",be:"",tt:"",sr:"Srpski"},Zg=m.createContext(void 0),Qb=({children:e})=>{const[t,n]=m.useState("en");m.useEffect(()=>{const d=localStorage.getItem("app_language");d&&d in Xn&&n(d)},[]);const r=d=>{n(d),localStorage.setItem("app_language",d)},a=d=>Xn[t].ui[d]||Xn.en.ui[d]||d,o=d=>Xn[t].cards[d]||Xn.en.cards[d],s=d=>Xn[t].counters[d]||Xn.en.counters[d],l=d=>{const f=Xn[t].deckNames,h=Xn.en.deckNames;return f[d]||h[d]};return i.jsx(Zg.Provider,{value:{language:t,setLanguage:r,t:a,getCardTranslation:o,getCounterTranslation:s,getDeckTranslation:l,resources:Xn[t],isRTL:!1},children:i.jsx("div",{dir:"ltr",children:e})})},un=()=>{const e=m.useContext(Zg);if(!e)throw new Error("useLanguage must be used within a LanguageProvider");return e},Qg=({x:e,y:t,children:n})=>{const r=m.useRef(null),[a,o]=m.useState({top:t+20,left:e+20});return m.useLayoutEffect(()=>{if(r.current){const{innerWidth:s,innerHeight:l}=window,{offsetWidth:c,offsetHeight:d}=r.current;let f=e+20;f+c>s&&(f=e-c-20),f<5&&(f=5);let h=t+20;h+d>l&&(h=t-d-20),h<5&&(h=5),o({top:h,left:f})}},[e,t,n]),Nf.createPortal(i.jsx("div",{ref:r,className:"fixed bg-gray-900 border border-gray-700 rounded-md shadow-lg z-[99999] p-3 text-white text-base pointer-events-none transition-opacity duration-100",style:{top:a.top,left:a.left,opacity:1},children:n}),document.body)},Ic=({card:e,statusDescriptions:t,className:n,hideOwner:r=!1,powerPosition:a="default"})=>{var A;const{resources:o,getCardTranslation:s}=un(),l=o.abilityKeywords,c=o.cardTypes,d=e.baseId?s(e.baseId):void 0,f=(d==null?void 0:d.name)||e.name,h=(d==null?void 0:d.ability)||e.ability,v=(A=e.types)!=null&&A.length?e.types.map(M=>c[M]||M).join(", "):e.deck==="counter"?"":`${e.deck} Card`,w=["readyDeploy","readySetup","readyCommit"],_=(e.statuses??[]).reduce((M,K)=>(w.includes(K.type)||(M[K.type]=(M[K.type]||0)+1),M),{}),C=Object.keys(_).length>0,D=e.ownerName||(e.ownerId?`Player ${e.ownerId}`:null),x=e.ability?e.ability.length:0,y=C?Object.keys(_).length*10:0,k=x>35||y>35,j=n||"relative flex flex-col text-left w-max max-w-[90vw]",$=a==="inner"?{powerContainer:"absolute top-[2px] right-[2px] w-4 h-4 rounded-full bg-gray-700 border border-gray-500 flex items-center justify-center text-xs font-bold"}:null;return i.jsxs("div",{className:j,children:[i.jsxs("div",{className:"mb-1 pr-1 whitespace-nowrap relative",children:[i.jsx("div",{className:"font-bold text-white text-lg leading-tight mb-0.5",children:f}),v&&i.jsx("div",{className:"text-xs text-gray-400 font-semibold",children:v}),$&&e.power&&e.power>0&&i.jsx("div",{className:$.powerContainer,children:e.power})]}),i.jsxs("div",{className:`flex flex-col ${!n&&k?"w-[16rem]":"w-full"} whitespace-normal break-words`,children:[h&&i.jsx("hr",{className:"border-gray-600 mt-[0px] mb-[2px]"}),h&&i.jsx("div",{className:"text-sm text-gray-200 leading-snug",children:Af(h,l)}),h&&i.jsx("hr",{className:"border-gray-600 my-[4px]"}),C&&i.jsx("div",{className:"text-xs text-gray-200 leading-snug",children:Object.entries(_).map(([M,K],ee,re)=>i.jsxs("span",{children:[i.jsx("span",{className:"font-bold text-indigo-300",children:M}),K>1&&i.jsxs("span",{className:"text-gray-400 ml-1",children:["(x",K,")"]}),(t==null?void 0:t[M])&&i.jsxs("span",{className:"text-gray-400 ml-1",children:["(",t[M],")"]}),ee<re.length-1?i.jsx("span",{className:"text-gray-400 mr-1",children:", "}):""]},M))}),C&&D&&!r&&i.jsx("hr",{className:"border-gray-600 my-[2px]"}),D&&!r&&i.jsxs("div",{className:"text-xs text-gray-500 font-semibold",children:["Owner: ",i.jsx("span",{className:"text-gray-300",children:D})]})]})]})},di="readyDeploy",ui="readySetup",fi="readyCommit",ho=(e,t,n,r)=>Math.abs(e-n)+Math.abs(t-r)===1,zt=(e,t,n)=>e.statuses?e.statuses.some(r=>r.type===t&&(n===void 0||r.addedByPlayerId===n)):!1,Lo=(e,t)=>e.statuses?e.statuses.some(n=>n.type===t):!1,ex=[{baseId:"ipDeptAgent",activationType:"deploy",getAction:(e,t,n,r)=>({type:"CREATE_STACK",tokenType:"Stun",count:2,requiredTargetStatus:"Exploit",requireStatusFromSourceOwner:!0,placeAllAtOnce:!0})},{baseId:"ipDeptAgent",activationType:"commit",supportRequired:!0,getAction:(e,t,n,r)=>({type:"ENTER_MODE",mode:"SELECT_TARGET",sourceCard:e,sourceCoords:r,payload:{actionType:"DESTROY",filter:a=>zt(a,"Revealed",n),handOnly:!0}})},{baseId:"tacticalAgent",activationType:"deploy",getAction:(e,t,n,r)=>({type:"CREATE_STACK",tokenType:"Aim",count:1,requiredTargetStatus:"Threat",requireStatusFromSourceOwner:!0})},{baseId:"tacticalAgent",activationType:"setup",getAction:(e,t,n,r)=>({type:"ENTER_MODE",mode:"SELECT_TARGET",sourceCard:e,sourceCoords:r,payload:{actionType:"DESTROY",filter:a=>zt(a,"Aim",n)}})},{baseId:"patrolAgent",activationType:"setup",getAction:(e,t,n,r)=>({type:"ENTER_MODE",mode:"PATROL_MOVE",sourceCard:e,sourceCoords:r,payload:{}})},{baseId:"patrolAgent",activationType:"commit",getAction:(e,t,n,r)=>({type:"CREATE_STACK",tokenType:"Stun",count:1,requiredTargetStatus:"Threat",onlyOpponents:!0,mustBeAdjacentToSource:!0,sourceCoords:r,sourceCard:e})},{baseId:"riotAgent",activationType:"deploy",getAction:(e,t,n,r)=>({type:"ENTER_MODE",mode:"RIOT_PUSH",sourceCard:e,sourceCoords:r,payload:{}})},{baseId:"riotAgent",activationType:"commit",getAction:(e,t,n,r)=>({type:"CREATE_STACK",tokenType:"Stun",count:1,requiredTargetStatus:"Threat",onlyOpponents:!0,mustBeAdjacentToSource:!0,sourceCoords:r,sourceCard:e})},{baseId:"threatAnalyst",activationType:"deploy",getAction:(e,t,n,r)=>({type:"CREATE_STACK",tokenType:"Exploit",count:1})},{baseId:"threatAnalyst",activationType:"commit",supportRequired:!0,getAction:(e,t,n,r)=>{let a=0;return t.board.forEach(o=>{o.forEach(s=>{var l;(l=s.card)!=null&&l.statuses&&(a+=s.card.statuses.filter(c=>c.type==="Exploit"&&c.addedByPlayerId===n).length)})}),a===0?null:{type:"CREATE_STACK",tokenType:"Revealed",count:a,onlyFaceDown:!0}}},{baseId:"mrPearlDoF",activationType:"deploy",getAction:(e,t,n,r)=>({type:"OPEN_MODAL",mode:"SEARCH_DECK",sourceCard:e,payload:{filterType:"Unit",actionType:"RETRIEVE_FROM_DECK"}})},{baseId:"vigilantSpotter",activationType:"commit",getAction:(e,t,n,r)=>({type:"CREATE_STACK",tokenType:"Revealed",count:1,onlyFaceDown:!0,excludeOwnerId:n})},{baseId:"codeKeeper",activationType:"deploy",getAction:(e,t,n,r)=>({type:"GLOBAL_AUTO_APPLY",payload:{tokenType:"Exploit",filter:a=>{var o;return a.ownerId!==n&&((o=a.statuses)==null?void 0:o.some(s=>s.type==="Threat"))}},sourceCard:e,sourceCoords:r})},{baseId:"codeKeeper",activationType:"commit",supportRequired:!0,getAction:(e,t,n,r)=>({type:"ENTER_MODE",mode:"SELECT_UNIT_FOR_MOVE",sourceCard:e,sourceCoords:r,payload:{filter:a=>a.ownerId!==n&&zt(a,"Exploit",n)}})},{baseId:"centurion",activationType:"commit",getAction:(e,t,n,r)=>({type:"ENTER_MODE",mode:"SELECT_TARGET",sourceCard:e,sourceCoords:r,payload:{actionType:"SACRIFICE_AND_BUFF_LINES",filter:(a,o,s)=>{var l;return a.ownerId===n&&((l=a.types)==null?void 0:l.includes("Unit"))&&o!==void 0&&s!==void 0}}})},{baseId:"recklessProvocateur",activationType:"deploy",getAction:(e,t,n,r)=>({type:"ENTER_MODE",mode:"SWAP_POSITIONS",sourceCard:e,sourceCoords:r,payload:{filter:(a,o,s)=>ho(o,s,r.row,r.col)}})},{baseId:"recklessProvocateur",activationType:"commit",getAction:(e,t,n,r)=>({type:"ENTER_MODE",mode:"TRANSFER_ALL_STATUSES",sourceCard:e,sourceCoords:r,payload:{filter:a=>a.id===e.id?!1:a.ownerId===n}})},{baseId:"dataLiberator",activationType:"deploy",getAction:(e,t,n,r)=>({type:"CREATE_STACK",tokenType:"Exploit",count:1})},{baseId:"cautiousAvenger",activationType:"deploy",getAction:(e,t,n,r)=>({type:"CREATE_STACK",tokenType:"Aim",count:1,sourceCoords:r,maxOrthogonalDistance:2,sourceCard:e})},{baseId:"cautiousAvenger",activationType:"setup",supportRequired:!0,getAction:(e,t,n,r)=>({type:"ENTER_MODE",mode:"SELECT_TARGET",sourceCard:e,sourceCoords:r,payload:{actionType:"DESTROY",filter:a=>zt(a,"Aim",n)}})},{baseId:"inventiveMaker",activationType:"deploy",getAction:(e,t,n,r)=>({type:"ENTER_MODE",mode:"SPAWN_TOKEN",sourceCard:e,sourceCoords:r,payload:{tokenName:"Recon Drone"}})},{baseId:"inventiveMaker",activationType:"setup",supportRequired:!0,getAction:(e,t,n,r)=>({type:"OPEN_MODAL",mode:"RETRIEVE_DEVICE",sourceCard:e,sourceCoords:r,payload:{}})},{baseId:"faber",activationType:"deploy",getAction:(e,t,n,r)=>({type:"ENTER_MODE",mode:"SELECT_TARGET",sourceCard:e,sourceCoords:r,originalOwnerId:n,payload:{actionType:"SELECT_HAND_FOR_DISCARD_THEN_SPAWN",tokenName:"Walking Turret",filter:a=>a.ownerId===n}})},{baseId:"censor",activationType:"deploy",getAction:(e,t,n,r)=>({type:"CREATE_STACK",tokenType:"Exploit",count:1})},{baseId:"censor",activationType:"commit",supportRequired:!0,getAction:(e,t,n,r)=>({type:"CREATE_STACK",tokenType:"Stun",count:1,requiredTargetStatus:"Exploit",requireStatusFromSourceOwner:!0,sourceCoords:r,sourceCard:e,replaceStatus:!0})},{baseId:"princeps",activationType:"deploy",getAction:(e,t,n,r)=>({type:"ENTER_MODE",mode:"PRINCEPS_SHIELD_THEN_AIM",sourceCard:e,sourceCoords:r,payload:{}})},{baseId:"princeps",activationType:"setup",getAction:(e,t,n,r)=>({type:"ENTER_MODE",mode:"SELECT_TARGET",sourceCard:e,sourceCoords:r,payload:{actionType:"DESTROY",filter:a=>zt(a,"Aim",n)}})},{baseId:"immunis",activationType:"deploy",supportRequired:!0,getAction:(e,t,n,r)=>zt(e,"Support",n)?{type:"OPEN_MODAL",mode:"IMMUNIS_RETRIEVE",sourceCard:e,sourceCoords:r,payload:{filter:(a,o)=>ho(a,o,r.row,r.col)}}:null},{baseId:"devoutSynthetic",activationType:"deploy",getAction:(e,t,n,r)=>({type:"ENTER_MODE",mode:"RIOT_PUSH",sourceCard:e,sourceCoords:r,payload:{}})},{baseId:"devoutSynthetic",activationType:"setup",getAction:(e,t,n,r)=>({type:"ENTER_MODE",mode:"SELECT_TARGET",sourceCard:e,sourceCoords:r,payload:{actionType:"DESTROY",filter:(a,o,s)=>ho(o,s,r.row,r.col)&&a.ownerId!==n&&(zt(a,"Threat",n)||zt(a,"Stun",n))}})},{baseId:"unwaveringIntegrator",activationType:"deploy",getAction:(e,t,n,r)=>({type:"CREATE_STACK",tokenType:"Exploit",count:1})},{baseId:"unwaveringIntegrator",activationType:"setup",supportRequired:!0,getAction:(e,t,n,r)=>({type:"ENTER_MODE",mode:"INTEGRATOR_LINE_SELECT",sourceCard:e,sourceCoords:r,payload:{}})},{baseId:"signalProphet",activationType:"deploy",getAction:(e,t,n,r)=>({type:"GLOBAL_AUTO_APPLY",payload:{tokenType:"Exploit",filter:a=>a.ownerId===n&&zt(a,"Support",n)},sourceCard:e,sourceCoords:r})},{baseId:"signalProphet",activationType:"commit",supportRequired:!0,getAction:(e,t,n,r)=>({type:"ENTER_MODE",mode:"SELECT_UNIT_FOR_MOVE",sourceCard:e,sourceCoords:r,payload:{filter:a=>a.ownerId===n&&zt(a,"Exploit",n)}})},{baseId:"zealousMissionary",activationType:"deploy",getAction:(e,t,n,r)=>({type:"CREATE_STACK",tokenType:"Exploit",count:1})},{baseId:"zealousMissionary",activationType:"commit",supportRequired:!0,getAction:(e,t,n,r)=>({type:"ENTER_MODE",mode:"ZEALOUS_WEAKEN",sourceCard:e,sourceCoords:r,payload:{filter:a=>zt(a,"Exploit",n)}})},{baseId:"walkingTurret",activationType:"deploy",getAction:(e,t,n,r)=>({type:"CREATE_STACK",tokenType:"Aim",count:1,mustBeInLineWithSource:!0,sourceCoords:r,sourceCard:e})},{baseId:"walkingTurret",activationType:"setup",getAction:(e,t,n,r)=>({type:"ENTER_MODE",mode:"SELECT_TARGET",sourceCard:e,sourceCoords:r,payload:{actionType:"MODIFY_POWER",amount:-1,filter:a=>zt(a,"Aim",n)}})},{baseId:"reconDrone",activationType:"setup",getAction:(e,t,n,r)=>({type:"ENTER_MODE",mode:"SELECT_CELL",sourceCard:e,sourceCoords:r,payload:{allowSelf:!1,range:"global"}})},{baseId:"reconDrone",activationType:"commit",getAction:(e,t,n,r)=>({type:"ENTER_MODE",mode:"REVEAL_ENEMY",sourceCard:e,sourceCoords:r,payload:{filter:(a,o,s)=>ho(o,s,r.row,r.col)&&a.ownerId!==n}})},{baseId:"abrGawain",baseIdAlt:["autonomousBattleRobot"],activationType:"deploy",getAction:(e,t,n,r)=>({type:"ENTER_MODE",mode:"GAWAIN_DEPLOY_SHIELD_AIM",sourceCard:e,sourceCoords:r,payload:{}})},{baseId:"abrGawain",baseIdAlt:["autonomousBattleRobot"],activationType:"setup",getAction:(e,t,n,r)=>({type:"ENTER_MODE",mode:"SELECT_TARGET",sourceCard:e,sourceCoords:r,payload:{actionType:"DESTROY",filter:a=>zt(a,"Aim",n)}})},{baseId:"reclaimedGawain",activationType:"deploy",getAction:(e,t,n,r)=>({type:"ENTER_MODE",mode:"SHIELD_SELF_THEN_RIOT_PUSH",sourceCard:e,sourceCoords:r,payload:{}})},{baseId:"reclaimedGawain",activationType:"setup",getAction:(e,t,n,r)=>({type:"ENTER_MODE",mode:"SELECT_TARGET",sourceCard:e,sourceCoords:r,payload:{actionType:"DESTROY",filter:(a,o,s)=>ho(o,s,r.row,r.col)&&a.ownerId!==n&&(zt(a,"Threat",n)||zt(a,"Stun",n))}})},{baseId:"FalkPD",activationType:"deploy",getAction:(e,t,n,r)=>({type:"OPEN_MODAL",mode:"SEARCH_DECK",sourceCard:e,payload:{filterType:"Any"}})},{baseId:"FalkPD",activationType:"commit",getAction:(e,t,n,r)=>({type:"CREATE_STACK",tokenType:"Revealed",count:1,onlyFaceDown:!0,excludeOwnerId:n})},{baseId:"edithByron",activationType:"deploy",getAction:(e,t,n,r)=>({type:"ENTER_MODE",mode:"SHIELD_SELF_THEN_SPAWN",sourceCard:e,sourceCoords:r,payload:{tokenName:"Recon Drone"}})},{baseId:"edithByron",activationType:"setup",getAction:(e,t,n,r)=>({type:"ENTER_MODE",mode:"PATROL_MOVE",sourceCard:e,sourceCoords:r,payload:{}})},{baseId:"pinkunonekoSV",activationType:"deploy",getAction:(e,t,n,r)=>({type:"CREATE_STACK",tokenType:"Stun",count:1,onlyOpponents:!0,mustBeAdjacentToSource:!0,sourceCoords:r,sourceCard:e})},{baseId:"pinkunonekoSV",activationType:"setup",getAction:(e,t,n,r)=>({type:"ENTER_MODE",mode:"SELECT_TARGET",sourceCard:e,sourceCoords:r,payload:{actionType:"DESTROY",filter:(a,o,s)=>ho(o,s,r.row,r.col)&&(zt(a,"Threat",n)||zt(a,"Stun",n)),chainedAction:{type:"ENTER_MODE",mode:"SELECT_CELL",payload:{range:1,allowSelf:!0}}}})},{baseId:"EleftheriaMD",activationType:"deploy",getAction:(e,t,n,r)=>({type:"CREATE_STACK",tokenType:"Aim",count:1})},{baseId:"EleftheriaMD",activationType:"setup",getAction:(e,t,n,r)=>({type:"ENTER_MODE",mode:"SELECT_TARGET",sourceCard:e,sourceCoords:r,payload:{actionType:"DESTROY",filter:a=>zt(a,"Aim",n)}})},{baseId:"ziusIJ",activationType:"deploy",getAction:(e,t,n,r)=>({type:"CREATE_STACK",tokenType:"Exploit",count:1})},{baseId:"ziusIJ",activationType:"setup",supportRequired:!0,getAction:(e,t,n,r)=>({type:"CREATE_STACK",tokenType:"Exploit",count:1,sourceCard:e,sourceCoords:r,recordContext:!0,chainedAction:{type:"ENTER_MODE",mode:"ZIUS_LINE_SELECT",sourceCard:e,sourceCoords:r,payload:{actionType:"ZIUS_SCORING"}}})},{baseId:"secretInformant",activationType:"deploy",getAction:(e,t,n,r)=>({type:"ENTER_MODE",mode:"SELECT_DECK",sourceCard:e,sourceCoords:r,payload:{}})},{baseId:"reverendOfTheChoir",activationType:"setup",getAction:(e,t,n,r)=>({type:"REVEREND_SETUP_SCORE",sourceCard:e,sourceCoords:r,ownerId:n})},{baseId:"reverendOfTheChoir",activationType:"deploy",getAction:(e,t,n,r)=>({type:"ENTER_MODE",mode:"REVEREND_DOUBLE_EXPLOIT",sourceCard:e,sourceCoords:r,payload:{}})},{baseId:"luciusTheImmortal",activationType:"setup",getAction:(e,t,n,r)=>({type:"ENTER_MODE",mode:"SELECT_TARGET",sourceCard:e,sourceCoords:r,payload:{actionType:"LUCIUS_SETUP",filter:a=>a.ownerId===n}})},{baseId:"finnMW",baseIdAlt:["finnSD"],activationType:"setup",getAction:(e,t,n,r)=>({type:"ENTER_MODE",mode:"SELECT_UNIT_FOR_MOVE",sourceCard:e,sourceCoords:r,payload:{filter:a=>a.ownerId===n,range:2}})},{baseId:"finnMW",baseIdAlt:["finnSD"],activationType:"commit",getAction:(e,t,n,r)=>({type:"GLOBAL_AUTO_APPLY",payload:{customAction:"FINN_SCORING"},sourceCard:e,sourceCoords:r})}],Lf=e=>{const t=e.baseId||"";return ex.filter(n=>{var r;return n.baseId===t||((r=n.baseIdAlt)==null?void 0:r.includes(t))})},tx=e=>{const n=Lf(e).map(r=>r.activationType);return[...new Set(n)]},Iu=(e,t,n,r)=>{var s;if(n!==e.ownerId)return!1;if(r&&e.ownerId!==void 0){const l=r.players.find(c=>c.id===e.ownerId);if(l!=null&&l.isDummy&&r.activePlayerId!==e.ownerId)return!1}if((s=e.statuses)!=null&&s.some(l=>l.type==="Stun"))return!1;const a=Lf(e),o=t===1&&a.some(l=>l.activationType==="setup")||t===3&&a.some(l=>l.activationType==="commit");if(t===1){const l=a.find(c=>c.activationType==="setup");if(l&&Lo(e,ui))return!(l.supportRequired&&!zt(e,"Support",n))}if(t===3){const l=a.find(c=>c.activationType==="commit");if(l&&Lo(e,fi))return!(l.supportRequired&&!zt(e,"Support",n))}if(!o){const l=a.find(c=>c.activationType==="deploy");if(l&&Lo(e,di))return!(l.supportRequired&&!zt(e,"Support",n))}return!1},nx=(e,t,n,r)=>{if(n!==e.ownerId)if(e.ownerId!==void 0){const c=t.players.find(d=>d.id===e.ownerId);if(!(c!=null&&c.isDummy))return null}else return null;const a=Lf(e),o=e.ownerId??n??0,s=t.currentPhase,l=s===1&&a.some(c=>c.activationType==="setup")||s===3&&a.some(c=>c.activationType==="commit");if(s===1){const c=a.find(d=>d.activationType==="setup");if(c&&Lo(e,ui)){if(c.supportRequired&&!zt(e,"Support",o))return null;const d=c.getAction(e,t,o,r);if(d)return{...d,readyStatusToRemove:ui}}}if(s===3){const c=a.find(d=>d.activationType==="commit");if(c&&Lo(e,fi)){if(c.supportRequired&&!zt(e,"Support",o))return null;const d=c.getAction(e,t,o,r);if(d)return{...d,readyStatusToRemove:fi}}}if(!l){const c=a.find(d=>d.activationType==="deploy");if(c&&Lo(e,di)){if(c.supportRequired&&!zt(e,"Support",o))return null;const d=c.getAction(e,t,o,r);if(d)return{...d,isDeployAbility:!0,readyStatusToRemove:di}}}return null},Mf=(e,t,n)=>{let r,a;return typeof t=="object"?(r=t.currentPhase,n=t.activePlayerId??void 0,a=t):r=t,Iu(e,r,n??void 0,a)},hd=(e,t)=>{e.statuses||(e.statuses=[]);const n=e.statuses.length,r=e.statuses.map(o=>o.type),a=tx(e);console.log(`[initializeReadyStatuses] Card: ${e.name} (${e.id}), ownerId: ${t}, abilities: [${a.join(", ")}]`);for(const o of a){let s="";o==="deploy"?s=di:o==="setup"?s=ui:o==="commit"&&(s=fi),s&&!e.statuses.some(l=>l.type===s)&&(e.statuses.push({type:s,addedByPlayerId:t}),console.log(`[initializeReadyStatuses] Added status: ${s} to ${e.name}`))}e.statuses.length!==n&&console.log(`[initializeReadyStatuses] Card ${e.name}: statuses changed from [${r.join(", ")}] to [${e.statuses.map(o=>o.type).join(", ")}]`)},md=e=>{e.statuses&&(e.statuses=e.statuses.filter(t=>t.type!==di&&t.type!==ui&&t.type!==fi))},gd=m.memo(({type:e,playerId:t,count:n,refreshVersion:r,playerColorMap:a,smallStatusIcons:o=!1})=>{const s=a.get(t),l=s&&Kn[s]?Kn[s].bg:"bg-gray-500",c=m.useMemo(()=>{let C=Vo[e];if(C){const D=C.includes("?")?"&":"?";C=`${C}${D}v=${r}`}return C},[e,r]),d=["Support","Threat","Revealed","LastPlayed"].includes(e),f=!d&&n>1,h=f?"p-1.5":"p-1",v=o?"w-6 h-6":"w-8 h-8",w=o?f?"text-xs":"text-base":f?"text-base":"text-lg",_=o?"text-[10px]":"text-xs";return i.jsxs("div",{className:`relative ${v} flex items-center justify-center ${l} bg-opacity-80 rounded-sm shadow-md flex-shrink-0`,title:`${e} (Player ${t}) ${!d&&n>0?`x${n}`:""}`,children:[c?i.jsx("img",{src:c,alt:e,className:`object-contain w-full h-full transition-all duration-150 ${h}`}):i.jsx("span",{className:`text-white font-black transition-all duration-150 ${w}`,style:{textShadow:"0 0 2px black"},children:e.charAt(0)}),f&&i.jsx("span",{className:`absolute top-0 right-0.5 text-white font-bold ${_} leading-none`,style:{textShadow:"1px 1px 2px black"},children:n})]})}),rx=m.memo(({card:e,isFaceUp:t,playerColorMap:n,localPlayerId:r,imageRefreshVersion:a,disableTooltip:o=!1,smallStatusIcons:s=!1,activePhaseIndex:l,activePlayerId:c,disableActiveHighlights:d=!1,extraPowerSpacing:f=!1,hidePower:h=!1,preserveDeployAbilities:v=!1,activeAbilitySourceCoords:w=null,boardCoords:_=null,abilityCheckKey:C,onCardClick:D,targetingMode:x=!1})=>{var U;const{getCardTranslation:y}=un(),[k,j]=m.useState(!1),[$,A]=m.useState({x:0,y:0}),M=m.useRef(null),[K,ee]=m.useState(!1),[re,Ie]=m.useState(!1),B=e.baseId?y(e.baseId):void 0,fe=B?{...e,...B}:e;m.useEffect(()=>{Ie(!1)},[l,C]),m.useEffect(()=>{d||Ie(!1)},[d]);const[he,ke]=m.useState(()=>{let te=e.imageUrl;if(a&&te){const Te=te.includes("?")?"&":"?";te=`${te}${Te}v=${a}`}return te});m.useEffect(()=>{let te=e.imageUrl;if(a&&te){const Te=te.includes("?")?"&":"?";te=`${te}${Te}v=${a}`}ke(te)},[e.imageUrl,a]);const ie=()=>{let te=e.fallbackImage;if(a&&te){const Te=te.includes("?")?"&":"?";te=`${te}${Te}v=${a}`}he!==te&&ke(te)},ae=(U=e.types)==null?void 0:U.includes("Hero");m.useEffect(()=>{if(!ae||!t){ee(!1);return}let te,Te;const ve=()=>{const O=3e3+Math.random()*500;te=window.setTimeout(()=>{ee(!0),Te=window.setTimeout(()=>{ee(!1),ve()},750)},O)};return ve(),()=>{te!==void 0&&window.clearTimeout(te),Te!==void 0&&window.clearTimeout(Te)}},[ae,t]);const J=m.useCallback(te=>{o||((te.clientX!==0||te.clientY!==0)&&A({x:te.clientX,y:te.clientY}),!k&&!M.current&&(M.current=window.setTimeout(()=>{j(!0)},250)))},[o,k]),q=m.useCallback(te=>{o||((te.clientX!==0||te.clientY!==0)&&A({x:te.clientX,y:te.clientY}),M.current&&clearTimeout(M.current),M.current=window.setTimeout(()=>{j(!0)},250))},[o]),H=m.useCallback(()=>{M.current&&(clearTimeout(M.current),M.current=null),j(!1)},[]),ne=m.useCallback(()=>{M.current&&(clearTimeout(M.current),M.current=null),j(!1)},[]),de=Mf(e,l??0,c),xe=_&&w&&_.row===w.row&&_.col===w.col,Z=!d&&!re&&de&&!xe&&!x,Oe=m.useCallback(te=>{(D||Z)&&te.stopPropagation(),Z&&r===e.ownerId&&Ie(!0),D&&_&&D(e,_)},[Z,r,e,D,_]),Re=m.useMemo(()=>{const te=["readyDeploy","readySetup","readyCommit"];return(e.statuses??[]).reduce((Te,ve)=>{if(te.includes(ve.type))return Te;const O=`${ve.type}_${ve.addedByPlayerId}`;return Te[O]||(Te[O]={type:ve.type,playerId:ve.addedByPlayerId,count:0}),Te[O].count++,Te},{})},[e.statuses]),Ce=m.useMemo(()=>{const te=e.ownerId?n.get(e.ownerId):null;return te&&Kn[te]?Kn[te]:null},[e.ownerId,n]),Le=m.useMemo(()=>Object.values(Re).sort((te,Te)=>te.type!==Te.type?te.type.localeCompare(Te.type):te.playerId-Te.playerId),[Re]),{currentPower:We,powerTextColor:V}=m.useMemo(()=>{const te=(e.powerModifier||0)+(e.bonusPower||0),Te=Math.max(0,e.power+te);let ve="text-white";return te>0?ve="text-green-400":te<0&&(ve="text-red-500"),{currentPower:Te,powerTextColor:ve}},[e.power,e.powerModifier,e.bonusPower]),Ke=m.useMemo(()=>k&&t&&!o&&$.x>0&&$.y>0,[k,t,o,$.x,$.y]);if(e.deck==="counter")return i.jsx("div",{title:fe.name,className:`w-full h-full ${e.color} shadow-md`,style:{clipPath:"polygon(30% 0%, 70% 0%, 100% 30%, 100% 70%, 70% 100%, 30% 100%, 0% 70%, 0% 30%)"}});const E=f?"bottom-[10px] right-[10px]":"bottom-[5px] right-[5px]";return i.jsxs(i.Fragment,{children:[t?(()=>{var Y;const te=Ce?Ce.border:((Y=Eu[e.deck])==null?void 0:Y.color)||"border-gray-300",Te=e.deck===it.Tokens?e.color:"bg-card-face",ve=(e.deck===it.Tokens,"text-black"),O=["Support","Shield"],et=Le.filter(X=>O.includes(X.type)),ue=Le.filter(X=>!O.includes(X.type)&&X.type!=="LastPlayed"),we=Le.find(X=>X.type==="LastPlayed"),pt=we?[we,...et]:et,Nt=Ce?Ce.glow:"shadow-[0_0_15px_#ffffff]",Wt=Z?`border-[5px] shadow-2xl ${Nt}`:"border-4",ht=e.ownerId?n.get(e.ownerId):null,Fe=ht?rc[ht]||{r:255,g:255,b:255}:null,se=Fe?{r:Math.min(255,Math.round(Fe.r*1.3)),g:Math.min(255,Math.round(Fe.g*1.3)),b:Math.min(255,Math.round(Fe.b*1.3))}:null,Q=Z&&Fe?{background:`radial-gradient(circle at center, transparent 20%, rgba(${Fe.r}, ${Fe.g}, ${Fe.b}, 0.5) 100%)`,boxShadow:se?`inset 0 0 12px rgba(${se.r}, ${se.g}, ${se.b}, 0.5)`:void 0,border:"5px solid",borderColor:"rgb(255, 255, 255)"}:{},me=Z&&Fe?i.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{background:`radial-gradient(circle at center, transparent 37.5%, rgba(${Fe.r}, ${Fe.g}, ${Fe.b}, 0.5) 100%)`,mixBlendMode:"normal",filter:"brightness(1.35)"}}):null;return i.jsxs("div",{onMouseEnter:q,onMouseLeave:H,onMouseMove:J,onMouseDown:ne,onClick:Oe,style:Q,className:`relative w-full h-full ${Te} rounded-md shadow-md ${Wt} ${te} ${ve} flex-shrink-0 select-none overflow-hidden transition-all duration-300 ${Z?"scale-[1.10] z-10":""}`,children:[he?i.jsxs(i.Fragment,{children:[i.jsx("img",{src:he,onError:ie,alt:fe.name,className:"absolute inset-0 w-full h-full object-cover"}),me,ae&&i.jsx("div",{className:`absolute inset-0 hero-foil-overlay ${K?"animating":""}`})]}):i.jsx("div",{className:"w-full h-full p-1 flex items-center justify-center",children:i.jsx("span",{className:"text-center text-sm font-bold",children:fe.name})}),Le.length>0&&i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"absolute top-[3px] left-[3px] right-[3px] flex flex-row-reverse flex-wrap justify-start items-start z-10 pointer-events-none",children:ue.map(X=>i.jsx(gd,{type:X.type,playerId:X.playerId,count:X.count,refreshVersion:a,playerColorMap:n,smallStatusIcons:s},`${X.type}_${X.playerId}`))}),i.jsx("div",{className:"absolute bottom-[3px] left-[3px] right-[30px] flex flex-wrap-reverse content-start items-end z-10 pointer-events-none",children:pt.map(X=>i.jsx(gd,{type:X.type,playerId:X.playerId,count:X.count,refreshVersion:a,playerColorMap:n,smallStatusIcons:s},`${X.type}_${X.playerId}`))})]}),e.power>0&&!h&&i.jsx("div",{className:`absolute ${E} w-8 h-8 rounded-full ${Ce?Ce.bg:"bg-gray-600"} border-[3px] border-white flex items-center justify-center z-20 shadow-md`,children:i.jsx("span",{className:`${V} font-bold text-lg leading-none`,style:{textShadow:"0 0 2px black"},children:We})})]})})():(()=>{const te=Ce?Ce.bg:"bg-card-back",Te=Ce?Ce.border:"border-blue-300",ve=Le.find(O=>O.type==="LastPlayed");return i.jsx("div",{onMouseEnter:q,onMouseLeave:H,onMouseMove:J,onMouseDown:ne,className:`relative w-full h-full ${te} rounded-md shadow-md border-2 ${Te} flex-shrink-0 transition-transform duration-300 ${Z?"scale-[1.10] z-10":""}`,children:ve&&i.jsx("div",{className:"absolute bottom-[3px] left-[3px] pointer-events-none",children:i.jsx(gd,{type:ve.type,playerId:ve.playerId,count:ve.count,refreshVersion:a,playerColorMap:n,smallStatusIcons:s})})})})(),Ke&&i.jsx(Qg,{x:$.x,y:$.y,children:i.jsx(Ic,{card:fe})})]})}),ax=(e,t)=>{var s,l,c,d,f,h,v,w;if(e.card.id!==t.card.id||e.isFaceUp!==t.isFaceUp||e.card.imageUrl!==t.card.imageUrl||e.card.fallbackImage!==t.card.fallbackImage||e.card.name!==t.card.name||e.card.deck!==t.card.deck||e.card.color!==t.card.color||e.card.baseId!==t.card.baseId)return!1;const n=e.card.types||[],r=t.card.types||[];if(n.length!==r.length)return!1;for(let _=0;_<n.length;_++)if(n[_]!==r[_])return!1;if(e.imageRefreshVersion!==t.imageRefreshVersion||e.smallStatusIcons!==t.smallStatusIcons||e.extraPowerSpacing!==t.extraPowerSpacing||e.hidePower!==t.hidePower||e.disableTooltip!==t.disableTooltip||e.disableActiveHighlights!==t.disableActiveHighlights||e.preserveDeployAbilities!==t.preserveDeployAbilities||e.activePhaseIndex!==t.activePhaseIndex||e.activePlayerId!==t.activePlayerId||e.localPlayerId!==t.localPlayerId||((s=e.activeAbilitySourceCoords)==null?void 0:s.row)!==((l=t.activeAbilitySourceCoords)==null?void 0:l.row)||((c=e.activeAbilitySourceCoords)==null?void 0:c.col)!==((d=t.activeAbilitySourceCoords)==null?void 0:d.col)||((f=e.boardCoords)==null?void 0:f.row)!==((h=t.boardCoords)==null?void 0:h.row)||((v=e.boardCoords)==null?void 0:v.col)!==((w=t.boardCoords)==null?void 0:w.col)||e.abilityCheckKey!==t.abilityCheckKey||e.targetingMode!==t.targetingMode)return!1;const a=e.card.statuses||[],o=t.card.statuses||[];if(a.length!==o.length)return!1;for(let _=0;_<a.length;_++){const C=a[_],D=o[_];if(!D||C.type!==D.type||C.addedByPlayerId!==D.addedByPlayerId)return!1}return!(e.card.power!==t.card.power||e.card.powerModifier!==t.card.powerModifier||e.card.bonusPower!==t.card.bonusPower||e.card.ownerId!==t.card.ownerId||e.card.ownerId&&t.card.ownerId&&e.playerColorMap.get(e.card.ownerId)!==t.playerColorMap.get(t.card.ownerId))},Bn=m.memo(rx,ax);function Ct(e){const t=e,n=t==null?void 0:t.targetingMode;n&&delete t.targetingMode;let r;return typeof structuredClone<"u"?r=structuredClone(e):r=JSON.parse(JSON.stringify(e)),n&&(r.targetingMode=n,t.targetingMode=n),r}const nt={MODE_CLEAR_DELAY:100,TOOLTIP_DELAY:250,RECONNECT_DELAY:3e3,DECK_SYNC_DELAY:500,FLOATING_TEXT_DURATION:1e4,INACTIVITY_TIMEOUT:3e5,GAME_CLEANUP_DELAY:3e4,PLAYER_DUMMY_DELAY:12e4,NO_TARGET_DURATION:2e3,HIGHLIGHT_DURATION:1e3,COPY_SUCCESS_DURATION:1500,LINK_COPY_SUCCESS_DURATION:2e3,DRAG_END_FALLBACK:500,DEBOUNCE_SHORT:100};function ks(e){return{r:Math.min(255,Math.round(e.r*1.3)),g:Math.min(255,Math.round(e.g*1.3)),b:Math.min(255,Math.round(e.b*1.3))}}function Ar(e,t){return`rgba(${e.r}, ${e.g}, ${e.b}, ${t})`}function mo(e,t){return e?rc[e]:t}const ey=m.memo(({row:e,col:t,cell:n,isGameStarted:r,handleDrop:a,draggedItem:o,setDraggedItem:s,openContextMenu:l,playMode:c,setPlayMode:d,playerColorMap:f,localPlayerId:h,onCardDoubleClick:v,onEmptyCellDoubleClick:w,imageRefreshVersion:_,cursorStack:C,currentPhase:D,activePlayerId:x,onCardClick:y,onEmptyCellClick:k,isValidTarget:j,isTargetingModeValidTarget:$,targetingModePlayerId:A,targetingModeOriginalOwnerId:M,showNoTarget:K,disableActiveHighlights:ee,preserveDeployAbilities:re,abilitySourceCoords:Ie,abilityCheckKey:B})=>{const[fe,he]=m.useState(!1),ke=m.useCallback(O=>{O.preventDefault(),o&&a(o,{target:"board",boardCoords:{row:e,col:t}}),he(!1)},[o,a,e,t]),ie=m.useCallback(()=>{if(c){const O={...c.sourceItem,card:{...c.sourceItem.card}};O.card.isFaceDown=!!c.faceDown,a(O,{target:"board",boardCoords:{row:e,col:t}}),d(null)}else n.card&&y?y(n.card,{row:e,col:t}):!n.card&&k&&k({row:e,col:t})},[c,n.card,y,k,a,d,e,t]),ae=m.useCallback(O=>{O.preventDefault();const et=(o==null?void 0:o.source)==="counter_panel";(!n.card||n.card&&et)&&he(!0)},[o,n.card]),J=m.useCallback(()=>{he(!1)},[]),q=m.useCallback(O=>{n.card||l(O,"emptyBoardCell",{boardCoords:{row:e,col:t}})},[n.card,l,e,t]),H=m.useCallback(()=>{n.card||w({row:e,col:t})},[n.card,w,e,t]),ne=m.useCallback(()=>{C||n.card&&s({card:n.card,source:"board",boardCoords:{row:e,col:t},isManual:!0,bypassOwnershipCheck:!0})},[n.card,s,e,t,C]),de=m.useCallback(O=>{n.card&&l(O,"boardItem",{card:n.card,boardCoords:{row:e,col:t}})},[n.card,l,e,t]),xe=m.useCallback(O=>{O.stopPropagation(),!C&&n.card?v(n.card,{row:e,col:t}):ie()},[C,n.card,v,ie,e,t]),Z=!!c,Oe=!!C,Re=!!n.card,Ce="w-full h-full rounded-lg transition-colors duration-200 flex items-center justify-center relative",Le=!!o&&(!Re||Re&&o.source==="counter_panel"),Ke=j||Z&&!Re||Oe&&j,E=n.card&&Mf(n.card,D??0,x),U=j||E,Te=`bg-board-cell-active ${fe&&Le?"bg-indigo-400 opacity-80":""} ${Z&&Re?"cursor-not-allowed":""} ${Ke?"cursor-pointer z-10":""}`,ve=m.useMemo(()=>{var pt;const O=n.card;if(!O)return!1;const et=O.revealedTo==="all",ue=h!==null&&Array.isArray(O.revealedTo)&&O.revealedTo.includes(h),we=h!==null&&((pt=O.statuses)==null?void 0:pt.some(Nt=>Nt.type==="Revealed"&&Nt.addedByPlayerId===h));return!O.isFaceDown||et||ue||we||!1},[n.card,h]);return i.jsxs("div",{onDrop:ke,onDragOver:ae,onDragLeave:J,onClick:ie,onContextMenu:q,onDoubleClick:H,className:`${Ce} ${Te}`,"data-interactive":!n.card,"data-board-coords":`${e},${t}`,children:[K&&i.jsx("div",{className:"absolute inset-0 z-50 flex items-center justify-center pointer-events-none",children:i.jsx("img",{src:"https://res.cloudinary.com/dxxh6meej/image/upload/v1763978163/no_tarket_mic5sm.png",alt:"No Target",className:"w-24 h-24 object-contain animate-fade-out drop-shadow-[0_0_5px_rgba(255,0,0,0.8)]"})}),$&&(A||M)&&(()=>{const O=M??A,et=O!==void 0?f.get(O):void 0,ue=et&&rc[et]?rc[et]:{r:37,g:99,b:235},we=ks(ue);return i.jsx("div",{className:"absolute inset-0 rounded-md pointer-events-none animate-glow-pulse",style:{zIndex:50,boxShadow:`0 0 12px 2px ${Ar(we,.5)}`,border:"3px solid",borderColor:"rgb(255, 255, 255)",background:`radial-gradient(circle at center, transparent 20%, ${Ar(ue,.5)} 100%)`}},`targeting-mode-${O}`)})(),n.card&&i.jsx("div",{draggable:r&&!C,onDragStart:ne,onDragEnd:()=>{setTimeout(()=>s(null),nt.DRAG_END_FALLBACK)},onContextMenu:de,onDoubleClick:xe,className:`w-full h-full ${r&&!C?"cursor-grab":"cursor-default"} relative ${U?"z-40":"z-30"}`,"data-interactive":"true",children:i.jsx(Bn,{card:n.card,isFaceUp:ve,playerColorMap:f,localPlayerId:h,imageRefreshVersion:_,activePhaseIndex:D,activePlayerId:x,disableActiveHighlights:ee,preserveDeployAbilities:re,activeAbilitySourceCoords:Ie,boardCoords:{row:e,col:t},abilityCheckKey:B,onCardClick:y,targetingMode:!!A})},n.card.id)]})});ey.displayName="GridCell";const oh={4:"grid-cols-4 grid-rows-4",5:"grid-cols-5 grid-rows-5",6:"grid-cols-6 grid-rows-6",7:"grid-cols-7 grid-rows-7"},ty=m.memo(({textData:e,playerColorMap:t})=>{const n=m.useMemo(()=>{const r=t.get(e.playerId);return r&&ah[r]?ah[r]:"text-white"},[t,e.playerId]);return i.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none z-[60] animate-float-up",children:i.jsx("span",{className:`text-4xl font-black ${n}`,style:{textShadow:"2px 2px 0 #000"},children:e.text})})});ty.displayName="FloatingTextOverlay";const ny=m.memo(({board:e,isGameStarted:t,activeGridSize:n,handleDrop:r,draggedItem:a,setDraggedItem:o,openContextMenu:s,playMode:l,setPlayMode:c,highlight:d,playerColorMap:f,localPlayerId:h,onCardDoubleClick:v,onEmptyCellDoubleClick:w,imageRefreshVersion:_,cursorStack:C,currentPhase:D,activePlayerId:x,onCardClick:y,onEmptyCellClick:k,validTargets:j,noTargetOverlay:$,disableActiveHighlights:A,preserveDeployAbilities:M=!1,activeFloatingTexts:K,abilitySourceCoords:ee=null,abilityCheckKey:re,targetingMode:Ie,targetSelectionEffects:B})=>{const fe=m.useMemo(()=>{const ie=e.length,ae=Math.floor((ie-n)/2);return e.slice(ae,ae+n).map(J=>J.slice(ae,ae+n))},[e,n]),he=m.useMemo(()=>{if(!d)return null;const{type:ie,row:ae,col:J,playerId:q}=d,H=f.get(q),de=`outline outline-[8px] ${H&&Kn[H]?Kn[H].outline:"outline-yellow-400"} rounded-lg`,xe=e.length,Z=Math.floor((xe-n)/2);if(ie==="row"&&ae!==void 0&&ae>=Z&&ae<Z+n){const Oe=ae-Z+1;return i.jsx("div",{className:de,style:{gridArea:`${Oe} / 1 / ${Oe+1} / ${n+1}`}})}if(ie==="col"&&J!==void 0&&J>=Z&&J<Z+n){const Oe=J-Z+1;return i.jsx("div",{className:de,style:{gridArea:`1 / ${Oe} / ${n+1} / ${Oe+1}`}})}if(ie==="cell"&&ae!==void 0&&J!==void 0&&ae>=Z&&ae<Z+n&&J>=Z&&J<Z+n){const Oe=ae-Z+1,Re=J-Z+1;return i.jsx("div",{className:de,style:{gridArea:`${Oe} / ${Re} / ${Oe+1} / ${Re+1}`}})}return null},[d,f,n,e.length]),ke=m.useMemo(()=>{var ne;const ie=e.length,ae=Math.floor((ie-n)/2),J=new Set((j==null?void 0:j.map(de=>`${de.row}-${de.col}`))||[]),q=new Set(((ne=Ie==null?void 0:Ie.boardTargets)==null?void 0:ne.map(de=>`${de.row}-${de.col}`))||[]),H=(de,xe)=>J.has(`${de}-${xe}`)||q.has(`${de}-${xe}`);return fe.map((de,xe)=>de.map((Z,Oe)=>{const Re=xe+ae,Ce=Oe+ae,Le=`${Re}-${Ce}`,We=q.has(Le);return{cellKey:Le,originalRowIndex:Re,originalColIndex:Ce,cell:Z,isValidTarget:H(Re,Ce),isTargetingModeValidTarget:We,isNoTarget:($==null?void 0:$.row)===Re&&$.col===Ce,cellFloatingTexts:(K==null?void 0:K.filter(V=>V.row===Re&&V.col===Ce))||[],cellTargetSelectionEffects:(B==null?void 0:B.filter(V=>{var Ke,E;return V.location==="board"&&((Ke=V.boardCoords)==null?void 0:Ke.row)===Re&&((E=V.boardCoords)==null?void 0:E.col)===Ce}))||[]}}))},[fe,e.length,n,j,Ie,$,K,B]);return i.jsx("div",{className:"relative p-2 bg-board-bg rounded-xl h-full aspect-square transition-all duration-300",children:i.jsxs("div",{className:`grid ${oh[n]} gap-0.5 h-full w-full`,children:[ke.map(ie=>ie.map(({cellKey:ae,originalRowIndex:J,originalColIndex:q,cell:H,isValidTarget:ne,isTargetingModeValidTarget:de,isNoTarget:xe,cellFloatingTexts:Z,cellTargetSelectionEffects:Oe})=>i.jsxs("div",{className:"relative w-full h-full",children:[i.jsx(ey,{row:J,col:q,cell:H,isGameStarted:t,handleDrop:r,draggedItem:a,setDraggedItem:o,openContextMenu:s,playMode:l,setPlayMode:c,playerColorMap:f,localPlayerId:h,onCardDoubleClick:v,onEmptyCellDoubleClick:w,imageRefreshVersion:_,cursorStack:C,currentPhase:D,activePlayerId:x,onCardClick:y,onEmptyCellClick:k,isValidTarget:ne,isTargetingModeValidTarget:de,targetingModePlayerId:Ie==null?void 0:Ie.playerId,targetingModeOriginalOwnerId:Ie==null?void 0:Ie.originalOwnerId,showNoTarget:xe,disableActiveHighlights:A,preserveDeployAbilities:M,abilitySourceCoords:ee,abilityCheckKey:re}),Z.map(Re=>i.jsx(ty,{textData:Re,playerColorMap:f},Re.id||`${Re.row}-${Re.col}-${Re.timestamp}`)),Oe.map(Re=>i.jsx(Ab,{effect:Re},Re.timestamp))]},ae))),"      ",d&&i.jsxs("div",{className:`absolute top-2 right-2 bottom-2 left-2 grid ${oh[n]} gap-0.5 pointer-events-none z-20`,children:["          ",he,"        "]})]})})});ny.displayName="GameBoard";const Do=60,sh=200,ih=10*1024,yd={HERO:1,COMMAND:2,DEFAULT:3},ox=/^(\d{1,2})x\s+([\p{L}\p{N}\p{M}\s'"\-.,&()]+)$/u;function sx(e){let t=e.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g,"");return t=t.replace(/\0/g,""),t.trim()}function lh(e){return[/<script/i,/javascript:/i,/on\w+\s*=/i,/<iframe/i,/<object/i,/<embed/i,/eval\s*\(/i,/expression\s*\(/i,/@import/i,/\$\{/,/__proto__/i,/constructor\s*\[/].some(n=>n.test(e))}function ry(){if(typeof window>"u")return"en";const e=localStorage.getItem("app_language");return e&&e in Xn?e:"en"}function zf(e,t){const r=(Xn[t]||Xn.en).cards[e],a=Wo(e);return a?(r==null?void 0:r.name)||a.name:""}function ix(e){var r;const t=new Map,n=qg();for(const{id:a,card:o}of n){if(!((r=o.allowedPanels)!=null&&r.includes("DECK_BUILDER")))continue;const l=zf(a,e).toLowerCase().trim().replace(/\s+/g," ");t.set(l,a);const c=o.name.toLowerCase().trim().replace(/\s+/g," ");c!==l&&t.set(c,a)}return t}function ay(e){var f,h,v,w;if(new Blob([e]).size>ih)return{isValid:!1,error:`File too large. Maximum size is ${ih/1024}KB.`};if(lh(e))return{isValid:!1,error:"File contains invalid content."};const n=e.split(/\r?\n/),r=[];for(const _ of n){const C=_.trim();if(C.length!==0){if(C.length>sh)return{isValid:!1,error:`Line too long (maximum ${sh} characters).`};if(lh(C))return{isValid:!1,error:`Invalid content in line: "${C.substring(0,30)}..."`};r.push(C)}}if(r.length===0)return{isValid:!1,error:"File is empty or contains no valid cards."};const a=ry(),o=ix(a),s=new Map;let l=0;for(let _=0;_<r.length;_++){const C=r[_],D=C.match(ox);if(!D)return{isValid:!1,error:`Invalid format on line ${_+1}: "${C}". Expected format: "Nx Card Name"`};const x=D[1],y=sx(D[2]),k=parseInt(x,10);if(isNaN(k)||k<1||k>99)return{isValid:!1,error:`Invalid quantity on line ${_+1}: "${x}". Must be between 1 and 99.`};if(y.length===0)return{isValid:!1,error:`Empty card name on line ${_+1}.`};const j=y.toLowerCase().trim().replace(/\s+/g," "),$=o.get(j);if(!$)return{isValid:!1,error:`Card not found: "${y}"`};const A=Wo($);if(!A)return{isValid:!1,error:`Card definition error: "${y}"`};if(s.has($))return{isValid:!1,error:`Duplicate card entry: "${y}"`};if(!((f=A.allowedPanels)!=null&&f.includes("DECK_BUILDER")))return{isValid:!1,error:`Card not allowed in decks: "${y}"`};if(s.set($,k),l+=k,l>Do)return{isValid:!1,error:`Deck exceeds ${Do} card limit.`}}for(const[_,C]of s.entries()){const D=Wo(_);if(!D)continue;const x=(h=D.types)==null?void 0:h.includes("Hero"),y=(v=D.types)==null?void 0:v.includes("Rarity"),k=(w=D.types)==null?void 0:w.includes("Command");let j=yd.DEFAULT,$="";if(x||y?(j=yd.HERO,$=x?"Hero":"Rarity"):k&&(j=yd.COMMAND,$="Command"),C>j)return{isValid:!1,error:`Invalid quantity for "${zf(_,a)}" (${$}): ${C} (maximum ${j} per deck)`}}return{isValid:!0,deckFile:{deckName:"Imported Deck",cards:Array.from(s.entries()).map(([_,C])=>({cardId:_,quantity:C}))}}}function lx(e){const t=[],n=ry(),r=[];for(const{cardId:a,quantity:o}of e.cards){const s=zf(a,n);s&&r.push({name:s,quantity:o})}r.sort((a,o)=>a.name.localeCompare(o.name,void 0,{sensitivity:"base"}));for(const{name:a,quantity:o}of r)t.push(`${o}x ${a}`);return t.join(`
`)}const Aa=new Map,ch=m.memo(({player:e,canEditSettings:t,selectedColors:n,onColorChange:r,compact:a=!1})=>{const[o,s]=m.useState(!1),l=m.useRef(null);m.useEffect(()=>{const w=_=>{l.current&&!l.current.contains(_.target)&&s(!1)};return o&&document.addEventListener("mousedown",w),()=>{document.removeEventListener("mousedown",w)}},[o]);const c=a?"w-4 h-4":"w-9 h-9",d=a?"rounded-sm":"rounded-md",f=a?"border":"border-2",h=a?"border-white/40":"border-gray-600";return i.jsxs("div",{className:"relative",ref:l,children:[i.jsx("button",{onClick:()=>t&&s(!o),className:`${c} p-0 ${d} ${Kn[e.color].bg} ${f} ${h} ${t?"hover:border-white cursor-pointer":"cursor-default"} transition-all shadow-md flex items-center justify-center group flex-shrink-0`,title:t?"Change Color":e.color,children:!a&&t&&i.jsx("svg",{className:"w-4 h-4 text-white/60 group-hover:text-white transition-colors drop-shadow-md",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M19 9l-7 7-7-7"})})}),o&&i.jsx("div",{className:"absolute top-full left-0 mt-2 p-2 bg-gray-800 border border-gray-600 rounded-lg shadow-xl z-50 grid grid-cols-4 gap-2 w-max animate-fade-in",children:Object.keys(Kn).map(w=>{const _=w,C=n.has(_)&&e.color!==_,D=e.color===_;return i.jsx("button",{onClick:()=>{C||(r(_),s(!1))},disabled:C,className:`w-8 h-8 rounded-md ${Kn[_].bg} border-2 ${D?"border-white ring-1 ring-white scale-110":C?"border-transparent opacity-20 cursor-not-allowed":"border-transparent hover:border-white hover:scale-110 hover:shadow-lg"} transition-all duration-150`,title:_},_)})})]})}),Oa=({onDrop:e,className:t,isOverClassName:n,children:r,onContextMenu:a})=>{const[o,s]=m.useState(!1);return i.jsx("div",{onDragOver:l=>{l.preventDefault(),l.stopPropagation(),s(!0)},onDragLeave:l=>{l.stopPropagation(),s(!1)},onDrop:l=>{l.preventDefault(),s(!1),e()},onContextMenu:a,className:`${t||""} ${o?`relative z-10 ${n||""}`:""}`,children:r})},dh=({score:e,onChange:t,canEdit:n})=>{const[r,a]=m.useState(0),[o,s]=m.useState(0),[l,c]=m.useState(0),d=m.useRef(null),f=m.useRef(0),h=m.useRef(e),v=m.useRef(!1);m.useEffect(()=>{if(h.current!==e){const x=e-h.current;let y;if(v.current?v.current=!1:(c(x),s(k=>k+1),y=setTimeout(()=>{c(0)},1500)),h.current=e,y)return()=>clearTimeout(y)}},[e]);const w=x=>{if(!n)return;const y=f.current+x;f.current=y,a(y),s(k=>k+1),d.current&&clearTimeout(d.current),d.current=setTimeout(()=>{const k=f.current;k!==0&&(v.current=!0,t(k)),f.current=0,a(0)},250)};m.useEffect(()=>()=>{d.current&&clearTimeout(d.current)},[]);const _=r!==0||l!==0,C=l!==0?l:r,D=l!==0;return i.jsxs("div",{className:"w-full h-full aspect-square bg-gray-800 rounded flex flex-col items-center text-white select-none overflow-hidden",children:[i.jsx("button",{onClick:()=>w(1),disabled:!n,className:"h-1/3 w-full flex items-center justify-center bg-gray-700 hover:bg-gray-600 active:bg-gray-500 transition-colors text-base sm:text-xl font-bold disabled:opacity-50 disabled:cursor-default leading-none",children:"+"}),i.jsxs("div",{className:"h-1/3 flex items-center justify-center font-bold text-base sm:text-xl w-full px-px relative",children:[i.jsx("span",{className:"absolute left-1/2 -translate-x-1/2",children:e}),_&&i.jsx("span",{className:`absolute right-1 text-base sm:text-lg font-bold ${C>0?"text-green-400":"text-red-400"} ${D?"animate-fade-out":""}`,children:C>0?`+${C}`:C},o)]}),i.jsx("button",{onClick:()=>w(-1),disabled:!n,className:"h-1/3 w-full flex items-center justify-center bg-gray-700 hover:bg-gray-600 active:bg-gray-500 transition-colors text-base sm:text-xl font-bold disabled:opacity-50 disabled:cursor-default leading-none",children:"-"})]})},uh=({label:e,count:t,onClick:n,children:r,className:a,style:o,delta:s})=>i.jsx("div",{onClick:n,className:`w-full h-full rounded flex flex-col items-center justify-center cursor-pointer hover:ring-2 ring-indigo-400 transition-all shadow-sm select-none text-white border border-gray-600 relative overflow-hidden ${a||""}`,style:o,children:r||i.jsxs(i.Fragment,{children:[i.jsx("span",{className:"text-[9px] font-bold mb-0.5 opacity-80 uppercase tracking-tighter",children:e}),i.jsxs("div",{className:"relative",children:[i.jsx("span",{className:"text-base font-bold",children:t}),s!=null&&i.jsx("span",{className:`absolute left-full top-0 ml-0.5 text-base font-bold animate-fade-out ${s>0?"text-green-400":"text-red-400"}`,children:s>0?`+${s}`:s})]})]})}),fh=m.memo(({player:e,isLocalPlayer:t,localPlayerId:n,isGameStarted:r,onNameChange:a,onColorChange:o,onScoreChange:s,onDeckChange:l,onLoadCustomDeck:c,onDrawCard:d,handleDrop:f,draggedItem:h,setDraggedItem:v,openContextMenu:w,onHandCardDoubleClick:_,playerColorMap:C,allPlayers:D,localPlayerTeamId:x,activePlayerId:y,onToggleActivePlayer:k,imageRefreshVersion:j,layoutMode:$,onCardClick:A,validHandTargets:M,onAnnouncedCardDoubleClick:K,currentPhase:ee,disableActiveHighlights:re,preserveDeployAbilities:Ie=!1,roundWinners:B,startingPlayerId:fe,onDeckClick:he,isDeckSelectable:ke,hideDummyCards:ie=!1,deckSelections:ae=[],handCardSelections:J=[],cursorStack:q=null,remoteValidTargets:H=null,highlightOwnerId:ne})=>{const{t:de,resources:xe}=un(),Z=m.useRef(null),Oe=m.useRef(e.deck.length),[Re,Ce]=m.useState(null),[Le,We]=m.useState(0),V=t||!!e.isDummy,Ke=V&&!q,E=y===e.id,U=x!==void 0&&e.teamId===x&&!t,te=!!e.isDisconnected,Te=m.useMemo(()=>Cu.filter(Fe=>Fe.isSelectable),[Cu]),ve=m.useMemo(()=>new Set(D.map(Fe=>Fe.color)),[D]),O=B?Object.values(B).filter(Fe=>Fe.includes(e.id)).length:0,et=fe===e.id,ue=rh.FIRST_PLAYER,we=rh.ROUND_WIN_MEDAL;m.useEffect(()=>{const Fe=Oe.current,se=e.deck.length;if(Fe!==se){const Q=se-Fe;Oe.current=se;const me=Aa.get(e.id);if(me){clearTimeout(me.timerId);const Y=me.delta+Q;Ce(Y),We(L=>L+1);const X=setTimeout(()=>{Ce(null),Aa.delete(e.id)},500);Aa.set(e.id,{delta:Y,timerId:X})}else{Ce(Q),We(X=>X+1);const Y=setTimeout(()=>{Ce(null),Aa.delete(e.id)},500);Aa.set(e.id,{delta:Q,timerId:Y})}}},[e.deck.length,e.id]),m.useEffect(()=>()=>{const Fe=Aa.get(e.id);Fe&&(clearTimeout(Fe.timerId),Aa.delete(e.id))},[e.id]);const pt=Fe=>{l(Fe.target.value)},Nt=Fe=>{var me;const se=(me=Fe.target.files)==null?void 0:me[0];if(!se)return;const Q=new FileReader;Q.onload=Y=>{var X;try{const L=(X=Y.target)==null?void 0:X.result,be=ay(L);if(!be.isValid){console.error("Failed to load deck:",be.error),alert(be.error);return}const{deckFile:De}=be;c(De)}catch(L){console.error("Failed to parse deck file",L),alert("Failed to parse deck file.")}},Q.readAsText(se)},Wt=()=>{var Fe;(Fe=Z.current)==null||Fe.click()},ht=()=>{ke&&he?he(e.id):V&&d()};if($==="list-local"){const Fe=E?"border-yellow-400":"border-gray-700";return i.jsxs("div",{className:`w-full h-full flex flex-col p-4 bg-panel-bg border-2 ${Fe} rounded-lg shadow-2xl ${te?"opacity-60":""} relative`,children:[i.jsxs("div",{className:"absolute top-4 right-4 flex items-center gap-[2px] z-50",children:[O>0&&Array.from({length:O}).map((se,Q)=>i.jsx("img",{src:we,alt:"Round Winner",className:"w-6 h-6 drop-shadow-md flex-shrink-0",title:"Round Winner"},`win-${Q}`)),et&&i.jsx("img",{src:ue,alt:"First Player",className:"w-6 h-6 drop-shadow-md flex-shrink-0",title:"First Player"}),i.jsx("input",{type:"checkbox",checked:E,onChange:()=>k(e.id),disabled:!V,className:`w-6 h-6 text-yellow-400 bg-gray-700 border-2 border-yellow-400 rounded flex-shrink-0 ${V?"cursor-pointer":"cursor-not-allowed"}`,title:"Active Player"})]}),i.jsxs("div",{className:"flex items-center gap-2 mb-[3px] flex-shrink-0 pr-[100px]",children:[i.jsx(ch,{player:e,canEditSettings:!r&&V,selectedColors:ve,onColorChange:o}),i.jsx("div",{className:"flex-grow relative flex items-center min-w-0",children:i.jsx("input",{type:"text",value:e.name,onChange:se=>a(se.target.value),readOnly:r||!V,className:"bg-transparent font-bold text-xl p-1 flex-grow focus:bg-gray-800 rounded focus:outline-none border-b border-gray-600 text-white truncate"})})]}),i.jsx("div",{className:"bg-gray-800 p-1 rounded-lg mb-1 flex-shrink-0",children:i.jsxs("div",{className:"grid grid-cols-4 gap-1 sm:gap-2",children:[i.jsx(Oa,{className:"relative",onDrop:()=>h&&f(h,{target:"deck",playerId:e.id,deckPosition:"top"}),onContextMenu:se=>w(se,"deckPile",{player:e}),isOverClassName:"rounded ring-2 ring-white",children:(()=>{const se=ke,Q=(H==null?void 0:H.isDeckSelectable)??!1,me=se||Q,Y=Q&&H?H.playerId:y,X=Y!=null?C.get(Y):null,L=mo(X,{r:37,g:99,b:235}),be=me?{boxShadow:`0 0 12px 2px ${Ar(ks(L),.5)}`,border:"3px solid rgb(255, 255, 255)"}:{},De=Date.now(),Ee=ae==null?void 0:ae.find(Ue=>Ue.playerId===e.id&&De-Ue.timestamp<1e3),Pe=Ee!=null&&Ee.selectedByPlayerId?C.get(Ee.selectedByPlayerId):null,Ae=mo(Pe,L);return i.jsxs("div",{className:"relative aspect-square",children:[me&&i.jsx("div",{className:"absolute inset-0 rounded pointer-events-none animate-glow-pulse",style:{zIndex:10,background:`radial-gradient(circle at center, transparent 30%, ${Ar(L,.4)} 100%)`}}),Ee&&i.jsx("div",{className:"absolute inset-0 rounded pointer-events-none animate-deck-selection",style:{zIndex:15,border:"3px solid",borderColor:`rgb(${Ae.r}, ${Ae.g}, ${Ae.b})`,background:`radial-gradient(circle at center, transparent 20%, ${Ar(Ae,.6)} 100%)`}}),i.jsxs("div",{onClick:ht,className:"absolute inset-0 bg-card-back rounded flex flex-col items-center justify-center cursor-pointer hover:ring-2 ring-indigo-400 transition-all shadow-md select-none text-white",style:be,children:[i.jsx("span",{className:"text-[10px] sm:text-xs font-bold mb-0.5 uppercase tracking-tight relative z-20",children:de("deck")}),i.jsxs("div",{className:"relative z-20",children:[i.jsx("span",{className:"text-base sm:text-lg font-bold",children:e.deck.length}),Re!==null&&i.jsx("span",{className:`absolute left-full top-0 ml-1 text-base sm:text-lg font-bold animate-fade-out ${Re>0?"text-green-400":"text-red-400"}`,children:Re>0?`+${Re}`:Re},Le)]})]})]})})()}),i.jsx(Oa,{onDrop:()=>h&&f(h,{target:"discard",playerId:e.id}),onContextMenu:se=>w(se,"discardPile",{player:e}),isOverClassName:"rounded ring-2 ring-white",children:i.jsxs("div",{className:"aspect-square bg-gray-700 rounded flex flex-col items-center justify-center cursor-pointer hover:bg-gray-600 transition-all shadow-md border border-gray-600 select-none text-white",children:[i.jsx("span",{className:"text-[10px] sm:text-xs font-bold mb-0.5 text-gray-400 uppercase tracking-tight",children:de("discard")}),i.jsx("span",{className:"text-base sm:text-lg font-bold",children:e.discard.length})]})}),i.jsx(Oa,{onDrop:()=>h&&f(h,{target:"announced",playerId:e.id}),isOverClassName:"rounded ring-2 ring-white",children:i.jsx("div",{className:"aspect-square bg-gray-800 border border-dashed border-gray-600 rounded flex items-center justify-center relative overflow-hidden",children:e.announcedCard?i.jsx("div",{className:"w-full h-full p-1 cursor-pointer",draggable:Ke,onDragStart:()=>Ke&&v({card:e.announcedCard,source:"announced",playerId:e.id,isManual:!0}),onDragEnd:()=>{setTimeout(()=>v(null),nt.DRAG_END_FALLBACK)},onContextMenu:se=>V&&e.announcedCard&&w(se,"announcedCard",{card:e.announcedCard,player:e}),onDoubleClick:()=>K==null?void 0:K(e,e.announcedCard),children:i.jsx(Bn,{card:e.announcedCard,isFaceUp:!0,playerColorMap:C,imageRefreshVersion:j,activePhaseIndex:ee,activePlayerId:y,disableActiveHighlights:re,preserveDeployAbilities:Ie})}):i.jsx("span",{className:"text-[10px] sm:text-xs font-bold text-gray-500 select-none uppercase tracking-tight",children:de("showcase")})})}),i.jsx(dh,{score:e.score,onChange:s,canEdit:V})]})}),!r&&V&&Te.length>0&&i.jsxs("div",{className:"mb-[3px] flex-shrink-0 text-white",children:[i.jsx("input",{type:"file",ref:Z,onChange:Nt,accept:".txt",className:"hidden"}),e.selectedDeck===it.Custom?i.jsxs("div",{className:"flex gap-2",children:[i.jsx("button",{onClick:Wt,className:"bg-transparent border border-gray-500 hover:bg-gray-700 px-4 py-1.5 rounded font-bold",children:de("loadDeck")}),i.jsxs("select",{value:e.selectedDeck,onChange:pt,className:"flex-grow bg-gray-700 border border-gray-600 rounded p-1",children:[Te.map(se=>i.jsx("option",{value:se.id,children:xe.deckNames[se.id]||se.name},se.id)),i.jsx("option",{value:it.Custom,children:de("customDeck")})]})]}):i.jsxs("select",{value:e.selectedDeck,onChange:pt,className:"w-full bg-gray-700 border border-gray-600 rounded p-2 mb-2",children:[Te.map(se=>i.jsx("option",{value:se.id,children:xe.deckNames[se.id]||se.name},se.id)),i.jsx("option",{value:it.Custom,children:de("customDeck")})]})]}),i.jsx("div",{className:"flex-grow flex flex-col min-h-0",children:i.jsx(Oa,{onDrop:()=>{h&&(f(h,{target:"hand",playerId:e.id}),v(null))},className:"flex-grow bg-gray-800 rounded-lg p-2 overflow-y-scroll border border border-gray-700 custom-scrollbar",children:i.jsx("div",{className:"flex flex-col gap-[2px]",children:e.hand.map((se,Q)=>{var Ue;const me=M==null?void 0:M.some(Me=>Me.playerId===e.id&&Me.cardIndex===Q),Y=(Ue=H==null?void 0:H.validHandTargets)==null?void 0:Ue.some(Me=>Me.playerId===e.id&&Me.cardIndex===Q),X=me||Y,L=Y&&H?H.playerId:ne??y,be=L!=null?C.get(L):null,De=mo(be,{r:37,g:99,b:235}),Ee=Date.now(),Pe=J==null?void 0:J.find(Me=>Me.playerId===e.id&&Me.cardIndex===Q&&Ee-Me.timestamp<1e3),Ae=X?{boxShadow:`0 0 12px 2px ${Ar(ks(De),.5)}`,border:"3px solid rgb(255, 255, 255)"}:{};return i.jsxs("div",{className:"relative",children:[X&&i.jsx("div",{className:"absolute inset-0 rounded pointer-events-none animate-glow-pulse",style:{zIndex:10,background:`radial-gradient(circle at center, transparent 30%, ${Ar(De,.4)} 100%)`}}),Pe&&i.jsx("div",{className:"absolute inset-0 rounded pointer-events-none animate-deck-selection",style:{zIndex:15,border:"3px solid",borderColor:`rgb(${De.r}, ${De.g}, ${De.b})`,background:`radial-gradient(circle at center, transparent 20%, ${Ar(De,.6)} 100%)`}}),i.jsxs("div",{className:`flex items-center bg-gray-900 border rounded p-2 ${X?"border-transparent":"border-gray-700"}`,style:Ae,draggable:Ke,onDragStart:()=>Ke&&v({card:se,source:"hand",playerId:e.id,cardIndex:Q,isManual:!0}),onDragEnd:()=>{setTimeout(()=>v(null),nt.DRAG_END_FALLBACK)},onContextMenu:Me=>V&&w(Me,"handCard",{card:se,player:e,cardIndex:Q}),onDoubleClick:()=>_(e,se,Q),onClick:()=>{A==null||A(e,se,Q)},"data-hand-card":`${e.id},${Q}`,"data-interactive":"true",children:[i.jsx("div",{className:"aspect-square flex-shrink-0 mr-3 w-[28.75%] max-w-[230px] min-w-[40px] overflow-hidden rounded",children:i.jsx(Bn,{card:se,isFaceUp:!0,playerColorMap:C,localPlayerId:n,imageRefreshVersion:j,disableTooltip:!0,disableActiveHighlights:re,preserveDeployAbilities:Ie})}),i.jsx("div",{className:"flex-grow min-w-0",children:i.jsx(Ic,{card:se,className:"relative flex flex-col text-left w-full h-full justify-start whitespace-normal break-words",hideOwner:se.ownerId===e.id})})]})]},`${e.id}-hand-${Q}-${se.id}`)})})})})]})}if($==="list-remote"){const Fe=E?"border-yellow-400":"border-gray-700";return i.jsxs("div",{className:`w-full h-full flex flex-col p-1 pt-[3px] bg-panel-bg border-2 ${Fe} rounded-lg shadow-xl ${te?"opacity-60":""} relative`,children:[i.jsxs("div",{className:"flex items-center gap-1 px-1 min-h-[20px] mt-[2px] relative z-10",children:[i.jsx(ch,{player:e,canEditSettings:!r&&V,selectedColors:ve,onColorChange:o,compact:!0}),i.jsx("span",{className:"font-bold text-white text-[14px] truncate leading-tight flex-1 min-w-0 relative z-10",children:e.name}),i.jsxs("div",{className:"flex items-center gap-[2px] flex-shrink-0",children:[!r&&V&&Te.length>0&&(e.selectedDeck===it.Custom?i.jsxs(i.Fragment,{children:[i.jsx("input",{type:"file",ref:Z,onChange:Nt,accept:".txt",className:"hidden"}),i.jsx("button",{onClick:Wt,className:"text-[11px] bg-transparent border border-gray-500 hover:bg-gray-700 text-white rounded px-1 py-0 h-5 flex-shrink-0",children:de("loadDeck")}),i.jsxs("select",{value:e.selectedDeck,onChange:pt,className:"text-[11px] bg-gray-700 text-white border border-gray-600 rounded px-1 py-0 h-5 w-[90px] focus:outline-none truncate flex-shrink-0",children:[Te.map(se=>i.jsx("option",{value:se.id,children:xe.deckNames[se.id]||se.name},se.id)),i.jsx("option",{value:it.Custom,children:de("customDeck")})]})]}):i.jsxs("select",{value:e.selectedDeck,onChange:pt,className:"text-[11px] bg-gray-700 text-white border border-gray-600 rounded px-1 py-0 h-5 w-[110px] focus:outline-none truncate flex-shrink-0",children:[Te.map(se=>i.jsx("option",{value:se.id,children:xe.deckNames[se.id]||se.name},se.id)),i.jsx("option",{value:it.Custom,children:de("customDeck")})]})),O>0&&i.jsx("img",{src:we,alt:"Round Winner",className:"w-[19px] h-[17.7] flex-shrink-0 mt-[1.3px]",title:"Round Winner"}),et&&i.jsx("img",{src:ue,className:"w-[16.75px] h-[16.75px] flex-shrink-0",title:"First Player"}),i.jsx("input",{type:"checkbox",checked:E,onChange:()=>k(e.id),disabled:!V,className:"w-[15px] h-[15px] text-yellow-400 bg-gray-800 border-2 border-yellow-400 rounded cursor-pointer flex-shrink-0 accent-yellow-500",title:"Active Player"})]})]}),i.jsx("div",{className:"relative flex flex-col flex-1 min-h-0 overflow-hidden",children:i.jsxs("div",{className:"flex flex-col flex-1 min-h-0 gap-1 px-1 mt-[4px]",children:[i.jsxs("div",{className:"grid grid-cols-6 gap-1 flex-shrink-0 scale-[0.975] origin-left",children:[i.jsx("div",{className:"aspect-square relative",children:i.jsx(Oa,{className:"w-full h-full",onDrop:()=>h&&f(h,{target:"deck",playerId:e.id,deckPosition:"top"}),onContextMenu:se=>w(se,"deckPile",{player:e}),isOverClassName:"rounded ring-2 ring-white",children:(()=>{const se=ke,Q=(H==null?void 0:H.isDeckSelectable)??!1,me=se||Q,Y=Q&&H?H.playerId:y,X=Y!=null?C.get(Y):null,L=mo(X,{r:37,g:99,b:235}),be=me?{boxShadow:`0 0 12px 2px ${Ar(ks(L),.5)}`,border:"3px solid rgb(255, 255, 255)"}:{},De=Date.now(),Ee=ae==null?void 0:ae.find(Ue=>Ue.playerId===e.id&&De-Ue.timestamp<1e3),Pe=Ee!=null&&Ee.selectedByPlayerId?C.get(Ee.selectedByPlayerId):null,Ae=mo(Pe,L);return i.jsxs("div",{className:"relative w-full h-full",children:[me&&i.jsx("div",{className:"absolute inset-0 rounded pointer-events-none animate-glow-pulse",style:{zIndex:10,background:`radial-gradient(circle at center, transparent 30%, rgba(${L.r}, ${L.g}, ${L.b}, 0.4) 100%)`}}),Ee&&i.jsx("div",{className:"absolute inset-0 rounded pointer-events-none animate-deck-selection",style:{zIndex:15,border:"3px solid",borderColor:`rgb(${Ae.r}, ${Ae.g}, ${Ae.b})`,background:`radial-gradient(circle at center, transparent 20%, rgba(${Ae.r}, ${Ae.g}, ${Ae.b}, 0.6) 100%)`}}),i.jsx(uh,{label:de("deck"),count:e.deck.length,onClick:ht,className:"bg-card-back",style:be,delta:Re})]})})()})}),i.jsx("div",{className:"aspect-square relative",children:i.jsx(Oa,{className:"w-full h-full",onDrop:()=>h&&f(h,{target:"discard",playerId:e.id}),onContextMenu:se=>w(se,"discardPile",{player:e}),isOverClassName:"rounded ring-2 ring-white",children:i.jsx(uh,{label:de("discard"),count:e.discard.length,className:"bg-gray-700"})})}),i.jsx("div",{className:"aspect-square relative",children:i.jsx(Oa,{className:"w-full h-full",onDrop:()=>h&&f(h,{target:"announced",playerId:e.id}),isOverClassName:"rounded ring-2 ring-white",children:i.jsx("div",{className:"w-full h-full bg-gray-800 border border-dashed border-gray-600 rounded flex items-center justify-center relative overflow-hidden",children:e.announcedCard?i.jsx("div",{className:"w-full h-full",draggable:Ke,onDragStart:()=>Ke&&v({card:e.announcedCard,source:"announced",playerId:e.id,isManual:!0}),onDragEnd:()=>{setTimeout(()=>v(null),nt.DRAG_END_FALLBACK)},onContextMenu:se=>e.announcedCard&&w(se,"announcedCard",{card:e.announcedCard,player:e}),onDoubleClick:()=>K==null?void 0:K(e,e.announcedCard),children:i.jsx(Bn,{card:e.announcedCard,isFaceUp:!0,playerColorMap:C,imageRefreshVersion:j,disableTooltip:!1,disableActiveHighlights:re,preserveDeployAbilities:Ie})}):i.jsx("span",{className:"text-[9px] font-bold text-gray-500 select-none uppercase",children:"SHOW"})})})}),i.jsx("div",{className:"aspect-square"}),i.jsx("div",{className:"aspect-square"}),i.jsx("div",{className:"aspect-square",children:i.jsx(dh,{score:e.score,onChange:s,canEdit:V})})]}),i.jsx("div",{onDragOver:se=>se.preventDefault(),onDrop:se=>{se.preventDefault(),se.stopPropagation(),h&&f(h,{target:"hand",playerId:e.id})},className:"grid grid-cols-6 gap-1 overflow-y-scroll custom-scrollbar flex-grow content-start min-h-[30px]",children:e.hand.map((se,Q)=>{var rn,an;const me=M==null?void 0:M.some(bt=>bt.playerId===e.id&&bt.cardIndex===Q),Y=(rn=H==null?void 0:H.validHandTargets)==null?void 0:rn.some(bt=>bt.playerId===e.id&&bt.cardIndex===Q),X=me||Y,L=Y&&H?H.playerId:ne??y,be=L!=null?C.get(L):null,De=mo(be,{r:37,g:99,b:235}),Ee=Date.now(),Pe=J==null?void 0:J.find(bt=>bt.playerId===e.id&&bt.cardIndex===Q&&Ee-bt.timestamp<1e3),Ae=X?{boxShadow:`0 0 12px 2px ${Ar(ks(De),.5)}`,border:"3px solid rgb(255, 255, 255)"}:{},Ue=se.revealedTo==="all",Me=n!==null&&Array.isArray(se.revealedTo)&&se.revealedTo.includes(n),ut=n!==null&&((an=se.statuses)==null?void 0:an.some(bt=>bt.type==="Revealed"&&bt.addedByPlayerId===n)),Ze=D.find(bt=>bt.id===se.ownerId),at=Ze==null?void 0:Ze.isDummy,hn=n===se.ownerId||!!at&&(!ie||!!Ue||!!Me||!!ut)||U||Ue||!!Me||!!ut;return i.jsxs("div",{className:"aspect-square relative",draggable:Ke,onDragStart:()=>Ke&&v({card:se,source:"hand",playerId:e.id,cardIndex:Q,isManual:!0}),onDragEnd:()=>{setTimeout(()=>v(null),nt.DRAG_END_FALLBACK)},onContextMenu:bt=>{bt.preventDefault(),bt.stopPropagation(),w(bt,"handCard",{card:se,player:e,cardIndex:Q})},onDoubleClick:()=>_(e,se,Q),onClick:()=>{A==null||A(e,se,Q)},onDragOver:bt=>{bt.preventDefault(),bt.stopPropagation()},onDrop:bt=>{bt.preventDefault(),bt.stopPropagation(),h&&(h.playerId===e.id&&h.source==="hand"?f(h,{target:"hand",playerId:e.id,cardIndex:Q}):f(h,{target:"hand",playerId:e.id}))},"data-hand-card":`${e.id},${Q}`,"data-interactive":"true",children:[X&&i.jsx("div",{className:"absolute inset-0 rounded pointer-events-none animate-glow-pulse",style:{zIndex:10,background:`radial-gradient(circle at center, transparent 30%, rgba(${De.r}, ${De.g}, ${De.b}, 0.4) 100%)`}}),Pe&&i.jsx("div",{className:"absolute inset-0 rounded pointer-events-none animate-deck-selection",style:{zIndex:15,border:"3px solid",borderColor:`rgb(${De.r}, ${De.g}, ${De.b})`,background:`radial-gradient(circle at center, transparent 20%, rgba(${De.r}, ${De.g}, ${De.b}, 0.6) 100%)`}}),i.jsx("div",{className:"w-full h-full rounded",style:Ae,children:i.jsx(Bn,{card:se,isFaceUp:hn,playerColorMap:C,localPlayerId:n,imageRefreshVersion:j,disableTooltip:!hn,disableActiveHighlights:re,smallStatusIcons:!0,preserveDeployAbilities:Ie})})]},`${e.id}-hand-${Q}-${se.id}`)})})]})})]})}return null},(e,t)=>{var a,o,s,l,c,d,f,h;const n=e.cursorStack===null&&t.cursorStack===null||e.cursorStack!==null&&t.cursorStack!==null&&e.cursorStack.type===t.cursorStack.type&&e.cursorStack.count===t.cursorStack.count,r=e.draggedItem===t.draggedItem||((a=e.draggedItem)==null?void 0:a.card.id)===((o=t.draggedItem)==null?void 0:o.card.id)&&((s=e.draggedItem)==null?void 0:s.source)===((l=t.draggedItem)==null?void 0:l.source)&&((c=e.draggedItem)==null?void 0:c.playerId)===((d=t.draggedItem)==null?void 0:d.playerId);return e.player.id===t.player.id&&e.player.score===t.player.score&&e.player.color===t.player.color&&e.player.name===t.player.name&&e.player.selectedDeck===t.player.selectedDeck&&e.player.hand.length===t.player.hand.length&&e.player.deck.length===t.player.deck.length&&e.player.discard.length===t.player.discard.length&&((f=e.player.announcedCard)==null?void 0:f.id)===((h=t.player.announcedCard)==null?void 0:h.id)&&e.isGameStarted===t.isGameStarted&&e.activePlayerId===t.activePlayerId&&e.currentPhase===t.currentPhase&&e.imageRefreshVersion===t.imageRefreshVersion&&e.currentRound===t.currentRound&&e.validHandTargets===t.validHandTargets&&n&&r});function oy(e,t,n=!1,r){const a=window.location.origin+window.location.pathname,o=localStorage.getItem("websocket_url")||"",s=o?btoa(encodeURIComponent(o)):"";if(!e)return{url:s?`${a}#s=${s}`:a,type:"mainMenu",description:s?"Share server configuration":"Share game site"};const l=s?`${a}#game=${e}&s=${s}`:`${a}#game=${e}`;return t?{url:l,type:"inGame",description:n?"Share private game (spectator)":"Share game link (spectator)"}:{url:l,type:"lobby",description:n?"Share private game invite":"Share game invite"}}const sy=m.memo(({connectionStatus:e,isReconnecting:t,reconnectProgress:n})=>i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs("span",{className:"relative flex h-3 w-3",title:e,children:[e==="Connected"&&!t&&i.jsxs(i.Fragment,{children:[i.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"}),i.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-green-500"})]}),(e==="Connecting"||t)&&i.jsxs(i.Fragment,{children:[i.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-yellow-400 opacity-75"}),i.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-yellow-500"})]}),e==="Disconnected"&&!t&&i.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-red-500"})]}),t&&n&&i.jsxs("span",{className:"text-xs text-yellow-400 animate-pulse",children:["Reconnecting (",Math.round(n.timeRemaining/1e3),"s)"]})]}));sy.displayName="StatusIndicator";const iy=m.memo(({currentRound:e,turnNumber:t,onMouseEnter:n,onMouseLeave:r,showTooltip:a,isGameStarted:o,t:s})=>{const l=m.useMemo(()=>e*10+10,[e]);return i.jsxs("div",{className:"relative",children:[i.jsxs("div",{className:`flex items-center bg-gray-800 rounded-lg px-3 py-1.5 border border-gray-700 shadow-md ${o?"cursor-help":"opacity-50"}`,onMouseEnter:n,onMouseLeave:r,children:[i.jsxs("span",{className:"text-yellow-500 font-bold text-sm tracking-wider",children:[s("round").toUpperCase()," ",e]}),i.jsx("span",{className:"text-gray-500 mx-2",children:"|"}),i.jsxs("span",{className:"text-gray-300 text-xs font-mono",children:[s("turn").toUpperCase()," ",t]})]}),a&&i.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 mt-2 z-[100] bg-gray-900 text-white p-3 rounded-lg shadow-xl border border-gray-700 text-sm whitespace-nowrap min-w-max",children:i.jsxs("div",{className:"text-center",children:[i.jsxs("p",{className:"font-bold text-yellow-400 mb-1 whitespace-nowrap",children:[s("round")," ",e," ",s("roundVictoryCondition")]}),i.jsxs("p",{className:"whitespace-nowrap",children:[s("reach")," ",i.jsxs("span",{className:"font-bold text-white",children:[l," ",s("scorePoints")]})," ",s("toWinRound")]}),i.jsx("p",{className:"text-xs text-gray-400 mt-1",children:s("checkedAtFirstPlayer")})]})})]})});iy.displayName="RoundTracker";const ly=m.memo(({isOpen:e,onClose:t,anchorEl:n,isAutoAbilitiesEnabled:r,onToggleAutoAbilities:a,isAutoDrawEnabled:o,onToggleAutoDraw:s,dummyPlayerCount:l,onDummyPlayerCountChange:c,realPlayerCount:d,activeGridSize:f,onGridSizeChange:h,gameMode:v,onGameModeChange:w,isGameStarted:_,isHost:C,hideDummyCards:D,onToggleHideDummyCards:x,t:y})=>{const k=m.useRef(null),j=m.useMemo(()=>[0,1,2,3],[]);if(m.useEffect(()=>{if(!e)return;const A=M=>{k.current&&!k.current.contains(M.target)&&!(n!=null&&n.contains(M.target))&&t()};return document.addEventListener("mousedown",A),()=>document.removeEventListener("mousedown",A)},[e,t,n]),!e||!n)return null;const $=n.getBoundingClientRect();return i.jsxs("div",{ref:k,className:"fixed z-[100] bg-gray-800 rounded-lg shadow-xl border border-gray-700 p-4 min-w-[280px]",style:{top:$.bottom+8,left:$.left},children:[i.jsx("h3",{className:"text-white font-bold mb-4 text-sm border-b border-gray-700 pb-2",children:y("gameSettings")}),i.jsxs("div",{className:"flex items-center justify-between mb-3",children:[i.jsx("span",{className:"text-gray-300 text-sm",children:y("autoAbilities")}),i.jsx("button",{onClick:()=>a(!r),disabled:!C,className:`px-3 py-1 rounded text-xs font-bold transition-colors ${r?"bg-green-600 text-white":"bg-gray-600 text-gray-400"} ${C?"":"opacity-50 cursor-not-allowed"}`,children:y(r?"on":"off")})]}),i.jsxs("div",{className:"flex items-center justify-between mb-3",children:[i.jsx("span",{className:"text-gray-300 text-sm",children:y("autoDraw")}),i.jsx("button",{onClick:()=>s(!o),className:`px-3 py-1 rounded text-xs font-bold transition-colors ${o?"bg-green-600 text-white":"bg-gray-600 text-gray-400"}`,children:y(o?"on":"off")})]}),i.jsxs("div",{className:"flex items-center justify-between mb-3",children:[i.jsx("span",{className:"text-gray-300 text-sm",children:y("dummyPlayers")}),i.jsxs("div",{className:"flex gap-1 items-center",children:[j.map(A=>i.jsx("button",{onClick:()=>c(A),disabled:!C||_||d+A>Tu,className:`w-8 h-8 rounded text-xs font-bold transition-colors ${l===A?"bg-indigo-600 text-white":"bg-gray-700 text-gray-400 hover:bg-gray-600"} ${!C||_||d+A>Tu?"opacity-50 cursor-not-allowed":""}`,children:A},A)),i.jsx("button",{onClick:()=>x(!D),className:`w-8 h-8 rounded text-xs font-bold transition-colors ${D?"bg-red-600 text-white":"bg-gray-700 text-gray-400 hover:bg-gray-600"}`,title:y("hideDummyCardsTooltip"),children:""})]})]}),i.jsxs("div",{className:"flex items-center justify-between mb-3",children:[i.jsx("span",{className:"text-gray-300 text-sm",children:y("gridSize")}),i.jsx("div",{className:"flex gap-1",children:[4,5,6,7].map(A=>i.jsxs("button",{onClick:()=>h(A),disabled:!C||_,className:`w-10 h-8 rounded text-xs font-bold transition-colors ${f===A?"bg-indigo-600 text-white":"bg-gray-700 text-gray-400 hover:bg-gray-600"} ${!C||_?"opacity-50 cursor-not-allowed":""}`,children:[A,"x",A]},A))})]}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("span",{className:"text-gray-300 text-sm",children:y("gameMode")}),i.jsxs("select",{value:v,onChange:A=>w(A.target.value),disabled:!C||_,className:"bg-gray-700 border border-gray-600 text-white text-xs rounded px-2 py-1 disabled:opacity-50",children:[i.jsx("option",{value:Kr.FreeForAll,children:y("ffa")}),i.jsx("option",{value:Kr.TwoVTwo,children:y("2v2")}),i.jsx("option",{value:Kr.ThreeVOne,children:y("3v1")})]})]})]})});ly.displayName="GameSettingsMenu";const cy=m.memo(({isOpen:e,onClose:t,anchorEl:n,gameId:r,isPrivate:a,onPrivacyChange:o,isHost:s,isGameStarted:l,hostId:c,t:d})=>{const f=m.useRef(null),[h,v]=m.useState(!1),[w,_]=m.useState(!1);m.useEffect(()=>{if(!e)return;const y=k=>{f.current&&!f.current.contains(k.target)&&!(n!=null&&n.contains(k.target))&&t()};return document.addEventListener("mousedown",y),()=>document.removeEventListener("mousedown",y)},[e,t,n]),m.useEffect(()=>{e||(v(!1),_(!1))},[e]);const C=m.useCallback(()=>{r&&navigator.clipboard.writeText(r).then(()=>{v(!0),setTimeout(()=>v(!1),1500)}).catch(y=>{console.error("Failed to copy:",y)})},[r]),D=m.useCallback(()=>{if(!r)return;const y=localStorage.getItem("webrtc_enabled")==="true";let k;if(y&&c)k=`${window.location.origin+window.location.pathname}#hostId=${encodeURIComponent(c)}`;else{const{url:j}=oy(r,l,a);k=j}navigator.clipboard.writeText(k).then(()=>{_(!0),setTimeout(()=>_(!1),2e3)}).catch(j=>{console.error("Failed to copy:",j)})},[r,l,a,c]);if(!e||!n)return null;const x=n.getBoundingClientRect();return i.jsxs("div",{ref:f,className:"fixed z-[100] bg-gray-800 rounded-lg shadow-xl border border-gray-700 p-4 min-w-[300px]",style:{top:x.bottom+8,left:Math.max(8,x.right-300)},children:[i.jsx("h3",{className:"text-white font-bold mb-4 text-sm border-b border-gray-700 pb-2",children:d("invitePlayer")}),i.jsx("div",{className:"mb-4",children:i.jsxs("div",{className:"bg-gray-900 rounded px-3 py-2 flex items-center justify-between gap-2",children:[i.jsx("span",{className:"font-mono text-indigo-300 text-sm truncate flex-1",children:r||"-"}),i.jsx("button",{onClick:C,disabled:!r,className:`w-8 h-8 flex items-center justify-center rounded transition-colors ${h?"bg-green-600 text-white":"bg-gray-700 hover:bg-gray-600 text-gray-300"} ${r?"":"opacity-50 cursor-not-allowed"}`,title:d("copy"),children:h?i.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})}):i.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[i.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),i.jsx("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]})})]})}),i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsx("span",{className:"text-gray-300 text-sm",children:d("hiddenGame")}),i.jsxs("div",{className:`flex rounded overflow-hidden ${!s||l?"opacity-50":""}`,children:[i.jsx("button",{onClick:()=>!a&&o(!0),disabled:!s||l,className:`w-10 h-8 flex items-center justify-center transition-colors ${a?"bg-red-600 text-white":"bg-gray-700 text-gray-400 hover:bg-gray-600"} ${!s||l?"cursor-not-allowed":""}`,title:d("private"),children:i.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:[i.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M1 1l22 22"}),i.jsx("path",{d:"M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19"})]})}),i.jsx("button",{onClick:()=>a&&o(!1),disabled:!s||l,className:`w-10 h-8 flex items-center justify-center transition-colors ${a?"bg-gray-700 text-gray-400 hover:bg-gray-600":"bg-green-600 text-white"} ${!s||l?"cursor-not-allowed":""}`,title:d("public"),children:i.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:[i.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),i.jsx("circle",{cx:"12",cy:"12",r:"3"})]})})]})]}),i.jsx("button",{onClick:D,disabled:!r,className:`w-full py-2 rounded text-sm font-bold transition-colors ${w?"bg-green-600 text-white":"bg-indigo-600 hover:bg-indigo-700 text-white"} ${r?"":"opacity-50 cursor-not-allowed"}`,children:d(w?"copied":"copyInviteLink")})]})});cy.displayName="InvitePlayerMenu";const cx=m.memo(({gameId:e,isGameStarted:t,onStartGame:n,onResetGame:r,activeGridSize:a,onGridSizeChange:o,dummyPlayerCount:s,onDummyPlayerCountChange:l,realPlayerCount:c,connectionStatus:d,onExitGame:f,onOpenTokensModal:h,onOpenCountersModal:v,gameMode:w,onGameModeChange:_,isPrivate:C,onPrivacyChange:D,isHost:x,hostId:y,onSyncGame:k,currentPhase:j,onSetPhase:$,onNextPhase:A,onPrevPhase:M,activePlayerId:K,playerColorMap:ee,isAutoAbilitiesEnabled:re,onToggleAutoAbilities:Ie,isAutoDrawEnabled:B,onToggleAutoDraw:fe,hideDummyCards:he,onToggleHideDummyCards:ke,currentRound:ie=1,turnNumber:ae=1,isReconnecting:J=!1,reconnectProgress:q=null})=>{const{t:H}=un(),[ne,de]=m.useState(!1),[xe,Z]=m.useState(!1),Oe=m.useRef(null),[Re,Ce]=m.useState(!1),Le=m.useRef(null),We=m.useCallback(()=>{de(!0)},[]),V=m.useCallback(()=>{de(!1)},[]);return i.jsxs(i.Fragment,{children:[i.jsxs("header",{className:"fixed top-0 left-0 right-0 h-14 bg-panel-bg bg-opacity-80 backdrop-blur-sm z-50 flex items-center justify-between px-4 shadow-lg",children:[i.jsxs("div",{className:"flex items-center space-x-3",children:[i.jsx(sy,{connectionStatus:d,isReconnecting:J,reconnectProgress:q}),i.jsx("div",{className:"w-px h-8 bg-gray-600"}),i.jsx("button",{ref:Oe,onClick:()=>Z(!xe),className:"bg-gray-700 hover:bg-gray-600 text-white font-medium py-2 px-3 rounded text-sm transition-colors",children:H("gameSettings")}),i.jsx("button",{ref:Le,onClick:()=>Ce(!Re),disabled:t,className:`font-medium py-2 px-3 rounded text-sm transition-colors ${t?"bg-gray-700 text-gray-500 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-700 text-white"}`,children:H("invitePlayer")})]}),i.jsx("div",{className:"absolute left-1/2 transform -translate-x-1/2 flex items-center",style:{marginLeft:"-280px"},children:i.jsx(iy,{currentRound:ie,turnNumber:ae,onMouseEnter:We,onMouseLeave:V,showTooltip:ne,isGameStarted:t,t:H})}),i.jsx("div",{className:"absolute left-1/2 transform -translate-x-1/2 flex items-center",children:i.jsxs("div",{className:`flex items-center bg-gray-800 rounded-lg p-1 border border-gray-700 shadow-md ${t?"":"opacity-50"}`,children:[i.jsx("button",{onClick:M,disabled:!t,className:"w-8 h-8 flex items-center justify-center text-gray-300 hover:text-white hover:bg-gray-700 rounded transition-colors disabled:cursor-not-allowed disabled:opacity-50 mr-1",children:i.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{d:"M15 6 L8 12 L15 18 Z"})})}),Fb.map((Ke,E)=>{var et;const U=E+1,te=j===U||j===0,Te=K!==null?ee.get(K):void 0,ve=Te?(et=Kn[Te])==null?void 0:et.bg:"bg-yellow-500",O=t&&te?`${ve} text-white`:"text-gray-400 hover:text-white";return i.jsx("div",{onClick:()=>t&&$(U),className:`
                    px-3 py-1.5 text-sm font-bold uppercase transition-all duration-200 cursor-pointer rounded
                    
                    ${O}
                  `,children:Ke},Ke)}),i.jsx("button",{onClick:A,disabled:!t,className:"w-8 h-8 flex items-center justify-center text-gray-300 hover:text-white hover:bg-gray-700 rounded transition-colors disabled:cursor-not-allowed disabled:opacity-50 ml-1",children:i.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{d:"M9 6 L16 12 L9 18 Z"})})})]})}),i.jsxs("div",{className:"absolute left-1/2 transform -translate-x-1/2 flex items-center",style:{marginLeft:"280px"},children:[i.jsx("button",{onClick:h,className:"bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-3 rounded text-sm",children:H("tokens")}),i.jsx("button",{onClick:v,className:"bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-3 rounded text-sm ml-[5px]",children:H("counters")})]}),i.jsxs("div",{className:"flex items-center space-x-2",children:[!t&&i.jsx("button",{onClick:n,disabled:!x,className:"bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded text-sm animate-pulse disabled:bg-gray-600 disabled:opacity-70 disabled:cursor-not-allowed disabled:animate-none",children:H("startGame")}),t&&r&&i.jsx("button",{onClick:r,disabled:!x,className:"bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded text-sm disabled:bg-gray-600 disabled:opacity-70 disabled:cursor-not-allowed",title:"Reset game to lobby (keeps players and decks)",children:H("resetGame")}),i.jsx("div",{className:"w-px h-8 bg-gray-600"}),i.jsx("button",{onClick:f,className:`bg-${t?"red":"gray"}-600 hover:bg-${t?"red":"gray"}-700 text-white font-bold py-2 px-4 rounded text-sm`,children:H("exit")})]})]}),i.jsx(ly,{isOpen:xe,onClose:()=>Z(!1),anchorEl:Oe.current,isAutoAbilitiesEnabled:re,onToggleAutoAbilities:Ie,isAutoDrawEnabled:B,onToggleAutoDraw:fe,dummyPlayerCount:s,onDummyPlayerCountChange:l,realPlayerCount:c,activeGridSize:a,onGridSizeChange:o,gameMode:w,onGameModeChange:_,isGameStarted:t,isHost:x,hideDummyCards:he,onToggleHideDummyCards:ke,t:H}),i.jsx(cy,{isOpen:Re,onClose:()=>Ce(!1),anchorEl:Le.current,gameId:e,isPrivate:C,onPrivacyChange:D,isHost:x,isGameStarted:t,hostId:y,t:H})]})}),dx=({isOpen:e,onClose:t,title:n,player:r,cards:a,setDraggedItem:o,onCardContextMenu:s,onCardDoubleClick:l,onCardClick:c,onReorder:d,canInteract:f,isDeckView:h=!1,playerColorMap:v,localPlayerId:w,imageRefreshVersion:_,highlightFilter:C,cursorStack:D=null})=>{const{t:x}=un(),[y,k]=m.useState(null),[j,$]=m.useState(null),[A,M]=m.useState(null),[K,ee]=m.useState(a),[re,Ie]=m.useState(!1),B=m.useRef(null),fe=m.useRef(null);m.useEffect(()=>{e&&(k(null),$(null),M(null),ee(a),Ie(!1),fe.current=null)},[e,a]);const he=m.useMemo(()=>{if(j!==null&&A!==null&&j!==A){const xe=[...K],[Z]=xe.splice(j,1);return xe.splice(A,0,Z),xe}return K},[K,j,A]),ke=m.useCallback((xe,Z)=>{f&&($(Z),k(xe.id),fe.current=xe,Ie(!1))},[f]),ie=m.useCallback((xe,Z)=>{xe.preventDefault(),xe.dataTransfer.dropEffect="move",A!==Z&&M(Z)},[A]),ae=m.useCallback(xe=>{if(!fe.current||!B.current)return;const Z=B.current.getBoundingClientRect(),Oe=xe.clientX,Re=xe.clientY;if(Oe<Z.left||Oe>Z.right||Re<Z.top||Re>Z.bottom){const Ce=fe.current,Le=j??0;o({card:Ce,source:h?"deck":"discard",playerId:r.id,cardIndex:Le}),Ie(!0),t()}},[j,h,r.id,o,t]),J=m.useCallback(()=>{re||(k(null),$(null),M(null)),fe.current=null},[re]),q=m.useCallback((xe,Z)=>{if(xe.preventDefault(),xe.stopPropagation(),re)return;if(j===null||j===Z){$(null),k(null),M(null);return}const Oe=[...K],[Re]=Oe.splice(j,1);Oe.splice(Z,0,Re),ee(Oe),d&&d(r.id,Oe),$(null),k(null),M(null)},[j,K,d,r.id,re]),ne=Math.ceil(a.length/5)>5,de="calc(5 * 7rem + 4 * 0.5rem + 1rem)";return e?i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 pointer-events-auto",onClick:t,onContextMenu:xe=>xe.preventDefault(),children:i.jsxs("div",{ref:B,onClick:xe=>xe.stopPropagation(),onDragLeave:ae,className:"bg-gray-800 rounded-lg p-4 shadow-xl w-auto max-w-4xl max-h-[95vh] flex flex-col",children:[i.jsxs("div",{className:"flex justify-between items-center mb-2 flex-shrink-0",children:[i.jsx("h2",{className:"text-xl font-bold",children:n}),i.jsx("button",{onClick:t,className:"bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-1 px-3 rounded text-sm",children:x("close")})]}),i.jsx("div",{className:`bg-gray-900 rounded p-2 ${ne?"overflow-y-auto":""}`,style:ne?{height:de}:{},children:i.jsxs("div",{className:"grid grid-cols-5 gap-2",children:[he.map((xe,Z)=>{const Oe=K.findIndex(E=>E.id===xe.id),Re=C?C(xe):!0,Ce=Re,Le=y===xe.id,We=A===Z&&j!==Z,V=f&&Re&&!D,Ke=Le?.5:Re?1:.3;return i.jsx("div",{style:{opacity:Ke},draggable:V,onDragStart:()=>ke(xe,Oe),onDragOver:E=>ie(E,Z),onDragEnd:J,onDrop:E=>q(E,Z),onContextMenu:E=>{E.preventDefault(),E.stopPropagation(),s&&s(E,Oe)},onClick:()=>V&&(c==null?void 0:c(Oe)),onDoubleClick:()=>V&&(l==null?void 0:l(Oe)),"data-interactive":V,className:`w-28 h-28 relative transition-all rounded-lg
                    ${V?"cursor-grab active:cursor-grabbing":"cursor-default"}
                    ${We?"scale-105 z-10":""}
                    ${Le?"scale-95":"hover:scale-105"}
                  `,children:i.jsx("div",{className:`w-full h-full ${Ce&&C?"ring-3 ring-cyan-400 rounded-md shadow-[0_0_9px_#22d3ee]":""}`,children:i.jsx(Bn,{card:xe,isFaceUp:!0,playerColorMap:v,localPlayerId:w,imageRefreshVersion:_,disableActiveHighlights:!Re})})},`${xe.id}-${Z}`)}),he.length===0&&i.jsx("p",{className:"col-span-5 w-full text-center text-gray-400 py-8",children:x("empty")})]})}),i.jsx("p",{className:"text-gray-400 text-xs mt-2 text-center",children:x("dragCardsReorder")})]})}):null},ux=({isOpen:e,onClose:t,setDraggedItem:n,openContextMenu:r,canInteract:a,anchorEl:o,imageRefreshVersion:s})=>{const{t:l}=un(),[c,d]=m.useState(null),[f,h]=m.useState(!1),v=m.useRef(null),w=m.useRef(null);if(m.useEffect(()=>{e&&(d(null),h(!1),w.current=null)},[e]),!e||!o)return null;const _=(Yg[it.Tokens]||[]).filter(k=>!k.allowedPanels||k.allowedPanels.includes("TOKEN_PANEL")),C={position:"fixed",top:`${o.top}px`,left:`${o.left}px`,zIndex:60},D=k=>{a&&(d(k.id),w.current=k,h(!1))},x=k=>{if(!w.current||!v.current)return;const j=v.current.getBoundingClientRect(),$=k.clientX,A=k.clientY;($<j.left||$>j.right||A<j.top||A>j.bottom)&&(n({card:w.current,source:"token_panel"}),h(!0),t())},y=()=>{f||d(null),w.current=null};return i.jsx("div",{style:C,className:"pointer-events-auto",ref:v,onDragLeave:x,children:i.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 shadow-xl w-96 max-w-[90vw] h-auto flex flex-col",onClick:k=>k.stopPropagation(),children:[i.jsxs("div",{className:"flex justify-between items-center mb-2",children:[i.jsx("h2",{className:"text-xl font-bold",children:l("tokens")}),i.jsx("button",{onClick:t,className:"bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-1 px-3 rounded text-sm",children:l("close")})]}),i.jsx("div",{className:"flex-grow bg-gray-900 rounded p-2 overflow-y-auto",children:i.jsx("div",{className:"grid grid-cols-3 gap-2",children:_.map(k=>{const j=c===k.id,$=j?.5:1;return i.jsx("div",{style:{opacity:$},draggable:a,onDragStart:()=>D(k),onDragEnd:y,onContextMenu:A=>a&&r(A,"token_panel_item",{card:k}),"data-interactive":a,className:`w-24 h-24 transition-all rounded-lg ${a?"cursor-grab active:cursor-grabbing hover:scale-105":"cursor-not-allowed"} ${j?"scale-95":""}`,children:i.jsx(Bn,{card:k,isFaceUp:!0,playerColorMap:new Map,imageRefreshVersion:s})},k.id)})})}),i.jsx("p",{className:"text-gray-400 text-xs mt-2 text-center",children:l("dragOutsideToPlaceToken")})]})})},fx="https://res.cloudinary.com/dxxh6meej/image/upload/v1763653192/background_counter_socvss.png",px=({isOpen:e,onClose:t,canInteract:n,anchorEl:r,imageRefreshVersion:a,onCounterMouseDown:o,cursorStack:s})=>{const{getCounterTranslation:l,t:c}=un(),[d,f]=m.useState(null),[h,v]=m.useState({x:0,y:0}),w=m.useMemo(()=>Jg(),[wu().size]);if(!e||!r)return null;const _={position:"fixed",top:`${r.top}px`,left:`${r.left}px`,zIndex:60},C=$=>{let A=Vo[$];if(A&&a){const M=A.includes("?")?"&":"?";A=`${A}${M}v=${a}`}return A},D=($,A,M)=>{if($.button===2){const K=l(A),ee=K?K.name:M,re=K?K.description:ac[A]||"",Ie={id:`tooltip_${A}_${Date.now()}`,deck:"counter",name:ee,imageUrl:"",fallbackImage:"",power:0,ability:re,types:[],statuses:[]};f(Ie),v({x:$.clientX,y:$.clientY})}else $.button===0&&n&&o(A,$)},x=()=>{f(null)},y=$=>{d&&v({x:$.clientX,y:$.clientY})},k=()=>{s&&t(),f(null)},j=$=>{const A=$.currentTarget.getBoundingClientRect(),M=$.clientX,K=$.clientY;(M<A.left||M>=A.right||K<A.top||K>=A.bottom)&&t()};return i.jsxs(i.Fragment,{children:[i.jsx("div",{style:_,className:"pointer-events-auto counter-modal-content",onMouseLeave:k,onDragLeave:j,children:i.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 shadow-xl w-80 max-w-[90vw] h-auto flex flex-col",onClick:$=>$.stopPropagation(),children:[i.jsxs("div",{className:"mb-2",children:[i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsx("h2",{className:"text-xl font-bold",children:c("counters")}),i.jsx("button",{onClick:t,className:"bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-1 px-3 rounded text-sm",children:c("close")})]}),i.jsx("p",{className:"text-xs text-gray-400 mt-1",children:c("holdRightClickViewHints")})]}),i.jsx("div",{className:"bg-gray-900 rounded p-4",children:i.jsx("div",{className:"grid grid-cols-4 gap-1",children:w.map($=>{const A=C($.type),M=$.type.startsWith("Power"),K=l($.type),ee=K?K.name:$.label;return i.jsx("button",{onContextMenu:re=>re.preventDefault(),onMouseDown:re=>D(re,$.type,ee),onMouseUp:x,onMouseMove:y,className:`w-12 h-12 rounded-full border-white flex items-center justify-center shadow-lg mx-auto relative select-none ${n?"cursor-pointer hover:ring-2 ring-indigo-400":"cursor-not-allowed"}`,style:{backgroundImage:`url(${fx})`,backgroundSize:"contain",backgroundPosition:"center",backgroundRepeat:"no-repeat"},children:A?i.jsx("img",{src:A,alt:ee,className:"w-full h-full object-contain p-1 pointer-events-none"}):i.jsx("span",{className:`font-bold text-white pointer-events-none ${M?"text-sm":"text-lg"}`,style:{textShadow:"0 0 2px black"},children:M?ee:$.type.charAt(0)})},$.type)})})})]})}),d&&i.jsx(Qg,{x:h.x,y:h.y,children:i.jsx(Ic,{card:d,statusDescriptions:ac})})]})},dy=({player:e,onDragStart:t})=>{const n=Kn[e.color]||Kn.blue;return i.jsxs("div",{draggable:!0,onDragStart:r=>t(r,e.id),className:"flex items-center gap-2 bg-gray-600 p-2 rounded-md cursor-grab active:cursor-grabbing",children:[i.jsx("div",{className:`w-4 h-4 rounded-full ${n.bg} border border-white/50`}),i.jsx("span",{className:"font-medium",children:e.name})]})},ph=({teamId:e,teamName:t,players:n,capacity:r,onDrop:a,onDragOver:o,onDragLeave:s,onPlayerDragStart:l,isOver:c})=>i.jsxs("div",{onDrop:d=>a(d,e),onDragOver:o,onDragLeave:s,className:`bg-gray-800 p-4 rounded-lg border-2 ${c?"border-indigo-500":"border-gray-700"} transition-colors`,children:[i.jsxs("h3",{className:"text-lg font-bold mb-3 border-b border-gray-700 pb-2",children:[t," (",n.length,"/",r,")"]}),i.jsx("div",{className:"space-y-2 min-h-[4rem]",children:n.map(d=>i.jsx(dy,{player:d,onDragStart:l},d.id))})]}),hx=({players:e,gameMode:t,onCancel:n,onConfirm:r})=>{const{t:a}=un(),[o,s]=m.useState(e),[l,c]=m.useState([]),[d,f]=m.useState([]),[h,v]=m.useState(null),[w,_]=m.useState(null),{team1Capacity:C,team2Capacity:D}=m.useMemo(()=>t===Kr.TwoVTwo?{team1Capacity:2,team2Capacity:2}:t===Kr.ThreeVOne?{team1Capacity:3,team2Capacity:1}:(console.warn(`Unexpected gameMode: ${t}, falling back to TwoVTwo capacities`),{team1Capacity:2,team2Capacity:2}),[t]),x=o.length===0&&l.length===C&&d.length===D,y=(A,M)=>{A.dataTransfer.effectAllowed="move",v(M)},k=A=>{A.preventDefault(),A.dataTransfer.dropEffect="move"},j=(A,M)=>{if(A.preventDefault(),h===null)return;const K=e.find(ke=>ke.id===h);if(!K)return;const ee=[...o],re=[...l],Ie=[...d],B=ee.findIndex(ke=>ke.id===h);B>-1&&ee.splice(B,1);const fe=re.findIndex(ke=>ke.id===h);fe>-1&&re.splice(fe,1);const he=Ie.findIndex(ke=>ke.id===h);he>-1&&Ie.splice(he,1),M===1&&re.length<C?re.push(K):M===2&&Ie.length<D?Ie.push(K):ee.push(K),s(ee),c(re),f(Ie),v(null),_(null)},$=()=>{if(!x)return;const A={1:l.map(M=>M.id),2:d.map(M=>M.id)};r(A)};return i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",children:i.jsxs("div",{className:"bg-gray-900 border border-gray-700 rounded-lg p-8 shadow-xl w-full max-w-4xl",children:[i.jsx("h2",{className:"text-3xl font-bold mb-2",children:a("assignTeams")}),i.jsx("p",{className:"text-gray-400 mb-6",children:a("dragToReorder")}),i.jsxs("div",{className:"grid grid-cols-3 gap-6",children:[i.jsxs("div",{onDrop:A=>j(A,"unassigned"),onDragOver:A=>{k(A),_("unassigned")},onDragLeave:()=>_(null),className:`bg-gray-800 p-4 rounded-lg border-2 ${w==="unassigned"?"border-indigo-500":"border-gray-700"} transition-colors`,children:[i.jsx("h3",{className:"text-lg font-bold mb-3 border-b border-gray-700 pb-2",children:a("unassigned")}),i.jsx("div",{className:"space-y-2",children:o.map(A=>i.jsx(dy,{player:A,onDragStart:y},A.id))})]}),i.jsx(ph,{teamId:1,teamName:`${a("team")} 1`,players:l,capacity:C,onDrop:j,onDragOver:A=>{k(A),_(1)},onDragLeave:()=>_(null),onPlayerDragStart:y,isOver:w===1}),i.jsx(ph,{teamId:2,teamName:`${a("team")} 2`,players:d,capacity:D,onDrop:j,onDragOver:A=>{k(A),_(2)},onDragLeave:()=>_(null),onPlayerDragStart:y,isOver:w===2})]}),i.jsxs("div",{className:"flex justify-end mt-8 space-x-4",children:[i.jsx("button",{type:"button",onClick:n,className:"bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded",children:a("cancel")}),i.jsx("button",{type:"button",onClick:$,disabled:!x,className:"bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors",children:a("confirmTeams")})]})]})})},mx=({players:e,localPlayer:t,onReady:n,onCancel:r})=>{const{t:a}=un(),o=()=>{t.isReady||n()};return i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",children:i.jsxs("div",{className:"bg-gray-800 rounded-lg p-8 shadow-xl w-full max-w-md",children:[i.jsx("h2",{className:"text-2xl font-bold mb-4 text-center",children:a("readyToStart")}),i.jsx("p",{className:"text-gray-400 text-center mb-6",children:a("gameWillBegin")}),i.jsx("ul",{className:"space-y-3 mb-8",children:e.map(s=>i.jsxs("li",{className:"flex items-center justify-between bg-gray-700 p-3 rounded-lg",children:[i.jsxs("span",{className:"font-medium",children:[s.name," ",s.id===t.id&&a("youLabel")]}),s.isReady?i.jsxs("span",{className:"flex items-center text-green-400",children:[i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-1",viewBox:"0 0 20 20",fill:"currentColor",children:i.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),a("ready")]}):i.jsxs("span",{className:"flex items-center text-yellow-400",children:[i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-1 animate-pulse",viewBox:"0 0 20 20",fill:"currentColor",children:i.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 102 0V6zM9 14a1 1 0 112 0 1 1 0 01-2 0z",clipRule:"evenodd"})}),a("waiting")]})]},s.id))}),i.jsxs("div",{className:"flex flex-col space-y-3",children:[i.jsx("button",{onClick:o,disabled:t.isReady,className:"w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors text-lg",children:t.isReady?a("waitingForOthers"):a("imReady")}),i.jsx("button",{onClick:r,className:"w-full bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded transition-colors",children:a("cancelStart")})]})]})})},uy=({card:e,ownerPlayer:t,onClose:n,statusDescriptions:r,allPlayers:a,imageRefreshVersion:o})=>{var j,$,A,M,K;const{getCardTranslation:s,getCounterTranslation:l,resources:c}=un(),d=c.abilityKeywords,[f,h]=m.useState(e.imageUrl),v=e.baseId?s(e.baseId):void 0,w=v?{...e,...v}:e;m.useEffect(()=>{let ee=e.imageUrl;if(o&&ee){const re=ee.includes("?")?"&":"?";ee=`${ee}${re}v=${o}`}h(ee)},[e.imageUrl,o]);const _=()=>{let ee=e.fallbackImage;if(o&&ee){const re=ee.includes("?")?"&":"?";ee=`${ee}${re}v=${o}`}f!==ee&&h(ee)},C=t==null?void 0:t.color,D=C?((j=Kn[C])==null?void 0:j.border)||(($=Eu[e.deck])==null?void 0:$.color)||"border-gray-300":((A=Eu[e.deck])==null?void 0:A.color)||"border-gray-300",x=m.useMemo(()=>(t==null?void 0:t.teamId)===void 0?null:`Team ${t.teamId}`,[t]),y=["readyDeploy","readySetup","readyCommit"],k=(e.statuses??[]).reduce((ee,re)=>(y.includes(re.type)||(ee[re.type]||(ee[re.type]=[]),ee[re.type].push(re.addedByPlayerId)),ee),{});return i.jsx("div",{onClick:n,className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-[300]",children:i.jsxs("div",{onClick:ee=>ee.stopPropagation(),className:`bg-gray-800 rounded-lg shadow-2xl w-full max-w-4xl h-[40rem] p-6 flex gap-6 border-4 ${D}`,children:[i.jsx("div",{className:"w-1/2 h-full flex-shrink-0",children:f?i.jsx("img",{src:f,onError:_,alt:w.name,className:"w-full h-full object-contain rounded-lg"}):i.jsx("div",{className:"w-full h-full bg-gray-700 rounded-lg flex items-center justify-center text-2xl font-bold text-center p-4",children:w.name})}),i.jsxs("div",{className:"w-1/2 h-full flex flex-col gap-4 overflow-y-auto pr-2 text-left",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-4xl font-bold",children:w.name}),i.jsx("p",{className:"text-lg text-gray-400 capitalize",children:((M=w.types)==null?void 0:M.join(", "))||`${w.deck} Card`})]}),i.jsxs("div",{className:"bg-gray-900 p-4 rounded-lg",children:[i.jsxs("p",{children:[i.jsx("strong",{className:"text-indigo-400 text-lg",children:"Power:"})," ",i.jsx("span",{className:"text-xl font-bold",children:w.power})]}),i.jsxs("p",{className:"mt-2",children:[i.jsx("strong",{className:"text-indigo-400 text-lg",children:"Ability:"})," ",i.jsx("span",{className:"text-gray-200 text-base",children:Af(w.ability,d)})]})]}),t&&i.jsxs("div",{className:"bg-gray-900 p-4 rounded-lg text-sm",children:[i.jsxs("p",{children:[i.jsx("strong",{className:"text-indigo-400",children:"Owner:"})," ",t.name]}),x&&i.jsxs("p",{className:"mt-1",children:[i.jsx("strong",{className:"text-indigo-400",children:"Team:"})," ",x]})]}),e.statuses&&e.statuses.length>0&&i.jsxs("div",{className:"bg-gray-900 p-4 rounded-lg",children:[i.jsx("h3",{className:"text-indigo-400 text-lg font-bold mb-2",children:"Statuses"}),i.jsx("ul",{className:"space-y-2 text-sm",children:Object.entries(k).map(([ee,re])=>{const Ie=re.reduce((ke,ie)=>(ke[ie]=(ke[ie]||0)+1,ke),{}),B=Object.entries(Ie).map(([ke,ie])=>{var J;return`${((J=a.find(q=>q.id===Number(ke)))==null?void 0:J.name)||`Player ${ke}`} (x${ie})`}).join(", "),fe=l(ee),he=fe?fe.description:r[ee]||"No description available.";return i.jsxs("li",{children:[i.jsx("strong",{className:"text-gray-200",children:ee})," ",i.jsxs("span",{className:"text-gray-400 text-xs ml-1",children:["- ",B]}),i.jsx("p",{className:"text-gray-400 text-xs pl-2 mt-0.5",children:he})]},ee)})})]}),w.flavorText&&i.jsxs("div",{className:"bg-gray-900 p-4 rounded-lg",children:[i.jsx("h3",{className:"text-indigo-400 font-bold mb-1",children:"Flavor Text"}),i.jsx("p",{className:"italic text-gray-400",children:(K=w.flavorText)==null?void 0:K.split(`
`).map((ee,re)=>i.jsxs(ca.Fragment,{children:[re>0&&i.jsx("br",{}),ee]},re))})]}),i.jsx("button",{onClick:n,className:"mt-auto bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded self-end",children:"Close"})]})]})})},gx=({fromPlayer:e,cardCount:t,onAccept:n,onDecline:r})=>i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[105]",children:i.jsxs("div",{className:"bg-gray-800 rounded-lg p-8 shadow-xl w-full max-w-md text-center",children:[i.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Reveal Request"}),i.jsxs("p",{className:"text-gray-300 mb-6",children:[i.jsx("span",{className:"font-bold",children:e.name})," would like to see ",t>1?`${t} of your hidden cards`:"one of your hidden cards","."]}),i.jsxs("div",{className:"flex justify-center space-x-4",children:[i.jsx("button",{onClick:r,className:"bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-6 rounded transition-colors",children:"Decline"}),i.jsx("button",{onClick:n,className:"bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded transition-colors",children:"Accept"})]})]})}),fy=({x:e,y:t,items:n,onClose:r})=>{const a=m.useRef(null),[o,s]=m.useState({top:t,left:e});return m.useEffect(()=>{if(a.current){const{innerWidth:l,innerHeight:c}=window,{offsetWidth:d,offsetHeight:f}=a.current,h=e+d>l?l-d-10:e,v=t+f>c?c-f-10:t;s({top:v,left:h})}},[e,t,n]),Nf.createPortal(i.jsx("div",{ref:a,className:"fixed bg-gray-900 border border-gray-700 rounded-md shadow-lg z-[9999] py-1",style:{top:o.top,left:o.left,opacity:a.current?1:0},onClick:l=>l.stopPropagation(),children:n.map((l,c)=>"isDivider"in l?i.jsx("hr",{className:"border-gray-700 my-1"},`divider-${c}`):"onClick"in l?i.jsx("button",{onClick:()=>{l.disabled||(l.onClick(),r())},disabled:l.disabled,className:"block w-full text-left px-4 py-1 text-sm text-white hover:bg-indigo-600 disabled:text-gray-500 disabled:cursor-not-allowed disabled:bg-gray-800",style:{fontWeight:l.isBold?"bold":"normal"},children:l.label},c):i.jsxs("div",{className:"flex items-center justify-between px-4 py-1 text-sm text-white w-full space-x-2",children:[i.jsx("button",{onClick:d=>{d.stopPropagation(),l.onRemove()},disabled:l.removeDisabled,className:"w-7 h-6 flex items-center justify-center bg-gray-700 hover:bg-red-600 rounded disabled:bg-gray-800 disabled:text-gray-500 disabled:cursor-not-allowed font-mono text-lg",children:"-"}),i.jsx("span",{className:"flex-grow text-center",children:l.label}),i.jsx("button",{onClick:d=>{d.stopPropagation(),l.onAdd()},className:"w-7 h-6 flex items-center justify-center bg-gray-700 hover:bg-green-600 rounded font-mono text-lg",children:"+"})]},c))}),document.body)},yx=({isOpen:e,card:t,playerColorMap:n,onConfirm:r,onCancel:a})=>{const{getCardTranslation:o,t:s,resources:l}=un(),c=l.abilityKeywords,d=t.baseId?o(t.baseId):void 0,f=d?{...t,...d}:t,h=f.ability||"",v=ca.useMemo(()=>h.split("").map(_=>_.trim()).filter(_=>_.length>0),[h]);return e?i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-[200] backdrop-blur-sm",children:i.jsxs("div",{className:"bg-gray-900 rounded-xl border-2 border-yellow-500 shadow-2xl p-6 w-full max-w-4xl flex gap-6",children:[i.jsxs("div",{className:"w-1/3 flex flex-col items-center justify-center border-r border-gray-700 pr-6",children:[i.jsx("div",{className:"w-72 h-72 relative transform hover:scale-105 transition-transform duration-300",children:i.jsx(Bn,{card:f,isFaceUp:!0,playerColorMap:n,disableTooltip:!0})}),i.jsx("h2",{className:"text-2xl font-bold text-yellow-500 mt-6 text-center leading-tight",children:f.name})]}),i.jsxs("div",{className:"w-2/3 flex flex-col",children:[i.jsx("h3",{className:"text-xl font-bold text-white mb-4 border-b border-gray-700 pb-2",children:"Select Module"}),i.jsxs("div",{className:"flex flex-col gap-3 flex-grow justify-center overflow-y-auto max-h-[60vh] pr-2",children:[v.map((w,_)=>i.jsxs("button",{onClick:()=>r(_),className:"group relative bg-gray-800 hover:bg-indigo-900 border-2 border-gray-600 hover:border-indigo-400 rounded-lg p-4 transition-all duration-200 text-left shadow-lg hover:shadow-indigo-500/20 flex items-start gap-4 shrink-0",children:[i.jsx("div",{className:"bg-gray-700 text-gray-400 w-6 h-6 flex-shrink-0 flex items-center justify-center rounded-full font-bold text-xs group-hover:bg-indigo-500 group-hover:text-white transition-colors mt-1",children:_+1}),i.jsx("div",{className:"text-gray-200 group-hover:text-white text-base font-medium leading-snug",children:Af(w,c)})]},_)),v.length===0&&i.jsx("div",{className:"text-gray-500 text-center italic",children:"No selectable modules found on this card."})]}),i.jsx("div",{className:"mt-6 flex justify-end",children:i.jsx("button",{onClick:a,className:"px-6 py-2 rounded bg-gray-700 hover:bg-gray-600 text-white font-bold transition-colors text-sm",children:s("cancel")})})]})]})}):null},vx=m.memo(({isOpen:e,onClose:t,onJoin:n,games:r,onRefreshGames:a})=>{const{t:o}=un(),[s,l]=m.useState(""),c=m.useCallback(()=>{s.trim()&&n(s.trim().toUpperCase())},[s,n]),d=m.useCallback(v=>{n(v)},[n]),f=m.useCallback(v=>{l(v.target.value)},[l]),h=m.useMemo(()=>r.map(v=>i.jsx("li",{children:i.jsxs("button",{onClick:()=>d(v.gameId),className:"w-full text-left p-4 bg-gray-700 hover:bg-indigo-600 hover:border-indigo-400 border border-gray-600 rounded-lg transition-all shadow-md group flex flex-col gap-2",children:[i.jsxs("div",{className:"flex justify-between items-center w-full",children:[i.jsx("span",{className:"text-xs font-bold text-gray-400 group-hover:text-indigo-200 uppercase tracking-wider",children:o("gameCode")}),i.jsxs("span",{className:"bg-gray-800 px-2 py-1 rounded-full text-xs font-bold border border-gray-600 group-hover:border-indigo-300",children:[v.playerCount," / 4"]})]}),i.jsx("span",{className:"block font-mono text-xl text-indigo-300 group-hover:text-white font-bold truncate",children:v.gameId})]})},v.gameId)),[r,d,o]);return e?i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-[5px]",children:i.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 shadow-xl w-full max-w-6xl flex flex-col max-h-[calc(100vh-10px)]",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-4 flex-shrink-0",children:[i.jsx("h2",{className:"text-2xl font-bold",children:o("joinGame")}),i.jsx("button",{onClick:a,className:"w-8 h-8 flex items-center justify-center bg-gray-700 hover:bg-gray-600 text-white rounded transition-colors",title:"Refresh games",children:""})]}),i.jsx("h3",{className:"text-lg font-semibold text-gray-300 mb-2 flex-shrink-0",children:o("activeGames")}),i.jsx("div",{className:"flex-grow overflow-y-auto pr-2 border-b border-gray-700 pb-4 mb-4 custom-scrollbar min-h-[100px]",children:r.length>0?i.jsx("ul",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:h}):i.jsx("div",{className:"flex items-center justify-center h-full min-h-[150px]",children:i.jsxs("p",{className:"text-gray-400 text-center opacity-70",children:[o("noActiveGames")," ",i.jsx("br",{}),i.jsx("span",{className:"text-sm",children:o("createOne")})]})})}),i.jsxs("div",{className:"flex-shrink-0",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-300 mb-2",children:o("orJoinWithCode")}),i.jsxs("div",{className:"flex space-x-2",children:[i.jsx("input",{type:"text",value:s,onChange:f,placeholder:o("enterGameId"),className:"flex-grow bg-gray-700 border border-gray-600 text-white font-mono rounded-lg p-2 focus:ring-indigo-500 focus:border-indigo-500",onKeyDown:v=>v.key==="Enter"&&c()}),i.jsx("button",{onClick:c,disabled:!s.trim(),className:"bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-6 rounded disabled:bg-gray-600 disabled:cursor-not-allowed transition-colors",children:o("join")})]}),i.jsx("div",{className:"flex justify-end mt-6",children:i.jsx("button",{type:"button",onClick:t,className:"bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-6 rounded transition-colors",children:o("cancel")})})]})]})}):null}),bx=({isOpen:e,onClose:t,setViewingCard:n})=>{const{getCardTranslation:r,t:a}=un(),[,o]=m.useState(0);m.useEffect(()=>{const q=()=>{const ne=wu();if(ne.size>0){o(ne.size);return}else{const de=setTimeout(q,100);return()=>clearTimeout(de)}};return q()},[]);const s=m.useMemo(()=>qg().filter(({card:q})=>{var H;return(H=q.allowedPanels)==null?void 0:H.includes("DECK_BUILDER")}),[wu().size]),l=Ub(),[c,d]=m.useState("My Custom Deck"),[f,h]=m.useState(new Map),[v,w]=m.useState("All"),[_,C]=m.useState(""),[D,x]=m.useState(""),[y,k]=m.useState([]),[j,$]=m.useState(!1),A=m.useRef(null),M=m.useRef(null);m.useEffect(()=>{const q=H=>{M.current&&!M.current.contains(H.target)&&$(!1)};return document.addEventListener("mousedown",q),()=>document.removeEventListener("mousedown",q)},[]);const K=m.useMemo(()=>{const q=new Set;return s.forEach(({card:H})=>{var ne;return(ne=H.types)==null?void 0:ne.forEach(de=>q.add(de))}),Array.from(q).sort()},[s]),ee=m.useMemo(()=>s.filter(({id:H,card:ne})=>{var Oe;const de=r(H),xe=(de==null?void 0:de.name)||ne.name,Z=(de==null?void 0:de.ability)||ne.ability||"";if(_){const Re=_.toLowerCase();if(!xe.toLowerCase().includes(Re)&&!Z.toLowerCase().includes(Re))return!1}if(D!==""&&ne.power!==Number(D))return!1;if(y.length>0){const Re=ne.types||[];if(!y.every(Le=>Re.includes(Le)))return!1}if(v!=="All"){if(v==="Command")return Tl.has(H)||((Oe=ne.types)==null?void 0:Oe.includes("Command"));if(v==="Neutral")return ne.faction==="Neutral";if(ne.faction!==v)return!1}return!0}),[s,v,_,D,y,r]),re=m.useMemo(()=>{let q=0;return f.forEach(H=>q+=H),q},[f]),Ie=q=>{var Oe,Re,Ce;if(re>=Do){alert(`Deck cannot exceed ${Do} cards.`);return}const H=Wo(q),ne=(Oe=H==null?void 0:H.types)==null?void 0:Oe.includes("Hero"),de=(Re=H==null?void 0:H.types)==null?void 0:Re.includes("Rarity"),xe=Tl.has(q)||((Ce=H==null?void 0:H.types)==null?void 0:Ce.includes("Command")),Z=ne||de?1:xe?2:3;h(Le=>{const We=new Map(Le),V=We.get(q)||0;return V>=Z||We.set(q,V+1),We})},B=q=>{h(H=>{const ne=new Map(H),de=ne.get(q)||0;return de>1?ne.set(q,de-1):ne.delete(q),ne})},fe=()=>{confirm("Are you sure you want to clear the current deck?")&&(h(new Map),d("My Custom Deck"))},he=q=>{x(H=>{const de=(H===""?0:H)+q;return de<0?0:de})},ke=q=>{k(H=>H.includes(q)?H.filter(ne=>ne!==q):H.length>=10?H:[...H,q])},ie=()=>{if(re===0){alert(a("cannotSaveEmptyDeck")||"Cannot save an empty deck.");return}const q={deckName:c.trim()||"Untitled Deck",cards:Array.from(f.entries()).map(([Z,Oe])=>({cardId:Z,quantity:Oe}))},H=lx(q),ne=new Blob([H],{type:"text/plain;charset=utf-8"}),de=URL.createObjectURL(ne),xe=document.createElement("a");xe.href=de,xe.download=`${q.deckName.replace(/[^a-z0-9]/gi,"_").toLowerCase()}.txt`,document.body.appendChild(xe),xe.click(),document.body.removeChild(xe),URL.revokeObjectURL(de)},ae=()=>{var q;(q=A.current)==null||q.click()},J=q=>{var de;const H=(de=q.target.files)==null?void 0:de[0];if(!H)return;const ne=new FileReader;ne.onload=xe=>{var Z;try{const Oe=(Z=xe.target)==null?void 0:Z.result,Re=ay(Oe);if(!Re.isValid){alert(Re.error);return}const{deckFile:Ce}=Re;d(Ce.deckName);const Le=new Map;Ce.cards.forEach(We=>Le.set(We.cardId,We.quantity)),h(Le)}catch{alert(a("failedToParseDeckFile")||"Failed to parse deck file.")}finally{q.target&&(q.target.value="")}},ne.readAsText(H)};return e?i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50",children:i.jsxs("div",{className:"bg-gray-900 w-full h-full md:w-[95vw] md:h-[90vh] md:rounded-xl flex flex-col overflow-hidden shadow-2xl border border-gray-700",children:[i.jsxs("div",{className:"bg-gray-800 p-4 border-b border-gray-700 flex justify-between items-center flex-shrink-0",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("h2",{className:"text-2xl font-bold text-white",children:a("deckBuilding")}),i.jsx("input",{type:"text",value:c,onChange:q=>d(q.target.value),className:"bg-gray-700 text-white px-3 py-1 rounded border border-gray-600 focus:outline-none focus:border-indigo-500 font-bold",placeholder:"Deck Name"})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("button",{onClick:fe,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded text-sm font-bold transition-colors",children:a("clear")}),i.jsx("button",{onClick:ae,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded text-sm font-bold transition-colors",children:a("loadTextDeck")}),i.jsx("input",{type:"file",ref:A,onChange:J,accept:".txt",className:"hidden"}),i.jsx("button",{onClick:ie,className:"px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded text-sm font-bold transition-colors",children:a("saveText")}),i.jsx("div",{className:"w-px h-8 bg-gray-600 mx-2"}),i.jsx("button",{onClick:t,className:"px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded text-sm font-bold transition-colors",children:a("close")})]})]}),i.jsxs("div",{className:"flex flex-grow overflow-hidden",children:[i.jsxs("div",{className:"flex-grow flex flex-col p-4 overflow-hidden border-r border-gray-700 bg-gray-900/50",children:[i.jsxs("div",{className:"mb-4 flex flex-wrap items-center gap-4 bg-gray-800 p-2 rounded-lg border border-gray-700 relative z-40",children:[i.jsxs("div",{className:"relative",children:[i.jsx("div",{className:"absolute inset-y-0 left-0 pl-2 flex items-center pointer-events-none",children:i.jsx("svg",{className:"h-4 w-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),i.jsx("input",{type:"text",value:_,onChange:q=>C(q.target.value),placeholder:"Search...",className:"pl-8 pr-6 py-1 bg-gray-700 text-white border border-gray-600 rounded text-sm focus:outline-none focus:border-indigo-500 w-32 md:w-48"}),_&&i.jsx("button",{onClick:()=>C(""),className:"absolute inset-y-0 right-0 pr-2 flex items-center text-gray-400 hover:text-white",title:"Clear Search",children:i.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"text-gray-400 text-sm font-bold",children:"Pow:"}),i.jsxs("div",{className:"flex items-center bg-gray-700 rounded border border-gray-600 overflow-hidden",children:[i.jsx("button",{onClick:()=>he(-1),className:"px-2 py-1 hover:bg-gray-600 text-white font-bold border-r border-gray-600 active:bg-gray-500",children:"-"}),i.jsx("div",{className:"w-8 text-center text-sm font-bold text-white select-none",children:D===""?"-":D}),i.jsx("button",{onClick:()=>he(1),className:"px-2 py-1 hover:bg-gray-600 text-white font-bold border-l border-gray-600 active:bg-gray-500",children:"+"})]}),D!==""&&i.jsx("button",{onClick:()=>x(""),className:"p-1 bg-gray-700 hover:bg-red-600 text-gray-400 hover:text-white rounded transition-colors",title:"Reset Power Filter",children:i.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsxs("div",{className:"relative",ref:M,children:[i.jsxs("button",{onClick:()=>$(!j),className:`px-3 py-1 bg-gray-700 text-white border border-gray-600 rounded text-sm flex items-center gap-2 focus:outline-none hover:bg-gray-600 ${y.length>0?"border-indigo-500 text-indigo-300":""}`,children:[i.jsxs("span",{children:["Types ",y.length>0?`(${y.length})`:""]}),i.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),j&&i.jsxs("div",{className:"absolute top-full left-0 mt-1 w-48 bg-gray-800 border border-gray-600 rounded shadow-xl z-50 max-h-60 overflow-y-auto p-1",children:[i.jsx("div",{className:"px-2 py-1 text-xs text-gray-400 border-b border-gray-700 mb-1",children:"Match ALL selected"}),K.map(q=>i.jsxs("label",{className:"flex items-center px-2 py-1.5 hover:bg-gray-700 rounded cursor-pointer",children:[i.jsx("input",{type:"checkbox",checked:y.includes(q),onChange:()=>ke(q),className:"form-checkbox h-4 w-4 text-indigo-600 rounded border-gray-500 bg-gray-700 focus:ring-indigo-500"}),i.jsx("span",{className:"ml-2 text-sm text-gray-200",children:q})]},q))]})]}),y.length>0&&i.jsx("button",{onClick:()=>k([]),className:"p-1 bg-gray-700 hover:bg-red-600 text-gray-400 hover:text-white rounded transition-colors",title:"Clear Types",children:i.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsxs("select",{value:v,onChange:q=>w(q.target.value),className:`bg-gray-700 text-white border border-gray-600 rounded px-2 py-1 text-sm focus:outline-none focus:border-indigo-500 max-w-[140px] ${v!=="All"?"border-indigo-500 text-indigo-300":""}`,children:[i.jsx("option",{value:"All",children:"All Factions"}),l.map(q=>i.jsx("option",{value:q.id,children:q.name},q.id)),i.jsx("option",{value:"Neutral",children:"Neutral"}),i.jsx("option",{value:"Command",children:"Command Cards"})]}),v!=="All"&&i.jsx("button",{onClick:()=>w("All"),className:"p-1 bg-gray-700 hover:bg-red-600 text-gray-400 hover:text-white rounded transition-colors",title:"Reset Faction",children:i.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),i.jsx("span",{className:"ml-auto text-gray-500 text-xs hidden xl:inline",children:"Right-click to view card details"})]}),i.jsx("div",{className:"flex-grow overflow-y-auto pr-2",children:i.jsxs("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 xl:grid-cols-7 gap-2",children:[ee.map(({id:q,card:H})=>{const ne={...H,id:q,baseId:q,deck:H.faction==="Neutral"?it.Neutral:H.faction||it.Custom,ownerId:0};return i.jsxs("div",{className:"relative group cursor-pointer",onClick:()=>Ie(q),onContextMenu:de=>{de.preventDefault(),n({card:ne})},children:[i.jsx("div",{className:"w-full aspect-square transition-transform duration-100 hover:scale-105 hover:shadow-lg hover:z-[100]",children:i.jsx(Bn,{card:ne,isFaceUp:!0,playerColorMap:new Map,extraPowerSpacing:!0})}),i.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black/80 text-white text-[10px] text-center py-0.5 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none truncate px-1",children:a("clickToAdd")})]},q)}),ee.length===0&&i.jsx("div",{className:"col-span-full text-center text-gray-500 py-10",children:"No cards match your filters."})]})})]}),i.jsxs("div",{className:"w-80 md:w-96 bg-gray-800 flex flex-col border-l border-gray-700 flex-shrink-0",children:[i.jsxs("div",{className:"p-4 bg-gray-800 border-b border-gray-600",children:[i.jsx("h3",{className:"text-xl font-bold text-white",children:a("currentDeck")}),i.jsxs("p",{className:`text-sm font-bold mt-1 ${re>Do?"text-red-500":"text-indigo-400"}`,children:[re," / ",Do," Cards"]})]}),i.jsxs("div",{className:"flex-grow overflow-y-auto p-2 space-y-2",children:[f.size===0&&i.jsxs("div",{className:"text-center text-gray-500 mt-10",children:[i.jsx("p",{children:a("emptyDeck")}),i.jsx("p",{className:"text-xs mt-2",children:a("clickToAdd")})]}),Array.from(f.entries()).map(([q,H])=>{var V,Ke,E;const ne=Wo(q);if(!ne)return null;const de={...ne,id:q,baseId:q,deck:ne.faction==="Neutral"?it.Neutral:ne.faction||it.Custom,ownerId:0},xe=r(q),Z=xe?xe.name:ne.name,Oe=(V=ne.types)==null?void 0:V.includes("Hero"),Re=(Ke=ne.types)==null?void 0:Ke.includes("Rarity"),Ce=Tl.has(q)||((E=ne.types)==null?void 0:E.includes("Command")),Le=Oe||Re?1:Ce?2:3,We=Oe||Re?"Max 1 (Rarity/Hero)":Ce?"Max 2 (Command)":"Max 3";return i.jsxs("div",{className:"flex items-center bg-gray-700 rounded p-2 group hover:bg-gray-600 transition-colors select-none",children:[i.jsx("div",{className:"w-12 h-12 flex-shrink-0 mr-3 cursor-pointer",onContextMenu:U=>{U.preventDefault(),n({card:de})},children:i.jsx(Bn,{card:de,isFaceUp:!0,playerColorMap:new Map,hidePower:!0})}),i.jsxs("div",{className:"flex-grow min-w-0",children:[i.jsx("div",{className:"font-bold text-sm text-white truncate",children:Z}),i.jsxs("div",{className:"text-xs text-gray-400 truncate",children:[ne.faction," ",Oe||Re?"(Hero/Rarity)":""]})]}),i.jsxs("div",{className:"flex items-center gap-2 ml-2",children:[i.jsx("button",{onClick:()=>B(q),className:"w-6 h-6 flex items-center justify-center bg-gray-800 hover:bg-red-900 text-gray-300 rounded text-sm font-bold",title:"Remove one",children:"-"}),i.jsx("span",{className:"font-bold text-white w-4 text-center",children:H}),i.jsx("button",{onClick:()=>Ie(q),className:"w-6 h-6 flex items-center justify-center bg-gray-800 hover:bg-green-900 text-gray-300 rounded text-sm font-bold disabled:opacity-30 disabled:cursor-not-allowed",title:We,disabled:H>=Le,children:"+"})]})]},q)})]})]})]})]})}):null},xx=({isOpen:e,onClose:t,onSave:n,connectionStatus:r,onReconnect:a,gameId:o=null,isGameStarted:s=!1,isPrivate:l=!1,webrtcEnabled:c=!1,onWebrtcToggle:d})=>{const{language:f,setLanguage:h,t:v}=un(),[w,_]=m.useState(""),[C,D]=m.useState(!1),[x,y]=m.useState(!1),[k,j]=m.useState(!1),[$,A]=m.useState(!1),[M,K]=m.useState(c),ee=r==="Connected";if(m.useEffect(()=>{K(c)},[c]),m.useEffect(()=>{if(e){const ae=localStorage.getItem("webrtc_enabled");K(ae==="true")}},[e]),m.useEffect(()=>{if(ee){const ae=localStorage.getItem("custom_ws_url")||"";w.trim()===ae&&j(!1)}},[ee,r,w]),m.useEffect(()=>{if(e){const ae=localStorage.getItem("custom_ws_url")||"";_(ae),D(!1),y(!1),j(!1)}},[e]),!e)return null;const re=()=>{const ae=w.trim();localStorage.setItem("custom_ws_url",ae),j(!1),a(),t()},Ie=()=>{const ae=w.trim();localStorage.setItem("custom_ws_url",ae),j(!1),y(!0),a(),setTimeout(()=>y(!1),2e3)},B=ae=>{_(ae),j(!0)},fe=()=>{const{url:ae}=oy(o,s,l);navigator.clipboard.writeText(ae).then(()=>{D(!0),setTimeout(()=>D(!1),2e3)}).catch(J=>{console.error("Failed to copy:",J)})},he=()=>{A(!0),localStorage.clear(),sessionStorage.clear(),setTimeout(()=>{window.location.reload()},1e3)},ke=ae=>{K(ae),localStorage.setItem("webrtc_enabled",ae.toString()),d&&d(ae)},ie=ee&&!k;return i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",children:i.jsxs("div",{className:"bg-gray-800 rounded-lg p-8 shadow-xl w-full max-w-xl",children:[i.jsx("h2",{className:"text-2xl font-bold mb-6",children:v("settings")}),i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{children:[i.jsx("label",{htmlFor:"language-select",className:"block text-sm font-medium text-gray-300 mb-1",children:v("language")}),i.jsx("select",{id:"language-select",value:f,onChange:ae=>h(ae.target.value),className:"w-full bg-gray-700 border border-gray-600 text-white font-sans rounded-lg p-2 focus:ring-indigo-500 focus:border-indigo-500",children:Xb.map(ae=>i.jsx("option",{value:ae,children:Zb[ae]},ae))})]}),i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:v("webrtcMode")}),i.jsx("p",{className:"text-xs text-gray-400",children:v("webrtcModeDesc")})]}),i.jsx("button",{onClick:()=>ke(!M),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${M?"bg-indigo-600":"bg-gray-600"}`,children:i.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${M?"translate-x-6":"translate-x-1"}`})})]}),M&&i.jsx("div",{className:"mt-2 p-2 bg-indigo-900 bg-opacity-30 rounded border border-indigo-700",children:i.jsxs("p",{className:"text-xs text-indigo-300",children:[i.jsxs("span",{className:"font-bold",children:[v("peerToPeer"),":"]})," ",v("directConnection")]})})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"server-url",className:"block text-sm font-medium text-gray-300 mb-1",children:v("serverAddress")}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("input",{id:"server-url",type:"text",value:w,onChange:ae=>B(ae.target.value),placeholder:"wss://your-server.ngrok-free.app",className:"flex-1 bg-gray-700 border border-gray-600 text-white font-mono rounded-lg p-2 focus:ring-indigo-500 focus:border-indigo-500",onKeyDown:ae=>ae.key==="Enter"&&re()}),i.jsx("button",{onClick:Ie,className:`w-10 h-10 flex items-center justify-center rounded transition-colors ${x?"bg-green-600 text-white animate-pulse":"bg-gray-700 hover:bg-gray-600 text-gray-300"}`,title:v("reconnect"),children:i.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:[i.jsx("polyline",{points:"23 4 23 10 17 10"}),i.jsx("path",{d:"M20.49 15a9 9 0 1 1-2.12-9.36L23 10"})]})}),i.jsx("div",{className:`w-10 h-10 flex items-center justify-center rounded bg-gray-900 border border-gray-700 ${r==="Connected"?"cursor-help":""}`,title:r,children:i.jsxs("span",{className:"relative flex h-3 w-3",children:[r==="Connected"&&i.jsxs(i.Fragment,{children:[i.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"}),i.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-green-500"})]}),r==="Connecting"&&i.jsxs(i.Fragment,{children:[i.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-yellow-400 opacity-75"}),i.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-yellow-500"})]}),r==="Disconnected"&&i.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-red-500"})]})})]}),i.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"WebSocket URL   (ws://  wss://)"})]}),i.jsxs("div",{className:"-mt-3",children:[i.jsx("button",{onClick:fe,disabled:!ie,className:`w-full py-2 rounded text-sm font-bold transition-colors ${ie?C?"bg-green-600 text-white":"bg-indigo-600 hover:bg-indigo-700 text-white":"bg-gray-600 text-gray-400 cursor-not-allowed"}`,children:v(C?"copied":"copyGameLink")}),i.jsx("p",{className:"text-xs text-gray-400 mt-1",children:v("copyGameLinkDesc")})]}),i.jsxs("div",{className:"-mt-3",children:[i.jsx("button",{onClick:he,disabled:$,className:`w-full py-2 rounded text-sm font-bold transition-colors ${$?"bg-orange-600 text-white":"bg-red-700 hover:bg-red-600 text-white"}`,children:v($?"cacheCleared":"clearCache")}),i.jsx("p",{className:"text-xs text-gray-400 mt-1",children:v("clearCacheDesc")})]})]}),i.jsxs("div",{className:"flex justify-end mt-8 space-x-3",children:[i.jsx("button",{type:"button",onClick:t,className:"bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded",children:v("cancel")}),i.jsx("button",{onClick:re,className:"bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded transition-colors",children:v("saveApply")})]})]})})},Cx={title:'Game Rules: "New Avalon: Skirmish"',conceptTitle:"I. General Concept",conceptText:`**Genre & Role:** New Avalon: Skirmish is a fast-paced tactical duel card game played on a restricted grid battlefield. Players act as faction leaders, deploying Units and Commands to seize control of key lines.

**Explanation:** The game focuses on positional control and the timing of ability activation rather than just direct attacks. Victory is achieved by accumulating Victory Points (VP) based on the power of your units in selected lines.`,winConditionTitle:"II. Victory Conditions",winConditionText:`**Match Victory:** A match is played until a player wins 2 rounds. The first player to reach 2 round wins immediately wins the match.
**Match Draw:** If multiple players reach 2 round wins simultaneously after any round, they are all declared match winners.

**Round Victory (Thresholds & Limits):** A round ends as soon as one or more players reach the Victory Point (VP) threshold, or after the 5th turn is completed.
**Turn Limit:** Each round is limited to 5 full turns per player. If the VP threshold is not met, a final scoring occurs at the end of Turn 5 to determine the winner.

**Thresholds:**
- Round 1: 20 Victory Points (VP).
- Round 2: 30 Victory Points (VP).
- Round 3+: Threshold increases by +10 VP from the previous round (e.g., Round 3 is 40 VP).

**Determining Round Winner:** The winner is the player who hits the threshold first, or the player with the highest VP after the turn limit.
**Round Draw:** If two or more players have the same highest score at the end of a round, they all are declared winners of that round.`,fieldTitle:"III. Game Board & Components",fieldText:`**Battlefield (Grid):** The game takes place on a square grid, the size of which depends on the total number of participating players.
**Sizes:**
- 2 Players: 5x5 grid.
- 3 Players: 6x6 grid.
- 4 Players: 7x7 grid.

**Positioning Definitions:**
- **Line:** Refers to an entire horizontal Row or vertical Column. Used for the Scoring mechanic.
- **Adjacency:** Cells are considered adjacent only horizontally and vertically (orthogonally). Diagonal adjacency does not count unless specified otherwise on a card.

**Cards:** Two main types of cards are played from Hand:
- **Units:** The main combat entities, possessing Power and Abilities. They remain on the battlefield until destroyed.
- **Commands:** Instant-effect cards. They are played, execute their effect (often offering a "Choose 1 of 2 options" choice), and are then sent to the Discard pile.

**Game Zones:**
- **Hand:** Cards hidden from opponents.
- **Discard:** The zone where destroyed Units and played Commands go.
- **Showcase/Announced:** A temporary zone where a Command card is placed before it resolves.`,setupTitle:"IV. Game Start (Setup)",setupText:`**Deck Construction:** Before the match begins, each player selects a faction or builds a deck according to construction rules (minimum 30 cards).
**Explanation:** Decks are shuffled.

**Starting Hand:** Each player draws 6 cards from their deck to form their starting hand.
**Hidden Information:** Cards in hand are hidden from opponents.

**Mulligan:** Once at the start of the game, after drawing the starting hand, a player may shuffle any number of cards from their hand back into the deck and draw the same number of new cards.

**First Player Determination:** Determine the first active player by any convenient method (e.g., coin toss).
**Explanation:** Play proceeds in turn order, starting with the first player. The first player begins their first turn directly in the Setup Phase.`,abilitiesTitle:"V. Card Abilities",abilitiesText:`**Ability Types:**
- **Deploy:** Triggers automatically and immediately when the card is played from hand onto the battlefield face-up.
- **Setup:** Triggers automatically at the start of the Setup Phase of each of your turns (before drawing a card), if the card is already face-up on the battlefield.
- **Commit:** Triggers automatically at the start of the Commit Phase of each of your turns, if the card is already face-up on the battlefield.
- **Pas (Passive):** The effect is constantly active as long as the card is on the battlefield and face-up.

**Conditions ():**
Many abilities have a requirement denoted by an arrow (e.g., **Support  Deploy:** ...).
- This means "CONDITION  EFFECT".
- If the condition to the left of the arrow (e.g., having Support status) is not met at the moment of activation, the ability **does not trigger** at all.

**Important Rules:**
- **Stun:** Stunned cards (with a Stun token) **do not activate** their abilities (neither Deploy, nor Phased, nor Passive).
- **Face-down:** Cards played face-down have no abilities.
- **Mandatory:** If an ability triggers (conditions met), you **must** apply its effect if there are legal targets. If there are no legal targets, the ability fizzles.`,statusesTitle:"VI. Dynamic Statuses (Positioning)",statusesText:`Dynamic statuses are calculated automatically and constantly updated with any change on the board. Units with the Stun status cannot provide or participate in the calculation of these statuses.

**Support:** A unit has the Support status if there is an allied unit in at least one adjacent cell (horizontal or vertical).
**Stun/Support:** A unit with a Stun token is ignored when calculating Support for adjacent allies.
**Significance:** Having Support is a condition for activating many powerful abilities, denoted by the syntax **Support  [Effect]**.

**Threat:** A unit receives the Threat status if it is in a dangerous position created by enemy units.
**Conditions:** Threat status is assigned in one of two cases:
1. **Pinned:** The unit is sandwiched between cards of a single opponent on any two sides (two adjacent or two opposite sides).
2. **Cornered:** The unit is on the edge of the battlefield and has at least one opponent card adjacent to it.
**Stun/Threat:** A unit with a Stun token is ignored when calculating Threat for adjacent enemies.
**Significance:** Units under Threat are vulnerable targets for powerful control and destruction abilities.`,countersTitle:"VII. Counters",countersText:`Counters are persistent markers placed by card abilities. They remain on a unit until removed or the unit is destroyed.

**Stun (O):**
- **Effect:** A Stunned unit generates 0 VP during the Scoring Phase, cannot activate its abilities, and cannot be moved by its owner (but can be moved by opponents).
- **Removal:** At the end of the Commit Phase, 1 Stun token is automatically removed from every unit owned by the active player.

**Shield (S):**
- **Effect:** If an ability attempts to Destroy this unit, the destruction effect is prevented, and 1 Shield token is removed instead. The unit remains on the field.

**Revealed & Face-down:**
- **Revealed:** Allows the player who owns the Revealed token to see the hidden information (face) of the card.
- **Face-down Explanation:** A card played face-down has 0 Power and no Abilities. If such a card receives a Revealed token, its info becomes visible to the opponent, but it is still mechanically considered Face-down (0 Power, no abilities).

**Special Tokens (Aim, Exploit):**
- **Aim (A) & Exploit (E):** These tokens act as markers for faction interactions (e.g., Snipers or Hackers). By themselves, they have no inherent game effect.

**Last Played:**
- **Effect:** A temporary status automatically assigned to the last card played onto the battlefield by the active player this turn. This status determines the line the player must choose for Scoring.`,turnTitle:"VIII. Turn Structure & Timing",turnText:`The turn passes from player to player. Card abilities only trigger during their owner's turn. The active player's turn consists of four sequential phases:

**1. Setup Phase:**
- **Draw Card:** The active player draws 1 card from their deck.
- **Abilities:** Abilities of all cards on the board with the keyword **Setup:** trigger.
**Explanation:** This phase is for replenishing the hand and initial unit positioning.

**2. Main Phase (Action / Deploy):**
- **Main Action:** The active player may perform one of the following:
  - Play a Unit card (**Deploy:**) from hand to any empty cell. Its **Deploy:** ability triggers immediately.
  - Play a Command card from hand.
  - Pass.
**Command Explanation:** Command cards can be played in any quantity during this phase  before, after, or between unit deployments.

**3. Commit Phase:**
- **Abilities:** Abilities of all cards on the board with the keyword **Commit:** trigger.
- **Remove Stun:** At the end of this phase, 1 Stun token is automatically removed from every unit owned by the active player.
**Explanation:** This phase is used for applying control effects and gaining resources before scoring.

**4. Scoring Phase:**
- **Line Selection:** The active player must choose one Line (Row or Column) that passes through their card with the **Last Played** status.
- **Counting:** The Power of all units owned by the active player in the chosen line is summed up, and the total is added to the player's score.`,mechanicsTitle:"IX. Conflict Resolution & Key Mechanics",mechanicsText:`**Stun & Scoring:**
- **Effect:** A unit with Stun status or one that is Face-down contributes 0 points during the Scoring Phase, regardless of its base Power, permanent modifiers, or passive abilities that generate points (e.g., Spotter).

**Last Played Transfer:**
- **Destruction:** If the card with Last Played status leaves the battlefield (destroyed, returned to hand/deck) before the Scoring Phase, the status is transferred to the *previous* card played by that player (the one that was Last Played in the previous turn/action).
- **Movement:** If the card with Last Played moves to another cell, the player chooses lines based on its new position during Scoring.
- **Absence:** If a player has no cards on the board with Last Played status, they cannot choose a line and gain no points this turn.

**Unit Movement (Push, Swap):**
- **Push:** A unit forces another card to move to an adjacent cell. The push is blocked (does not happen) if the destination is an occupied cell or the edge of the board. Other effects of the ability still apply to the target.
- **Swap:** Allows two cards to trade places, even if both cells are occupied.

**Resurrect:**
- **Burnout Mechanic:** A card returned to the battlefield from the Discard pile (resurrected) immediately gains the **Resurrected** status upon Deploy. At the start of the next phase (phase change), this status is removed, and the card receives two Stun tokens.`,creditsTitle:"X. Credits",creditsText:`**Author:** Nikita Anahoret

**Powered By:**
- Google AI Studio
- Gemini
- ChatGPT

**Special Thanks:**
- Vasilisa Versus
- Kirill Tomashchuk
- Andrey Markosov
- Mitya Shepelin

For questions and suggestions, please contact via Telegram or Discord.
Support game development and authors via DonationAlerts and Patreon.`},wx="https://res.cloudinary.com/dxxh6meej/image/upload/v1764622845/Reclaimed_Gawain_sg6257.png",kx="/images/cards/NEU_RECLAIMED_GAWAIN.png",Lr={gawain:{id:"demo_gawain",name:'Reclaimed "Gawain"',deck:it.Neutral,power:5,imageUrl:wx,fallbackImage:kx,ability:`Deploy: Shield 1. Push an adjacent card 1 cell. May take its place.
Setup: Destroy an adjacent card with threat or stun.`,types:["Unit","Device","Rarity"],faction:"Neutral",ownerId:1},riot:{id:"demo_riot",name:"Riot Agent",deck:it.SynchroTech,power:3,imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1763253337/SYN_RIOT_AGENT_jurf4t.png",fallbackImage:"/images/cards/SYN_RIOT_AGENT.png",ability:"Deploy: Push.",types:["Unit","SynchroTech"],faction:"SynchroTech",ownerId:1},princeps:{id:"demo_princeps",name:"Princeps",deck:it.Optimates,power:3,imageUrl:"https://res.cloudinary.com/dxxh6meej/image/upload/v1763253332/OPT_PRINCEPS_w3o5lq.png",fallbackImage:"/images/cards/OPT_PRINCEPS.png",ability:"",types:["Unit","Optimates"],faction:"Optimates",ownerId:2}},$f=new Map([[1,"blue"],[2,"red"]]),Tx=e=>e.split(/(\[[^\]]+\]\([^)]+\)|\*\*[^*]+\*\*)/g).map((n,r)=>{const a=n.match(/\[([^\]]+)\]\(([^)]+)\)/);if(a){const o=a[1],s=a[2];return i.jsx("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:"text-sky-400 hover:text-sky-300 underline font-medium",children:o},r)}return n.startsWith("**")&&n.endsWith("**")?i.jsx("strong",{className:"text-indigo-300",children:n.slice(2,-2)},r):n}),Jo=({children:e})=>i.jsxs("div",{className:"w-full h-full bg-board-bg/50 rounded-xl shadow-inner border-2 border-gray-600/50 flex items-center justify-center overflow-hidden relative p-4",children:[i.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(ellipse_at_center,_var(--tw-gradient-stops))] from-indigo-900/20 via-transparent to-transparent pointer-events-none"}),e]}),Ex=()=>i.jsx(Jo,{children:i.jsxs("div",{className:"flex gap-16 items-center justify-center relative pl-4 scale-90 md:scale-100",children:[i.jsxs("div",{className:"relative w-48 h-48 flex-shrink-0",children:[i.jsx(Bn,{card:Lr.gawain,isFaceUp:!0,playerColorMap:$f,localPlayerId:1,disableTooltip:!0}),i.jsx("div",{className:"absolute -bottom-2 -right-2 w-full h-full pointer-events-none",children:i.jsxs("div",{className:"absolute bottom-[-45px] right-[5px] flex flex-col items-center",children:[i.jsx("div",{className:"w-px h-8 bg-white mb-1"}),i.jsx("div",{className:"bg-red-600 text-white text-[10px] font-bold px-2 py-0.5 rounded-full shadow-lg border border-white whitespace-nowrap",children:"Power"})]})})]}),i.jsx("div",{className:"relative w-80 flex-shrink-0",children:i.jsxs("div",{className:"bg-gray-900 border border-gray-700 rounded-md shadow-2xl p-3 text-white relative",children:[i.jsx(Ic,{card:Lr.gawain}),i.jsxs("div",{className:"absolute top-4 -left-[90px] flex items-center",children:[i.jsx("div",{className:"bg-indigo-600 text-white text-[10px] font-bold px-2 py-0.5 rounded-full shadow-lg border border-white",children:"Name"}),i.jsx("div",{className:"w-[60px] h-px bg-white ml-2"}),i.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full -ml-1"})]}),i.jsxs("div",{className:"absolute top-10 -left-[90px] flex items-center",children:[i.jsx("div",{className:"bg-purple-600 text-white text-[10px] font-bold px-2 py-0.5 rounded-full shadow-lg border border-white",children:"Types"}),i.jsx("div",{className:"w-[60px] h-px bg-white ml-2"}),i.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full -ml-1"})]}),i.jsxs("div",{className:"absolute bottom-12 -left-[90px] flex items-center",children:[i.jsx("div",{className:"bg-green-600 text-white text-[10px] font-bold px-2 py-0.5 rounded-full shadow-lg border border-white",children:"Abilities"}),i.jsx("div",{className:"w-[60px] h-px bg-white ml-2"}),i.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full -ml-1"})]})]})})]})}),ms=({text:e,subtext:t,color:n,top:r,left:a,subtextAbove:o=!1})=>{const s=n==="green"?"border-green-500/50":"border-red-500/50",l=n==="green"?"text-green-400":"text-red-400";return i.jsxs("div",{className:`absolute ${r} ${a} text-center w-28 pointer-events-none z-20 flex flex-col items-center`,children:[t&&o&&i.jsx("div",{className:"text-gray-400 text-[9px] font-semibold mb-0.5 leading-tight whitespace-nowrap",children:t}),i.jsx("div",{className:`${l} font-bold text-[10px] uppercase tracking-wider bg-gray-900/90 px-2 py-1 rounded shadow-sm border ${s}`,children:e}),t&&!o&&i.jsx("div",{className:"text-gray-400 text-[9px] font-semibold mt-0.5 leading-tight",children:t})]})},Ix=()=>{const e=Array(16).fill(null),t={...Lr.riot,id:"s1",statuses:[{type:"Support",addedByPlayerId:1}]},n={...Lr.riot,id:"s2",statuses:[{type:"Support",addedByPlayerId:1}]},r={...Lr.princeps,id:"e1",statuses:[{type:"Threat",addedByPlayerId:1}]},a={...Lr.riot,id:"v1",statuses:[{type:"Threat",addedByPlayerId:2}]},o={...Lr.princeps,id:"e2",statuses:[{type:"Threat",addedByPlayerId:1}]};return i.jsx(Jo,{children:i.jsxs("div",{className:"relative scale-[0.8] md:scale-100 origin-center",children:[i.jsx("div",{className:"grid grid-cols-4 grid-rows-4 gap-1 w-[460px] h-[452px]",children:e.map((s,l)=>{const c=Math.floor(l/4),d=l%4;let f=null;return c===1&&d===0&&(f=t),c===1&&d===1&&(f=n),c===2&&d===1&&(f=r),c===2&&d===2&&(f=a),c===2&&d===3&&(f=o),i.jsx("div",{className:"relative w-full h-full bg-board-cell/30 rounded border border-white/5 flex items-center justify-center",children:f&&i.jsx("div",{className:"w-28 h-28 p-0",children:i.jsx(Bn,{card:f,isFaceUp:!0,playerColorMap:$f,localPlayerId:1,disableTooltip:!0,smallStatusIcons:!0})})},l)})}),i.jsx(ms,{text:"Support",subtext:"Adjacent Ally",color:"green",top:"top-[68px]",left:"left-[0px]",subtextAbove:!0}),i.jsx(ms,{text:"Support",subtext:"Adjacent Ally",color:"green",top:"top-[68px]",left:"left-[116px]",subtextAbove:!0}),i.jsx(ms,{text:"Threat",subtext:"Pinned",color:"red",top:"top-[345px]",left:"left-[116px]"}),i.jsx(ms,{text:"Threat",subtext:"Pinned",color:"red",top:"top-[345px]",left:"left-[232px]"}),i.jsx(ms,{text:"Threat",subtext:i.jsxs(i.Fragment,{children:["Cornered",i.jsx("br",{}),"(Enemy + Edge)"]}),color:"red",top:"top-[345px]",left:"left-[348px]"})]})})},Sx=()=>i.jsx(Jo,{children:i.jsxs("div",{className:"grid grid-cols-4 gap-1 w-64 aspect-square relative scale-[1.3] origin-center",children:[Array.from({length:16}).map((e,t)=>i.jsx("div",{className:"bg-board-cell/40 rounded border border-white/5"},t)),i.jsx("div",{className:"absolute top-[25%] left-0 right-0 h-[25%] bg-yellow-500/30 border-y-2 border-yellow-500 shadow-[0_0_10px_rgba(234,179,8,0.4)] pointer-events-none flex items-center justify-end px-2 z-10",children:i.jsx("span",{className:"text-[8px] font-black text-yellow-200 uppercase tracking-wider drop-shadow-md",children:"Row"})}),i.jsx("div",{className:"absolute top-0 bottom-0 left-[50%] w-[25%] bg-indigo-500/30 border-x-2 border-indigo-500 shadow-[0_0_10px_rgba(99,102,241,0.4)] pointer-events-none flex items-end justify-center py-2 z-10",children:i.jsx("span",{className:"text-[8px] font-black text-indigo-200 uppercase tracking-wider whitespace-nowrap drop-shadow-md mb-1",children:"Column"})})]})}),_x=({demoImageRefreshVersion:e})=>{const t=[Lr.gawain,Lr.riot,Lr.gawain];return i.jsx(Jo,{children:i.jsxs("div",{className:"flex flex-col items-center gap-6 w-full",children:[i.jsxs("div",{className:"bg-gray-800 rounded-lg p-3 shadow-xl border border-gray-700 w-auto",children:[i.jsx("div",{className:"text-[10px] text-gray-400 mb-2 font-bold uppercase tracking-wider pl-1",children:"Hand (6 Cards)"}),i.jsx("div",{className:"flex gap-2 justify-center bg-gray-900/50 rounded p-2",children:t.map((n,r)=>i.jsx("div",{className:"w-28 h-28 flex-shrink-0 relative shadow-lg",children:i.jsx(Bn,{card:{...n,id:`hand_demo_${r}`},isFaceUp:!0,playerColorMap:$f,localPlayerId:1,disableTooltip:!0,imageRefreshVersion:e})},r))})]}),i.jsxs("div",{className:"flex items-center gap-2 opacity-70",children:[i.jsx("div",{className:"w-8 h-8 rounded-full border-2 border-dashed border-white/30 flex items-center justify-center animate-pulse",children:i.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",className:"text-indigo-400",children:i.jsx("path",{d:"M12 5v14M19 12l-7 7-7-7"})})}),i.jsx("span",{className:"text-xs text-gray-400",children:"Drag to Board"})]})]})})},Dx=()=>{const e=["Stun","Shield","Revealed","Aim","Exploit","Support","Threat"],t="https://res.cloudinary.com/dxxh6meej/image/upload/v1763653192/background_counter_socvss.png";return i.jsx(Jo,{children:i.jsx("div",{className:"grid grid-cols-4 gap-4 p-4 w-full",children:e.map(n=>{const r=Vo[n];return i.jsxs("div",{className:"flex flex-col items-center gap-2 p-2 bg-gray-800/50 rounded border border-white/5 hover:bg-gray-800 transition-colors",children:[i.jsx("div",{className:"w-10 h-10 rounded-full border-2 border-white/30 flex items-center justify-center shadow-lg relative",style:{backgroundImage:`url(${t})`,backgroundSize:"contain",backgroundPosition:"center",backgroundRepeat:"no-repeat"},children:r?i.jsx("img",{src:r,alt:n,className:"w-6 h-6 object-contain drop-shadow-md"}):i.jsx("span",{className:"font-bold text-white text-base",children:n[0]})}),i.jsx("span",{className:"text-[10px] font-bold text-gray-300 uppercase tracking-wider text-center leading-tight",children:n})]},n)})})})},Rx=({isOpen:e,onClose:t})=>{const{resources:n,t:r}=un(),a=n.rules&&n.rules.title?n.rules:Cx,o=m.useMemo(()=>Date.now(),[]),s=m.useMemo(()=>[{id:"concept",title:a.conceptTitle,text:a.conceptText,visual:i.jsx(Ex,{})},{id:"winCondition",title:a.winConditionTitle,text:a.winConditionText,visual:i.jsx(Jo,{children:i.jsxs("div",{className:"text-center text-yellow-400 font-black text-8xl font-mono bg-gray-900 p-10 rounded-3xl border-8 border-yellow-500 shadow-[0_0_50px_#eab308] scale-[1.2]",children:["30 ",i.jsx("div",{className:"text-lg font-bold text-gray-400 font-sans mt-2 uppercase tracking-widest",children:"Points"})]})})},{id:"field",title:a.fieldTitle,text:a.fieldText,visual:i.jsx(Sx,{})},{id:"setup",title:a.setupTitle,text:a.setupText,visual:i.jsx(_x,{demoImageRefreshVersion:o})},{id:"abilities",title:a.abilitiesTitle,text:a.abilitiesText,visual:null},{id:"statuses",title:a.statusesTitle,text:a.statusesText,visual:i.jsx(Ix,{})},{id:"counters",title:a.countersTitle,text:a.countersText,visual:i.jsx(Dx,{})},{id:"turn",title:a.turnTitle,text:a.turnText,visual:null},{id:"mechanics",title:a.mechanicsTitle,text:a.mechanicsText,visual:null},{id:"credits",title:a.creditsTitle,text:a.creditsText,visual:null}],[a,o]),[l,c]=m.useState("concept"),d=m.useMemo(()=>s.find(f=>f.id===l)||s[0],[l,s]);return e?i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-[100]",onClick:t,children:i.jsxs("div",{className:"bg-gray-900 w-[95vw] h-[90vh] rounded-xl shadow-2xl flex overflow-hidden border border-gray-700",onClick:f=>f.stopPropagation(),children:[i.jsxs("div",{className:"w-64 bg-gray-800 border-r border-gray-700 flex flex-col flex-shrink-0",children:[i.jsx("div",{className:"p-4 border-b border-gray-700 bg-gray-850",children:i.jsx("h2",{className:"text-xl font-bold text-indigo-400 tracking-wide",children:a.title})}),i.jsx("div",{className:"flex-grow overflow-y-auto p-2 space-y-1",children:s.map(f=>i.jsxs("button",{onClick:()=>c(f.id),className:`w-full text-left px-4 py-3 rounded-md transition-all duration-200 text-sm font-medium flex items-center justify-between ${l===f.id?"bg-indigo-600 text-white shadow-lg translate-x-1":"text-gray-400 hover:bg-gray-700 hover:text-gray-200"}`,children:[i.jsx("span",{className:"truncate",children:f.title}),l===f.id&&i.jsx("span",{className:"text-indigo-300",children:""})]},f.id))}),i.jsx("div",{className:"p-4 border-t border-gray-700",children:i.jsx("button",{onClick:t,className:"w-full bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 rounded transition-colors uppercase text-sm tracking-wider",children:r("close")})})]}),i.jsxs("div",{className:"flex-grow flex flex-col md:flex-row overflow-hidden bg-gray-900",children:[i.jsx("div",{className:"flex-1 p-8 overflow-y-auto custom-scrollbar",children:i.jsxs("div",{className:"max-w-2xl mx-auto",children:[i.jsx("h1",{className:"text-3xl font-black text-white mb-8 pb-4 border-b-2 border-indigo-500/50",children:d.title}),i.jsx("div",{className:"prose prose-invert prose-lg text-gray-300 leading-relaxed whitespace-pre-wrap",children:Tx(d.text)})]})}),i.jsxs("div",{className:"hidden md:flex w-[45%] bg-gray-850 border-l border-gray-700 flex-col items-center justify-start p-6 relative overflow-hidden",children:[i.jsx("h3",{className:"text-center text-gray-500 text-xs uppercase tracking-[0.3em] font-bold z-20 opacity-70 mb-2 absolute top-6",children:"Visual Example"}),i.jsx("div",{className:"relative z-10 w-full h-[65%] mt-20 flex items-center justify-center",children:d.visual?d.visual:i.jsxs("div",{className:"text-gray-600 italic flex flex-col items-center opacity-40",children:[i.jsx("svg",{className:"w-16 h-16 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),"No visual available"]})})]})]})]})}):null},py="0.2.9-WebRTC",jx=m.memo(({handleCreateGame:e,setSettingsModalOpen:t,handleOpenJoinModal:n,setDeckBuilderOpen:r,setRulesModalOpen:a,isJoinModalOpen:o,setJoinModalOpen:s,handleJoinGame:l,gamesList:c,requestGamesList:d,isDeckBuilderOpen:f,setViewingCard:h,isSettingsModalOpen:v,handleSaveSettings:w,isRulesModalOpen:_,viewingCard:C,gameState:D,imageRefreshVersion:x,t:y,connectionStatus:k,forceReconnect:j,gameId:$=null,isGameStarted:A=!1,isPrivate:M=!1,initializeWebrtcHost:K,connectAsGuest:ee})=>{const[re,Ie]=m.useState(!1),B=localStorage.getItem("webrtc_enabled")==="true",fe=async()=>{if(K){Ie(!0);try{await K()&&e()}catch(he){console.error("Failed to initialize host:",he)}finally{Ie(!1)}}};return i.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gray-900 text-white relative overflow-hidden",children:[i.jsx("div",{className:"absolute inset-0 z-0 opacity-30",style:{backgroundImage:"url(https://images.unsplash.com/photo-1614728853975-69c960c725af?q=80&w=1920&auto=format&fit=crop)",backgroundSize:"cover",backgroundPosition:"center"}}),i.jsxs("div",{className:"z-10 text-center p-8 bg-black bg-opacity-60 rounded-xl shadow-2xl border border-gray-700 max-w-md w-full",children:[i.jsx("h1",{className:"text-5xl font-bold mb-2 text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-600 drop-shadow-lg",children:"New Avalon"}),i.jsx("h2",{className:"text-2xl font-light mb-6 text-gray-300 tracking-widest",children:"SKIRMISH"}),i.jsxs("div",{className:"space-y-4 w-full",children:[i.jsx("button",{onClick:B?fe:e,disabled:!B&&k!=="Connected",className:`w-full font-bold py-3 px-6 rounded-lg shadow-lg transition-all transform flex items-center justify-center gap-2 ${B&&!re||!B&&k==="Connected"?"bg-indigo-600 hover:bg-indigo-700 text-white hover:scale-105":"bg-gray-800 text-gray-500 cursor-not-allowed"}`,children:B?i.jsxs(i.Fragment,{children:[i.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 12h14M12 5l7 7-7 7"})}),re?y("connecting")+"...":y("hostGame")]}):i.jsxs(i.Fragment,{children:[i.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),y("startGame")]})}),i.jsxs("button",{onClick:n,disabled:B||k!=="Connected",className:`w-full font-bold py-3 px-6 rounded-lg shadow-lg transition-all transform flex items-center justify-center gap-2 ${!B&&k==="Connected"?"bg-gray-700 hover:bg-gray-600 text-white hover:scale-105":"bg-gray-800 text-gray-500 cursor-not-allowed"}`,title:B?"Join via invite link in WebRTC mode":"",children:[i.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),y("joinGame")]}),i.jsxs("button",{disabled:!0,className:"w-full bg-gray-800 text-gray-500 font-bold py-3 px-6 rounded-lg shadow-inner flex items-center justify-center gap-2 cursor-not-allowed border border-gray-700",title:y("comingSoon"),children:[i.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})}),y("storyMode")]}),i.jsxs("button",{disabled:!0,className:"w-full bg-gray-800 text-gray-500 font-bold py-3 px-6 rounded-lg shadow-inner flex items-center justify-center gap-2 cursor-not-allowed border border-gray-700",title:y("comingSoon"),children:[i.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})}),y("puzzles")]}),i.jsxs("button",{onClick:()=>r(!0),className:"w-full bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-all transform hover:scale-105 flex items-center justify-center gap-2",children:[i.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})}),y("deckBuilding")]}),i.jsxs("button",{onClick:()=>a(!0),className:"w-full bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-all transform hover:scale-105 flex items-center justify-center gap-2",children:[i.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})}),y("rules")]}),i.jsxs("button",{onClick:()=>t(!0),className:"w-full bg-gray-800 hover:bg-gray-700 text-gray-300 font-bold py-2 px-6 rounded-lg shadow transition-all flex items-center justify-center gap-2 border border-gray-600",children:[i.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),y("settings")]})]}),i.jsxs("div",{className:"mt-6 flex items-center justify-center gap-2",children:[i.jsxs("span",{className:"relative flex h-3 w-3",children:[B&&i.jsxs(i.Fragment,{children:[i.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75"}),i.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-blue-500"})]}),!B&&k==="Connected"&&i.jsxs(i.Fragment,{children:[i.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"}),i.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-green-500"})]}),!B&&k==="Connecting"&&i.jsxs(i.Fragment,{children:[i.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-yellow-400 opacity-75"}),i.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-yellow-500"})]}),!B&&k==="Disconnected"&&i.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-red-500"})]}),i.jsx("span",{className:"text-sm text-gray-400",children:B?y("peerToPeer"):i.jsxs(i.Fragment,{children:[k==="Connected"&&y("connected"),k==="Connecting"&&y("connecting"),k==="Disconnected"&&y("disconnected")]})}),!B&&k==="Disconnected"&&i.jsx("button",{onClick:j,className:"ml-2 text-xs text-blue-400 hover:text-blue-300 underline",children:y("reconnect")})]}),i.jsxs("div",{className:"mt-8 pt-6 border-t border-gray-700 flex justify-center gap-6",children:[i.jsx("a",{href:"https://t.me/NeurohoretApp",target:"_blank",rel:"noopener noreferrer",className:"transition-transform hover:scale-110",title:"Telegram",children:i.jsx("img",{src:"https://res.cloudinary.com/dxxh6meej/image/upload/v1764190409/Telegram_logo.svg_rnhkud.webp",alt:"Telegram",className:"w-8 h-8"})}),i.jsx("a",{href:"https://discord.gg/U5zKADsZZY",target:"_blank",rel:"noopener noreferrer",className:"transition-transform hover:scale-110",title:"Discord",children:i.jsx("img",{src:"https://res.cloudinary.com/dxxh6meej/image/upload/v1764190408/discord-icon_nhgjyx.svg",alt:"Discord",className:"w-8 h-8"})}),i.jsx("a",{href:"https://www.donationalerts.com/r/anahoret",target:"_blank",rel:"noopener noreferrer",className:"transition-transform hover:scale-110",title:"DonationAlerts",children:i.jsx("img",{src:"https://res.cloudinary.com/dxxh6meej/image/upload/v1764190414/donationalerts_hpjtbe.png",alt:"DonationAlerts",className:"w-8 h-8 rounded"})}),i.jsx("a",{href:"https://www.patreon.com/c/AnchoriteComics",target:"_blank",rel:"noopener noreferrer",className:"transition-transform hover:scale-110",title:"Patreon",children:i.jsx("img",{src:"https://res.cloudinary.com/dxxh6meej/image/upload/v1764190408/Patreon_logo.svg_ala7gn.png",alt:"Patreon",className:"w-8 h-8"})})]})]}),i.jsxs("div",{className:"absolute bottom-4 text-gray-500 text-xs",children:["v",py]}),i.jsx(vx,{isOpen:o,onClose:()=>s(!1),onJoin:l,games:c,onRefreshGames:d}),i.jsx(bx,{isOpen:f,onClose:()=>r(!1),setViewingCard:h}),i.jsx(xx,{isOpen:v,onClose:()=>t(!1),onSave:w,connectionStatus:k,onReconnect:j,gameId:$,isGameStarted:A,isPrivate:M}),i.jsx(Rx,{isOpen:_,onClose:()=>a(!1)}),C&&i.jsx(uy,{card:C.card,ownerPlayer:C.player,onClose:()=>h(null),statusDescriptions:ac,allPlayers:D.players,imageRefreshVersion:x})]})}),Px="https://res.cloudinary.com/dxxh6meej/image/upload/v1764252181/medal_rgbw8d.png",Nx=({gameState:e,onContinueGame:t,onStartNextRound:n,onExit:r})=>{const{t:a}=un();if(!e.isRoundEndModalOpen)return null;const o=e.roundWinners[e.currentRound]||[],l=!!e.gameWinner,c=e.currentRound+1,d=c*10+10,f=[...e.players].sort((_,C)=>_.id-C.id),h=e.startingPlayerId||1,v=f.findIndex(_=>_.id===h);let w=[];return v!==-1?w=[...f.slice(v),...f.slice(0,v)]:w=f,i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-[200] backdrop-blur-sm",children:i.jsxs("div",{className:"bg-gray-900 rounded-lg border-2 border-gray-700 shadow-2xl p-6 w-full max-w-md text-left relative",children:[i.jsx("div",{className:"mb-4 text-center",children:i.jsx("h2",{className:"text-sm font-bold text-gray-400 uppercase tracking-widest leading-none",children:l?a("gameOver"):`${a("round")} ${e.currentRound} ${a("complete")}`})}),i.jsx("div",{className:"space-y-2 mb-4",children:w.map(_=>{const C=o.includes(_.id),D=Object.values(e.roundWinners).flat().filter(y=>y===_.id).length,x=Kn[_.color];return i.jsxs("div",{className:`flex items-center justify-between p-3 rounded bg-gray-800 border ${C?"border-yellow-500/50":"border-gray-700"}`,children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:`w-3 h-3 rounded-full ${(x==null?void 0:x.bg)||"bg-gray-500"}`}),i.jsx("span",{className:`font-bold text-lg ${C?"text-white":"text-gray-400"}`,children:_.name})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"text-xl font-bold text-white font-mono mr-2",children:_.score}),D>0&&Array.from({length:D}).map((y,k)=>i.jsx("img",{src:Px,alt:"Winner",className:"w-6 h-6 object-contain drop-shadow-md",title:a("roundWinner")},k))]})]},_.id)})}),i.jsx("hr",{className:"border-gray-600 my-2"}),i.jsxs("div",{className:"text-xs text-gray-400 flex justify-between px-1",children:[i.jsxs("span",{children:[a("endedOnTurn")," ",e.turnNumber]}),i.jsxs("span",{children:["v",py]})]}),i.jsx("hr",{className:"border-gray-600 my-2"}),i.jsx("div",{className:"text-sm text-gray-300 leading-snug space-y-2 mt-3",children:l?i.jsxs("div",{className:"text-center py-2",children:[i.jsx("div",{className:"text-yellow-400 font-bold text-lg mb-1",children:a("matchComplete")}),i.jsx("p",{className:"text-gray-400 text-xs",children:a("thankYouPlaying")})]}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-gray-400",children:a("nextRound")}),i.jsxs("span",{className:"font-bold text-white",children:[a("round")," ",c]})]}),i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-gray-400",children:a("victoryCondition")}),i.jsxs("span",{className:"font-bold text-yellow-400",children:[d," ",a("score")]})]})]})}),i.jsx("div",{className:"mt-6 flex justify-end gap-3",children:l?i.jsxs(i.Fragment,{children:[i.jsx("button",{onClick:r,className:"flex-1 bg-red-900 hover:bg-red-800 text-white font-bold py-2 px-4 rounded border border-red-700 text-sm transition-colors",children:a("returnToMenu")}),i.jsx("button",{onClick:t,className:"flex-1 bg-green-800 hover:bg-green-700 text-white font-bold py-2 px-4 rounded border border-green-600 text-sm transition-colors",children:a("continueGame")})]}):i.jsxs("button",{onClick:n,className:"bg-green-800 hover:bg-green-700 text-white font-bold py-2 px-6 rounded border border-green-600 text-sm transition-colors w-full",children:[a("startRound")," ",c]})})]})})},vd=e=>e.filter(n=>n.type!=="Support"&&n.type!=="Threat"&&n.type!=="LastPlayed"&&n.type!=="REMOVE_COMMIT"&&n.type!=="RESET_DEPLOY"&&n.type!=="REDEPLOY"&&n.type!=="readyDeploy"&&n.type!=="readyCommit"&&n.type!=="readySetup").reduce((n,r)=>(n[r.type]=(n[r.type]||0)+1,n),{}),Ax=({isOpen:e,data:t,onConfirm:n,onCancel:r})=>{const[a,o]=m.useState(()=>vd(t.card.statuses||[])),[s,l]=m.useState(()=>vd(t.card.statuses||[]));if(m.useEffect(()=>{if(e&&t.card){const w=vd(t.card.statuses||[]);o(w),l(w)}},[e,t.card]),!e)return null;const c=Object.keys(s),d=w=>{const _=a[w]||0;_>0&&o({...a,[w]:_-1})},f=w=>{const _=a[w]||0,C=s[w];_<C&&o({...a,[w]:_+1})},h=c.reduce((w,_)=>w+(s[_]-a[_]),0),v=()=>{const w={};c.forEach(_=>{const C=s[_]-a[_];C>0&&(w[_]=C)}),n(w,t)};return i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[250]",children:i.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 shadow-xl w-96 border border-gray-600",children:[i.jsx("h3",{className:"text-xl font-bold text-white mb-4 text-center",children:"Remove Counters"}),i.jsxs("p",{className:"text-gray-400 text-sm mb-6 text-center",children:["Adjust counters on ",i.jsx("strong",{children:t.card.name}),".",i.jsx("br",{}),i.jsx("span",{className:"text-xs text-gray-500",children:"Press (-) to remove, (+) to keep."})]}),i.jsxs("div",{className:"space-y-3 mb-6 bg-gray-900 p-3 rounded-lg max-h-[300px] overflow-y-auto",children:[c.length===0&&i.jsx("p",{className:"text-center text-gray-500 italic py-4",children:"No removable counters found."}),c.map(w=>{const _=a[w],C=s[w],D=Vo[w];return i.jsxs("div",{className:"flex items-center justify-between bg-gray-800 border border-gray-700 p-3 rounded",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-8 h-8 flex items-center justify-center bg-gray-700 rounded-sm",children:D?i.jsx("img",{src:D,className:"w-6 h-6 object-contain",alt:`${w} icon`}):i.jsx("span",{className:"font-bold text-white",children:w[0]})}),i.jsx("div",{children:i.jsx("div",{className:"text-gray-200 font-medium leading-none",children:w})})]}),i.jsxs("div",{className:"flex items-center bg-gray-700 rounded border border-gray-600",children:[i.jsx("button",{onClick:()=>d(w),disabled:_===0,className:"w-8 h-8 flex items-center justify-center text-gray-400 hover:text-white hover:bg-gray-600 disabled:opacity-30 disabled:hover:bg-transparent transition-colors",children:"-"}),i.jsx("div",{className:"w-8 text-center font-bold text-white select-none",children:_}),i.jsx("button",{onClick:()=>f(w),disabled:_>=C,className:"w-8 h-8 flex items-center justify-center text-gray-400 hover:text-white hover:bg-gray-600 disabled:opacity-30 disabled:hover:bg-transparent transition-colors",children:"+"})]})]},w)})]}),i.jsxs("div",{className:"flex justify-between items-center pt-4 border-t border-gray-700",children:[i.jsxs("div",{children:[i.jsx("span",{className:"text-gray-400 text-sm",children:"Total Removed:"}),i.jsx("span",{className:"text-indigo-400 font-bold text-xl ml-2",children:h})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx("button",{onClick:r,className:"px-4 py-2 rounded bg-gray-700 hover:bg-gray-600 text-sm font-medium transition-colors",children:"Cancel"}),i.jsx("button",{onClick:v,className:"px-4 py-2 rounded bg-green-600 hover:bg-green-500 font-bold text-sm text-white shadow-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:h===0,children:"Confirm"})]})]})]})})},Ox=m.memo(({isOpen:e,player:t,onClose:n,onReorder:r,onMoveToBottom:a,onMoveToHand:o,onMoveToDiscard:s,onPlayCard:l,onViewCard:c,setDraggedItem:d,playerColorMap:f,localPlayerId:h,imageRefreshVersion:v,initialCount:w=3,isLocked:_=!1})=>{const{t:C}=un(),[D,x]=m.useState(w),[y,k]=m.useState(null),[j,$]=m.useState(null),[A,M]=m.useState(null),[K,ee]=m.useState(null),[re,Ie]=m.useState([]),[B,fe]=m.useState(!1),he=m.useRef(null),ke=m.useRef(null);m.useEffect(()=>{e&&(x(w),$(null),M(null),ee(null),fe(!1),ke.current=null)},[e,w]),m.useEffect(()=>{const Ce=t.deck.slice(0,Math.min(D,t.deck.length));Ie(Ce)},[t.deck,D]);const ie=m.useMemo(()=>{if(A!==null&&K!==null&&A!==K){const Ce=[...re],[Le]=Ce.splice(A,1);return Ce.splice(K,0,Le),Ce}return re},[re,A,K]),ae=m.useCallback((Ce,Le)=>{Ce.preventDefault(),Ce.stopPropagation(),k({x:Ce.clientX,y:Ce.clientY,cardIndex:Le})},[]),J=m.useCallback(()=>{k(null)},[]),q=m.useCallback(()=>{!_&&D<t.deck.length&&x(Ce=>Ce+1)},[_,D,t.deck.length]),H=m.useCallback(()=>{!_&&D>1&&x(Ce=>Ce-1)},[_,D]),ne=m.useCallback((Ce,Le)=>{M(Le),$(Ce.id),ke.current=Ce,fe(!1)},[]),de=m.useCallback((Ce,Le)=>{Ce.preventDefault(),Ce.dataTransfer.dropEffect="move",K!==Le&&ee(Le)},[K]),xe=m.useCallback(Ce=>{if(!ke.current||!he.current)return;const Le=he.current.getBoundingClientRect(),We=Ce.clientX,V=Ce.clientY;if(We<Le.left||We>Le.right||V<Le.top||V>Le.bottom){const Ke=ke.current,E=A??0;d&&d({card:Ke,source:"deck",playerId:t.id,cardIndex:E}),fe(!0),n()}},[A,t.id,d,n]),Z=m.useCallback(()=>{B||($(null),M(null),ee(null)),ke.current=null},[B]),Oe=m.useCallback((Ce,Le)=>{if(Ce.preventDefault(),Ce.stopPropagation(),ee(null),B)return;if(A===null||A===Le){M(null),$(null);return}const We=[...re],[V]=We.splice(A,1);We.splice(Le,0,V),Ie(We),r(t.id,We),M(null),$(null)},[A,re,r,t.id,B]),Re=m.useMemo(()=>y?[{label:C("view"),isBold:!0,onClick:()=>c(ie[y.cardIndex])},{label:C("play"),disabled:_,onClick:()=>{l(y.cardIndex)}},{label:C("moveToBottom"),onClick:()=>{a(y.cardIndex),x(Ce=>Math.max(0,Ce-1))}},{isDivider:!0},{label:C("toHand"),disabled:_,onClick:()=>{o(y.cardIndex),x(Ce=>Math.max(0,Ce-1))}},{label:C("toDiscard"),disabled:_,onClick:()=>{s(y.cardIndex),x(Ce=>Math.max(0,Ce-1))}}]:[],[ie,_,c,l,a,o,s,y,C]);return e?i.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-[250] backdrop-blur-sm",onClick:n,children:[i.jsxs("div",{ref:he,onDragLeave:xe,className:"bg-gray-800 rounded-lg p-6 shadow-xl w-auto max-w-5xl border border-gray-600 relative flex flex-col items-center",onClick:Ce=>Ce.stopPropagation(),children:[i.jsx("h2",{className:"text-2xl font-bold text-white mb-2 text-center",children:C("topDeckView")}),i.jsxs("div",{className:"flex items-center gap-4 mb-4 bg-gray-900 p-2 rounded-full border border-gray-700",children:[i.jsx("button",{onClick:H,disabled:_||D<=1,className:"w-8 h-8 flex items-center justify-center bg-gray-700 hover:bg-red-600 rounded-full text-white font-bold disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:"-"}),i.jsx("span",{className:"text-xl font-mono font-bold text-indigo-400 w-8 text-center",children:D}),i.jsx("button",{onClick:q,disabled:_||D>=t.deck.length,className:"w-8 h-8 flex items-center justify-center bg-gray-700 hover:bg-green-600 rounded-full text-white font-bold disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:"+"})]}),i.jsxs("p",{className:"text-gray-400 text-xs mb-6 text-center",children:[C("dragToReorder")," ",C("rightClickForActions")]}),i.jsx("div",{className:"flex justify-center flex-wrap gap-4 mb-8 min-h-[140px] px-4",children:ie.length===0?i.jsx("p",{className:"text-gray-500 italic",children:C("deckEmpty")}):ie.map((Ce,Le)=>{const We=re.findIndex(E=>E.id===Ce.id),V=K===Le&&A!==Le,Ke=j===Ce.id;return i.jsxs("div",{draggable:!0,onDragStart:()=>ne(Ce,We),onDragOver:E=>de(E,Le),onDragEnd:Z,onDrop:E=>Oe(E,Le),onContextMenu:E=>ae(E,We),className:`w-32 h-32 relative transition-all rounded-lg
                    ${Ke?"opacity-50 scale-95":"hover:scale-105 cursor-grab active:cursor-grabbing"}
                    ${V?"scale-105 z-10":""}
                  `,children:[i.jsxs("div",{className:"absolute -top-3 -left-2 z-20 bg-gray-900 text-gray-400 text-xs font-bold px-2 py-0.5 rounded-full border border-gray-600 shadow-md",children:["#",Le+1]}),i.jsx(Bn,{card:Ce,isFaceUp:!0,playerColorMap:f,localPlayerId:h,imageRefreshVersion:v})]},Ce.id||Le)})}),i.jsx("p",{className:"text-gray-400 text-xs mb-4 text-center",children:C("dragOutsideToMove")}),i.jsx("div",{className:"flex justify-center",children:i.jsx("button",{onClick:n,className:"bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-8 rounded shadow-lg transition-colors",children:C("done")})})]}),y&&i.jsx("div",{className:"fixed inset-0 z-[255]",onClick:J}),y&&i.jsx(fy,{x:y.x,y:y.y,onClose:J,items:Re})]}):null}),P={info:(...e)=>{},warn:(...e)=>{console.warn(...e)},error:(...e)=>{console.error(...e)},debug:(...e)=>{}},Ms="webrtc_game_state",zs="webrtc_host_data",$s="webrtc_guest_data",Lx="webrtc_current_host_peerId",Mx=30*60*1e3;function Gf(){return Date.now()}function pi(e){return Date.now()-e<Mx}function zx(e){try{const t={...e,timestamp:Gf()};localStorage.setItem(zs,JSON.stringify(t)),P.info("[WebRTC Persistence] Saved host data:",{peerId:t.peerId})}catch(t){P.error("[WebRTC Persistence] Failed to save host data:",t)}}function hh(e){try{const t={...e,timestamp:Gf()};localStorage.setItem($s,JSON.stringify(t)),P.info("[WebRTC Persistence] Saved guest data:",{hostPeerId:t.hostPeerId,playerId:t.playerId})}catch(t){P.error("[WebRTC Persistence] Failed to save guest data:",t)}}function bd(e){try{const t={...e,timestamp:Gf()};localStorage.setItem(Ms,JSON.stringify(t)),P.info("[WebRTC Persistence] Saved game state, timestamp:",new Date(t.timestamp).toISOString())}catch(t){P.error("[WebRTC Persistence] Failed to save game state:",t)}}function hy(){try{const e=localStorage.getItem(zs);if(!e)return null;const t=JSON.parse(e);return pi(t.timestamp)?(P.info("[WebRTC Persistence] Loaded valid host data:",{peerId:t.peerId}),t):(P.info("[WebRTC Persistence] Host data expired, removing"),localStorage.removeItem(zs),null)}catch(e){return P.error("[WebRTC Persistence] Failed to load host data:",e),localStorage.removeItem(zs),null}}function my(){try{const e=localStorage.getItem($s);if(!e)return null;const t=JSON.parse(e);return pi(t.timestamp)?(P.info("[WebRTC Persistence] Loaded valid guest data:",{hostPeerId:t.hostPeerId,playerId:t.playerId}),t):(P.info("[WebRTC Persistence] Guest data expired, removing"),localStorage.removeItem($s),null)}catch(e){return P.error("[WebRTC Persistence] Failed to load guest data:",e),localStorage.removeItem($s),null}}function mh(){try{const e=localStorage.getItem(Ms);if(!e)return null;const t=JSON.parse(e);return pi(t.timestamp)?(P.info("[WebRTC Persistence] Loaded valid game state, timestamp:",new Date(t.timestamp).toISOString()),t):(P.info("[WebRTC Persistence] Game state expired, removing"),localStorage.removeItem(Ms),null)}catch(e){return P.error("[WebRTC Persistence] Failed to load game state:",e),localStorage.removeItem(Ms),null}}function za(){localStorage.removeItem(Ms),localStorage.removeItem(zs),localStorage.removeItem($s),localStorage.removeItem(Lx)}function xd(e,t){try{const n=`webrtc_host_${t}`,r={peerId:e,gameId:t,timestamp:Date.now()};localStorage.setItem(n,JSON.stringify(r)),P.debug(`[WebRTC Persistence] Broadcasted host peerId for game ${t}:`,e)}catch(n){P.error("[WebRTC Persistence] Failed to broadcast host peerId:",n)}}function Cd(e){try{const t=`webrtc_host_${e}`,n=localStorage.getItem(t);if(!n)return null;const r=JSON.parse(n);return Date.now()-r.timestamp>15e3?null:{peerId:r.peerId,timestamp:r.timestamp}}catch(t){return P.error("[WebRTC Persistence] Failed to get host peerId:",t),null}}function $x(e){try{const t=`webrtc_host_${e}`;localStorage.removeItem(t),P.debug(`[WebRTC Persistence] Cleared host peerId broadcast for game ${e}`)}catch(t){P.error("[WebRTC Persistence] Failed to clear host peerId broadcast:",t)}}function Gx(){const e=hy();if(e&&pi(e.timestamp))return"host";const t=my();return t&&pi(t.timestamp)?"guest":"none"}const Ux=({isOpen:e,message:t,onExit:n})=>{const{t:r}=un(),[a,o]=m.useState(""),s=()=>{za(),n&&n(),window.location.reload()};return m.useEffect(()=>{if(!e){o("");return}const l=[r("connectingToHost")||"Connecting to host...",r("reconnectingDescription")||"Attempting to restore connection..."];let c=0;o(l[0]);const d=setInterval(()=>{c=(c+1)%l.length,o(l[c])},2e3);return()=>clearInterval(d)},[e,r]),e?i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-[300] backdrop-blur-sm",children:i.jsxs("div",{className:"bg-gray-900 rounded-lg border-2 border-blue-500 shadow-2xl p-8 w-full max-w-md text-center",children:[i.jsx("div",{className:"flex justify-center mb-6",children:i.jsxs("div",{className:"relative w-16 h-16",children:[i.jsx("div",{className:"absolute inset-0 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"}),i.jsx("div",{className:"absolute inset-2 border-4 border-blue-400 border-t-transparent rounded-full animate-spin",style:{animationDuration:"1.5s"}})]})}),i.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:r("reconnecting")}),i.jsx("p",{className:"text-blue-300 mb-4 min-h-[24px] flex items-center justify-center",children:t||a}),i.jsx("p",{className:"text-sm text-gray-400",children:r("pleaseWait")}),i.jsx("p",{className:"text-xs text-gray-500 mt-4",children:r("doNotClose")||"Do not close this window while reconnecting"}),i.jsxs("div",{className:"flex justify-center gap-2 mt-6 mb-6",children:[i.jsx("span",{className:"w-3 h-3 bg-blue-500 rounded-full animate-pulse",style:{animationDelay:"0ms"}}),i.jsx("span",{className:"w-3 h-3 bg-blue-500 rounded-full animate-pulse",style:{animationDelay:"200ms"}}),i.jsx("span",{className:"w-3 h-3 bg-blue-500 rounded-full animate-pulse",style:{animationDelay:"400ms"}})]}),i.jsx("button",{onClick:s,className:"mt-4 px-6 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition font-medium",children:r("cancel")||"Cancel"})]})}):null};function Gs(e){const t=[...e];for(let n=t.length-1;n>0;n--){const r=Math.floor(Math.random()*(n+1));[t[n],t[r]]=[t[r],t[n]]}return t}const gh=7,wd="mrPearlDoF",Fx="reverendOfTheChoir";function Bx(e){return typeof structuredClone<"u"?structuredClone(e):JSON.parse(JSON.stringify(e))}const yh=()=>Array(gh).fill(null).map(()=>Array(gh).fill(null).map(()=>({card:null}))),Cn=e=>{var _,C;const{board:t,activeGridSize:n,players:r}=e,a=Bx(t),o=a.length,s=Math.floor((o-n)/2),l=new Map;r.forEach(D=>l.set(D.id,D.teamId));for(let D=0;D<o;D++)for(let x=0;x<o;x++){const y=a[D][x].card;y&&(y.statuses&&(y.statuses=y.statuses.filter(k=>k.type!=="Support"&&k.type!=="Threat")),delete y.bonusPower)}for(let D=0;D<o;D++)for(let x=0;x<o;x++){const y=a[D][x].card;if((y==null?void 0:y.ownerId)===void 0||y.isFaceDown)continue;const k=y.ownerId,j=l.get(k),$=[{r:D-1,c:x},{r:D+1,c:x},{r:D,c:x-1},{r:D,c:x+1}],A={};let M=!1;for(const ee of $){const{r:re,c:Ie}=ee;if(re>=0&&re<o&&Ie>=0&&Ie<o){const B=a[re][Ie].card,fe=(_=B==null?void 0:B.statuses)==null?void 0:_.some(he=>he.type==="Stun");if((B==null?void 0:B.ownerId)!==void 0&&!B.isFaceDown&&!fe){const he=B.ownerId,ke=l.get(he);k===he||j!==void 0&&j===ke?M=!0:(A[he]||(A[he]=[]),A[he].push({r:re,c:Ie}))}}}M&&(y.statuses||(y.statuses=[]),y.statuses.some(ee=>ee.type==="Support")||y.statuses.push({type:"Support",addedByPlayerId:k}));let K=null;for(const ee in A){const re=A[ee];if(re&&re.length>=2){K=parseInt(ee,10);break}}if(K===null&&D>=s&&D<s+n&&x>=s&&x<s+n){const re=D===s||D===s+n-1||x===s||x===s+n-1,Ie=Object.keys(A).length>0;if(re&&Ie){const B=Object.keys(A)[0];B&&(K=parseInt(B,10))}}K!==null&&(y.statuses||(y.statuses=[]),y.statuses.some(ee=>ee.type==="Threat")||y.statuses.push({type:"Threat",addedByPlayerId:K}))}const c=[],d=[];for(let D=0;D<o;D++)for(let x=0;x<o;x++){const y=a[D][x].card,k=(C=y==null?void 0:y.statuses)==null?void 0:C.some(j=>j.type==="Stun");y!=null&&y.baseId&&!y.isFaceDown&&y.ownerId!==void 0&&!k&&(y.baseId===Fx?c.push({r:D,c:x,ownerId:y.ownerId,baseId:y.baseId}):y.baseId===wd&&d.push({r:D,c:x,ownerId:y.ownerId,baseId:y.baseId}))}const f=new Set,h=new Set;for(const D of c){const{r:x,c:y,ownerId:k}=D,j=`${x}-${k}`;if(!f.has(j)){f.add(j);for(let A=0;A<o;A++){const M=a[x][A].card;M&&M.ownerId===k&&!M.isFaceDown&&(M.statuses||(M.statuses=[]),M.statuses.some(K=>K.type==="Support")||M.statuses.push({type:"Support",addedByPlayerId:k}))}}const $=`${y}-${k}`;if(!h.has($)){h.add($);for(let A=0;A<o;A++){const M=a[A][y].card;M&&M.ownerId===k&&!M.isFaceDown&&(M.statuses||(M.statuses=[]),M.statuses.some(K=>K.type==="Support")||M.statuses.push({type:"Support",addedByPlayerId:k}))}}}const v=new Set,w=new Set;for(const D of d){const{r:x,c:y,ownerId:k}=D,j=`${x}-${k}`;if(!v.has(j)){v.add(j);for(let A=0;A<o;A++){const M=a[x][A].card;M&&M.ownerId===k&&!M.isFaceDown&&M.baseId!==wd&&(M.bonusPower=(M.bonusPower||0)+1)}}const $=`${y}-${k}`;if(!w.has($)){w.add($);for(let A=0;A<o;A++){const M=a[A][y].card;M&&M.ownerId===k&&!M.isFaceDown&&M.baseId!==wd&&(M.bonusPower=(M.bonusPower||0)+1)}}}return a},vh=-1,Hx=-2,Ts=1,cl=2,va=(e,t,n,r)=>{var l,c,d,f,h;const{card:a,ownerId:o,location:s}=e;if(t.targetOwnerId!==void 0&&t.targetOwnerId!==vh&&t.targetOwnerId!==Hx&&t.targetOwnerId!==o||t.excludeOwnerId!==void 0&&t.excludeOwnerId===o)return!1;if(t.onlyOpponents||t.targetOwnerId===vh){if(o===n)return!1;const v=r.find(_=>_.id===n),w=r.find(_=>_.id===o);if(v&&w&&v.teamId!==void 0&&v.teamId===w.teamId)return!1}if(t.targetType&&!((l=a.types)!=null&&l.includes(t.targetType))||t.onlyFaceDown&&((c=a.statuses)!=null&&c.some(v=>v.type==="Revealed"&&v.addedByPlayerId===n)||s==="board"&&!a.isFaceDown)||t.tokenType==="Revealed"&&(d=a.statuses)!=null&&d.some(v=>v.type==="Revealed"&&v.addedByPlayerId===n)||t.requiredTargetStatus&&(!((f=a.statuses)!=null&&f.some(v=>v.type===t.requiredTargetStatus))||t.requireStatusFromSourceOwner&&n!==null&&!((h=a.statuses)==null?void 0:h.some(w=>w.type===t.requiredTargetStatus&&w.addedByPlayerId===n))))return!1;if(t.mustBeAdjacentToSource&&t.sourceCoords&&e.boardCoords){const{row:v,col:w}=t.sourceCoords,{row:_,col:C}=e.boardCoords;if(Math.abs(v-_)+Math.abs(w-C)!==Ts)return!1}if(t.mustBeInLineWithSource&&t.sourceCoords&&e.boardCoords){const{row:v,col:w}=t.sourceCoords,{row:_,col:C}=e.boardCoords;if(v!==_&&w!==C)return!1}if(t.maxDistanceFromSource!==void 0&&t.sourceCoords&&e.boardCoords){const{row:v,col:w}=t.sourceCoords,{row:_,col:C}=e.boardCoords;if(Math.max(Math.abs(v-_),Math.abs(w-C))>t.maxDistanceFromSource)return!1}if(t.maxOrthogonalDistance!==void 0&&t.sourceCoords&&e.boardCoords){const{row:v,col:w}=t.sourceCoords,{row:_,col:C}=e.boardCoords;if(Math.abs(v-_)+Math.abs(w-C)>t.maxOrthogonalDistance)return!1}return!0},hi=(e,t,n,r)=>{if(!e||e.type!=="ENTER_MODE"&&e.type!=="CREATE_STACK")return[];const a=[],o=t.board,s=o.length,l=t.activeGridSize,c=Math.floor((s-l)/2),d=c,f=c+l-1;if(e.type==="CREATE_STACK"){const C={targetOwnerId:e.targetOwnerId,excludeOwnerId:e.excludeOwnerId,onlyOpponents:e.onlyOpponents,onlyFaceDown:e.onlyFaceDown,targetType:e.targetType,requiredTargetStatus:e.requiredTargetStatus,requireStatusFromSourceOwner:e.requireStatusFromSourceOwner,mustBeAdjacentToSource:e.mustBeAdjacentToSource,mustBeInLineWithSource:e.mustBeInLineWithSource,maxDistanceFromSource:e.maxDistanceFromSource,maxOrthogonalDistance:e.maxOrthogonalDistance,sourceCoords:e.sourceCoords,tokenType:e.tokenType};for(let D=d;D<=f;D++)for(let x=d;x<=f;x++){const y=o[D][x];y.card&&y.card.ownerId!==void 0&&va({card:y.card,ownerId:y.card.ownerId,location:"board",boardCoords:{row:D,col:x}},C,n,t.players)&&a.push({row:D,col:x})}return a}const{mode:h,payload:v,sourceCoords:w,contextCheck:_}=e;if(h==="REVEREND_DOUBLE_EXPLOIT"){for(let C=d;C<=f;C++)for(let D=d;D<=f;D++)o[C][D].card&&a.push({row:C,col:D});return a}if((h==="SELECT_TARGET"||h==="CENSOR_SWAP"||h==="ZEALOUS_WEAKEN"||h==="CENTURION_BUFF"||h==="SELECT_UNIT_FOR_MOVE")&&v.filter&&typeof v.filter=="function"){if(v.actionType==="SELECT_HAND_FOR_DISCARD_THEN_SPAWN"||v.actionType==="LUCIUS_SETUP"||v.actionType==="SELECT_HAND_FOR_DEPLOY"||v.handOnly)return[];for(let C=d;C<=f;C++)for(let D=d;D<=f;D++){const x=o[C][D];let y=x.card&&v.filter(x.card,C,D);if(y&&_==="ADJACENT_TO_LAST_MOVE"&&(r!=null&&r.lastMovedCardCoords)){const{row:k,col:j}=r.lastMovedCardCoords;Math.abs(C-k)+Math.abs(D-j)===1||(y=!1)}y&&a.push({row:C,col:D})}}else if(h==="SELECT_TARGET"&&(v.actionType==="ENHANCED_INT_REVEAL"||v.actionType==="ENHANCED_INT_MOVE"))for(let C=d;C<=f;C++)for(let D=d;D<=f;D++)o[C][D].card&&a.push({row:C,col:D});else if(h==="PATROL_MOVE"&&w)for(let C=d;C<=f;C++)for(let D=d;D<=f;D++){const x=C===w.row||D===w.col,y=C===w.row&&D===w.col,k=!o[C][D].card;x&&(k||y)&&a.push({row:C,col:D})}else if(h==="RIOT_PUSH"&&w){const C=[{r:w.row-1,c:w.col},{r:w.row+1,c:w.col},{r:w.row,c:w.col-1},{r:w.row,c:w.col+1}],D=(x,y)=>x>=d&&x<=f&&y>=d&&y<=f;C.forEach(x=>{if(D(x.r,x.c)){const y=o[x.r][x.c].card;if(y&&y.ownerId!==n){const k=t.players.find(A=>A.id===n),j=t.players.find(A=>A.id===y.ownerId);if(!((k==null?void 0:k.teamId)!==void 0&&(j==null?void 0:j.teamId)!==void 0&&k.teamId===j.teamId)){const A=x.r-w.row,M=x.c-w.col,K=x.r+A,ee=x.c+M;D(K,ee)&&(o[K][ee].card||a.push({row:x.r,col:x.c}))}}}})}else if(h==="RIOT_MOVE"&&v.vacatedCoords)a.push(v.vacatedCoords),w&&a.push(w);else if(h==="SWAP_POSITIONS"&&v.filter)for(let C=d;C<=f;C++)for(let D=d;D<=f;D++){const x=o[C][D];x.card&&v.filter(x.card,C,D)&&a.push({row:C,col:D})}else if((h==="TRANSFER_STATUS_SELECT"||h==="TRANSFER_ALL_STATUSES")&&v.filter)for(let C=d;C<=f;C++)for(let D=d;D<=f;D++){const x=o[C][D];x.card&&v.filter(x.card,C,D)&&a.push({row:C,col:D})}else if(h==="SPAWN_TOKEN"||h==="SELECT_CELL"||h==="IMMUNIS_RETRIEVE")for(let C=d;C<=f;C++)for(let D=d;D<=f;D++){const x=!o[C][D].card;if(h==="IMMUNIS_RETRIEVE"&&v.filter){x&&v.filter(C,D)&&a.push({row:C,col:D});continue}if(h==="SELECT_CELL"){if(v.moveFromHand){x&&a.push({row:C,col:D});continue}if(!w)continue;const y=C===w.row&&D===w.col,k=v.range==="global";let j=!1;if(k)j=!0;else if(v.range==="line")j=C===w.row||D===w.col;else if(v.range===cl){const $=Math.abs(C-w.row),A=Math.abs(D-w.col),M=$+A;if(M===Ts)j=!0;else if(M===cl){const K=[];$===cl&&A===0?K.push({r:(C+w.row)/2,c:D}):$===0&&A===cl?K.push({r:C,c:(D+w.col)/2}):$===Ts&&A===Ts&&(K.push({r:C,c:w.col}),K.push({r:w.row,c:D})),j=K.some(ee=>ee.r<0||ee.r>=s||ee.c<0||ee.c>=s?!1:!o[ee.r][ee.c].card)}}else j=Math.abs(C-w.row)+Math.abs(D-w.col)===Ts;(x&&j||v.allowSelf&&y)&&a.push({row:C,col:D})}else if(h==="SPAWN_TOKEN"&&w){const y=Math.abs(C-w.row)+Math.abs(D-w.col)===1;x&&y&&a.push({row:C,col:D})}}else if(h==="REVEAL_ENEMY"&&v.filter)for(let C=d;C<=f;C++)for(let D=d;D<=f;D++){const x=o[C][D];x.card&&v.filter(x.card,C,D)&&a.push({row:C,col:D})}else if(h==="SELECT_LINE_START")for(let C=d;C<=f;C++)for(let D=d;D<=f;D++)a.push({row:C,col:D});else if(h==="SELECT_LINE_END"&&v.firstCoords){const{row:C,col:D}=v.firstCoords;for(let x=d;x<=f;x++)a.push({row:C,col:x});for(let x=d;x<=f;x++)a.push({row:x,col:D})}else if(h==="INTEGRATOR_LINE_SELECT"&&w){const{row:C,col:D}=w;for(let x=d;x<=f;x++)a.push({row:C,col:x});for(let x=d;x<=f;x++)a.push({row:x,col:D})}else if(h==="ZIUS_LINE_SELECT"&&w){const{row:C,col:D}=w;for(let x=d;x<=f;x++)a.push({row:C,col:x});for(let x=d;x<=f;x++)a.push({row:x,col:D})}else if(h==="SELECT_DIAGONAL")if(v.firstCoords){const{row:C,col:D}=v.firstCoords;for(let x=d;x<=f;x++)for(let y=d;y<=f;y++)Math.abs(x-C)===Math.abs(y-D)&&a.push({row:x,col:y})}else for(let C=d;C<=f;C++)for(let D=d;D<=f;D++)a.push({row:C,col:D});return a},Es=(e,t,n,r)=>{var o,s,l,c,d;if(e.type==="OPEN_MODAL"||e.mode==="SELECT_DECK")return!0;if(e.mode==="REVEREND_DOUBLE_EXPLOIT"){for(let f=0;f<t.board.length;f++)for(let h=0;h<t.board[f].length;h++)if(t.board[f][h].card)return!0;return!1}if(e.mode==="PRINCEPS_SHIELD_THEN_AIM"||e.mode==="SHIELD_SELF_THEN_SPAWN"||e.mode==="SHIELD_SELF_THEN_RIOT_PUSH"||e.mode==="ABR_DEPLOY_SHIELD_AIM"||e.mode==="GAWAIN_DEPLOY_SHIELD_AIM")return!0;if(e.mode==="SELECT_TARGET"&&((o=e.payload)!=null&&o.actionType)){const f=e.payload.actionType;if(f==="SELECT_HAND_FOR_DISCARD_THEN_SPAWN"||f==="LUCIUS_SETUP"||f==="SELECT_HAND_FOR_DEPLOY"){const h=((s=e.sourceCard)==null?void 0:s.ownerId)||n;if(h!==null){const v=t.players.find(w=>w.id===h);if(v&&v.hand.length>0)return!0}return!1}}if(e.type==="CREATE_STACK"){if(hi(e,t,n,r).length>0)return!0;if(e.tokenType==="Revealed"||(l=e.tokenType)!=null&&l.startsWith("Power"))for(const h of t.players)for(let v=0;v<h.hand.length;v++){const w={targetOwnerId:e.targetOwnerId,excludeOwnerId:e.excludeOwnerId,onlyOpponents:e.onlyOpponents,onlyFaceDown:e.onlyFaceDown,targetType:e.targetType,tokenType:e.tokenType};if(va({card:h.hand[v],ownerId:h.id,location:"hand"},w,n,t.players))return!0}return!1}if(e.mode==="SELECT_TARGET"&&((c=e.payload)!=null&&c.filter)){if(e.payload.handOnly||e.payload.allowHandTargets||e.payload.actionType==="DESTROY"){for(const f of t.players)if(f.hand.some(h=>e.payload.filter(h))&&e.payload.handOnly)return!0}if(e.payload.handOnly)return!1}return hi(e,t,n,r).length>0?!0:((e.mode==="CENSOR_SWAP"||e.mode==="ZEALOUS_WEAKEN"||e.mode==="CENTURION_BUFF"||e.mode==="SELECT_UNIT_FOR_MOVE")&&((d=e.payload)!=null&&d.filter),!1)};class Wx{constructor(){this.encoder=new TextEncoder,this._pieces=[],this._parts=[]}append_buffer(t){this.flush(),this._parts.push(t)}append(t){this._pieces.push(t)}flush(){if(this._pieces.length>0){const t=new Uint8Array(this._pieces);this._parts.push(t),this._pieces=[]}}toArrayBuffer(){const t=[];for(const n of this._parts)t.push(n);return Vx(t).buffer}}function Vx(e){let t=0;for(const a of e)t+=a.byteLength;const n=new Uint8Array(t);let r=0;for(const a of e){const o=new Uint8Array(a.buffer,a.byteOffset,a.byteLength);n.set(o,r),r+=a.byteLength}return n}function gy(e){return new Kx(e).unpack()}function yy(e){const t=new Yx,n=t.pack(e);return n instanceof Promise?n.then(()=>t.getBuffer()):t.getBuffer()}class Kx{constructor(t){this.index=0,this.dataBuffer=t,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}unpack(){const t=this.unpack_uint8();if(t<128)return t;if((t^224)<32)return(t^224)-32;let n;if((n=t^160)<=15)return this.unpack_raw(n);if((n=t^176)<=15)return this.unpack_string(n);if((n=t^144)<=15)return this.unpack_array(n);if((n=t^128)<=15)return this.unpack_map(n);switch(t){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return n=this.unpack_uint16(),this.unpack_string(n);case 217:return n=this.unpack_uint32(),this.unpack_string(n);case 218:return n=this.unpack_uint16(),this.unpack_raw(n);case 219:return n=this.unpack_uint32(),this.unpack_raw(n);case 220:return n=this.unpack_uint16(),this.unpack_array(n);case 221:return n=this.unpack_uint32(),this.unpack_array(n);case 222:return n=this.unpack_uint16(),this.unpack_map(n);case 223:return n=this.unpack_uint32(),this.unpack_map(n)}}unpack_uint8(){const t=this.dataView[this.index]&255;return this.index++,t}unpack_uint16(){const t=this.read(2),n=(t[0]&255)*256+(t[1]&255);return this.index+=2,n}unpack_uint32(){const t=this.read(4),n=((t[0]*256+t[1])*256+t[2])*256+t[3];return this.index+=4,n}unpack_uint64(){const t=this.read(8),n=((((((t[0]*256+t[1])*256+t[2])*256+t[3])*256+t[4])*256+t[5])*256+t[6])*256+t[7];return this.index+=8,n}unpack_int8(){const t=this.unpack_uint8();return t<128?t:t-256}unpack_int16(){const t=this.unpack_uint16();return t<32768?t:t-65536}unpack_int32(){const t=this.unpack_uint32();return t<2**31?t:t-2**32}unpack_int64(){const t=this.unpack_uint64();return t<2**63?t:t-2**64}unpack_raw(t){if(this.length<this.index+t)throw new Error(`BinaryPackFailure: index is out of range ${this.index} ${t} ${this.length}`);const n=this.dataBuffer.slice(this.index,this.index+t);return this.index+=t,n}unpack_string(t){const n=this.read(t);let r=0,a="",o,s;for(;r<t;)o=n[r],o<160?(s=o,r++):(o^192)<32?(s=(o&31)<<6|n[r+1]&63,r+=2):(o^224)<16?(s=(o&15)<<12|(n[r+1]&63)<<6|n[r+2]&63,r+=3):(s=(o&7)<<18|(n[r+1]&63)<<12|(n[r+2]&63)<<6|n[r+3]&63,r+=4),a+=String.fromCodePoint(s);return this.index+=t,a}unpack_array(t){const n=new Array(t);for(let r=0;r<t;r++)n[r]=this.unpack();return n}unpack_map(t){const n={};for(let r=0;r<t;r++){const a=this.unpack();n[a]=this.unpack()}return n}unpack_float(){const t=this.unpack_uint32(),n=t>>31,r=(t>>23&255)-127,a=t&8388607|8388608;return(n===0?1:-1)*a*2**(r-23)}unpack_double(){const t=this.unpack_uint32(),n=this.unpack_uint32(),r=t>>31,a=(t>>20&2047)-1023,s=(t&1048575|1048576)*2**(a-20)+n*2**(a-52);return(r===0?1:-1)*s}read(t){const n=this.index;if(n+t<=this.length)return this.dataView.subarray(n,n+t);throw new Error("BinaryPackFailure: read index out of range")}}class Yx{getBuffer(){return this._bufferBuilder.toArrayBuffer()}pack(t){if(typeof t=="string")this.pack_string(t);else if(typeof t=="number")Math.floor(t)===t?this.pack_integer(t):this.pack_double(t);else if(typeof t=="boolean")t===!0?this._bufferBuilder.append(195):t===!1&&this._bufferBuilder.append(194);else if(t===void 0)this._bufferBuilder.append(192);else if(typeof t=="object")if(t===null)this._bufferBuilder.append(192);else{const n=t.constructor;if(t instanceof Array){const r=this.pack_array(t);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else if(t instanceof ArrayBuffer)this.pack_bin(new Uint8Array(t));else if("BYTES_PER_ELEMENT"in t){const r=t;this.pack_bin(new Uint8Array(r.buffer,r.byteOffset,r.byteLength))}else if(t instanceof Date)this.pack_string(t.toString());else{if(t instanceof Blob)return t.arrayBuffer().then(r=>{this.pack_bin(new Uint8Array(r)),this._bufferBuilder.flush()});if(n==Object||n.toString().startsWith("class")){const r=this.pack_object(t);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else throw new Error(`Type "${n.toString()}" not yet supported`)}}else throw new Error(`Type "${typeof t}" not yet supported`);this._bufferBuilder.flush()}pack_bin(t){const n=t.length;if(n<=15)this.pack_uint8(160+n);else if(n<=65535)this._bufferBuilder.append(218),this.pack_uint16(n);else if(n<=4294967295)this._bufferBuilder.append(219),this.pack_uint32(n);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(t)}pack_string(t){const n=this._textEncoder.encode(t),r=n.length;if(r<=15)this.pack_uint8(176+r);else if(r<=65535)this._bufferBuilder.append(216),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(217),this.pack_uint32(r);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(n)}pack_array(t){const n=t.length;if(n<=15)this.pack_uint8(144+n);else if(n<=65535)this._bufferBuilder.append(220),this.pack_uint16(n);else if(n<=4294967295)this._bufferBuilder.append(221),this.pack_uint32(n);else throw new Error("Invalid length");const r=a=>{if(a<n){const o=this.pack(t[a]);return o instanceof Promise?o.then(()=>r(a+1)):r(a+1)}};return r(0)}pack_integer(t){if(t>=-32&&t<=127)this._bufferBuilder.append(t&255);else if(t>=0&&t<=255)this._bufferBuilder.append(204),this.pack_uint8(t);else if(t>=-128&&t<=127)this._bufferBuilder.append(208),this.pack_int8(t);else if(t>=0&&t<=65535)this._bufferBuilder.append(205),this.pack_uint16(t);else if(t>=-32768&&t<=32767)this._bufferBuilder.append(209),this.pack_int16(t);else if(t>=0&&t<=4294967295)this._bufferBuilder.append(206),this.pack_uint32(t);else if(t>=-2147483648&&t<=2147483647)this._bufferBuilder.append(210),this.pack_int32(t);else if(t>=-9223372036854776e3&&t<=9223372036854776e3)this._bufferBuilder.append(211),this.pack_int64(t);else if(t>=0&&t<=18446744073709552e3)this._bufferBuilder.append(207),this.pack_uint64(t);else throw new Error("Invalid integer")}pack_double(t){let n=0;t<0&&(n=1,t=-t);const r=Math.floor(Math.log(t)/Math.LN2),a=t/2**r-1,o=Math.floor(a*2**52),s=2**32,l=n<<31|r+1023<<20|o/s&1048575,c=o%s;this._bufferBuilder.append(203),this.pack_int32(l),this.pack_int32(c)}pack_object(t){const n=Object.keys(t),r=n.length;if(r<=15)this.pack_uint8(128+r);else if(r<=65535)this._bufferBuilder.append(222),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(223),this.pack_uint32(r);else throw new Error("Invalid length");const a=o=>{if(o<n.length){const s=n[o];if(t.hasOwnProperty(s)){this.pack(s);const l=this.pack(t[s]);if(l instanceof Promise)return l.then(()=>a(o+1))}return a(o+1)}};return a(0)}pack_uint8(t){this._bufferBuilder.append(t)}pack_uint16(t){this._bufferBuilder.append(t>>8),this._bufferBuilder.append(t&255)}pack_uint32(t){const n=t&4294967295;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255)}pack_uint64(t){const n=t/4294967296,r=t%2**32;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}pack_int8(t){this._bufferBuilder.append(t&255)}pack_int16(t){this._bufferBuilder.append((t&65280)>>8),this._bufferBuilder.append(t&255)}pack_int32(t){this._bufferBuilder.append(t>>>24&255),this._bufferBuilder.append((t&16711680)>>>16),this._bufferBuilder.append((t&65280)>>>8),this._bufferBuilder.append(t&255)}pack_int64(t){const n=Math.floor(t/4294967296),r=t%2**32;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}constructor(){this._bufferBuilder=new Wx,this._textEncoder=new TextEncoder}}let vy=!0,by=!0;function Is(e,t,n){const r=e.match(t);return r&&r.length>=n&&parseFloat(r[n],10)}function eo(e,t,n){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,a=r.addEventListener;r.addEventListener=function(s,l){if(s!==t)return a.apply(this,arguments);const c=d=>{const f=n(d);f&&(l.handleEvent?l.handleEvent(f):l(f))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(l,c),a.apply(this,[s,c])};const o=r.removeEventListener;r.removeEventListener=function(s,l){if(s!==t||!this._eventMap||!this._eventMap[t])return o.apply(this,arguments);if(!this._eventMap[t].has(l))return o.apply(this,arguments);const c=this._eventMap[t].get(l);return this._eventMap[t].delete(l),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,o.apply(this,[s,c])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(s){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),s&&this.addEventListener(t,this["_on"+t]=s)},enumerable:!0,configurable:!0})}function qx(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(vy=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function Jx(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(by=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function xy(){if(typeof window=="object"){if(vy)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Uf(e,t){by&&console.warn(e+" is deprecated, please use "+t+" instead.")}function Xx(e){const t={browser:null,version:null};if(typeof e>"u"||!e.navigator||!e.navigator.userAgent)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.userAgentData&&n.userAgentData.brands){const r=n.userAgentData.brands.find(a=>a.brand==="Chromium");if(r)return{browser:"chrome",version:parseInt(r.version,10)}}if(n.mozGetUserMedia)t.browser="firefox",t.version=parseInt(Is(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||e.isSecureContext===!1&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=parseInt(Is(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(e.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))t.browser="safari",t.version=parseInt(Is(n.userAgent,/AppleWebKit\/(\d+)\./,1)),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype,t._safariVersion=Is(n.userAgent,/Version\/(\d+(\.?\d+))/,1);else return t.browser="Not a supported browser.",t;return t}function bh(e){return Object.prototype.toString.call(e)==="[object Object]"}function Cy(e){return bh(e)?Object.keys(e).reduce(function(t,n){const r=bh(e[n]),a=r?Cy(e[n]):e[n],o=r&&!Object.keys(a).length;return a===void 0||o?t:Object.assign(t,{[n]:a})},{}):e}function Su(e,t,n){!t||n.has(t.id)||(n.set(t.id,t),Object.keys(t).forEach(r=>{r.endsWith("Id")?Su(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach(a=>{Su(e,e.get(a),n)})}))}function xh(e,t,n){const r=n?"outbound-rtp":"inbound-rtp",a=new Map;if(t===null)return a;const o=[];return e.forEach(s=>{s.type==="track"&&s.trackIdentifier===t.id&&o.push(s)}),o.forEach(s=>{e.forEach(l=>{l.type===r&&l.trackId===s.id&&Su(e,l,a)})}),a}const Ch=xy;function wy(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const r=function(l){if(typeof l!="object"||l.mandatory||l.optional)return l;const c={};return Object.keys(l).forEach(d=>{if(d==="require"||d==="advanced"||d==="mediaSource")return;const f=typeof l[d]=="object"?l[d]:{ideal:l[d]};f.exact!==void 0&&typeof f.exact=="number"&&(f.min=f.max=f.exact);const h=function(v,w){return v?v+w.charAt(0).toUpperCase()+w.slice(1):w==="deviceId"?"sourceId":w};if(f.ideal!==void 0){c.optional=c.optional||[];let v={};typeof f.ideal=="number"?(v[h("min",d)]=f.ideal,c.optional.push(v),v={},v[h("max",d)]=f.ideal,c.optional.push(v)):(v[h("",d)]=f.ideal,c.optional.push(v))}f.exact!==void 0&&typeof f.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[h("",d)]=f.exact):["min","max"].forEach(v=>{f[v]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[h(v,d)]=f[v])})}),l.advanced&&(c.optional=(c.optional||[]).concat(l.advanced)),c},a=function(l,c){if(t.version>=61)return c(l);if(l=JSON.parse(JSON.stringify(l)),l&&typeof l.audio=="object"){const d=function(f,h,v){h in f&&!(v in f)&&(f[v]=f[h],delete f[h])};l=JSON.parse(JSON.stringify(l)),d(l.audio,"autoGainControl","googAutoGainControl"),d(l.audio,"noiseSuppression","googNoiseSuppression"),l.audio=r(l.audio)}if(l&&typeof l.video=="object"){let d=l.video.facingMode;d=d&&(typeof d=="object"?d:{ideal:d});const f=t.version<66;if(d&&(d.exact==="user"||d.exact==="environment"||d.ideal==="user"||d.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!f)){delete l.video.facingMode;let h;if(d.exact==="environment"||d.ideal==="environment"?h=["back","rear"]:(d.exact==="user"||d.ideal==="user")&&(h=["front"]),h)return n.mediaDevices.enumerateDevices().then(v=>{v=v.filter(_=>_.kind==="videoinput");let w=v.find(_=>h.some(C=>_.label.toLowerCase().includes(C)));return!w&&v.length&&h.includes("back")&&(w=v[v.length-1]),w&&(l.video.deviceId=d.exact?{exact:w.deviceId}:{ideal:w.deviceId}),l.video=r(l.video),Ch("chrome: "+JSON.stringify(l)),c(l)})}l.video=r(l.video)}return Ch("chrome: "+JSON.stringify(l)),c(l)},o=function(l){return t.version>=64?l:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[l.name]||l.name,message:l.message,constraint:l.constraint||l.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},s=function(l,c,d){a(l,f=>{n.webkitGetUserMedia(f,c,h=>{d&&d(o(h))})})};if(n.getUserMedia=s.bind(n),n.mediaDevices.getUserMedia){const l=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(c){return a(c,d=>l(d).then(f=>{if(d.audio&&!f.getAudioTracks().length||d.video&&!f.getVideoTracks().length)throw f.getTracks().forEach(h=>{h.stop()}),new DOMException("","NotFoundError");return f},f=>Promise.reject(o(f))))}}}function ky(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function Ty(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",a=>{let o;e.RTCPeerConnection.prototype.getReceivers?o=this.getReceivers().find(l=>l.track&&l.track.id===a.track.id):o={track:a.track};const s=new Event("track");s.track=a.track,s.receiver=o,s.transceiver={receiver:o},s.streams=[r.stream],this.dispatchEvent(s)}),r.stream.getTracks().forEach(a=>{let o;e.RTCPeerConnection.prototype.getReceivers?o=this.getReceivers().find(l=>l.track&&l.track.id===a.id):o={track:a};const s=new Event("track");s.track=a,s.receiver=o,s.transceiver={receiver:o},s.streams=[r.stream],this.dispatchEvent(s)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else eo(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function Ey(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(a,o){return{track:o,get dtmf(){return this._dtmf===void 0&&(o.kind==="audio"?this._dtmf=a.createDTMFSender(o):this._dtmf=null),this._dtmf},_pc:a}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const a=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(l,c){let d=a.apply(this,arguments);return d||(d=t(this,l),this._senders.push(d)),d};const o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(l){o.apply(this,arguments);const c=this._senders.indexOf(l);c!==-1&&this._senders.splice(c,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(o){this._senders=this._senders||[],n.apply(this,[o]),o.getTracks().forEach(s=>{this._senders.push(t(this,s))})};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(o){this._senders=this._senders||[],r.apply(this,[o]),o.getTracks().forEach(s=>{const l=this._senders.find(c=>c.track===s);l&&this._senders.splice(this._senders.indexOf(l),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const r=t.apply(this,[]);return r.forEach(a=>a._pc=this),r},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Iy(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){const o=n.apply(this,[]);return o.forEach(s=>s._pc=this),o});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const o=r.apply(this,arguments);return o._pc=this,o}),e.RTCRtpSender.prototype.getStats=function(){const o=this;return this._pc.getStats().then(s=>xh(s,o.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){const a=n.apply(this,[]);return a.forEach(o=>o._pc=this),a}),eo(e,"track",r=>(r.receiver._pc=r.srcElement,r)),e.RTCRtpReceiver.prototype.getStats=function(){const a=this;return this._pc.getStats().then(o=>xh(o,a.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const r=arguments[0];let a,o,s;return this.getSenders().forEach(l=>{l.track===r&&(a?s=!0:a=l)}),this.getReceivers().forEach(l=>(l.track===r&&(o?s=!0:o=l),l.track===r)),s||a&&o?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):a?a.getStats():o?o.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function Sy(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(s=>this._shimmedLocalStreams[s][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(s,l){if(!l)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=t.apply(this,arguments);return this._shimmedLocalStreams[l.id]?this._shimmedLocalStreams[l.id].indexOf(c)===-1&&this._shimmedLocalStreams[l.id].push(c):this._shimmedLocalStreams[l.id]=[l,c],c};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(s){this._shimmedLocalStreams=this._shimmedLocalStreams||{},s.getTracks().forEach(d=>{if(this.getSenders().find(h=>h.track===d))throw new DOMException("Track already exists.","InvalidAccessError")});const l=this.getSenders();n.apply(this,arguments);const c=this.getSenders().filter(d=>l.indexOf(d)===-1);this._shimmedLocalStreams[s.id]=[s].concat(c)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[s.id],r.apply(this,arguments)};const a=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},s&&Object.keys(this._shimmedLocalStreams).forEach(l=>{const c=this._shimmedLocalStreams[l].indexOf(s);c!==-1&&this._shimmedLocalStreams[l].splice(c,1),this._shimmedLocalStreams[l].length===1&&delete this._shimmedLocalStreams[l]}),a.apply(this,arguments)}}function _y(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return Sy(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const f=n.apply(this);return this._reverseStreams=this._reverseStreams||{},f.map(h=>this._reverseStreams[h.id])};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(f){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},f.getTracks().forEach(h=>{if(this.getSenders().find(w=>w.track===h))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[f.id]){const h=new e.MediaStream(f.getTracks());this._streams[f.id]=h,this._reverseStreams[h.id]=f,f=h}r.apply(this,[f])};const a=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(f){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},a.apply(this,[this._streams[f.id]||f]),delete this._reverseStreams[this._streams[f.id]?this._streams[f.id].id:f.id],delete this._streams[f.id]},e.RTCPeerConnection.prototype.addTrack=function(f,h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const v=[].slice.call(arguments,1);if(v.length!==1||!v[0].getTracks().find(C=>C===f))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(C=>C.track===f))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const _=this._streams[h.id];if(_)_.addTrack(f),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const C=new e.MediaStream([f]);this._streams[h.id]=C,this._reverseStreams[C.id]=h,this.addStream(C)}return this.getSenders().find(C=>C.track===f)};function o(d,f){let h=f.sdp;return Object.keys(d._reverseStreams||[]).forEach(v=>{const w=d._reverseStreams[v],_=d._streams[w.id];h=h.replace(new RegExp(_.id,"g"),w.id)}),new RTCSessionDescription({type:f.type,sdp:h})}function s(d,f){let h=f.sdp;return Object.keys(d._reverseStreams||[]).forEach(v=>{const w=d._reverseStreams[v],_=d._streams[w.id];h=h.replace(new RegExp(w.id,"g"),_.id)}),new RTCSessionDescription({type:f.type,sdp:h})}["createOffer","createAnswer"].forEach(function(d){const f=e.RTCPeerConnection.prototype[d],h={[d](){const v=arguments;return arguments.length&&typeof arguments[0]=="function"?f.apply(this,[_=>{const C=o(this,_);v[0].apply(null,[C])},_=>{v[1]&&v[1].apply(null,_)},arguments[2]]):f.apply(this,arguments).then(_=>o(this,_))}};e.RTCPeerConnection.prototype[d]=h[d]});const l=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?l.apply(this,arguments):(arguments[0]=s(this,arguments[0]),l.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const d=c.get.apply(this);return d.type===""?d:o(this,d)}}),e.RTCPeerConnection.prototype.removeTrack=function(f){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!f._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(f._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let v;Object.keys(this._streams).forEach(w=>{this._streams[w].getTracks().find(C=>f.track===C)&&(v=this._streams[w])}),v&&(v.getTracks().length===1?this.removeStream(this._reverseStreams[v.id]):v.removeTrack(f.track),this.dispatchEvent(new Event("negotiationneeded")))}}function _u(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const r=e.RTCPeerConnection.prototype[n],a={[n](){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=a[n]})}function Dy(e,t){eo(e,"negotiationneeded",n=>{const r=n.target;if(!((t.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return n})}const wh=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:Dy,shimAddTrackRemoveTrack:_y,shimAddTrackRemoveTrackWithNative:Sy,shimGetSendersWithDtmf:Ey,shimGetUserMedia:wy,shimMediaStream:ky,shimOnTrack:Ty,shimPeerConnection:_u,shimSenderReceiverGetStats:Iy},Symbol.toStringTag,{value:"Module"}));function Ry(e,t){const n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(a,o,s){Uf("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(a).then(o,s)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const a=function(s,l,c){l in s&&!(c in s)&&(s[c]=s[l],delete s[l])},o=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(s){return typeof s=="object"&&typeof s.audio=="object"&&(s=JSON.parse(JSON.stringify(s)),a(s.audio,"autoGainControl","mozAutoGainControl"),a(s.audio,"noiseSuppression","mozNoiseSuppression")),o(s)},r&&r.prototype.getSettings){const s=r.prototype.getSettings;r.prototype.getSettings=function(){const l=s.apply(this,arguments);return a(l,"mozAutoGainControl","autoGainControl"),a(l,"mozNoiseSuppression","noiseSuppression"),l}}if(r&&r.prototype.applyConstraints){const s=r.prototype.applyConstraints;r.prototype.applyConstraints=function(l){return this.kind==="audio"&&typeof l=="object"&&(l=JSON.parse(JSON.stringify(l)),a(l,"autoGainControl","mozAutoGainControl"),a(l,"noiseSuppression","mozNoiseSuppression")),s.apply(this,[l])}}}}function Zx(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){const a=new DOMException("getDisplayMedia without video constraints is undefined");return a.name="NotFoundError",a.code=8,Promise.reject(a)}return r.video===!0?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})}function jy(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Du(e,t){if(typeof e!="object"||!(e.RTCPeerConnection||e.mozRTCPeerConnection))return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(a){const o=e.RTCPeerConnection.prototype[a],s={[a](){return arguments[0]=new(a==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};e.RTCPeerConnection.prototype[a]=s[a]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[o,s,l]=arguments;return r.apply(this,[o||null]).then(c=>{if(t.version<53&&!s)try{c.forEach(d=>{d.type=n[d.type]||d.type})}catch(d){if(d.name!=="TypeError")throw d;c.forEach((f,h)=>{c.set(h,Object.assign({},f,{type:n[f.type]||f.type}))})}return c}).then(s,l)}}function Py(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const a=t.apply(this,[]);return a.forEach(o=>o._pc=this),a});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const a=n.apply(this,arguments);return a._pc=this,a}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Ny(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const r=t.apply(this,[]);return r.forEach(a=>a._pc=this),r}),eo(e,"track",n=>(n.receiver._pc=n.srcElement,n)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Ay(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(n){Uf("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&n.getTracks().includes(r.track)&&this.removeTrack(r)})})}function Oy(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function Ly(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const a=r.length>0;a&&r.forEach(s=>{if("rid"in s&&!/^[a-z0-9]{0,16}$/i.test(s.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in s&&!(parseFloat(s.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in s&&!(parseFloat(s.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const o=t.apply(this,arguments);if(a){const{sender:s}=o,l=s.getParameters();(!("encodings"in l)||l.encodings.length===1&&Object.keys(l.encodings[0]).length===0)&&(l.encodings=r,s.sendEncodings=r,this.setParametersPromises.push(s.setParameters(l).then(()=>{delete s.sendEncodings}).catch(()=>{delete s.sendEncodings})))}return o})}function My(e){if(!(typeof e=="object"&&e.RTCRtpSender))return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const r=t.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function zy(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function $y(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}const kh=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:Ly,shimCreateAnswer:$y,shimCreateOffer:zy,shimGetDisplayMedia:Zx,shimGetParameters:My,shimGetUserMedia:Ry,shimOnTrack:jy,shimPeerConnection:Du,shimRTCDataChannel:Oy,shimReceiverGetStats:Ny,shimRemoveStream:Ay,shimSenderGetStats:Py},Symbol.toStringTag,{value:"Module"}));function Gy(e){if(!(typeof e!="object"||!e.RTCPeerConnection)){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(a=>t.call(this,a,r)),r.getVideoTracks().forEach(a=>t.call(this,a,r))},e.RTCPeerConnection.prototype.addTrack=function(r,...a){return a&&a.forEach(o=>{this._localStreams?this._localStreams.includes(o)||this._localStreams.push(o):this._localStreams=[o]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(n);if(r===-1)return;this._localStreams.splice(r,1);const a=n.getTracks();this.getSenders().forEach(o=>{a.includes(o.track)&&this.removeTrack(o)})})}}function Uy(e){if(!(typeof e!="object"||!e.RTCPeerConnection)&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(a=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(a))return;this._remoteStreams.push(a);const o=new Event("addstream");o.stream=a,this.dispatchEvent(o)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(a){a.streams.forEach(o=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(o)>=0)return;r._remoteStreams.push(o);const s=new Event("addstream");s.stream=o,r.dispatchEvent(s)})}),t.apply(r,arguments)}}}function Fy(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,a=t.setLocalDescription,o=t.setRemoteDescription,s=t.addIceCandidate;t.createOffer=function(d,f){const h=arguments.length>=2?arguments[2]:arguments[0],v=n.apply(this,[h]);return f?(v.then(d,f),Promise.resolve()):v},t.createAnswer=function(d,f){const h=arguments.length>=2?arguments[2]:arguments[0],v=r.apply(this,[h]);return f?(v.then(d,f),Promise.resolve()):v};let l=function(c,d,f){const h=a.apply(this,[c]);return f?(h.then(d,f),Promise.resolve()):h};t.setLocalDescription=l,l=function(c,d,f){const h=o.apply(this,[c]);return f?(h.then(d,f),Promise.resolve()):h},t.setRemoteDescription=l,l=function(c,d,f){const h=s.apply(this,[c]);return f?(h.then(d,f),Promise.resolve()):h},t.addIceCandidate=l}function By(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const n=t.mediaDevices,r=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=a=>r(Hy(a))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(r,a,o){t.mediaDevices.getUserMedia(r).then(a,o)}).bind(t))}function Hy(e){return e&&e.video!==void 0?Object.assign({},e,{video:Cy(e.video)}):e}function Wy(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(r,a){if(r&&r.iceServers){const o=[];for(let s=0;s<r.iceServers.length;s++){let l=r.iceServers[s];l.urls===void 0&&l.url?(Uf("RTCIceServer.url","RTCIceServer.urls"),l=JSON.parse(JSON.stringify(l)),l.urls=l.url,delete l.url,o.push(l)):o.push(r.iceServers[s])}r.iceServers=o}return new t(r,a)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get(){return t.generateCertificate}})}function Vy(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Ky(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const a=this.getTransceivers().find(s=>s.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&a?a.direction==="sendrecv"?a.setDirection?a.setDirection("sendonly"):a.direction="sendonly":a.direction==="recvonly"&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive"):r.offerToReceiveAudio===!0&&!a&&this.addTransceiver("audio",{direction:"recvonly"}),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const o=this.getTransceivers().find(s=>s.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):r.offerToReceiveVideo===!0&&!o&&this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function Yy(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}const Th=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:Yy,shimCallbacksAPI:Fy,shimConstraints:Hy,shimCreateOfferLegacy:Ky,shimGetUserMedia:By,shimLocalStreamsAPI:Gy,shimRTCIceServerUrls:Wy,shimRemoteStreamsAPI:Uy,shimTrackEventTransceiver:Vy},Symbol.toStringTag,{value:"Module"}));var qy={exports:{}};(function(e){const t={};t.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},t.localCName=t.generateIdentifier(),t.splitLines=function(n){return n.trim().split(`
`).map(r=>r.trim())},t.splitSections=function(n){return n.split(`
m=`).map((a,o)=>(o>0?"m="+a:a).trim()+`\r
`)},t.getDescription=function(n){const r=t.splitSections(n);return r&&r[0]},t.getMediaSections=function(n){const r=t.splitSections(n);return r.shift(),r},t.matchPrefix=function(n,r){return t.splitLines(n).filter(a=>a.indexOf(r)===0)},t.parseCandidate=function(n){let r;n.indexOf("a=candidate:")===0?r=n.substring(12).split(" "):r=n.substring(10).split(" ");const a={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let o=8;o<r.length;o+=2)switch(r[o]){case"raddr":a.relatedAddress=r[o+1];break;case"rport":a.relatedPort=parseInt(r[o+1],10);break;case"tcptype":a.tcpType=r[o+1];break;case"ufrag":a.ufrag=r[o+1],a.usernameFragment=r[o+1];break;default:a[r[o]]===void 0&&(a[r[o]]=r[o+1]);break}return a},t.writeCandidate=function(n){const r=[];r.push(n.foundation);const a=n.component;a==="rtp"?r.push(1):a==="rtcp"?r.push(2):r.push(a),r.push(n.protocol.toUpperCase()),r.push(n.priority),r.push(n.address||n.ip),r.push(n.port);const o=n.type;return r.push("typ"),r.push(o),o!=="host"&&n.relatedAddress&&n.relatedPort&&(r.push("raddr"),r.push(n.relatedAddress),r.push("rport"),r.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(r.push("ufrag"),r.push(n.usernameFragment||n.ufrag)),"candidate:"+r.join(" ")},t.parseIceOptions=function(n){return n.substring(14).split(" ")},t.parseRtpMap=function(n){let r=n.substring(9).split(" ");const a={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),a.name=r[0],a.clockRate=parseInt(r[1],10),a.channels=r.length===3?parseInt(r[2],10):1,a.numChannels=a.channels,a},t.writeRtpMap=function(n){let r=n.payloadType;n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType);const a=n.channels||n.numChannels||1;return"a=rtpmap:"+r+" "+n.name+"/"+n.clockRate+(a!==1?"/"+a:"")+`\r
`},t.parseExtmap=function(n){const r=n.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},t.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},t.parseFmtp=function(n){const r={};let a;const o=n.substring(n.indexOf(" ")+1).split(";");for(let s=0;s<o.length;s++)a=o[s].trim().split("="),r[a[0].trim()]=a[1];return r},t.writeFmtp=function(n){let r="",a=n.payloadType;if(n.preferredPayloadType!==void 0&&(a=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const o=[];Object.keys(n.parameters).forEach(s=>{n.parameters[s]!==void 0?o.push(s+"="+n.parameters[s]):o.push(s)}),r+="a=fmtp:"+a+" "+o.join(";")+`\r
`}return r},t.parseRtcpFb=function(n){const r=n.substring(n.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},t.writeRtcpFb=function(n){let r="",a=n.payloadType;return n.preferredPayloadType!==void 0&&(a=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(o=>{r+="a=rtcp-fb:"+a+" "+o.type+(o.parameter&&o.parameter.length?" "+o.parameter:"")+`\r
`}),r},t.parseSsrcMedia=function(n){const r=n.indexOf(" "),a={ssrc:parseInt(n.substring(7,r),10)},o=n.indexOf(":",r);return o>-1?(a.attribute=n.substring(r+1,o),a.value=n.substring(o+1)):a.attribute=n.substring(r+1),a},t.parseSsrcGroup=function(n){const r=n.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(a=>parseInt(a,10))}},t.getMid=function(n){const r=t.matchPrefix(n,"a=mid:")[0];if(r)return r.substring(6)},t.parseFingerprint=function(n){const r=n.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},t.getDtlsParameters=function(n,r){return{role:"auto",fingerprints:t.matchPrefix(n+r,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(n,r){let a="a=setup:"+r+`\r
`;return n.fingerprints.forEach(o=>{a+="a=fingerprint:"+o.algorithm+" "+o.value+`\r
`}),a},t.parseCryptoLine=function(n){const r=n.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},t.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?t.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const r=n.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},t.getCryptoParameters=function(n,r){return t.matchPrefix(n+r,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(n,r){const a=t.matchPrefix(n+r,"a=ice-ufrag:")[0],o=t.matchPrefix(n+r,"a=ice-pwd:")[0];return a&&o?{usernameFragment:a.substring(12),password:o.substring(10)}:null},t.writeIceParameters=function(n){let r="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(r+=`a=ice-lite\r
`),r},t.parseRtpParameters=function(n){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},o=t.splitLines(n)[0].split(" ");r.profile=o[2];for(let l=3;l<o.length;l++){const c=o[l],d=t.matchPrefix(n,"a=rtpmap:"+c+" ")[0];if(d){const f=t.parseRtpMap(d),h=t.matchPrefix(n,"a=fmtp:"+c+" ");switch(f.parameters=h.length?t.parseFmtp(h[0]):{},f.rtcpFeedback=t.matchPrefix(n,"a=rtcp-fb:"+c+" ").map(t.parseRtcpFb),r.codecs.push(f),f.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(f.name.toUpperCase());break}}}t.matchPrefix(n,"a=extmap:").forEach(l=>{r.headerExtensions.push(t.parseExtmap(l))});const s=t.matchPrefix(n,"a=rtcp-fb:* ").map(t.parseRtcpFb);return r.codecs.forEach(l=>{s.forEach(c=>{l.rtcpFeedback.find(f=>f.type===c.type&&f.parameter===c.parameter)||l.rtcpFeedback.push(c)})}),r},t.writeRtpDescription=function(n,r){let a="";a+="m="+n+" ",a+=r.codecs.length>0?"9":"0",a+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",a+=r.codecs.map(s=>s.preferredPayloadType!==void 0?s.preferredPayloadType:s.payloadType).join(" ")+`\r
`,a+=`c=IN IP4 0.0.0.0\r
`,a+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(s=>{a+=t.writeRtpMap(s),a+=t.writeFmtp(s),a+=t.writeRtcpFb(s)});let o=0;return r.codecs.forEach(s=>{s.maxptime>o&&(o=s.maxptime)}),o>0&&(a+="a=maxptime:"+o+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(s=>{a+=t.writeExtmap(s)}),a},t.parseRtpEncodingParameters=function(n){const r=[],a=t.parseRtpParameters(n),o=a.fecMechanisms.indexOf("RED")!==-1,s=a.fecMechanisms.indexOf("ULPFEC")!==-1,l=t.matchPrefix(n,"a=ssrc:").map(v=>t.parseSsrcMedia(v)).filter(v=>v.attribute==="cname"),c=l.length>0&&l[0].ssrc;let d;const f=t.matchPrefix(n,"a=ssrc-group:FID").map(v=>v.substring(17).split(" ").map(_=>parseInt(_,10)));f.length>0&&f[0].length>1&&f[0][0]===c&&(d=f[0][1]),a.codecs.forEach(v=>{if(v.name.toUpperCase()==="RTX"&&v.parameters.apt){let w={ssrc:c,codecPayloadType:parseInt(v.parameters.apt,10)};c&&d&&(w.rtx={ssrc:d}),r.push(w),o&&(w=JSON.parse(JSON.stringify(w)),w.fec={ssrc:c,mechanism:s?"red+ulpfec":"red"},r.push(w))}}),r.length===0&&c&&r.push({ssrc:c});let h=t.matchPrefix(n,"b=");return h.length&&(h[0].indexOf("b=TIAS:")===0?h=parseInt(h[0].substring(7),10):h[0].indexOf("b=AS:")===0?h=parseInt(h[0].substring(5),10)*1e3*.95-50*40*8:h=void 0,r.forEach(v=>{v.maxBitrate=h})),r},t.parseRtcpParameters=function(n){const r={},a=t.matchPrefix(n,"a=ssrc:").map(l=>t.parseSsrcMedia(l)).filter(l=>l.attribute==="cname")[0];a&&(r.cname=a.value,r.ssrc=a.ssrc);const o=t.matchPrefix(n,"a=rtcp-rsize");r.reducedSize=o.length>0,r.compound=o.length===0;const s=t.matchPrefix(n,"a=rtcp-mux");return r.mux=s.length>0,r},t.writeRtcpParameters=function(n){let r="";return n.reducedSize&&(r+=`a=rtcp-rsize\r
`),n.mux&&(r+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(r+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),r},t.parseMsid=function(n){let r;const a=t.matchPrefix(n,"a=msid:");if(a.length===1)return r=a[0].substring(7).split(" "),{stream:r[0],track:r[1]};const o=t.matchPrefix(n,"a=ssrc:").map(s=>t.parseSsrcMedia(s)).filter(s=>s.attribute==="msid");if(o.length>0)return r=o[0].value.split(" "),{stream:r[0],track:r[1]}},t.parseSctpDescription=function(n){const r=t.parseMLine(n),a=t.matchPrefix(n,"a=max-message-size:");let o;a.length>0&&(o=parseInt(a[0].substring(19),10)),isNaN(o)&&(o=65536);const s=t.matchPrefix(n,"a=sctp-port:");if(s.length>0)return{port:parseInt(s[0].substring(12),10),protocol:r.fmt,maxMessageSize:o};const l=t.matchPrefix(n,"a=sctpmap:");if(l.length>0){const c=l[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:o}}},t.writeSctpDescription=function(n,r){let a=[];return n.protocol!=="DTLS/SCTP"?a=["m="+n.kind+" 9 "+n.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:a=["m="+n.kind+" 9 "+n.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&a.push("a=max-message-size:"+r.maxMessageSize+`\r
`),a.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(n,r,a){let o;const s=r!==void 0?r:2;return n?o=n:o=t.generateSessionId(),`v=0\r
o=`+(a||"thisisadapterortc")+" "+o+" "+s+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(n,r){const a=t.splitLines(n);for(let o=0;o<a.length;o++)switch(a[o]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return a[o].substring(2)}return r?t.getDirection(r):"sendrecv"},t.getKind=function(n){return t.splitLines(n)[0].split(" ")[0].substring(2)},t.isRejected=function(n){return n.split(" ",2)[1]==="0"},t.parseMLine=function(n){const a=t.splitLines(n)[0].substring(2).split(" ");return{kind:a[0],port:parseInt(a[1],10),protocol:a[2],fmt:a.slice(3).join(" ")}},t.parseOLine=function(n){const a=t.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:a[0],sessionId:a[1],sessionVersion:parseInt(a[2],10),netType:a[3],addressType:a[4],address:a[5]}},t.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const r=t.splitLines(n);for(let a=0;a<r.length;a++)if(r[a].length<2||r[a].charAt(1)!=="=")return!1;return!0},e.exports=t})(qy);var Jy=qy.exports;const Mo=Ph(Jy),Qx=l0({__proto__:null,default:Mo},[Jy]);function El(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substring(2)),r.candidate&&r.candidate.length){const a=new t(r),o=Mo.parseCandidate(r.candidate);for(const s in o)s in a||Object.defineProperty(a,s,{value:o[s]});return a.toJSON=function(){return{candidate:a.candidate,sdpMid:a.sdpMid,sdpMLineIndex:a.sdpMLineIndex,usernameFragment:a.usernameFragment}},a}return new t(r)},e.RTCIceCandidate.prototype=t.prototype,eo(e,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new e.RTCIceCandidate(n.candidate),writable:"false"}),n))}function Ru(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||eo(e,"icecandidate",t=>{if(t.candidate){const n=Mo.parseCandidate(t.candidate.candidate);n.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return t})}function Il(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(l){if(!l||!l.sdp)return!1;const c=Mo.splitSections(l.sdp);return c.shift(),c.some(d=>{const f=Mo.parseMLine(d);return f&&f.kind==="application"&&f.protocol.indexOf("SCTP")!==-1})},r=function(l){const c=l.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const d=parseInt(c[1],10);return d!==d?-1:d},a=function(l){let c=65536;return t.browser==="firefox"&&(t.version<57?l===-1?c=16384:c=2147483637:t.version<60?c=t.version===57?65535:65536:c=2147483637),c},o=function(l,c){let d=65536;t.browser==="firefox"&&t.version===57&&(d=65535);const f=Mo.matchPrefix(l.sdp,"a=max-message-size:");return f.length>0?d=parseInt(f[0].substring(19),10):t.browser==="firefox"&&c!==-1&&(d=2147483637),d},s=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const c=r(arguments[0]),d=a(c),f=o(arguments[0],c);let h;d===0&&f===0?h=Number.POSITIVE_INFINITY:d===0||f===0?h=Math.max(d,f):h=Math.min(d,f);const v={};Object.defineProperty(v,"maxMessageSize",{get(){return h}}),this._sctp=v}return s.apply(this,arguments)}}function Sl(e){if(!(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype))return;function t(r,a){const o=r.send;r.send=function(){const l=arguments[0],c=l.length||l.size||l.byteLength;if(r.readyState==="open"&&a.sctp&&c>a.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+a.sctp.maxMessageSize+" bytes)");return o.apply(r,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const a=n.apply(this,arguments);return t(a,this),a},eo(e,"datachannel",r=>(t(r.channel,r.target),r))}function ju(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const r=t[n];t[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=a=>{const o=a.target;if(o._lastConnectionState!==o.connectionState){o._lastConnectionState=o.connectionState;const s=new Event("connectionstatechange",a);o.dispatchEvent(s)}return a},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function Pu(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t._safariVersion>=13.1)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(a){if(a&&a.sdp&&a.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const o=a.sdp.split(`
`).filter(s=>s.trim()!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&a instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:a.type,sdp:o}):a.sdp=o}return n.apply(this,arguments)}}function _l(e,t){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;const n=e.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Dl(e,t){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;const n=e.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(e.RTCPeerConnection.prototype.setLocalDescription=function(){let a=arguments[0]||{};if(typeof a!="object"||a.type&&a.sdp)return n.apply(this,arguments);if(a={type:a.type,sdp:a.sdp},!a.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":a.type="offer";break;default:a.type="answer";break}return a.sdp||a.type!=="offer"&&a.type!=="answer"?n.apply(this,[a]):(a.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(s=>n.apply(this,[s]))})}const eC=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:Pu,shimAddIceCandidateNullOrEmpty:_l,shimConnectionState:ju,shimMaxMessageSize:Il,shimParameterlessSetLocalDescription:Dl,shimRTCIceCandidate:El,shimRTCIceCandidateRelayProtocol:Ru,shimSendThrowTypeError:Sl},Symbol.toStringTag,{value:"Module"}));function tC({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const n=xy,r=Xx(e),a={browserDetails:r,commonShim:eC,extractVersion:Is,disableLog:qx,disableWarnings:Jx,sdp:Qx};switch(r.browser){case"chrome":if(!wh||!_u||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),a;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),a;n("adapter.js shimming chrome."),a.browserShim=wh,_l(e,r),Dl(e),wy(e,r),ky(e),_u(e,r),Ty(e),_y(e,r),Ey(e),Iy(e),Dy(e,r),El(e),Ru(e),ju(e),Il(e,r),Sl(e),Pu(e,r);break;case"firefox":if(!kh||!Du||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),a;n("adapter.js shimming firefox."),a.browserShim=kh,_l(e,r),Dl(e),Ry(e,r),Du(e,r),jy(e),Ay(e),Py(e),Ny(e),Oy(e),Ly(e),My(e),zy(e),$y(e),El(e),ju(e),Il(e,r),Sl(e);break;case"safari":if(!Th||!t.shimSafari)return n("Safari shim is not included in this adapter release."),a;n("adapter.js shimming safari."),a.browserShim=Th,_l(e,r),Dl(e),Wy(e),Ky(e),Fy(e),Gy(e),Uy(e),Vy(e),By(e),Yy(e),El(e),Ru(e),Il(e,r),Sl(e),Pu(e,r);break;default:n("Unsupported browser!");break}return a}const Eh=tC({window:typeof window>"u"?void 0:window});function to(e,t,n,r){Object.defineProperty(e,t,{get:n,set:r,enumerable:!0,configurable:!0})}class Xy{constructor(){this.chunkedMTU=16300,this._dataCount=1,this.chunk=t=>{const n=[],r=t.byteLength,a=Math.ceil(r/this.chunkedMTU);let o=0,s=0;for(;s<r;){const l=Math.min(r,s+this.chunkedMTU),c=t.slice(s,l),d={__peerData:this._dataCount,n:o,data:c,total:a};n.push(d),s=l,o++}return this._dataCount++,n}}}function nC(e){let t=0;for(const a of e)t+=a.byteLength;const n=new Uint8Array(t);let r=0;for(const a of e)n.set(a,r),r+=a.byteLength;return n}const kd=Eh.default||Eh,gs=new class{isWebRTCSupported(){return typeof RTCPeerConnection<"u"}isBrowserSupported(){const e=this.getBrowser(),t=this.getVersion();return this.supportedBrowsers.includes(e)?e==="chrome"?t>=this.minChromeVersion:e==="firefox"?t>=this.minFirefoxVersion:e==="safari"?!this.isIOS&&t>=this.minSafariVersion:!1:!1}getBrowser(){return kd.browserDetails.browser}getVersion(){return kd.browserDetails.version||0}isUnifiedPlanSupported(){const e=this.getBrowser(),t=kd.browserDetails.version||0;if(e==="chrome"&&t<this.minChromeVersion)return!1;if(e==="firefox"&&t>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let n,r=!1;try{n=new RTCPeerConnection,n.addTransceiver("audio"),r=!0}catch{}finally{n&&n.close()}return r}toString(){return`Supports:
    browser:${this.getBrowser()}
    version:${this.getVersion()}
    isIOS:${this.isIOS}
    isWebRTCSupported:${this.isWebRTCSupported()}
    isBrowserSupported:${this.isBrowserSupported()}
    isUnifiedPlanSupported:${this.isUnifiedPlanSupported()}`}constructor(){this.isIOS=typeof navigator<"u"?["iPad","iPhone","iPod"].includes(navigator.platform):!1,this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}},rC=e=>!e||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(e),Zy=()=>Math.random().toString(36).slice(2),Ih={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"};class aC extends Xy{noop(){}blobToArrayBuffer(t,n){const r=new FileReader;return r.onload=function(a){a.target&&n(a.target.result)},r.readAsArrayBuffer(t),r}binaryStringToArrayBuffer(t){const n=new Uint8Array(t.length);for(let r=0;r<t.length;r++)n[r]=t.charCodeAt(r)&255;return n.buffer}isSecure(){return location.protocol==="https:"}constructor(...t){super(...t),this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.defaultConfig=Ih,this.browser=gs.getBrowser(),this.browserVersion=gs.getVersion(),this.pack=yy,this.unpack=gy,this.supports=function(){const n={browser:gs.isBrowserSupported(),webRTC:gs.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!n.webRTC)return n;let r;try{r=new RTCPeerConnection(Ih),n.audioVideo=!0;let a;try{a=r.createDataChannel("_PEERJSTEST",{ordered:!0}),n.data=!0,n.reliable=!!a.ordered;try{a.binaryType="blob",n.binaryBlob=!gs.isIOS}catch{}}catch{}finally{a&&a.close()}}catch{}finally{r&&r.close()}return n}(),this.validateId=rC,this.randomToken=Zy}}const Gn=new aC,oC="PeerJS: ";class sC{get logLevel(){return this._logLevel}set logLevel(t){this._logLevel=t}log(...t){this._logLevel>=3&&this._print(3,...t)}warn(...t){this._logLevel>=2&&this._print(2,...t)}error(...t){this._logLevel>=1&&this._print(1,...t)}setLogFunction(t){this._print=t}_print(t,...n){const r=[oC,...n];for(const a in r)r[a]instanceof Error&&(r[a]="("+r[a].name+") "+r[a].message);t>=3?console.log(...r):t>=2?console.warn("WARNING",...r):t>=1&&console.error("ERROR",...r)}constructor(){this._logLevel=0}}var He=new sC,Ff={},iC=Object.prototype.hasOwnProperty,An="~";function mi(){}Object.create&&(mi.prototype=Object.create(null),new mi().__proto__||(An=!1));function lC(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function Qy(e,t,n,r,a){if(typeof n!="function")throw new TypeError("The listener must be a function");var o=new lC(n,r||e,a),s=An?An+t:t;return e._events[s]?e._events[s].fn?e._events[s]=[e._events[s],o]:e._events[s].push(o):(e._events[s]=o,e._eventsCount++),e}function Rl(e,t){--e._eventsCount===0?e._events=new mi:delete e._events[t]}function En(){this._events=new mi,this._eventsCount=0}En.prototype.eventNames=function(){var t=[],n,r;if(this._eventsCount===0)return t;for(r in n=this._events)iC.call(n,r)&&t.push(An?r.slice(1):r);return Object.getOwnPropertySymbols?t.concat(Object.getOwnPropertySymbols(n)):t};En.prototype.listeners=function(t){var n=An?An+t:t,r=this._events[n];if(!r)return[];if(r.fn)return[r.fn];for(var a=0,o=r.length,s=new Array(o);a<o;a++)s[a]=r[a].fn;return s};En.prototype.listenerCount=function(t){var n=An?An+t:t,r=this._events[n];return r?r.fn?1:r.length:0};En.prototype.emit=function(t,n,r,a,o,s){var l=An?An+t:t;if(!this._events[l])return!1;var c=this._events[l],d=arguments.length,f,h;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,n),!0;case 3:return c.fn.call(c.context,n,r),!0;case 4:return c.fn.call(c.context,n,r,a),!0;case 5:return c.fn.call(c.context,n,r,a,o),!0;case 6:return c.fn.call(c.context,n,r,a,o,s),!0}for(h=1,f=new Array(d-1);h<d;h++)f[h-1]=arguments[h];c.fn.apply(c.context,f)}else{var v=c.length,w;for(h=0;h<v;h++)switch(c[h].once&&this.removeListener(t,c[h].fn,void 0,!0),d){case 1:c[h].fn.call(c[h].context);break;case 2:c[h].fn.call(c[h].context,n);break;case 3:c[h].fn.call(c[h].context,n,r);break;case 4:c[h].fn.call(c[h].context,n,r,a);break;default:if(!f)for(w=1,f=new Array(d-1);w<d;w++)f[w-1]=arguments[w];c[h].fn.apply(c[h].context,f)}}return!0};En.prototype.on=function(t,n,r){return Qy(this,t,n,r,!1)};En.prototype.once=function(t,n,r){return Qy(this,t,n,r,!0)};En.prototype.removeListener=function(t,n,r,a){var o=An?An+t:t;if(!this._events[o])return this;if(!n)return Rl(this,o),this;var s=this._events[o];if(s.fn)s.fn===n&&(!a||s.once)&&(!r||s.context===r)&&Rl(this,o);else{for(var l=0,c=[],d=s.length;l<d;l++)(s[l].fn!==n||a&&!s[l].once||r&&s[l].context!==r)&&c.push(s[l]);c.length?this._events[o]=c.length===1?c[0]:c:Rl(this,o)}return this};En.prototype.removeAllListeners=function(t){var n;return t?(n=An?An+t:t,this._events[n]&&Rl(this,n)):(this._events=new mi,this._eventsCount=0),this};En.prototype.off=En.prototype.removeListener;En.prototype.addListener=En.prototype.on;En.prefixed=An;En.EventEmitter=En;Ff=En;var no={};to(no,"ConnectionType",()=>ba);to(no,"PeerErrorType",()=>tn);to(no,"BaseConnectionErrorType",()=>Nu);to(no,"DataConnectionErrorType",()=>Bf);to(no,"SerializationType",()=>Sc);to(no,"SocketEventType",()=>la);to(no,"ServerMessageType",()=>wn);var ba=function(e){return e.Data="data",e.Media="media",e}({}),tn=function(e){return e.BrowserIncompatible="browser-incompatible",e.Disconnected="disconnected",e.InvalidID="invalid-id",e.InvalidKey="invalid-key",e.Network="network",e.PeerUnavailable="peer-unavailable",e.SslUnavailable="ssl-unavailable",e.ServerError="server-error",e.SocketError="socket-error",e.SocketClosed="socket-closed",e.UnavailableID="unavailable-id",e.WebRTC="webrtc",e}({}),Nu=function(e){return e.NegotiationFailed="negotiation-failed",e.ConnectionClosed="connection-closed",e}({}),Bf=function(e){return e.NotOpenYet="not-open-yet",e.MessageToBig="message-too-big",e}({}),Sc=function(e){return e.Binary="binary",e.BinaryUTF8="binary-utf8",e.JSON="json",e.None="raw",e}({}),la=function(e){return e.Message="message",e.Disconnected="disconnected",e.Error="error",e.Close="close",e}({}),wn=function(e){return e.Heartbeat="HEARTBEAT",e.Candidate="CANDIDATE",e.Offer="OFFER",e.Answer="ANSWER",e.Open="OPEN",e.Error="ERROR",e.IdTaken="ID-TAKEN",e.InvalidKey="INVALID-KEY",e.Leave="LEAVE",e.Expire="EXPIRE",e}({});const e0="1.5.5";class cC extends Ff.EventEmitter{constructor(t,n,r,a,o,s=5e3){super(),this.pingInterval=s,this._disconnected=!0,this._messagesQueue=[];const l=t?"wss://":"ws://";this._baseUrl=l+n+":"+r+a+"peerjs?key="+o}start(t,n){this._id=t;const r=`${this._baseUrl}&id=${t}&token=${n}`;this._socket||!this._disconnected||(this._socket=new WebSocket(r+"&version="+e0),this._disconnected=!1,this._socket.onmessage=a=>{let o;try{o=JSON.parse(a.data),He.log("Server message received:",o)}catch{He.log("Invalid server message",a.data);return}this.emit(la.Message,o)},this._socket.onclose=a=>{this._disconnected||(He.log("Socket closed.",a),this._cleanup(),this._disconnected=!0,this.emit(la.Disconnected))},this._socket.onopen=()=>{this._disconnected||(this._sendQueuedMessages(),He.log("Socket open"),this._scheduleHeartbeat())})}_scheduleHeartbeat(){this._wsPingTimer=setTimeout(()=>{this._sendHeartbeat()},this.pingInterval)}_sendHeartbeat(){if(!this._wsOpen()){He.log("Cannot send heartbeat, because socket closed");return}const t=JSON.stringify({type:wn.Heartbeat});this._socket.send(t),this._scheduleHeartbeat()}_wsOpen(){return!!this._socket&&this._socket.readyState===1}_sendQueuedMessages(){const t=[...this._messagesQueue];this._messagesQueue=[];for(const n of t)this.send(n)}send(t){if(this._disconnected)return;if(!this._id){this._messagesQueue.push(t);return}if(!t.type){this.emit(la.Error,"Invalid message");return}if(!this._wsOpen())return;const n=JSON.stringify(t);this._socket.send(n)}close(){this._disconnected||(this._cleanup(),this._disconnected=!0)}_cleanup(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)}}class t0{constructor(t){this.connection=t}startConnection(t){const n=this._startPeerConnection();if(this.connection.peerConnection=n,this.connection.type===ba.Media&&t._stream&&this._addTracksToConnection(t._stream,n),t.originator){const r=this.connection,a={ordered:!!t.reliable},o=n.createDataChannel(r.label,a);r._initializeDataChannel(o),this._makeOffer()}else this.handleSDP("OFFER",t.sdp)}_startPeerConnection(){He.log("Creating RTCPeerConnection.");const t=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(t),t}_setupListeners(t){const n=this.connection.peer,r=this.connection.connectionId,a=this.connection.type,o=this.connection.provider;He.log("Listening for ICE candidates."),t.onicecandidate=s=>{!s.candidate||!s.candidate.candidate||(He.log(`Received ICE candidates for ${n}:`,s.candidate),o.socket.send({type:wn.Candidate,payload:{candidate:s.candidate,type:a,connectionId:r},dst:n}))},t.oniceconnectionstatechange=()=>{switch(t.iceConnectionState){case"failed":He.log("iceConnectionState is failed, closing connections to "+n),this.connection.emitError(Nu.NegotiationFailed,"Negotiation of connection to "+n+" failed."),this.connection.close();break;case"closed":He.log("iceConnectionState is closed, closing connections to "+n),this.connection.emitError(Nu.ConnectionClosed,"Connection to "+n+" closed."),this.connection.close();break;case"disconnected":He.log("iceConnectionState changed to disconnected on the connection with "+n);break;case"completed":t.onicecandidate=()=>{};break}this.connection.emit("iceStateChanged",t.iceConnectionState)},He.log("Listening for data channel"),t.ondatachannel=s=>{He.log("Received data channel");const l=s.channel;o.getConnection(n,r)._initializeDataChannel(l)},He.log("Listening for remote stream"),t.ontrack=s=>{He.log("Received remote stream");const l=s.streams[0],c=o.getConnection(n,r);if(c.type===ba.Media){const d=c;this._addStreamToMediaConnection(l,d)}}}cleanup(){He.log("Cleaning up PeerConnection to "+this.connection.peer);const t=this.connection.peerConnection;if(!t)return;this.connection.peerConnection=null,t.onicecandidate=t.oniceconnectionstatechange=t.ondatachannel=t.ontrack=()=>{};const n=t.signalingState!=="closed";let r=!1;const a=this.connection.dataChannel;a&&(r=!!a.readyState&&a.readyState!=="closed"),(n||r)&&t.close()}async _makeOffer(){const t=this.connection.peerConnection,n=this.connection.provider;try{const r=await t.createOffer(this.connection.options.constraints);He.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await t.setLocalDescription(r),He.log("Set localDescription:",r,`for:${this.connection.peer}`);let a={sdp:r,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata};if(this.connection.type===ba.Data){const o=this.connection;a={...a,label:o.label,reliable:o.reliable,serialization:o.serialization}}n.socket.send({type:wn.Offer,payload:a,dst:this.connection.peer})}catch(a){a!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(n.emitError(tn.WebRTC,a),He.log("Failed to setLocalDescription, ",a))}}catch(r){n.emitError(tn.WebRTC,r),He.log("Failed to createOffer, ",r)}}async _makeAnswer(){const t=this.connection.peerConnection,n=this.connection.provider;try{const r=await t.createAnswer();He.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await t.setLocalDescription(r),He.log("Set localDescription:",r,`for:${this.connection.peer}`),n.socket.send({type:wn.Answer,payload:{sdp:r,type:this.connection.type,connectionId:this.connection.connectionId},dst:this.connection.peer})}catch(a){n.emitError(tn.WebRTC,a),He.log("Failed to setLocalDescription, ",a)}}catch(r){n.emitError(tn.WebRTC,r),He.log("Failed to create answer, ",r)}}async handleSDP(t,n){n=new RTCSessionDescription(n);const r=this.connection.peerConnection,a=this.connection.provider;He.log("Setting remote description",n);const o=this;try{await r.setRemoteDescription(n),He.log(`Set remoteDescription:${t} for:${this.connection.peer}`),t==="OFFER"&&await o._makeAnswer()}catch(s){a.emitError(tn.WebRTC,s),He.log("Failed to setRemoteDescription, ",s)}}async handleCandidate(t){He.log("handleCandidate:",t);try{await this.connection.peerConnection.addIceCandidate(t),He.log(`Added ICE candidate for:${this.connection.peer}`)}catch(n){this.connection.provider.emitError(tn.WebRTC,n),He.log("Failed to handleCandidate, ",n)}}_addTracksToConnection(t,n){if(He.log(`add tracks from stream ${t.id} to peer connection`),!n.addTrack)return He.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");t.getTracks().forEach(r=>{n.addTrack(r,t)})}_addStreamToMediaConnection(t,n){He.log(`add stream ${t.id} to media connection ${n.connectionId}`),n.addStream(t)}}class n0 extends Ff.EventEmitter{emitError(t,n){He.error("Error:",n),this.emit("error",new dC(`${t}`,n))}}class dC extends Error{constructor(t,n){typeof n=="string"?super(n):(super(),Object.assign(this,n)),this.type=t}}class r0 extends n0{get open(){return this._open}constructor(t,n,r){super(),this.peer=t,this.provider=n,this.options=r,this._open=!1,this.metadata=r.metadata}}var Au;const Ws=class Ws extends r0{get type(){return ba.Media}get localStream(){return this._localStream}get remoteStream(){return this._remoteStream}constructor(t,n,r){super(t,n,r),this._localStream=this.options._stream,this.connectionId=this.options.connectionId||Ws.ID_PREFIX+Gn.randomToken(),this._negotiator=new t0(this),this._localStream&&this._negotiator.startConnection({_stream:this._localStream,originator:!0})}_initializeDataChannel(t){this.dataChannel=t,this.dataChannel.onopen=()=>{He.log(`DC#${this.connectionId} dc connection success`),this.emit("willCloseOnRemote")},this.dataChannel.onclose=()=>{He.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}addStream(t){He.log("Receiving stream",t),this._remoteStream=t,super.emit("stream",t)}handleMessage(t){const n=t.type,r=t.payload;switch(t.type){case wn.Answer:this._negotiator.handleSDP(n,r.sdp),this._open=!0;break;case wn.Candidate:this._negotiator.handleCandidate(r.candidate);break;default:He.warn(`Unrecognized message type:${n} from peer:${this.peer}`);break}}answer(t,n={}){if(this._localStream){He.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=t,n&&n.sdpTransform&&(this.options.sdpTransform=n.sdpTransform),this._negotiator.startConnection({...this.options._payload,_stream:t});const r=this.provider._getMessages(this.connectionId);for(const a of r)this.handleMessage(a);this._open=!0}close(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,super.emit("close"))}};Au=new WeakMap,ss(Ws,Au,Ws.ID_PREFIX="mc_");let oc=Ws;class uC{constructor(t){this._options=t}_buildRequest(t){const n=this._options.secure?"https":"http",{host:r,port:a,path:o,key:s}=this._options,l=new URL(`${n}://${r}:${a}${o}${s}/${t}`);return l.searchParams.set("ts",`${Date.now()}${Math.random()}`),l.searchParams.set("version",e0),fetch(l.href,{referrerPolicy:this._options.referrerPolicy})}async retrieveId(){try{const t=await this._buildRequest("id");if(t.status!==200)throw new Error(`Error. Status:${t.status}`);return t.text()}catch(t){He.error("Error retrieving ID",t);let n="";throw this._options.path==="/"&&this._options.host!==Gn.CLOUD_HOST&&(n=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+n)}}async listAllPeers(){try{const t=await this._buildRequest("peers");if(t.status!==200){if(t.status===401){let n="";throw this._options.host===Gn.CLOUD_HOST?n="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":n="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+n)}throw new Error(`Error. Status:${t.status}`)}return t.json()}catch(t){throw He.error("Error retrieving list peers",t),new Error("Could not get list peers from the server."+t)}}}var Ou,Lu;const $a=class $a extends r0{get type(){return ba.Data}constructor(t,n,r){super(t,n,r),this.connectionId=this.options.connectionId||$a.ID_PREFIX+Zy(),this.label=this.options.label||this.connectionId,this.reliable=!!this.options.reliable,this._negotiator=new t0(this),this._negotiator.startConnection(this.options._payload||{originator:!0,reliable:this.reliable})}_initializeDataChannel(t){this.dataChannel=t,this.dataChannel.onopen=()=>{He.log(`DC#${this.connectionId} dc connection success`),this._open=!0,this.emit("open")},this.dataChannel.onmessage=n=>{He.log(`DC#${this.connectionId} dc onmessage:`,n.data)},this.dataChannel.onclose=()=>{He.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}close(t){if(t!=null&&t.flush){this.send({__peerData:{type:"close"}});return}this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this.dataChannel=null),this.open&&(this._open=!1,super.emit("close"))}send(t,n=!1){if(!this.open){this.emitError(Bf.NotOpenYet,"Connection is not open. You should listen for the `open` event before sending messages.");return}return this._send(t,n)}async handleMessage(t){const n=t.payload;switch(t.type){case wn.Answer:await this._negotiator.handleSDP(t.type,n.sdp);break;case wn.Candidate:await this._negotiator.handleCandidate(n.candidate);break;default:He.warn("Unrecognized message type:",t.type,"from peer:",this.peer);break}}};Ou=new WeakMap,Lu=new WeakMap,ss($a,Ou,$a.ID_PREFIX="dc_"),ss($a,Lu,$a.MAX_BUFFERED_AMOUNT=8388608);let sc=$a;class Hf extends sc{get bufferSize(){return this._bufferSize}_initializeDataChannel(t){super._initializeDataChannel(t),this.dataChannel.binaryType="arraybuffer",this.dataChannel.addEventListener("message",n=>this._handleDataMessage(n))}_bufferedSend(t){(this._buffering||!this._trySend(t))&&(this._buffer.push(t),this._bufferSize=this._buffer.length)}_trySend(t){if(!this.open)return!1;if(this.dataChannel.bufferedAmount>sc.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(()=>{this._buffering=!1,this._tryBuffer()},50),!1;try{this.dataChannel.send(t)}catch(n){return He.error(`DC#:${this.connectionId} Error when sending:`,n),this._buffering=!0,this.close(),!1}return!0}_tryBuffer(){if(!this.open||this._buffer.length===0)return;const t=this._buffer[0];this._trySend(t)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}close(t){if(t!=null&&t.flush){this.send({__peerData:{type:"close"}});return}this._buffer=[],this._bufferSize=0,super.close()}constructor(...t){super(...t),this._buffer=[],this._bufferSize=0,this._buffering=!1}}class Td extends Hf{close(t){super.close(t),this._chunkedData={}}constructor(t,n,r){super(t,n,r),this.chunker=new Xy,this.serialization=Sc.Binary,this._chunkedData={}}_handleDataMessage({data:t}){const n=gy(t),r=n.__peerData;if(r){if(r.type==="close"){this.close();return}this._handleChunk(n);return}this.emit("data",n)}_handleChunk(t){const n=t.__peerData,r=this._chunkedData[n]||{data:[],count:0,total:t.total};if(r.data[t.n]=new Uint8Array(t.data),r.count++,this._chunkedData[n]=r,r.total===r.count){delete this._chunkedData[n];const a=nC(r.data);this._handleDataMessage({data:a})}}_send(t,n){const r=yy(t);if(r instanceof Promise)return this._send_blob(r);if(!n&&r.byteLength>this.chunker.chunkedMTU){this._sendChunks(r);return}this._bufferedSend(r)}async _send_blob(t){const n=await t;if(n.byteLength>this.chunker.chunkedMTU){this._sendChunks(n);return}this._bufferedSend(n)}_sendChunks(t){const n=this.chunker.chunk(t);He.log(`DC#${this.connectionId} Try to send ${n.length} chunks...`);for(const r of n)this.send(r,!0)}}class fC extends Hf{_handleDataMessage({data:t}){super.emit("data",t)}_send(t,n){this._bufferedSend(t)}constructor(...t){super(...t),this.serialization=Sc.None}}class pC extends Hf{_handleDataMessage({data:t}){const n=this.parse(this.decoder.decode(t)),r=n.__peerData;if(r&&r.type==="close"){this.close();return}this.emit("data",n)}_send(t,n){const r=this.encoder.encode(this.stringify(t));if(r.byteLength>=Gn.chunkedMTU){this.emitError(Bf.MessageToBig,"Message too big for JSON channel");return}this._bufferedSend(r)}constructor(...t){super(...t),this.serialization=Sc.JSON,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.stringify=JSON.stringify,this.parse=JSON.parse}}var Mu;const Vs=class Vs extends n0{get id(){return this._id}get options(){return this._options}get open(){return this._open}get socket(){return this._socket}get connections(){const t=Object.create(null);for(const[n,r]of this._connections)t[n]=r;return t}get destroyed(){return this._destroyed}get disconnected(){return this._disconnected}constructor(t,n){super(),this._serializers={raw:fC,json:pC,binary:Td,"binary-utf8":Td,default:Td},this._id=null,this._lastServerId=null,this._destroyed=!1,this._disconnected=!1,this._open=!1,this._connections=new Map,this._lostMessages=new Map;let r;if(t&&t.constructor==Object?n=t:t&&(r=t.toString()),n={debug:0,host:Gn.CLOUD_HOST,port:Gn.CLOUD_PORT,path:"/",key:Vs.DEFAULT_KEY,token:Gn.randomToken(),config:Gn.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin",serializers:{},...n},this._options=n,this._serializers={...this._serializers,...this.options.serializers},this._options.host==="/"&&(this._options.host=window.location.hostname),this._options.path&&(this._options.path[0]!=="/"&&(this._options.path="/"+this._options.path),this._options.path[this._options.path.length-1]!=="/"&&(this._options.path+="/")),this._options.secure===void 0&&this._options.host!==Gn.CLOUD_HOST?this._options.secure=Gn.isSecure():this._options.host==Gn.CLOUD_HOST&&(this._options.secure=!0),this._options.logFunction&&He.setLogFunction(this._options.logFunction),He.logLevel=this._options.debug||0,this._api=new uC(n),this._socket=this._createServerConnection(),!Gn.supports.audioVideo&&!Gn.supports.data){this._delayedAbort(tn.BrowserIncompatible,"The current browser does not support WebRTC");return}if(r&&!Gn.validateId(r)){this._delayedAbort(tn.InvalidID,`ID "${r}" is invalid`);return}r?this._initialize(r):this._api.retrieveId().then(a=>this._initialize(a)).catch(a=>this._abort(tn.ServerError,a))}_createServerConnection(){const t=new cC(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return t.on(la.Message,n=>{this._handleMessage(n)}),t.on(la.Error,n=>{this._abort(tn.SocketError,n)}),t.on(la.Disconnected,()=>{this.disconnected||(this.emitError(tn.Network,"Lost connection to server."),this.disconnect())}),t.on(la.Close,()=>{this.disconnected||this._abort(tn.SocketClosed,"Underlying socket is already closed.")}),t}_initialize(t){this._id=t,this.socket.start(t,this._options.token)}_handleMessage(t){const n=t.type,r=t.payload,a=t.src;switch(n){case wn.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case wn.Error:this._abort(tn.ServerError,r.msg);break;case wn.IdTaken:this._abort(tn.UnavailableID,`ID "${this.id}" is taken`);break;case wn.InvalidKey:this._abort(tn.InvalidKey,`API KEY "${this._options.key}" is invalid`);break;case wn.Leave:He.log(`Received leave message from ${a}`),this._cleanupPeer(a),this._connections.delete(a);break;case wn.Expire:this.emitError(tn.PeerUnavailable,`Could not connect to peer ${a}`);break;case wn.Offer:{const o=r.connectionId;let s=this.getConnection(a,o);if(s&&(s.close(),He.warn(`Offer received for existing Connection ID:${o}`)),r.type===ba.Media){const c=new oc(a,this,{connectionId:o,_payload:r,metadata:r.metadata});s=c,this._addConnection(a,s),this.emit("call",c)}else if(r.type===ba.Data){const c=new this._serializers[r.serialization](a,this,{connectionId:o,_payload:r,metadata:r.metadata,label:r.label,serialization:r.serialization,reliable:r.reliable});s=c,this._addConnection(a,s),this.emit("connection",c)}else{He.warn(`Received malformed connection type:${r.type}`);return}const l=this._getMessages(o);for(const c of l)s.handleMessage(c);break}default:{if(!r){He.warn(`You received a malformed message from ${a} of type ${n}`);return}const o=r.connectionId,s=this.getConnection(a,o);s&&s.peerConnection?s.handleMessage(t):o?this._storeMessage(o,t):He.warn("You received an unrecognized message:",t);break}}}_storeMessage(t,n){this._lostMessages.has(t)||this._lostMessages.set(t,[]),this._lostMessages.get(t).push(n)}_getMessages(t){const n=this._lostMessages.get(t);return n?(this._lostMessages.delete(t),n):[]}connect(t,n={}){if(n={serialization:"default",...n},this.disconnected){He.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(tn.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}const r=new this._serializers[n.serialization](t,this,n);return this._addConnection(t,r),r}call(t,n,r={}){if(this.disconnected){He.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(tn.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!n){He.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}const a=new oc(t,this,{...r,_stream:n});return this._addConnection(t,a),a}_addConnection(t,n){He.log(`add connection ${n.type}:${n.connectionId} to peerId:${t}`),this._connections.has(t)||this._connections.set(t,[]),this._connections.get(t).push(n)}_removeConnection(t){const n=this._connections.get(t.peer);if(n){const r=n.indexOf(t);r!==-1&&n.splice(r,1)}this._lostMessages.delete(t.connectionId)}getConnection(t,n){const r=this._connections.get(t);if(!r)return null;for(const a of r)if(a.connectionId===n)return a;return null}_delayedAbort(t,n){setTimeout(()=>{this._abort(t,n)},0)}_abort(t,n){He.error("Aborting!"),this.emitError(t,n),this._lastServerId?this.disconnect():this.destroy()}destroy(){this.destroyed||(He.log(`Destroy peer with ID:${this.id}`),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))}_cleanup(){for(const t of this._connections.keys())this._cleanupPeer(t),this._connections.delete(t);this.socket.removeAllListeners()}_cleanupPeer(t){const n=this._connections.get(t);if(n)for(const r of n)r.close()}disconnect(){if(this.disconnected)return;const t=this.id;He.log(`Disconnect peer with ID:${t}`),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=t,this._id=null,this.emit("disconnected",t)}reconnect(){if(this.disconnected&&!this.destroyed)He.log(`Attempting reconnection to server with ID ${this._lastServerId}`),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)He.error("In a hurry? We're still trying to make the initial connection!");else throw new Error(`Peer ${this.id} cannot reconnect because it is not disconnected from the server!`)}}listAllPeers(t=n=>{}){this._api.listAllPeers().then(n=>t(n)).catch(n=>this._abort(tn.ServerError,n))}};Mu=new WeakMap,ss(Vs,Mu,Vs.DEFAULT_KEY="peerjs");let Us=Vs;class hC{constructor(){this.peer=null,this.connections=new Map,this.isHost=!1,this.hostConnection=null,this.eventHandlers=new Set,this.isReconnecting=!1,localStorage.getItem("webrtc_enabled")}async initializeAsHost(t){return this.peer&&this.cleanup(),this.isHost=!0,new Promise((n,r)=>{const a=t?{id:t}:void 0;this.peer=new Us(a),this.peer.on("open",o=>{this.emitEvent({type:"peer_open",data:{peerId:o}}),n(o)}),this.peer.on("connection",o=>{P.info(`Guest connection request from: ${o.peer}`),this.handleGuestConnection(o)}),this.peer.on("error",o=>{P.error("WebRTC Peer error:",o),this.emitEvent({type:"error",data:o}),r(o)}),this.peer.on("close",()=>{P.warn("WebRTC Peer closed"),this.emitEvent({type:"peer_closed"})})})}async initializeAsGuest(t){return this.peer&&this.cleanup(),this.isHost=!1,new Promise((n,r)=>{this.peer=new Us,this.peer.on("open",a=>{const o=this.peer.connect(t,{reliable:!0,serialization:"json"});this.setupHostConnection(o),o.on("open",()=>{this.hostConnection=o,this.emitEvent({type:"connected_to_host",data:{hostPeerId:t}}),this.sendMessageToHost({type:"JOIN_REQUEST",senderId:a,timestamp:Date.now()}),n()}),o.on("error",s=>{P.error("Host connection error:",s),this.emitEvent({type:"error",data:s}),r(s)})}),this.peer.on("error",a=>{P.error("WebRTC Peer error:",a),this.emitEvent({type:"error",data:a}),r(a)})})}async initializeAsReconnectingGuest(t,n){return this.peer&&this.cleanup(),this.isHost=!1,this.isReconnecting=!0,new Promise((r,a)=>{this.peer=new Us,this.peer.on("open",o=>{const s=this.peer.connect(t,{reliable:!0,serialization:"json"});this.setupHostConnection(s),s.on("open",()=>{this.hostConnection=s,this.emitEvent({type:"connected_to_host",data:{hostPeerId:t}}),this.sendMessageToHost({type:"PLAYER_RECONNECT",senderId:o,playerId:n,timestamp:Date.now()}),this.isReconnecting=!1,r()}),s.on("error",l=>{P.error("Host connection error:",l),this.emitEvent({type:"error",data:l}),this.isReconnecting=!1,a(l)})}),this.peer.on("error",o=>{P.error("WebRTC Peer error:",o),this.emitEvent({type:"error",data:o}),this.isReconnecting=!1,a(o)})})}handleGuestConnection(t){this.connections.set(t.peer,t),t.on("open",()=>{P.info(`Guest connected: ${t.peer}`),this.emitEvent({type:"guest_connected",data:{peerId:t.peer}})}),t.on("data",n=>{this.handleMessage(n,t)}),t.on("close",()=>{P.info(`Guest disconnected: ${t.peer}`),this.connections.delete(t.peer),this.emitEvent({type:"guest_disconnected",data:{peerId:t.peer}})}),t.on("error",n=>{P.error(`Guest connection error (${t.peer}):`,n)})}setupHostConnection(t){this.hostConnection=t,t.on("data",n=>{this.handleMessage(n,t)}),t.on("close",()=>{P.warn("Host disconnected"),this.hostConnection=null,this.emitEvent({type:"host_disconnected"})}),t.on("error",n=>{P.error("Host connection error:",n)})}handleMessage(t,n){P.debug("Received WebRTC message:",t.type),this.emitEvent({type:"message_received",data:t})}sendMessageToHost(t){if(!this.isHost&&this.hostConnection&&this.hostConnection.open)try{return this.hostConnection.send(t),!0}catch(n){return P.error("Failed to send message to host:",n),!1}return!1}broadcastToGuests(t,n){if(!this.isHost){P.warn("Only host can broadcast to guests");return}let r=0;this.connections.forEach((a,o)=>{if(a.open&&o!==n)try{a.send(t),r++}catch(s){P.error(`Failed to send to guest ${o}:`,s)}}),P.debug(`Broadcast to ${r}/${this.connections.size} guests`)}sendToGuest(t,n){if(!this.isHost)return P.warn("Only host can send to specific guest"),!1;const r=this.connections.get(t);if(!r)return P.error(`[sendToGuest] No connection found for guest ${t}. Available connections: ${Array.from(this.connections.keys()).join(", ")}`),!1;if(!r.open)return P.error(`[sendToGuest] Connection for guest ${t} is not open`),!1;try{return r.send(n),P.debug(`Sent message to guest ${t}`),!0}catch(a){return P.error(`[sendToGuest] Failed to send message to ${t}:`,a),!1}}acceptGuest(t,n,r){var s;const a=this.connections.get(t);if(!a){P.error(`[acceptGuest] No connection found for guest ${t}. Available connections: ${Array.from(this.connections.keys()).join(", ")}`);return}if(!a.open){P.error(`[acceptGuest] Connection for guest ${t} is not open`);return}const o={type:"JOIN_ACCEPT",senderId:(s=this.peer)==null?void 0:s.id,playerId:r,data:{gameState:n},timestamp:Date.now()};try{a.send(o),P.info(`Accepted guest ${t} as player ${r}`)}catch(l){P.error(`[acceptGuest] Failed to send JOIN_ACCEPT to ${t}:`,l)}}acceptGuestMinimal(t,n,r){var s;const a=this.connections.get(t);if(!a){P.error(`[acceptGuestMinimal] No connection found for guest ${t}. Available connections: ${Array.from(this.connections.keys()).join(", ")}`);return}if(!a.open){P.error(`[acceptGuestMinimal] Connection for guest ${t} is not open`);return}const o={type:"JOIN_ACCEPT_MINIMAL",senderId:(s=this.peer)==null?void 0:s.id,playerId:r,data:n,timestamp:Date.now()};try{a.send(o),P.info(`Accepted guest ${t} as player ${r} (minimal)`)}catch(l){P.error(`[acceptGuestMinimal] Failed to send JOIN_ACCEPT_MINIMAL to ${t}:`,l)}}broadcastGameState(t,n){var a;const r={type:"STATE_UPDATE",senderId:(a=this.peer)==null?void 0:a.id,data:{gameState:t},timestamp:Date.now()};this.broadcastToGuests(r,n)}broadcastStateDelta(t,n){var a,o;const r={type:"STATE_DELTA",senderId:(a=this.peer)==null?void 0:a.id,data:{delta:t},timestamp:Date.now()};P.info(`[broadcastStateDelta] Preparing to send STATE_DELTA: playerDeltas=${Object.keys(t.playerDeltas||{}).length}, boardCells=${((o=t.boardCells)==null?void 0:o.length)||0}, phaseDelta=${!!t.phaseDelta}`),this.broadcastToGuests(r,n),P.info(`[broadcastStateDelta] Sent STATE_DELTA from player ${t.sourcePlayerId} to ${this.connections.size} guests`)}sendAction(t,n){var a;const r={type:"ACTION",senderId:(a=this.peer)==null?void 0:a.id,data:{actionType:t,actionData:n},timestamp:Date.now()};return this.sendMessageToHost(r)}sendStateDelta(t){var r;const n={type:"STATE_DELTA",senderId:(r=this.peer)==null?void 0:r.id,data:{delta:t},timestamp:Date.now()};return this.sendMessageToHost(n)}getConnectionInfo(){const t=[];return this.isHost?this.connections.forEach((n,r)=>{t.push({peerId:r,playerId:null,playerName:null,connected:n.open})}):this.hostConnection&&t.push({peerId:this.hostConnection.peer,playerId:null,playerName:null,connected:this.hostConnection.open}),t}getPeerId(){var t;return((t=this.peer)==null?void 0:t.id)||null}getHostPeerId(){var t,n;return this.isHost?((t=this.peer)==null?void 0:t.id)||null:((n=this.hostConnection)==null?void 0:n.peer)||null}isConnected(){return this.isHost?this.peer!==null&&this.connections.size>0:this.hostConnection!==null&&this.hostConnection.open}isHostMode(){return this.isHost}getConnectionCount(){var t;return this.isHost?this.connections.size:(t=this.hostConnection)!=null&&t.open?1:0}on(t){return this.eventHandlers.add(t),()=>this.eventHandlers.delete(t)}emitEvent(t){this.eventHandlers.forEach(n=>{try{n(t)}catch(r){P.error("Error in WebRTC event handler:",r)}})}cleanup(){this.connections.forEach(t=>t.close()),this.connections.clear(),this.hostConnection&&(this.hostConnection.close(),this.hostConnection=null),this.peer&&(this.peer.destroy(),this.peer=null),this.isHost=!1}}let Ed=null;const mC=()=>(Ed||(Ed=new hC),Ed);function gC(e){return 10+e*10}function Wf(e){if(!e.isGameStarted)return{shouldEnd:!1,roundWinners:[]};const t=e.currentPhase===1,n=e.activePlayerId===e.startingPlayerId;if(!t||!n)return{shouldEnd:!1,roundWinners:[]};const r=e.currentRound||1,a=gC(r),o=[];for(const l of e.players)!l.isDummy&&!l.isDisconnected&&l.score>=a&&o.push(l.id);return{shouldEnd:o.length>0,roundWinners:o}}function a0(e){const{shouldEnd:t,roundWinners:n}=Wf(e);if(!t)return e;const r=e.currentRound||1,a={...e.roundWinners,[r]:n},o=new Map;for(const[l,c]of Object.entries(a))for(const d of c){const f=o.get(d)||0;o.set(d,f+1)}let s=null;for(const[l,c]of o.entries())if(c>=2){s=l;break}return P.info(`[endRound] Round ${r} ended. Winners: [${n.join(", ")}], Game winner: ${s||"none"}`),{...e,roundWinners:a,gameWinner:s,isRoundEndModalOpen:!0,roundEndTriggered:!0}}function Vf(e,t){if(e.currentPhase!==0)return P.warn(`[performPreparationPhase] Not in Preparation phase (current: ${e.currentPhase})`),e;const n=e.players.find(o=>o.id===t);if(!n)return P.error(`[performPreparationPhase] Active player ${t} not found!`),e;P.info(`[performPreparationPhase] Player ${t} has deck size: ${n.deck.length}, hand size: ${n.hand.length}`);const r=e.players.map(o=>{if(o.id===t&&o.deck.length>0){const s=o.deck[0],l=[...o.deck.slice(1)],c=[...o.hand,s];return P.info(`[performPreparationPhase] Player ${t} drew card ${(s==null?void 0:s.id)||"unknown"}, deck now: ${l.length}, hand: ${c.length}`),{...o,deck:l,hand:c,readySetup:!1,readyCommit:!1}}return o}),a={...e,players:r,currentPhase:1};return Wf(a).shouldEnd?a0(a):(P.info(`[performPreparationPhase] Transitioned to Setup phase, activePlayerId=${a.activePlayerId}`),a)}function Sh(e,t){const n=e.activePlayerId;if(n===t){const l={...e,activePlayerId:null};return t===e.startingPlayerId&&e.currentPhase===1&&Wf(l).shouldEnd?a0(l):l}if(!e.players.filter(l=>!l.isDisconnected).find(l=>l.id===t))return P.warn(`[toggleActivePlayer] Player ${t} not found or disconnected`),e;let o=e.turnNumber||1;t===e.startingPlayerId&&n!==null&&o++;const s={...e,activePlayerId:t,turnNumber:o,currentPhase:0};return Vf(s,t)}function yC(e,t){const n=e.players.filter(o=>!o.isDisconnected).sort((o,s)=>o.id-s.id);if(n.length===0)return null;if(t===null)return n[0].id;const r=n.findIndex(o=>o.id===t);if(r===-1)return n[0].id;const a=(r+1)%n.length;return n[a].id}function vC(e,t){var n;for(const r of e.board)for(const a of r)if(((n=a.card)==null?void 0:n.ownerId)===t)return!0;return!1}function dl(e){const t=yC(e,e.activePlayerId);if(t===null)return P.warn("[passTurnToNextPlayer] No next player found"),e;P.info(`[passTurnToNextPlayer] Passing turn from ${e.activePlayerId} to ${t}`);let n={...e,board:e.board.map(r=>r.map(a=>{var o;return((o=a.card)==null?void 0:o.ownerId)===e.activePlayerId&&a.card.statuses?{...a,card:{...a.card,statuses:a.card.statuses.filter(s=>s.type!=="Stun")}}:a}))};return n={...n,board:n.board.map(r=>r.map(a=>a.card&&a.card.statuses?{...a,card:{...a.card,statuses:a.card.statuses.filter(o=>o.type!=="enteredThisTurn")}}:a))},n={...n,activePlayerId:t,currentPhase:0,isScoringStep:!1},Vf(n,t)}function bC(e,t,n){const r=ku();let a=e;if(e==="Random"||!r[e]){const l=Object.keys(r);if(l.length===0)return P.error("[createDeckLocally] No decks loaded yet!"),[];a=l[0]}const o=r[a];if(!o)return P.error(`[createDeckLocally] Deck data for ${a} not found!`),[];const s=[...o].map(l=>({...l,ownerId:t,ownerName:n}));return Gs(s)}function _h(e,t,n){var a,o;P.debug(`[applyStateDelta] Applying delta: sourcePlayerId=${t.sourcePlayerId}, boardCells=${((a=t.boardCells)==null?void 0:a.length)||0}, playerDeltas=${Object.keys(t.playerDeltas||{}).length}, phase=${!!t.phaseDelta}`);const r={...e};if(t.playerDeltas){const s=[],l=new Set;P.debug(`[applyStateDelta] Processing player deltas for ${Object.keys(t.playerDeltas).length} players`);for(const c of e.players){const d=t.playerDeltas[c.id];if(d!=null&&d.removed){P.debug(`[applyStateDelta] Player ${c.id} removed, filtering out`);continue}if(l.add(c.id),d){const f={...c},h=c.id===n,v=f.isDummy||c.isDummy;if(v&&(d.hand&&(P.debug(`[applyStateDelta] Dummy player ${c.id}: using full hand from delta (${d.hand.length} cards)`),f.hand=d.hand),d.deck&&(P.debug(`[applyStateDelta] Dummy player ${c.id}: using full deck from delta (${d.deck.length} cards)`),f.deck=d.deck),d.discard&&(P.debug(`[applyStateDelta] Dummy player ${c.id}: using full discard from delta (${d.discard.length} cards)`),f.discard=d.discard)),!v||!d.hand&&!d.deck&&!d.discard){if(d.handSizeDelta!==void 0)if(h)P.debug(`[applyStateDelta] Local player ${c.id}: handSizeDelta=${d.handSizeDelta} (informational, skipping)`);else{const w=c.hand.length+d.handSizeDelta;if(P.debug(`[applyStateDelta] Player ${c.id}: hand ${c.hand.length} -> ${w} (delta: ${d.handSizeDelta})`),w<c.hand.length)f.hand=c.hand.slice(0,w);else if(w>c.hand.length){const _=[];for(let C=c.hand.length;C<w;C++)_.push({id:`placeholder_${c.id}_${C}`,name:"?",isPlaceholder:!0});f.hand=[...c.hand,..._],P.debug(`[applyStateDelta] Added ${_.length} placeholder cards to player ${c.id} hand`)}}if(d.deckSizeDelta!==void 0&&!h){const w=c.deck.length+d.deckSizeDelta;if(P.debug(`[applyStateDelta] Player ${c.id}: deck ${c.deck.length} -> ${w} (delta: ${d.deckSizeDelta})`),w<c.deck.length)f.deck=c.deck.slice(0,w);else if(w>c.deck.length){const _=[];for(let C=c.deck.length;C<w;C++)_.push({id:`placeholder_${c.id}_deck_${C}`,name:"?",isPlaceholder:!0});f.deck=[...c.deck,..._]}}if(d.discardAdd&&(f.discard=[...f.discard,...d.discardAdd]),d.discardClear&&(f.discard=[]),d.discardSizeDelta!==void 0&&!d.discardAdd&&!h){const w=c.discard.length+d.discardSizeDelta;if(w<c.discard.length)f.discard=c.discard.slice(0,w);else if(w>c.discard.length){const _=[];for(let C=c.discard.length;C<w;C++)_.push({id:`placeholder_${c.id}_discard_${C}`,name:"?",isPlaceholder:!0});f.discard=[...c.discard,..._]}}}d.scoreDelta!==void 0&&(f.score=Math.max(0,c.score+d.scoreDelta)),d.isReady!==void 0&&(f.isReady=d.isReady),d.selectedDeck!==void 0&&(f.selectedDeck=d.selectedDeck),d.name!==void 0&&(f.name=d.name),d.color!==void 0&&(f.color=d.color),d.isDisconnected!==void 0&&(f.isDisconnected=d.isDisconnected),d.isDummy!==void 0&&(f.isDummy=d.isDummy),d.announcedCard!==void 0&&(P.debug(`[applyStateDelta] Player ${c.id} announcedCard updated:`,((o=d.announcedCard)==null?void 0:o.id)||"null"),f.announcedCard=d.announcedCard),d.boardHistory!==void 0&&(f.boardHistory=[...d.boardHistory]),d.teamId!==void 0&&(f.teamId=d.teamId),d.autoDrawEnabled!==void 0&&(f.autoDrawEnabled=d.autoDrawEnabled),s.push(f)}else s.push(c)}for(const[c,d]of Object.entries(t.playerDeltas)){const f=Number(c);if(!l.has(f)&&!d.removed){P.debug(`[applyStateDelta] Adding new player ${f} (${d.name||"Unknown"}), isDummy=${d.isDummy}`);const h={id:f,name:d.name||`Player ${f}`,color:d.color||"blue",isDummy:d.isDummy||!1,isReady:d.isReady||!1,score:0,selectedDeck:d.selectedDeck||"Random",boardHistory:d.boardHistory||[],isDisconnected:d.isDisconnected||!1,autoDrawEnabled:d.autoDrawEnabled!==void 0?d.autoDrawEnabled:!0},v=(w,_)=>({id:`placeholder_${f}_${_}_${w}`,name:"?",isPlaceholder:!0,ownerId:f,color:h.color,deck:h.selectedDeck});if(d.isDummy){if(d.hand)h.hand=d.hand,P.debug(`[applyStateDelta] New dummy player ${f}: using full hand from delta (${h.hand.length} cards)`);else{const w=d.handSizeDelta||0;h.hand=[];for(let _=0;_<w;_++)h.hand.push(v(_,"hand"))}if(d.deck)h.deck=d.deck,P.debug(`[applyStateDelta] New dummy player ${f}: using full deck from delta (${h.deck.length} cards)`);else{const w=h.selectedDeck||"Random",_=bC(w,f,h.name),C=d.deckSizeDelta||_.length;if(_.length>C){const D=_.length-C;h.deck=_.slice(D)}else h.deck=_;P.debug(`[applyStateDelta] New dummy player ${f}: generated deck locally (${h.deck.length} cards, deckType=${w})`)}if(d.discard)h.discard=d.discard,P.debug(`[applyStateDelta] New dummy player ${f}: using full discard from delta (${h.discard.length} cards)`);else{const w=d.discardSizeDelta||0;h.discard=[];for(let _=0;_<w;_++)h.discard.push(v(_,"discard"))}P.debug(`[applyStateDelta] New dummy player ${f}: hand=${h.hand.length}, deck=${h.deck.length}, discard=${h.discard.length}`)}else{const w=d.handSizeDelta||0,_=d.deckSizeDelta||0,C=d.discardSizeDelta||0;h.hand=[];for(let D=0;D<w;D++)h.hand.push(v(D,"hand"));h.deck=[];for(let D=0;D<_;D++)h.deck.push(v(D,"deck"));h.discard=[];for(let D=0;D<C;D++)h.discard.push(v(D,"discard"))}d.announcedCard!==void 0?h.announcedCard=d.announcedCard:h.announcedCard=null,s.push(h)}}P.debug(`[applyStateDelta] Player count: ${e.players.length} -> ${s.length}`),r.players=s}if(t.boardCells&&t.boardCells.length>0&&(P.debug(`[applyStateDelta] Applying ${t.boardCells.length} board cell changes`),r.board=e.board.map((s,l)=>s.map((c,d)=>{var v,w,_,C,D,x,y;const f=t.boardCells.find(k=>k.row===l&&k.col===d);if(!f)return c;const h={...c};if(f.card!==void 0){const k=((w=(v=f.card)==null?void 0:v.statuses)==null?void 0:w.length)||0,j=((C=(_=f.card)==null?void 0:_.statuses)==null?void 0:C.map($=>$.type).join(","))||"none";P.debug(`[applyStateDelta] Cell [${l},${d}]: card ${f.card?"added":"removed"}, name: ${((D=f.card)==null?void 0:D.name)||"N/A"}, statuses: [${j}] (count: ${k})`),h.card=f.card}if(f.cardStatuses&&h.card){P.debug(`[applyStateDelta] Cell [${l},${d}]: applying cardStatuses, remove=${(x=f.cardStatuses.remove)==null?void 0:x.join(",")}, add count=${((y=f.cardStatuses.add)==null?void 0:y.length)||0}`);const k={...h.card};if(k.statuses||(k.statuses=[]),f.cardStatuses.clear)k.statuses=[];else{if(f.cardStatuses.remove&&f.cardStatuses.remove.length>0){const j=f.cardStatuses.remove,$=k.statuses.length;k.statuses=k.statuses.filter(M=>!j.includes(M.type));const A=k.statuses.length;$!==A&&P.debug(`[applyStateDelta] Cell [${l},${d}]: removed ${$-A} statuses with types: ${j.join(",")}`)}f.cardStatuses.add&&f.cardStatuses.add.length>0&&(k.statuses=[...k.statuses,...f.cardStatuses.add],P.debug(`[applyStateDelta] Cell [${l},${d}]: added ${f.cardStatuses.add.length} statuses`))}h.card=k}if(f.cardPowerDelta!==void 0&&h.card){const k={...h.card};k.power=Number(k.power??0)+f.cardPowerDelta,h.card=k}if(f.cardPowerModifier!==void 0&&h.card){P.debug(`[applyStateDelta] Applying powerModifier at [${l},${d}]: ${h.card.powerModifier} -> ${f.cardPowerModifier}`);const k={...h.card};k.powerModifier=f.cardPowerModifier,h.card=k}return h}))),t.phaseDelta&&(t.phaseDelta.currentPhase!==void 0&&(r.currentPhase=t.phaseDelta.currentPhase),t.phaseDelta.isScoringStep!==void 0&&(r.isScoringStep=t.phaseDelta.isScoringStep),t.phaseDelta.activePlayerId!==void 0&&(r.activePlayerId=t.phaseDelta.activePlayerId),t.phaseDelta.startingPlayerId!==void 0&&(r.startingPlayerId=t.phaseDelta.startingPlayerId)),t.roundDelta&&(t.roundDelta.currentRound!==void 0&&(r.currentRound=t.roundDelta.currentRound),t.roundDelta.turnNumber!==void 0&&(r.turnNumber=t.roundDelta.turnNumber),t.roundDelta.roundEndTriggered!==void 0&&(r.roundEndTriggered=t.roundDelta.roundEndTriggered),t.roundDelta.roundWinners!==void 0&&(r.roundWinners={...t.roundDelta.roundWinners}),t.roundDelta.gameWinner!==void 0&&(r.gameWinner=t.roundDelta.gameWinner),t.roundDelta.isRoundEndModalOpen!==void 0&&(r.isRoundEndModalOpen=t.roundDelta.isRoundEndModalOpen)),t.settingsDelta){if(t.settingsDelta.activeGridSize!==void 0&&(r.activeGridSize=t.settingsDelta.activeGridSize,e.board.length!==t.settingsDelta.activeGridSize)){const s=t.settingsDelta.activeGridSize;r.board=[];for(let l=0;l<s;l++){const c=[];for(let d=0;d<s;d++)c.push({card:null});r.board.push(c)}}t.settingsDelta.gameMode!==void 0&&(r.gameMode=t.settingsDelta.gameMode,P.debug(`[applyStateDelta] Game mode changed to ${t.settingsDelta.gameMode}`)),t.settingsDelta.isPrivate!==void 0&&(r.isPrivate=t.settingsDelta.isPrivate,P.debug(`[applyStateDelta] Game privacy changed to ${t.settingsDelta.isPrivate}`)),t.settingsDelta.dummyPlayerCount!==void 0&&(r.dummyPlayerCount=t.settingsDelta.dummyPlayerCount,P.debug(`[applyStateDelta] Dummy player count changed to ${t.settingsDelta.dummyPlayerCount}`))}if(t.highlightsDelta)if(t.highlightsDelta.clear)r.highlights=[];else{let s=[...e.highlights];t.highlightsDelta.remove&&(s=s.filter(l=>!t.highlightsDelta.remove.includes(l.timestamp))),t.highlightsDelta.add&&(s=[...s,...t.highlightsDelta.add]),r.highlights=s}return t.floatingTextsDelta&&(t.floatingTextsDelta.clear?r.floatingTexts=[]:t.floatingTextsDelta.add&&(r.floatingTexts=[...e.floatingTexts,...t.floatingTextsDelta.add])),t.targetingModeDelta&&(t.targetingModeDelta.clear?r.targetingMode=null:t.targetingModeDelta.set&&(r.targetingMode=t.targetingModeDelta.set)),t.abilityModeDelta&&(r.abilityMode=t.abilityModeDelta),r}function ul(e,t,n){var l,c,d,f,h,v,w,_,C,D,x,y,k,j,$,A,M,K,ee,re,Ie;const r={timestamp:Date.now(),sourcePlayerId:n};(e.currentPhase!==t.currentPhase||e.isScoringStep!==t.isScoringStep||e.activePlayerId!==t.activePlayerId||e.startingPlayerId!==t.startingPlayerId)&&(r.phaseDelta={...e.currentPhase!==t.currentPhase&&{currentPhase:t.currentPhase},...e.isScoringStep!==t.isScoringStep&&{isScoringStep:t.isScoringStep},...e.activePlayerId!==t.activePlayerId&&{activePlayerId:t.activePlayerId},...e.startingPlayerId!==t.startingPlayerId&&{startingPlayerId:t.startingPlayerId}}),(e.currentRound!==t.currentRound||e.turnNumber!==t.turnNumber||e.roundEndTriggered!==t.roundEndTriggered||e.gameWinner!==t.gameWinner||e.isRoundEndModalOpen!==t.isRoundEndModalOpen)&&(r.roundDelta={...e.currentRound!==t.currentRound&&{currentRound:t.currentRound},...e.turnNumber!==t.turnNumber&&{turnNumber:t.turnNumber},...e.roundEndTriggered!==t.roundEndTriggered&&{roundEndTriggered:t.roundEndTriggered},...e.gameWinner!==t.gameWinner&&{gameWinner:t.gameWinner},...e.isRoundEndModalOpen!==t.isRoundEndModalOpen&&{isRoundEndModalOpen:t.isRoundEndModalOpen}}),(e.activeGridSize!==t.activeGridSize||e.gameMode!==t.gameMode||e.isPrivate!==t.isPrivate||e.dummyPlayerCount!==t.dummyPlayerCount)&&(r.settingsDelta={...e.activeGridSize!==t.activeGridSize&&{activeGridSize:t.activeGridSize},...e.gameMode!==t.gameMode&&{gameMode:t.gameMode},...e.isPrivate!==t.isPrivate&&{isPrivate:t.isPrivate},...e.dummyPlayerCount!==t.dummyPlayerCount&&{dummyPlayerCount:t.dummyPlayerCount}},P.debug("[createDeltaFromStates] Settings changed:",r.settingsDelta));const a=[],o=Math.max(e.board.length,t.board.length);for(let B=0;B<o;B++){const fe=Math.max(((l=e.board[B])==null?void 0:l.length)||0,((c=t.board[B])==null?void 0:c.length)||0);for(let he=0;he<fe;he++){const ke=(d=e.board[B])==null?void 0:d[he],ie=(f=t.board[B])==null?void 0:f[he];if(!ke&&!ie)continue;const ae=(h=ke==null?void 0:ke.card)==null?void 0:h.id,J=(v=ie==null?void 0:ie.card)==null?void 0:v.id;if(ae!==J){const q=((_=(w=ie==null?void 0:ie.card)==null?void 0:w.statuses)==null?void 0:_.length)||0,H=((D=(C=ie==null?void 0:ie.card)==null?void 0:C.statuses)==null?void 0:D.map(ne=>ne.type).join(","))||"none";P.debug(`[createDeltaFromStates] Cell [${B},${he}]: card changed, new card: ${((x=ie==null?void 0:ie.card)==null?void 0:x.name)||"null"}, statuses: [${H}] (count: ${q})`),a.push({row:B,col:he,card:(ie==null?void 0:ie.card)||null})}else if(ke!=null&&ke.card&&(ie!=null&&ie.card)){const q={row:B,col:he},H=((y=ke==null?void 0:ke.card)==null?void 0:y.statuses)||[],ne=((k=ie==null?void 0:ie.card)==null?void 0:k.statuses)||[];if(H.length>0||ne.length>0){const Le=H.map(V=>V.type).join(","),We=ne.map(V=>V.type).join(",");Le!==We&&P.debug(`[createDeltaFromStates] Cell [${B},${he}] (${ie.card.name}): statuses differ - old: [${Le}], new: [${We}]`)}const de=[],xe=[];if(H.length!==ne.length){const Le=new Map,We=new Map;for(const V of H){const Ke=`${V.type}_${V.addedByPlayerId}`;Le.has(Ke)||Le.set(Ke,[]),Le.get(Ke).push(V)}for(const V of ne){const Ke=`${V.type}_${V.addedByPlayerId}`;We.has(Ke)||We.set(Ke,[]),We.get(Ke).push(V)}for(const[V,Ke]of Le){const E=We.get(V),U=Ke.length,te=E?E.length:0;if(te<U){const Te=U-te;for(let ve=0;ve<Te;ve++)xe.push(Ke[ve].type)}}for(const[V,Ke]of We){const E=Le.get(V),U=Ke.length,te=E?E.length:0;if(U>te)for(let Te=te;Te<U;Te++)de.push(Ke[Te])}P.debug(`[createDeltaFromStates] Cell [${B},${he}]: status length changed ${H.length} -> ${ne.length}, added: ${de.length}, removed: ${xe.join(",")}`)}else for(let Le=0;Le<H.length;Le++){const We=H[Le],V=ne[Le];(We.type!==V.type||We.addedByPlayerId!==V.addedByPlayerId)&&(xe.push(We.type),de.push(V),P.debug(`[createDeltaFromStates] Cell [${B},${he}]: status replaced at index ${Le}: ${We.type} -> ${V.type}`))}(de.length>0||xe.length>0)&&(q.cardStatuses={...de.length>0&&{add:de},...xe.length>0&&{remove:xe}},P.debug(`[createDeltaFromStates] Cell [${B},${he}]: cardStatuses delta created, remove: [${xe.join(",")}], add: ${de.map(Le=>Le.type).join(",")}`));const Z=Number(((j=ke==null?void 0:ke.card)==null?void 0:j.power)??0),Oe=Number((($=ie==null?void 0:ie.card)==null?void 0:$.power)??0);Z!==Oe&&(q.cardPowerDelta=Oe-Z);const Re=(A=ke==null?void 0:ke.card)==null?void 0:A.powerModifier,Ce=(M=ie==null?void 0:ie.card)==null?void 0:M.powerModifier;Re!==Ce&&(q.cardPowerModifier=Ce),Object.keys(q).length>2&&a.push(q)}}}a.length>0&&(r.boardCells=a);const s={};for(const B of t.players){const fe=e.players.find(J=>J.id===B.id);if(!fe){P.debug(`[createDeltaFromStates] New player added: ${B.id} (${B.name}), isDummy=${B.isDummy}`);const J={id:B.id,name:B.name,color:B.color,isDummy:B.isDummy,isReady:B.isReady,selectedDeck:B.selectedDeck,isDisconnected:B.isDisconnected,handSizeDelta:B.hand.length,deckSizeDelta:B.deck.length,discardSizeDelta:B.discard.length,announcedCard:B.announcedCard};s[B.id]=J,P.debug(`[createDeltaFromStates] New player delta: sizes hand=${B.hand.length}, deck=${B.deck.length}, discard=${B.discard.length}`);continue}const he={id:B.id};fe.score!==B.score&&(he.scoreDelta=B.score-fe.score),fe.isReady!==B.isReady&&(he.isReady=B.isReady),fe.selectedDeck!==B.selectedDeck&&(he.selectedDeck=B.selectedDeck),fe.name!==B.name&&(he.name=B.name),fe.color!==B.color&&(he.color=B.color),fe.isDisconnected!==B.isDisconnected&&(he.isDisconnected=B.isDisconnected),B.isDummy?(he.isDummy=!0,fe.hand.length===0&&B.hand.length>0&&B.hand.length>0&&(he.hand=[...B.hand],P.debug(`[createDeltaFromStates] Dummy player ${B.id}: game start, sending full hand (${B.hand.length} cards)`)),fe.hand.length!==B.hand.length&&(he.handSizeDelta=B.hand.length-fe.hand.length,P.debug(`[createDeltaFromStates] Dummy player ${B.id}: hand size delta: ${he.handSizeDelta}`)),fe.deck.length!==B.deck.length&&(he.deckSizeDelta=B.deck.length-fe.deck.length,P.debug(`[createDeltaFromStates] Dummy player ${B.id}: deck size delta: ${he.deckSizeDelta}`)),fe.discard.length!==B.discard.length&&(he.discardSizeDelta=B.discard.length-fe.discard.length,P.debug(`[createDeltaFromStates] Dummy player ${B.id}: discard size delta: ${he.discardSizeDelta}`))):(fe.hand.length!==B.hand.length&&(he.handSizeDelta=B.hand.length-fe.hand.length),fe.deck.length!==B.deck.length&&(he.deckSizeDelta=B.deck.length-fe.deck.length),fe.discard.length!==B.discard.length&&(he.discardSizeDelta=B.discard.length-fe.discard.length,B.discard.length>fe.discard.length&&(he.discardAdd=B.discard.slice(fe.discard.length))));const ke=fe.announcedCard,ie=B.announcedCard;(!ke!=!ie||ke&&ie&&(ke.id!==ie.id||ke.power!==ie.power||ke.powerModifier!==ie.powerModifier||(((K=ke.statuses)==null?void 0:K.length)??0)!==(((ee=ie.statuses)==null?void 0:ee.length)??0)||JSON.stringify(ke.statuses)!==JSON.stringify(ie.statuses)))&&(he.announcedCard=ie?{...ie}:null,P.debug(`[createDeltaFromStates] Player ${B.id} announcedCard changed:`,ke==null?void 0:ke.id,"->",ie==null?void 0:ie.id)),JSON.stringify(fe.boardHistory)!==JSON.stringify(B.boardHistory)&&(he.boardHistory=[...B.boardHistory]),fe.teamId!==B.teamId&&(he.teamId=B.teamId),fe.autoDrawEnabled!==B.autoDrawEnabled&&(he.autoDrawEnabled=B.autoDrawEnabled),fe.selectedDeck!==B.selectedDeck&&(he.selectedDeck=B.selectedDeck,P.debug(`[createDeltaFromStates] Player ${B.id} selectedDeck changed: ${fe.selectedDeck} -> ${B.selectedDeck}`)),Object.keys(he).length>1&&(s[B.id]=he)}for(const B of e.players)t.players.find(he=>he.id===B.id)||(P.debug(`[createDeltaFromStates] Player removed: ${B.id} (${B.name})`),s[B.id]={id:B.id,removed:!0});return Object.keys(s).length>0&&(r.playerDeltas=s),JSON.stringify(e.abilityMode)!==JSON.stringify(t.abilityMode)&&(r.abilityModeDelta=t.abilityMode,P.debug("[createDeltaFromStates] abilityMode changed:",(re=e.abilityMode)==null?void 0:re.mode,"->",(Ie=t.abilityMode)==null?void 0:Ie.mode)),JSON.stringify(e.targetingMode)!==JSON.stringify(t.targetingMode)&&(t.targetingMode===null?r.targetingModeDelta={clear:!0}:r.targetingModeDelta={set:t.targetingMode}),r}function ys(e){var t;return!e.phaseDelta&&!e.roundDelta&&!e.settingsDelta&&!((t=e.boardCells)!=null&&t.length)&&!e.playerDeltas&&!e.highlightsDelta&&!e.floatingTextsDelta&&!e.targetingModeDelta&&!e.abilityModeDelta}const xC=()=>{const e=localStorage.getItem("custom_ws_url");if(!e||e.trim()==="")return P.warn("No custom WebSocket URL configured in settings."),null;let t=e.trim();return t.endsWith("/")&&(t=t.slice(0,-1)),t.startsWith("https://")?t=t.replace("https://","wss://"):t.startsWith("http://")&&(t=t.replace("http://","ws://")),!t.startsWith("ws://")&&!t.startsWith("wss://")?(P.warn("Invalid WebSocket URL format (must start with ws:// or wss://)"),null):(localStorage.setItem("websocket_url",t),t)},Dh=()=>Math.random().toString(36).substring(2,18).toUpperCase(),Rh=(e,t)=>{var r;e.forEach(a=>a.forEach(o=>{var s;(s=o.card)!=null&&s.statuses&&(o.card.statuses=o.card.statuses.filter(l=>!(l.type==="LastPlayed"&&l.addedByPlayerId===t.id)))})),t.boardHistory||(t.boardHistory=[]);let n=!1;for(;t.boardHistory.length>0&&!n;){const a=t.boardHistory[t.boardHistory.length-1];for(let o=0;o<e.length;o++){for(let s=0;s<e[o].length;s++)if(((r=e[o][s].card)==null?void 0:r.id)===a){const l=e[o][s].card;if(!l||l.ownerId!==t.id)continue;l.statuses||(l.statuses=[]),l.statuses.push({type:"LastPlayed",addedByPlayerId:t.id}),n=!0;break}if(n)break}n||t.boardHistory.pop()}},ic="avalon_game_state",Ba="reconnection_data",Cr=new Map,vs=e=>{var r;if(!e||!lr)return e;const{cardDatabase:t,tokenDatabase:n}=lr;if(e.deck===it.Tokens||(r=e.id)!=null&&r.startsWith("TKN_")){if(e.baseId&&n[e.baseId]){const o=n[e.baseId];return{...e,imageUrl:o.imageUrl,fallbackImage:o.fallbackImage}}const a=Object.keys(n).find(o=>n[o].name===e.name);if(a){const o=n[a];return{...e,imageUrl:o.imageUrl,fallbackImage:o.fallbackImage,baseId:a}}}else if(e.baseId&&t[e.baseId]){const a=t[e.baseId];return{...e,imageUrl:a.imageUrl,fallbackImage:a.fallbackImage}}return e},Fs=e=>{var r,a;if(!lr)return e;const t=((r=e.board)==null?void 0:r.map(o=>o.map(s=>({...s,card:s.card?vs(s.card):null}))))||e.board,n=((a=e.players)==null?void 0:a.map(o=>{var s,l,c;return{...o,hand:((s=o.hand)==null?void 0:s.map(vs))||[],deck:((l=o.deck)==null?void 0:l.map(vs))||[],discard:((c=o.discard)==null?void 0:c.map(vs))||[],announcedCard:o.announcedCard?vs(o.announcedCard):null}}))||e.players;return{...e,board:t,players:n,floatingTexts:e.floatingTexts||[],highlights:e.highlights||[]}},jh=(e,t,n)=>{try{const r=Fs(e),a={gameState:r,localPlayerId:t,playerToken:n,timestamp:Date.now()};localStorage.setItem(ic,JSON.stringify(a)),r.gameId&&t!==null&&localStorage.setItem(Ba,JSON.stringify({gameId:r.gameId,playerId:t,playerToken:n||null,timestamp:Date.now()}))}catch(r){console.warn("Failed to save game state:",r)}},CC=()=>{try{const e=localStorage.getItem(ic);if(!e)return null;const t=JSON.parse(e),n=24*60*60*1e3;if(Date.now()-t.timestamp>n)return localStorage.removeItem(ic),localStorage.removeItem(Ba),null;const r=t.gameState;return{gameState:Fs(r),localPlayerId:t.localPlayerId,playerToken:t.playerToken}}catch(e){return console.warn("Failed to load game state:",e),null}},go=()=>{localStorage.removeItem(ic),localStorage.removeItem(Ba)},wC=(e={})=>{const{abilityMode:t,setAbilityMode:n}=e,r=m.useCallback((u,T,p)=>{const b=ku();let I=u;if(u==="Random"||!b[u]){const S=Object.keys(b);if(S.length===0)return console.error("[createDeck] No decks loaded yet!"),[];I=S[0],u==="Random"?console.log(`[createDeck] Random deck selected, using ${I} instead`):console.warn(`[createDeck] Deck ${u} not found, using ${I} instead`)}const g=b[I];if(!g)return console.error(`Deck data for ${I} not loaded! Returning empty deck. Available decks:`,Object.keys(b)),[];const N=[...g].map(S=>({...S,ownerId:T,ownerName:p}));return Gs(N)},[]),a=m.useCallback((u,T=!1)=>{const p=ku(),b=Object.keys(p);if(b.length===0)return console.error("[createNewPlayer] No decks loaded yet!"),{id:u,name:T?`Dummy ${u-1}`:`Player ${u}`,score:0,hand:[],deck:[],discard:[],announcedCard:null,selectedDeck:"Damanaki",color:sl[u-1]||"blue",isDummy:T,isReady:!1,boardHistory:[],autoDrawEnabled:!0};const I=b[0],g={id:u,name:T?`Dummy ${u-1}`:`Player ${u}`,score:0,hand:[],deck:[],discard:[],announcedCard:null,selectedDeck:I,color:sl[u-1]||"blue",isDummy:T,isReady:!1,boardHistory:[],autoDrawEnabled:!0};return g.deck=r(I,u,g.name),g},[r]),o=m.useCallback(()=>({players:[],spectators:[],board:yh(),activeGridSize:7,gameId:null,hostId:1,dummyPlayerCount:0,isGameStarted:!1,gameMode:Kr.FreeForAll,isPrivate:!0,isReadyCheckActive:!1,revealRequests:[],activePlayerId:null,startingPlayerId:null,currentPhase:0,isScoringStep:!1,preserveDeployAbilities:!1,autoAbilitiesEnabled:!0,autoDrawEnabled:!0,currentRound:1,turnNumber:1,roundEndTriggered:!1,roundWinners:{},gameWinner:null,isRoundEndModalOpen:!1,floatingTexts:[],highlights:[],deckSelections:[],handCardSelections:[],targetingMode:null,localPlayerId:null,isSpectator:!1}),[]),[s,l]=m.useState(o()),c=m.useRef(o()),d=m.useCallback((u,T)=>{l(p=>{const b=typeof u=="function"?u(p):u;return c.current=p,localStorage.getItem("webrtc_enabled")==="true"&&Z.current&&setTimeout(()=>{var N;const g=ul(p,b,T||we.current||0);!ys(g)&&O.current&&(O.current.broadcastStateDelta(g),P.debug(`[setGameStateWithDelta] Broadcast delta: phase=${!!g.phaseDelta}, round=${!!g.roundDelta}, board=${((N=g.boardCells)==null?void 0:N.length)||0}, players=${Object.keys(g.playerDeltas||{}).length}`))},0),b})},[]),[f,h]=m.useState(null),[v,w]=m.useState(null),[_,C]=m.useState("Connecting"),[D,x]=m.useState([]),[y,k]=m.useState(null),[j,$]=m.useState(null),[A,M]=m.useState(null),[K,ee]=m.useState([]),[re,Ie]=m.useState([]),[B,fe]=m.useState([]),[he,ke]=m.useState(null),[ie,ae]=m.useState(!!lr),[J,q]=m.useState(!1),[H,ne]=m.useState(null),[de,xe]=m.useState(!1),Z=m.useRef(!1),[Oe,Re]=m.useState(!1),[Ce,Le]=m.useState(null),We=m.useRef(!1),V=m.useRef(null),Ke=m.useRef(null),E=m.useRef(null),U=m.useRef(!1),te=m.useRef(!1),Te=m.useRef(void 0),ve=m.useRef(!1),O=m.useRef(null),et=m.useRef(()=>{});m.useEffect(()=>{et.current=d},[d]),m.useEffect(()=>{Z.current=de},[de]),m.useEffect(()=>{const u=localStorage.getItem("webrtc_enabled")==="true";if(q(u),u){O.current=mC();const T=O.current.on(p=>{Nt(p)});return()=>{T()}}},[]),m.useEffect(()=>{if(!(localStorage.getItem("webrtc_enabled")==="true"))return;const T=window.location.hash.slice(1);if(T&&new URLSearchParams(T).get("hostId"))return;const p=Gx();p!=="none"&&setTimeout(async()=>{var b,I;if(!O.current){P.warn("[Auto-restore] WebRTC manager not ready");return}try{if(p==="host"){pt.current=!0,P.info("[Auto-restore] Setting restoration flag to prevent premature exit");const g=hy(),N=mh();if(!g||!N){P.warn("[Auto-restore] Missing host data or state data"),za(),pt.current=!1;return}P.info(`[Auto-restore] Restoring host session: old peerId=${g.peerId}`);const S=await O.current.initializeAsHost();Z.current=!0,xe(!0),ne(S),C("Connected"),(b=N.gameState)!=null&&b.gameId&&(xd(S,N.gameState.gameId),P.info(`[Auto-restore] Broadcasted NEW host peerId ${S} for game ${N.gameState.gameId}`)),(N.gameState||N.localPlayerId!==null)&&(N.gameState&&(ue.current=N.gameState),N.localPlayerId!==null&&(we.current=N.localPlayerId),We.current=!0,setTimeout(()=>{We.current=!1},1e4),setTimeout(()=>{var z;N.gameState&&(l(N.gameState),P.info(`[Auto-restore] Restored game state with ${((z=N.gameState.players)==null?void 0:z.length)||0} players, gameId=${N.gameState.gameId}`)),N.localPlayerId!==null&&(h(N.localPlayerId),P.info(`[Auto-restore] Restored local player ID: ${N.localPlayerId}`))},0)),setTimeout(()=>{pt.current=!1,P.info("[Auto-restore] Cleared restoration flag")},100),P.info("[Auto-restore] Host session restoration initiated")}else if(p==="guest"){pt.current=!0,P.info("[Auto-restore] Setting restoration flag to prevent premature exit");const g=my(),N=mh();if(!g||!N){P.warn("[Auto-restore] Missing guest data or state data"),za(),pt.current=!1;return}P.info(`[Auto-restore] Restoring guest session: old hostPeerId=${g.hostPeerId}, playerId=${g.playerId}`),Z.current=!1,xe(!1),C("Connecting");let S=g.hostPeerId;if((I=N.gameState)!=null&&I.gameId){const z=Cd(N.gameState.gameId);z&&z.peerId&&(S=z.peerId,P.info(`[Auto-restore] Found NEW host peerId in localStorage: ${S}`))}if(ne(S),g.playerId!==null){P.info(`[Auto-restore] Reconnecting as existing player ${g.playerId} to host ${S}`);try{await O.current.initializeAsReconnectingGuest(S,g.playerId),C("Connected"),P.info("[Auto-restore] Successfully reconnected to host")}catch(z){P.error("[Auto-restore] Failed to reconnect to host:",z),C("Disconnected"),za(),P.info("[Auto-restore] Cleared stale guest data due to failed reconnection"),pt.current=!1;return}}else P.info("[Auto-restore] Connecting as new player"),await O.current.initializeAsGuest(S),C("Connected");(N.gameState||N.localPlayerId!==null)&&(N.gameState&&(ue.current=N.gameState),N.localPlayerId!==null&&(we.current=N.localPlayerId),We.current=!0,setTimeout(()=>{We.current=!1},1e4),setTimeout(()=>{var z,le;if(N.gameState&&(l(N.gameState),P.info(`[Auto-restore] Restored game state with ${((z=N.gameState.players)==null?void 0:z.length)||0} players, gameId=${N.gameState.gameId}, isGameStarted=${N.gameState.isGameStarted}`),N.localPlayerId!==null)){const Xe=(le=N.gameState.players)==null?void 0:le.some(Et=>Et.id===N.localPlayerId);P.info(`[Auto-restore] Player ${N.localPlayerId} exists in restored state: ${Xe}`)}N.localPlayerId!==null&&(h(N.localPlayerId),P.info(`[Auto-restore] Restored local player ID: ${N.localPlayerId}`))},0)),setTimeout(()=>{pt.current=!1,P.info("[Auto-restore] Cleared restoration flag")},100),P.info("[Auto-restore] Guest session restoration initiated")}}catch(g){P.error("[Auto-restore] Failed to restore session:",g),za(),pt.current=!1}},100)},[]),m.useEffect(()=>{if(!J||!O.current)return;const u=window.location.hash.slice(1);if(!u)return;const p=new URLSearchParams(u).get("hostId");p&&Y(p)},[J]);const ue=m.useRef(s);m.useEffect(()=>{ue.current=s},[s]);const we=m.useRef(f);m.useEffect(()=>{we.current=f},[f]);const pt=m.useRef(!1);m.useEffect(()=>{if(!J||!Z.current||!(s!=null&&s.gameId))return;const u=s.gameId,T=()=>{var I;const b=(I=O.current)==null?void 0:I.getPeerId();b&&u&&xd(b,u)};T();const p=setInterval(T,2e3);return()=>clearInterval(p)},[J,s==null?void 0:s.gameId]),m.useEffect(()=>{if(!J||Z.current||!(s!=null&&s.gameId))return;const u=s.gameId,T=I=>{var g;ne(I),C("Connecting"),(g=O.current)==null||g.initializeAsReconnectingGuest(I,we.current||0).then(()=>{C("Connected")}).catch(N=>{P.error("[Guest Auto-Reconnect] Failed to reconnect:",N),C("Disconnected")})},p=I=>{const g=`webrtc_host_${u}`;if(!(I.key!==g||!I.newValue))try{const S=JSON.parse(I.newValue).peerId;S&&S!==H&&T(S)}catch(N){P.error("[Guest Auto-Reconnect] Failed to parse storage event:",N)}},b=setInterval(()=>{const I=Cd(u);I&&I.peerId!==H&&(P.info(`[Guest Auto-Reconnect] Periodic check found new host peerId: ${I.peerId}`),T(I.peerId))},2e3);return window.addEventListener("storage",p),()=>{window.removeEventListener("storage",p),clearInterval(b)}},[J,s==null?void 0:s.gameId,H]),m.useEffect(()=>{const u=setInterval(()=>{l(T=>{const p=Date.now(),b=T.floatingTexts||[],I=b.filter(g=>p-g.timestamp<nt.FLOATING_TEXT_DURATION);return I.length!==b.length?{...T,floatingTexts:I}:T})},nt.DECK_SYNC_DELAY);return()=>clearInterval(u)},[]);const Nt=m.useCallback(u=>{var T,p;switch(u.type){case"peer_open":(T=u.data)!=null&&T.peerId&&(ne(u.data.peerId),P.info(`WebRTC peer opened with ID: ${u.data.peerId}`));break;case"guest_connected":P.info("Guest connected via WebRTC:",(p=u.data)==null?void 0:p.peerId);break;case"connected_to_host":C("Connected"),Re(!1),Le(null),We.current=!1;try{localStorage.removeItem("webrtc_reconnection_data")}catch{}break;case"host_disconnected":case"guest_disconnected":if(P.warn("WebRTC peer disconnected"),C("Disconnected"),Re(!0),!Z.current&&H&&s)try{const b={hostPeerId:H,playerId:f,gameState:s,timestamp:Date.now(),isHost:!1};localStorage.setItem("webrtc_reconnection_data",JSON.stringify(b)),P.info("[Reconnection] Stored reconnection data before disconnect"),Q(H)}catch(b){P.error("[Reconnection] Failed to store data:",b)}break;case"message_received":se(u.data);break;case"error":P.error("WebRTC error:",u.data);break}},[s,f,H,de]),Wt=m.useCallback(u=>{if(P.info(`[handleWebrtcGuestJoin] Called for guest ${u}, isHost: ${Z.current}`),!Z.current||!O.current){P.warn("[handleWebrtcGuestJoin] Not a host or manager not initialized");return}l(T=>{if(!T)return P.error("[handleWebrtcGuestJoin] No previous state"),T;P.info(`[handleWebrtcGuestJoin] Current state has ${T.players.length} players`);const p=T.players.map(z=>z.id);let b=1;for(;p.includes(b);)b++;const I={id:b,name:`Player ${b}`,color:sl[p.length%sl.length],hand:[],deck:[],discard:[],announcedCard:null,score:0,isDummy:!1,isReady:!1,selectedDeck:"Random",boardHistory:[],autoDrawEnabled:!0},g={...T,players:[...T.players,I]},N=T.board.map(z=>z.map(le=>({...le,card:le.card?{id:le.card.id,baseId:le.card.baseId,ownerId:le.card.ownerId,name:le.card.name,imageUrl:le.card.imageUrl,power:le.card.power,ability:le.card.ability,isFaceDown:le.card.isFaceDown,statuses:le.card.statuses||[]}:null}))),S=z=>z.map(le=>({id:le.id,baseId:le.baseId,name:le.name,imageUrl:le.imageUrl,power:le.power,powerModifier:le.powerModifier,ability:le.ability,ownerId:le.ownerId,color:le.color,deck:le.deck,isFaceDown:le.isFaceDown,types:le.types,faction:le.faction,statuses:le.statuses}));return O.current.acceptGuestMinimal(u,{playerId:b,gameId:T.gameId,isGameStarted:T.isGameStarted,players:g.players.map(z=>z.isDummy?{id:z.id,name:z.name,color:z.color,isDummy:z.isDummy,isReady:z.isReady,score:z.score,selectedDeck:z.selectedDeck,hand:S(z.hand||[]),deck:S(z.deck||[]),discard:S(z.discard||[]),handSize:z.hand.length,deckSize:z.deck.length,discardSize:z.discard.length}:{id:z.id,name:z.name,color:z.color,isDummy:z.isDummy,isReady:z.isReady,score:z.score,selectedDeck:z.selectedDeck,deckSize:z.deck.length,handSize:z.hand.length,discardSize:z.discard.length}),deckSelections:g.players.map(z=>({id:z.id,selectedDeck:z.selectedDeck})),gameMode:T.gameMode,currentRound:T.currentRound,currentPhase:T.currentPhase,activePlayerId:T.activePlayerId,startingPlayerId:T.startingPlayerId,activeGridSize:T.activeGridSize,board:N},b),O.current.broadcastToGuests({type:"SYNC_DECK_SELECTIONS",senderId:O.current.getPeerId(),data:{playerId:b,selectedDeck:"Random"},timestamp:Date.now()}),g})},[]),ht=m.useCallback(u=>{const T={...u,players:u.players.map(p=>{if(p.isDummy||!1){const g=N=>N.map(S=>({id:S.id,baseId:S.baseId,name:S.name,imageUrl:S.imageUrl,power:S.power,powerModifier:S.powerModifier,ability:S.ability,ownerId:S.ownerId,color:S.color,deck:S.deck,isFaceDown:S.isFaceDown,types:S.types,faction:S.faction,statuses:S.statuses}));return{id:p.id,name:p.name,color:p.color,isDummy:!0,isReady:p.isReady,score:p.score,isDisconnected:p.isDisconnected,selectedDeck:p.selectedDeck,autoDrawEnabled:p.autoDrawEnabled,boardHistory:p.boardHistory,announcedCard:null,hand:g(p.hand||[]),deck:g(p.deck||[]),discard:g(p.discard||[]),handSize:p.hand.length,deckSize:p.deck.length,discardSize:p.discard.length}}return{id:p.id,name:p.name,color:p.color,isDummy:p.isDummy,isReady:p.isReady,score:p.score,isDisconnected:p.isDisconnected,selectedDeck:p.selectedDeck,autoDrawEnabled:p.autoDrawEnabled,boardHistory:p.boardHistory,announcedCard:null,hand:[],deck:[],discard:[],handSize:p.handSize??p.hand.length,deckSize:p.deckSize??p.deck.length,discardSize:p.discardSize??p.discard.length}})};return T.board=u.board.map(p=>p.map(b=>({...b,card:b.card?{id:b.card.id,baseId:b.card.baseId,ownerId:b.card.ownerId,name:b.card.name,imageUrl:b.card.imageUrl,power:b.card.power,ability:b.card.ability,isFaceDown:b.card.isFaceDown}:null}))),T},[]),Fe=m.useCallback(u=>{const T=Z.current;if(P.info(`[broadcastWebrtcState] Called: webrtcManagerRef.current=${!!O.current}, webrtcIsHostRef.current=${T}`),!O.current||!T){P.warn("[broadcastWebrtcState] Skipping broadcast: manager or isHost missing");return}const p=ht(u,!0);O.current.broadcastGameState(p)},[ht]),se=m.useCallback(u=>{var T,p,b,I,g,N,S,z,le,Xe,Et,wt,ft,Qt,Vt,gt,st,dt,ge,Ne,Ge,rt,Ve,Ut,Jt,Kt,Gr,co,ea,ji,Pi,Ni,Ai,as,os,_n,Oi,Li,Mi,zi,$i,Gi;if(!(!u||!u.type))switch(P.info(`[handleWebrtcMessage] Received: ${u.type}`),u.type){case"JOIN_ACCEPT_MINIMAL":if(P.info(`[handleWebrtcMessage] Received JOIN_ACCEPT_MINIMAL, playerId: ${u.playerId}`),u.data){const G=u.data;P.info(`[handleWebrtcMessage] Creating minimal state with ${((T=G.players)==null?void 0:T.length)||0} players`);const W={gameId:G.gameId||Dh(),isGameStarted:G.isGameStarted||!1,isPrivate:!1,activeGridSize:G.activeGridSize||4,gameMode:G.gameMode||Kr.FreeForAll,dummyPlayerCount:0,players:((p=G.players)==null?void 0:p.map(oe=>{if((oe.isDummy||!1)&&oe.hand&&oe.deck&&oe.discard)return{id:oe.id,name:oe.name,color:oe.color,isDummy:!0,isReady:oe.isReady||!1,score:oe.score||0,hand:oe.hand||[],deck:oe.deck||[],discard:oe.discard||[],announcedCard:null,selectedDeck:oe.selectedDeck||"Random",boardHistory:[],autoDrawEnabled:!0};const pe=[],Ye=[],yt=[];for(let qe=0;qe<(oe.handSize||0);qe++)pe.push({id:`placeholder_${oe.id}_hand_${qe}`,name:"?",isPlaceholder:!0,ownerId:oe.id,deck:oe.selectedDeck||"Random",color:oe.color});for(let qe=0;qe<(oe.deckSize||0);qe++)Ye.push({id:`placeholder_${oe.id}_deck_${qe}`,name:"?",isPlaceholder:!0,ownerId:oe.id,deck:oe.selectedDeck||"Random",color:oe.color});for(let qe=0;qe<(oe.discardSize||0);qe++)yt.push({id:`placeholder_${oe.id}_discard_${qe}`,name:"?",isPlaceholder:!0,ownerId:oe.id,deck:oe.selectedDeck||"Random",color:oe.color});return{id:oe.id,name:oe.name,color:oe.color,isDummy:!1,isReady:oe.isReady||!1,score:oe.score||0,hand:pe,deck:Ye,discard:yt,announcedCard:null,selectedDeck:oe.selectedDeck||"Random",boardHistory:[],autoDrawEnabled:!0}}))||[],board:G.board||yh(),hostId:1,currentPhase:G.currentPhase??0,isScoringStep:!1,preserveDeployAbilities:!1,autoAbilitiesEnabled:!0,autoDrawEnabled:!0,currentRound:G.currentRound||1,turnNumber:G.turnNumber||1,activePlayerId:G.activePlayerId??null,startingPlayerId:G.startingPlayerId??null,roundEndTriggered:!1,roundWinners:{},gameWinner:null,isRoundEndModalOpen:!1,floatingTexts:[],highlights:[],deckSelections:[],handCardSelections:[],targetingMode:null,spectators:[],revealRequests:[],isReadyCheckActive:!1,localPlayerId:null,isSpectator:!1};l(W),u.playerId!==void 0&&(h(u.playerId),P.info(`[handleWebrtcMessage] Set local player ID to ${u.playerId}`)),l(oe=>{const tt=oe.players.map(pe=>{var yt;const Ye=(yt=G.players)==null?void 0:yt.find(qe=>qe.id===pe.id);if(pe.id===u.playerId){const Yt=pe.deck.length===0||pe.deck.some(Mn=>Mn.isPlaceholder)||pe.deck.length!==30;if(Ye!=null&&Ye.selectedDeck&&Yt){const Mn=r(Ye.selectedDeck,pe.id,pe.name);P.info(`[JOIN_ACCEPT_MINIMAL] Created local deck with ${Mn.length} cards from ${Ye.selectedDeck}`);const Dn=[...pe.hand],sn=[...Mn];if(G.isGameStarted&&Dn.length===0&&sn.length>0){for(let Rn=0;Rn<6&&Rn<sn.length;Rn++){const Rr=sn[0];sn.splice(0,1),Dn.push(Rr)}P.info(`[JOIN_ACCEPT_MINIMAL] Drew ${Dn.length} cards, deck now has ${sn.length} cards`)}return{...pe,deck:sn,hand:Dn,selectedDeck:Ye.selectedDeck}}}return pe});return{...oe,players:tt}});const ce=W.players.find(oe=>oe.id===u.playerId);ce&&O.current&&(O.current.sendAction("CHANGE_PLAYER_DECK",{playerId:u.playerId,deckType:ce.selectedDeck}),P.info(`[JOIN_ACCEPT_MINIMAL] Sent deck selection to host: ${ce.selectedDeck}`));try{const oe=(b=O.current)==null?void 0:b.getHostPeerId();oe&&hh({hostPeerId:oe,playerId:u.playerId,playerName:(ce==null?void 0:ce.name)||null,isHost:!1})}catch(oe){P.warn("[JOIN_ACCEPT_MINIMAL] Failed to save guest data:",oe)}}break;case"JOIN_ACCEPT":if(P.info(`[handleWebrtcMessage] Received JOIN_ACCEPT, playerId: ${u.playerId}, hasState: ${!!((I=u.data)!=null&&I.gameState)}`),(g=u.data)!=null&&g.gameState){const G=u.data.gameState;if(P.info(`[handleWebrtcMessage] Setting game state with ${((N=G.players)==null?void 0:N.length)||0} players`),l(G),u.playerId!==void 0){h(u.playerId),P.info(`[handleWebrtcMessage] Set local player ID to ${u.playerId}`);try{const W=(S=O.current)==null?void 0:S.getHostPeerId(),ce=G.players.find(oe=>oe.id===u.playerId);W&&hh({hostPeerId:W,playerId:u.playerId,playerName:(ce==null?void 0:ce.name)||null,isHost:!1})}catch(W){P.warn("[JOIN_ACCEPT] Failed to save guest data:",W)}}}break;case"STATE_UPDATE":if(ve.current=!0,(z=u.data)!=null&&z.gameState){const G=u.data.gameState;if(We.current){l(W=>({...W,currentPhase:G.currentPhase,activePlayerId:G.activePlayerId,startingPlayerId:G.startingPlayerId,isReadyCheckActive:G.isReadyCheckActive,isGameStarted:G.isGameStarted}));return}l(W=>{var tt;const ce=G.players.map(pe=>{var yt,qe,Yt,Mn;const Ye=W.players.find(Dn=>Dn.id===pe.id);if(pe.id===we.current&&Ye){const Dn=Ye.hand.every(zn=>zn.isPlaceholder)||Ye.hand.length===0,sn=pe.handSize??((yt=pe.hand)==null?void 0:yt.length)??0;if(pe.deckSize??((qe=pe.deck)==null||qe.length),Dn&&pe.hand&&pe.hand.length>0)return{...pe,hand:pe.hand,deck:pe.deck||Ye.deck,discard:pe.discard||Ye.discard};{let zn=Ye.hand,Rn=Ye.deck;if(sn>Ye.hand.length&&Rn.length>0){const Rr=sn-Ye.hand.length,Jn=[...Ye.hand],Pa=[...Ye.deck];for(let uo=0;uo<Rr&&uo<Pa.length;uo++){const Fi=Pa[0];Pa.splice(0,1),Jn.push(Fi)}zn=Jn,Rn=Pa}return{...pe,hand:zn,deck:Rn,discard:pe.discard||Ye.discard}}}else{if(pe.isDummy||!1)return P.info(`[STATE_UPDATE] Using real cards for dummy player ${pe.id}`),{...pe,hand:pe.hand||[],deck:pe.deck||[],discard:pe.discard||[]};const sn=pe.deckSize??((Yt=pe.deck)==null?void 0:Yt.length)??0,zn=pe.handSize??((Mn=pe.hand)==null?void 0:Mn.length)??0;P.info(`[STATE_UPDATE] Player ${pe.id}: deckSize=${sn}, handSize=${zn}`);const Rn=[];for(let Jn=0;Jn<sn;Jn++)Rn.push({id:`placeholder_${pe.id}_deck_${Jn}`,name:"?",isPlaceholder:!0,ownerId:pe.id,deck:pe.selectedDeck||"Random",color:pe.color});const Rr=[];for(let Jn=0;Jn<zn;Jn++)Rr.push({id:`placeholder_${pe.id}_hand_${Jn}`,name:"?",isPlaceholder:!0,ownerId:pe.id,deck:pe.selectedDeck||"Random",color:pe.color});return P.info(`[STATE_UPDATE] Created ${Rn.length} deck placeholders and ${Rr.length} hand placeholders for player ${pe.id}`),{...pe,hand:Rr,deck:Rn,discard:pe.discard||[]}}}),oe={...G,players:ce};if(!Z.current)try{((tt=O.current)==null?void 0:tt.getHostPeerId())&&we.current!==null&&(bd({gameState:oe,localPlayerId:we.current,isHost:!1}),P.debug("[STATE_UPDATE] Saved merged state for guest auto-restore"))}catch(pe){P.warn("[STATE_UPDATE] Failed to persist guest state:",pe)}return oe})}break;case"STATE_DELTA":if(Z.current||(ve.current=!0),P.info(`[STATE_DELTA] Received STATE_DELTA message, isHost: ${Z.current}, senderId: ${u.senderId}`),(le=u.data)!=null&&le.delta){const G=u.data.delta;P.info(`[STATE_DELTA] Delta: playerDeltas=${Object.keys(G.playerDeltas||{}).length}, boardCells=${((Xe=G.boardCells)==null?void 0:Xe.length)||0}, phaseDelta=${!!G.phaseDelta}`),G.boardCells&&G.boardCells.length>0&&G.boardCells.forEach(W=>{var ce,oe;P.info(`[STATE_DELTA] Board cell [${W.row},${W.col}]: card=${((ce=W.card)==null?void 0:ce.name)||"(empty)"}, owner=${(oe=W.card)==null?void 0:oe.ownerId}`)}),Z.current&&u.senderId&&O.current&&(P.info(`[STATE_DELTA] Host rebroadcasting delta from guest ${u.senderId} to other guests`),O.current.broadcastStateDelta(G,u.senderId)),G.phaseDelta&&P.info("[STATE_DELTA] phaseDelta:",JSON.stringify(G.phaseDelta)),G.playerDeltas&&Object.entries(G.playerDeltas).forEach(([W,ce])=>{P.info(`[STATE_DELTA] Player ${W} delta: handSizeDelta=${ce.handSizeDelta}, deckSizeDelta=${ce.deckSizeDelta}`)}),l(W=>{const ce=we.current||W.localPlayerId;P.info(`[STATE_DELTA] Applying delta with localPlayerId=${ce}, currentPhase before=${W.currentPhase}`);const oe=_h(W,G,ce);P.info(`[STATE_DELTA] Applying delta with localPlayerId=${ce}, currentPhase after=${oe.currentPhase}`);try{oe.gameId&&ce!==null&&(bd({gameState:oe,localPlayerId:ce,isHost:Z.current}),P.debug(`[STATE_DELTA] Saved state for ${Z.current?"host":"guest"} auto-restore`))}catch(tt){P.warn("[STATE_DELTA] Failed to persist state:",tt)}return oe})}break;case"JOIN_REQUEST":P.info(`[handleWebrtcMessage] Received JOIN_REQUEST, senderId: ${u.senderId}, isHost: ${Z.current}`),Z.current&&u.senderId?(P.info(`Host received JOIN_REQUEST from ${u.senderId}`),Wt(u.senderId)):P.warn(`[handleWebrtcMessage] Cannot process JOIN_REQUEST - isHost: ${Z.current}, senderId: ${u.senderId}`);break;case"ACTION":if(Z.current&&u.data){const{actionType:G,actionData:W}=u.data;if(G==="STATE_UPDATE"&&(W!=null&&W.gameState)){if(We.current){O.current&&u.senderId&&O.current.sendToGuest(u.senderId,{type:"STATE_UPDATE",senderId:O.current.getPeerId(),data:{gameState:ue.current},timestamp:Date.now()});break}l(ce=>{const oe=W.gameState,tt=oe.players.map(Ye=>{const yt=ce.players.find(qe=>qe.id===Ye.id);return yt&&Ye.id!==we.current?{...Ye,deck:yt.deck||Ye.deck,discard:yt.discard||Ye.discard,score:yt.score}:Ye}),pe={...oe,players:tt};return O.current&&O.current.broadcastToGuests({type:"STATE_UPDATE",senderId:O.current.getPeerId(),data:{gameState:pe},timestamp:Date.now()}),pe})}else G==="STATE_DELTA"&&(W!=null&&W.delta)?l(ce=>{const oe=W.delta;let tt=oe;We.current&&oe.playerDeltas&&(tt={...oe,playerDeltas:Object.fromEntries(Object.entries(oe.playerDeltas).map(([yt,qe])=>{const Yt={...qe};return delete Yt.scoreDelta,[yt,Yt]}))});const pe=we.current||ce.localPlayerId,Ye=_h(ce,tt,pe);return O.current&&O.current.broadcastStateDelta(tt),Ye}):G==="NEXT_PHASE"?l(ce=>{const oe=ce,tt=oe.currentPhase,pe=tt===2&&!oe.isScoringStep,Ye=tt+1;return{...oe,currentPhase:Ye,...pe&&{isScoringStep:!0}}}):G==="PREV_PHASE"?l(ce=>{const oe=ce;return oe.isScoringStep?{...oe,isScoringStep:!1,currentPhase:Math.max(1,oe.currentPhase-1)}:{...oe,currentPhase:Math.max(1,oe.currentPhase-1)}}):G==="SET_PHASE"&&(W==null?void 0:W.phaseIndex)!==void 0?l(ce=>({...ce,currentPhase:W.phaseIndex})):G==="UPDATE_PLAYER_NAME"&&(W==null?void 0:W.playerId)!==void 0&&(W==null?void 0:W.name)!==void 0?l(ce=>({...ce,players:ce.players.map(oe=>oe.id===W.playerId?{...oe,name:W.name}:oe)})):G==="CHANGE_PLAYER_COLOR"&&(W==null?void 0:W.playerId)!==void 0&&(W==null?void 0:W.color)!==void 0?l(ce=>({...ce,players:ce.players.map(oe=>oe.id===W.playerId?{...oe,color:W.color}:oe)})):G==="UPDATE_PLAYER_SCORE"&&(W==null?void 0:W.playerId)!==void 0&&(W==null?void 0:W.delta)!==void 0?l(ce=>({...ce,players:ce.players.map(oe=>oe.id===W.playerId?{...oe,score:Math.max(0,oe.score+W.delta)}:oe)})):G==="CHANGE_PLAYER_DECK"&&(W==null?void 0:W.playerId)!==void 0&&(W==null?void 0:W.deckType)!==void 0?l(ce=>{const oe=ce.players.find(pe=>pe.id===W.playerId);if(!oe)return ce;const tt=r(W.deckType,W.playerId,oe.name);return P.info(`[CHANGE_PLAYER_DECK] Host created deck for player ${W.playerId} with ${tt.length} cards from ${W.deckType}`),{...ce,players:ce.players.map(pe=>pe.id===W.playerId?{...pe,selectedDeck:W.deckType,deck:tt}:pe)}}):G==="TOGGLE_ACTIVE_PLAYER"&&(W==null?void 0:W.playerId)!==void 0?l(ce=>{if(!ce.players.find(pe=>pe.id===W.playerId))return ce;const tt=Sh(ce,W.playerId);if(O.current){const pe=ul(ce,tt,W.playerId);O.current.broadcastStateDelta(pe)}return tt}):G==="TOGGLE_AUTO_DRAW"&&(W==null?void 0:W.playerId)!==void 0?l(ce=>({...ce,players:ce.players.map(oe=>oe.id===W.playerId?{...oe,autoDrawEnabled:!oe.autoDrawEnabled}:oe)})):G==="START_NEXT_ROUND"?l(ce=>({...ce,isRoundEndModalOpen:!1,currentRound:(ce.currentRound||1)+1,players:ce.players.map(oe=>({...oe,score:0}))})):G==="RESET_DEPLOY_STATUS"?l(ce=>{const oe=ce.board.map(tt=>tt.map(pe=>{var Ye;return(Ye=pe.card)!=null&&Ye.statuses?{...pe,card:{...pe.card,statuses:pe.card.statuses.filter(yt=>yt.type!=="DeployAbilityUsed")}}:pe}));return{...ce,board:oe,preserveDeployAbilities:!1}}):P.warn(`[ACTION] Unknown action type: ${G}`)}break;case"PLAYER_LEAVE":break;case"PLAYER_RECONNECT":if(P.info(`[PLAYER_RECONNECT] Guest ${u.playerId} reconnecting from ${u.senderId}`),Z.current&&u.playerId!==void 0&&u.senderId){const G=ue.current;P.info(`[PLAYER_RECONNECT] Current state: hasGameId=${!!(G!=null&&G.gameId)}, gameId=${G==null?void 0:G.gameId}, hasPlayers=${((Et=G==null?void 0:G.players)==null?void 0:Et.length)||0}`),G&&G.gameId?(P.info(`[PLAYER_RECONNECT] Sending current state to reconnecting player ${u.playerId}`),(wt=O.current)==null||wt.sendToGuest(u.senderId,{type:"STATE_UPDATE",senderId:O.current.getPeerId(),data:{gameState:G},timestamp:Date.now()})):P.warn("[PLAYER_RECONNECT] No valid game state to send")}break;case"START_READY_CHECK":(((ft=u.data)==null?void 0:ft.isReadyCheckActive)!==void 0||((Qt=u.data)==null?void 0:Qt.isPrivate)!==void 0)&&l(G=>({...G,isReadyCheckActive:u.data.isReadyCheckActive??!0,isPrivate:u.data.isPrivate??!0}));break;case"CANCEL_READY_CHECK":((Vt=u.data)==null?void 0:Vt.isReadyCheckActive)!==void 0&&l(G=>({...G,isReadyCheckActive:u.data.isReadyCheckActive}));break;case"PLAYER_READY":Z.current&&u.playerId!==void 0&&l(G=>{const W=G.players.map(pe=>pe.id===u.playerId?{...pe,isReady:!0}:pe),ce={...G,players:W};P.info(`Player ${u.playerId} is ready via WebRTC`);const oe=ce.players.filter(pe=>!pe.isDummy&&!pe.isDisconnected);if(oe.length>0&&oe.every(pe=>pe.isReady)&&ce.isReadyCheckActive&&!ce.isGameStarted){const pe=ce.players.filter(Yt=>!Yt.isDisconnected),Ye=Math.floor(Math.random()*pe.length),yt=pe[Ye].id;let qe={...ce};return qe.isReadyCheckActive=!1,qe.isGameStarted=!0,qe.startingPlayerId=yt,qe.activePlayerId=yt,qe.currentPhase=0,qe.players=qe.players.map(Yt=>{if(Yt.hand.length===0&&Yt.deck.length>0){const Dn=[...Yt.hand],sn=[...Yt.deck];for(let zn=0;zn<6&&zn<sn.length;zn++){const Rn=sn[0];sn.splice(0,1),Dn.push(Rn)}return P.info(`[PLAYER_READY] Drew ${Dn.length} cards for player ${Yt.id}`),{...Yt,hand:Dn,deck:sn}}return Yt}),qe=Vf(qe,yt),P.info(`[PLAYER_READY] Preparation phase completed, currentPhase=${qe.currentPhase}`),O.current&&(O.current.broadcastToGuests({type:"GAME_START",senderId:O.current.getPeerId(),data:{startingPlayerId:yt,activePlayerId:yt,isGameStarted:!0,isReadyCheckActive:!1},timestamp:Date.now()}),setTimeout(()=>{var Yt,Mn;P.info(`[PLAYER_READY] Broadcasting state, player sizes: P1 deck=${(Yt=qe.players[0])==null?void 0:Yt.deck.length}, hand=${(Mn=qe.players[0])==null?void 0:Mn.hand.length}`),P.info(`[PLAYER_READY] Broadcasting state with currentPhase=${qe.currentPhase}`),Fe(qe)},100)),qe}return ce});break;case"ASSIGN_TEAMS":(gt=u.data)!=null&&gt.assignments&&l(G=>{const W=G.players.map(ce=>{let oe=ce.teamId||1;for(const[tt,pe]of Object.entries(u.data.assignments))if(pe.includes(ce.id)){oe=parseInt(tt);break}return{...ce,teamId:oe}});return{...G,players:W}});break;case"SET_GAME_MODE":((st=u.data)==null?void 0:st.mode)!==void 0&&l(G=>({...G,gameMode:u.data.mode}));break;case"SET_GAME_PRIVACY":((dt=u.data)==null?void 0:dt.isPrivate)!==void 0&&l(G=>({...G,isPrivate:u.data.isPrivate}));break;case"SET_GRID_SIZE":((ge=u.data)==null?void 0:ge.size)!==void 0&&l(G=>{const W=u.data.size,ce=[];for(let oe=0;oe<W;oe++){const tt=[];for(let pe=0;pe<W;pe++)tt.push({card:null});ce.push(tt)}return{...G,activeGridSize:W,board:ce}});break;case"SET_DUMMY_PLAYER_COUNT":((Ne=u.data)==null?void 0:Ne.count)!==void 0&&l(G=>({...G,dummyPlayerCount:u.data.count}));break;case"HOST_READY":u.playerId!==void 0&&(P.info(`[handleWebrtcMessage] Host (player ${u.playerId}) is ready`),l(G=>{const W=G.players.map(ce=>ce.id===u.playerId?{...ce,isReady:!0}:ce);return{...G,players:W}}));break;case"GAME_START":ve.current=!0,P.info("[handleWebrtcMessage] Game starting!",u.data),ue.current&&(P.info(`[GAME_START] Current phase before: ${ue.current.currentPhase}`),ue.current.players.forEach(G=>{P.info(`[GAME_START] Before: Player ${G.id} - deck: ${G.deck.length}, hand: ${G.hand.length}`)})),u.data&&l(G=>{P.info(`[GAME_START] Processing for localPlayerId=${we.current}`),G.players.forEach(tt=>{P.info(`[GAME_START] Player ${tt.id} before: deck=${tt.deck.length}, hand=${tt.hand.length}`)});const W=u.data.startingPlayerId??u.data.activePlayerId,ce={...G,isGameStarted:u.data.isGameStarted??!0,isReadyCheckActive:!1,startingPlayerId:W,activePlayerId:u.data.activePlayerId,currentPhase:G.currentPhase},oe=ce.players.find(tt=>tt.id===we.current);if(oe&&oe.hand.length===0&&oe.deck.length>0){const pe=[...oe.hand],Ye=[...oe.deck];for(let yt=0;yt<6&&yt<Ye.length;yt++){const qe=Ye[0];Ye.splice(0,1),pe.push(qe)}ce.players=ce.players.map(yt=>yt.id===we.current?{...yt,hand:pe,deck:Ye}:yt),P.info(`[GAME_START] Drew ${pe.length} cards for local player ${we.current}, deck now has ${Ye.length} cards`)}return ce.players.forEach(tt=>{P.info(`[GAME_START] Player ${tt.id} after: deck=${tt.deck.length}, hand=${tt.hand.length}`)}),P.info(`[GAME_START] Final state: currentPhase=${ce.currentPhase}, activePlayerId=${ce.activePlayerId}, startingPlayerId=${ce.startingPlayerId}`),ce});break;case"ACTIVE_PLAYER_CHANGED":P.info("[handleWebrtcMessage] Active player changed!",u.data),u.data&&l(G=>{const W={...G,activePlayerId:u.data.activePlayerId};if(u.data.currentPhase!==void 0&&(W.currentPhase=u.data.currentPhase),u.data.turnNumber!==void 0&&(W.turnNumber=u.data.turnNumber),W.currentPhase===0&&W.activePlayerId===we.current){const ce=W.players.find(oe=>oe.id===we.current);if(ce&&ce.deck.length>0){const oe=ce.deck[0],tt=[...ce.deck.slice(1)],pe=[...ce.hand,oe];W.players=W.players.map(Ye=>Ye.id===we.current?{...Ye,deck:tt,hand:pe}:Ye)}W.currentPhase=1}return W});break;case"SYNC_DECK_SELECTIONS":P.info("[SYNC_DECK_SELECTIONS] Received deck selection sync",u.data),u.data&&l(G=>u.data.playerId!==void 0&&u.data.selectedDeck!==void 0?{...G,players:G.players.map(W=>W.id===u.data.playerId?{...W,selectedDeck:u.data.selectedDeck}:W)}:u.data.deckSelections&&Array.isArray(u.data.deckSelections)?{...G,players:G.players.map(W=>{const ce=u.data.deckSelections.find(oe=>oe.id===W.id);return ce?{...W,selectedDeck:ce.selectedDeck}:W})}:G);break;case"CHANGE_PLAYER_DECK":P.info("[CHANGE_PLAYER_DECK] Received deck change",u.data),Z.current&&u.data?(l(G=>{const W=G.players.find(oe=>oe.id===u.data.playerId);if(!W)return G;const ce=r(u.data.deckType,u.data.playerId,W.name);return P.info(`[CHANGE_PLAYER_DECK] Host created deck for player ${u.data.playerId} with ${ce.length} cards from ${u.data.deckType}`),{...G,players:G.players.map(oe=>oe.id===u.data.playerId?{...oe,selectedDeck:u.data.deckType,deck:ce}:oe)}}),O.current&&O.current.broadcastToGuests({type:"CHANGE_PLAYER_DECK",senderId:O.current.getPeerId(),data:u.data,timestamp:Date.now()})):l(G=>({...G,players:G.players.map(W=>W.id===u.data.playerId?{...W,selectedDeck:u.data.deckType}:W)}));break;case"GAME_RESET":l(G=>{const W=u.data.activeGridSize||8,ce=[];for(let pe=0;pe<W;pe++){const Ye=[];for(let yt=0;yt<W;yt++)Ye.push({card:null});ce.push(Ye)}const oe=(u.data.players||[]).map(pe=>{if(pe.isDummy&&pe.hand&&pe.deck&&pe.discard)return{...pe,boardHistory:[]};{const Ye=pe.selectedDeck||"SynchroTech";return{...pe,hand:[],deck:r(Ye,pe.id,pe.name),discard:[],boardHistory:[]}}}),tt={...G,players:oe,gameMode:u.data.gameMode,isPrivate:u.data.isPrivate,activeGridSize:u.data.activeGridSize,dummyPlayerCount:u.data.dummyPlayerCount,autoAbilitiesEnabled:u.data.autoAbilitiesEnabled,isGameStarted:u.data.isGameStarted,currentPhase:u.data.currentPhase,currentRound:u.data.currentRound,turnNumber:u.data.turnNumber,activePlayerId:u.data.activePlayerId,startingPlayerId:u.data.startingPlayerId,roundWinners:u.data.roundWinners||{},gameWinner:u.data.gameWinner,isRoundEndModalOpen:u.data.isRoundEndModalOpen,isReadyCheckActive:u.data.isReadyCheckActive,board:ce,targetingMode:null,floatingTexts:[]};return ue.current=tt,tt});break;case"ABILITY_MODE_SET":(Ge=u.data)!=null&&Ge.abilityMode&&(l(G=>({...G,abilityMode:u.data.abilityMode})),P.info("[AbilityMode] Received ability mode from host",{playerId:u.data.abilityMode.playerId,mode:u.data.abilityMode.mode}));break;case"ABILITY_TARGET_SELECTED":P.info("[Ability] Target selected",u.data);break;case"ABILITY_COMPLETED":l(G=>({...G,abilityMode:null})),P.info("[Ability] Ability completed",u.data);break;case"ABILITY_CANCELLED":l(G=>({...G,abilityMode:null}));break;case"TRIGGER_HIGHLIGHT":if((rt=u.data)!=null&&rt.highlightData){const G=u.data.highlightData;k(G),Z.current&&O.current&&u.senderId&&O.current.broadcastToGuests({type:"HIGHLIGHT_TRIGGERED",senderId:u.senderId,data:G,timestamp:Date.now()},u.senderId)}break;case"HIGHLIGHT_TRIGGERED":if(u.data){const G=(Ve=O.current)==null?void 0:Ve.getPeerId();u.senderId!==G&&k(u.data)}break;case"TRIGGER_FLOATING_TEXT":if((Ut=u.data)!=null&&Ut.textData){const G=u.data.textData;l(W=>({...W,floatingTexts:[...W.floatingTexts,G].filter(ce=>Date.now()-ce.timestamp<nt.FLOATING_TEXT_DURATION)})),Z.current&&O.current&&u.senderId&&O.current.broadcastToGuests({type:"FLOATING_TEXT_TRIGGERED",senderId:u.senderId,data:G,timestamp:Date.now()},u.senderId)}break;case"TRIGGER_FLOATING_TEXT_BATCH":if((Jt=u.data)!=null&&Jt.batch){const G=u.data.batch;l(W=>({...W,floatingTexts:[...W.floatingTexts,...G].filter(ce=>Date.now()-ce.timestamp<nt.FLOATING_TEXT_DURATION)})),Z.current&&O.current&&u.senderId&&O.current.broadcastToGuests({type:"FLOATING_TEXT_BATCH_TRIGGERED",senderId:u.senderId,data:{batch:G},timestamp:Date.now()},u.senderId)}break;case"FLOATING_TEXT_TRIGGERED":case"FLOATING_TEXT_BATCH_TRIGGERED":const Ui=(Kt=O.current)==null?void 0:Kt.getPeerId();(Gr=u.data)!=null&&Gr.batch&&u.senderId!==Ui?l(G=>({...G,floatingTexts:[...G.floatingTexts,...u.data.batch].filter(W=>Date.now()-W.timestamp<nt.FLOATING_TEXT_DURATION)})):(co=u.data)!=null&&co.textData&&u.senderId!==Ui&&l(G=>({...G,floatingTexts:[...G.floatingTexts,u.data.textData].filter(W=>Date.now()-W.timestamp<nt.FLOATING_TEXT_DURATION)}));break;case"TRIGGER_NO_TARGET":if((ea=u.data)!=null&&ea.coords){const G=u.data.coords,W=u.data.timestamp;M({coords:G,timestamp:W}),Z.current&&O.current&&u.senderId&&O.current.broadcastToGuests({type:"NO_TARGET_TRIGGERED",senderId:u.senderId,data:{coords:G,timestamp:W},timestamp:Date.now()},u.senderId)}break;case"NO_TARGET_TRIGGERED":if((ji=u.data)!=null&&ji.coords){const G=(Pi=O.current)==null?void 0:Pi.getPeerId();u.senderId!==G&&M({coords:u.data.coords,timestamp:u.data.timestamp})}break;case"TRIGGER_DECK_SELECTION":if(u.data){const G=u.data;ee(W=>[...W,G]),setTimeout(()=>{ee(W=>W.filter(ce=>ce.timestamp!==G.timestamp))},1e3),Z.current&&O.current&&u.senderId&&O.current.broadcastToGuests({type:"DECK_SELECTION_TRIGGERED",senderId:u.senderId,data:G,timestamp:Date.now()},u.senderId)}break;case"TRIGGER_HAND_CARD_SELECTION":if(u.data){const G=u.data;Ie(W=>[...W,G]),setTimeout(()=>{Ie(W=>W.filter(ce=>ce.timestamp!==G.timestamp))},1e3),Z.current&&O.current&&u.senderId&&O.current.broadcastToGuests({type:"HAND_CARD_SELECTION_TRIGGERED",senderId:u.senderId,data:G,timestamp:Date.now()},u.senderId)}break;case"TRIGGER_TARGET_SELECTION":if(u.data){const G=u.data;fe(W=>[...W,G]),setTimeout(()=>{fe(W=>W.filter(ce=>ce.timestamp!==G.timestamp))},1e3),Z.current&&O.current&&u.senderId&&O.current.broadcastToGuests({type:"TARGET_SELECTION_TRIGGERED",senderId:u.senderId,data:G,timestamp:Date.now()},u.senderId)}break;case"TARGET_SELECTION_TRIGGERED":u.data&&u.senderId!==((Ni=O.current)==null?void 0:Ni.getPeerId())&&(fe(G=>[...G,u.data]),setTimeout(()=>{fe(G=>G.filter(W=>W.timestamp!==u.data.timestamp))},1e3));break;case"DECK_SELECTION_TRIGGERED":u.data&&u.senderId!==((Ai=O.current)==null?void 0:Ai.getPeerId())&&(ee(G=>[...G,u.data]),setTimeout(()=>{ee(G=>G.filter(W=>W.timestamp!==u.data.timestamp))},1e3));break;case"HAND_CARD_SELECTION_TRIGGERED":u.data&&u.senderId!==((as=O.current)==null?void 0:as.getPeerId())&&(Ie(G=>[...G,u.data]),setTimeout(()=>{Ie(G=>G.filter(W=>W.timestamp!==u.data.timestamp))},1e3));break;case"SET_TARGETING_MODE":if((os=u.data)!=null&&os.targetingMode){const G=u.data.targetingMode;l(W=>({...W,targetingMode:G})),ue.current.targetingMode=G,P.info("[TargetingMode] Received targeting mode via WebRTC",{playerId:G.playerId,mode:G.action.mode})}break;case"CLEAR_TARGETING_MODE":l(G=>({...G,targetingMode:null})),ue.current.targetingMode=null;break;case"SYNC_VALID_TARGETS":((_n=u.data)==null?void 0:_n.playerId)!==we.current&&(ke({playerId:u.data.playerId,validHandTargets:u.data.validHandTargets||[],isDeckSelectable:u.data.isDeckSelectable||!1}),setTimeout(()=>{ke(G=>(G==null?void 0:G.playerId)===u.data.playerId?null:G)},1e4));break;case"RECONNECT_ACCEPT":if((Oi=u.data)!=null&&Oi.gameState){const G=u.data.gameState;l(G),C("Connected"),P.info(`[Reconnection] State restored with ${((Li=G.players)==null?void 0:Li.length)||0} players`);try{localStorage.removeItem("webrtc_reconnection_data")}catch(W){P.warn("[Reconnection] Failed to clear stored data:",W)}}break;case"RECONNECT_REJECT":{const G=((Mi=u.data)==null?void 0:Mi.reason)||"unknown";P.warn(`[Reconnection] Reconnection rejected: ${G}`),C("Disconnected");try{localStorage.removeItem("webrtc_reconnection_data")}catch{}break}case"PLAYER_DISCONNECTED":((zi=u.data)==null?void 0:zi.playerId)!==void 0&&(P.info(`[Reconnection] Player ${u.data.playerId} disconnected, reconnection window open`),l(G=>({...G,players:G.players.map(W=>W.id===u.data.playerId?{...W,isDisconnected:!0}:W)})));break;case"PLAYER_RECONNECTED":(($i=u.data)==null?void 0:$i.playerId)!==void 0&&(P.info(`[Reconnection] Player ${u.data.playerId} reconnected`),l(G=>({...G,players:G.players.map(W=>W.id===u.data.playerId?{...W,isDisconnected:!1}:W)})));break;case"PLAYER_CONVERTED_TO_DUMMY":((Gi=u.data)==null?void 0:Gi.playerId)!==void 0&&(P.info(`[Reconnection] Player ${u.data.playerId} converted to dummy`),l(G=>({...G,players:G.players.map(W=>W.id===u.data.playerId?{...W,isDummy:!0,isDisconnected:!0}:W)})));break;default:P.warn(`[handleWebrtcMessage] Unknown message type: ${u.type}`,u);break}},[de,r,Fe,s,f]),Q=m.useCallback(u=>{if(!O.current||Oe)return;Re(!0),C("Connecting");const T=3e4,p=1e3;let b=0;const I=T/p;try{const N={hostPeerId:u,playerId:f,gameState:s,timestamp:Date.now(),isHost:!1};localStorage.setItem("webrtc_reconnection_data",JSON.stringify(N))}catch(N){P.error("[Reconnection] Failed to store data:",N)}const g=async()=>{b++;const N=Math.max(0,T-b*p);if(Le({attempt:b,maxAttempts:I,timeRemaining:N}),N<=0){P.warn("[Reconnection] Reconnection timeout expired - clearing stale data"),Re(!1),Le(null),za();return}let S=u;if(s!=null&&s.gameId){const z=Cd(s.gameId);if(z&&z.peerId!==u){S=z.peerId;try{const le={hostPeerId:S,playerId:f,gameState:s,timestamp:Date.now(),isHost:!1};localStorage.setItem("webrtc_reconnection_data",JSON.stringify(le))}catch(le){P.error("[Reconnection] Failed to update reconnection data:",le)}}}try{const z=f||we.current;z!==null?(P.info(`[Reconnection] Reconnecting as existing player ${z} to host ${S}`),await O.current.initializeAsReconnectingGuest(S,z)):(P.info("[Reconnection] No playerId, connecting as new player"),await O.current.initializeAsGuest(S)),P.info("[Reconnection] Successfully reconnected!"),Re(!1),Le(null)}catch(z){P.warn("[Reconnection] Reconnection attempt failed:",z),setTimeout(g,p)}};g()},[Oe,s,f]),me=m.useCallback(async()=>{var u;if(!O.current)return P.error("WebRTC manager not initialized"),null;try{xe(!0),C("Connecting");const T=await O.current.initializeAsHost();ne(T),C("Connected");const p=ue.current.gameId;p&&xd(T,p);const b=(u=ue.current.players)==null?void 0:u.find(I=>I.id===we.current);return zx({peerId:T,isHost:!0,playerName:(b==null?void 0:b.name)||null}),P.info("[initializeWebrtcHost] Saved host data for auto-restore"),T}catch(T){return P.error("Failed to initialize WebRTC host:",T),C("Disconnected"),null}},[]),Y=m.useCallback(async u=>{if(!O.current)return P.error("WebRTC manager not initialized"),!1;try{return xe(!1),C("Connecting"),await O.current.initializeAsGuest(u),!0}catch(T){return P.error("Failed to connect as guest:",T),C("Disconnected"),!1}},[]),X=m.useCallback((u,T)=>!O.current||Z.current?!1:O.current.sendAction(u,T),[]),L=m.useCallback(u=>{l(T=>{var I,g,N;if(!T)return P.error("[updateState] prevState is undefined, skipping update"),T;const p=typeof u=="function"?u(T):u;if(!p)return P.error("[updateState] newState is undefined, skipping update"),T;const b=!T.gameId&&p.gameId;if(!ve.current&&!b)return p;if(J&&O.current){const S=ul(T,p,we.current||0);if(P.info(`[updateState] WebRTC enabled, isHost=${Z.current}, delta: boardCells=${((I=S.boardCells)==null?void 0:I.length)||0}, playerDeltas=${Object.keys(S.playerDeltas||{}).length}, phase=${!!S.phaseDelta}`),Z.current){if(ys(S)||(O.current.broadcastStateDelta(S),P.info(`[updateState] Host broadcast delta: phase=${!!S.phaseDelta}, board=${((g=S.boardCells)==null?void 0:g.length)||0}`)),p.gameId&&we.current!==null)try{bd({gameState:p,localPlayerId:we.current,isHost:!0}),P.debug("[updateState] Saved game state for host auto-restore")}catch(z){P.warn("[updateState] Failed to save game state:",z)}}else if(!ys(S)){const z=O.current.sendStateDelta(S);P.info(`[updateState] Guest sent delta to host: success=${z}, boardCells=${((N=S.boardCells)==null?void 0:N.length)||0}`)}return p}if(V.current&&V.current.readyState===WebSocket.OPEN){const S={type:"UPDATE_STATE",gameState:p};Te.current&&(S.playerToken=Te.current),V.current.send(JSON.stringify(S))}return p})},[J,de,Fe]),be=m.useCallback(()=>{if(localStorage.getItem("webrtc_enabled")==="true"){C("Connected");return}if(U.current||V.current&&(V.current.readyState===WebSocket.OPEN||V.current.readyState===WebSocket.CONNECTING))return;const u=xC();if(!u){P.warn("No WebSocket URL configured in settings. Waiting for user input."),C("Disconnected"),Ke.current&&clearTimeout(Ke.current);return}try{V.current=new WebSocket(u)}catch(T){console.error("Failed to create WebSocket:",T),C("Disconnected"),Ke.current&&clearTimeout(Ke.current),Ke.current=window.setTimeout(be,nt.RECONNECT_DELAY);return}C("Connecting"),V.current.onopen=()=>{var b;ve.current=!1,C("Connected");const T=localStorage.getItem("custom_ws_url");T&&T.trim()!==""&&localStorage.setItem("websocket_url",T.trim());const p=ue.current;if(P.info("Current gameState on open:",p?`gameId=${p.gameId}`:"null"),P.info("playerTokenRef.current on open:",Te.current?"YES":"NO"),p&&p.gameId&&((b=V.current)==null?void 0:b.readyState)===WebSocket.OPEN){let I=Te.current;if(!I){try{const g=localStorage.getItem(Ba);if(g){const N=JSON.parse(g);P.info("RECONNECTION_DATA_KEY:",N==null?void 0:N.gameId,p.gameId),N!=null&&N.playerToken&&(I=N.playerToken,Te.current=I,P.info("Using playerToken from RECONNECTION_DATA_KEY"))}}catch(g){console.warn("Failed to parse reconnection data:",g instanceof Error?g.message:String(g))}if(!I&&p.players&&we.current){const g=p.players.find(N=>N.id===we.current);g!=null&&g.playerToken&&(I=g.playerToken,Te.current=I)}}P.info("JoinGame: Sending reconnection with token:",I?"YES":"NO","gameId:",p.gameId),V.current.send(JSON.stringify({type:"JOIN_GAME",gameId:p.gameId,playerToken:I}))}},V.current.onmessage=T=>{try{const p=JSON.parse(T.data);if(p.type==="GAMES_LIST")x(p.games);else if(p.type==="JOIN_SUCCESS"){if(p.isSpectator){h(null),P.info("Joined as spectator:",p.message||"Spectator mode"),E.current=null;return}h(p.playerId);const b=E.current||ue.current.gameId;b&&p.playerId!==null&&p.playerToken?(Te.current=p.playerToken,localStorage.setItem(Ba,JSON.stringify({gameId:b,playerId:p.playerId,playerToken:p.playerToken,timestamp:Date.now()})),ue.current.gameId===b&&jh(ue.current,p.playerId,p.playerToken)):p.playerId===null&&(go(),Te.current=void 0),E.current=null,p.playerId===1&&setTimeout(()=>{var I;((I=V.current)==null?void 0:I.readyState)===WebSocket.OPEN&&V.current.send(JSON.stringify({type:"UPDATE_DECK_DATA",deckData:lr}))},nt.DECK_SYNC_DELAY)}else if(p.type==="CONNECTION_ESTABLISHED"){P.info("Connection acknowledged by server");const b=sessionStorage.getItem("pending_invite_game"),I=sessionStorage.getItem("pending_invite_name");b&&V.current&&(sessionStorage.removeItem("pending_invite_game"),sessionStorage.removeItem("pending_invite_name"),P.info("Auto-joining invite game:",b),V.current.send(JSON.stringify({type:"JOIN_AS_INVITE",gameId:b,playerName:I||"Player"})))}else if(p.type==="DECK_DATA_UPDATED")P.info("Deck data synced with server");else if(p.type==="ERROR")if(p.message.includes("not found")||p.message.includes("Dummy")){P.info("Game not found error - clearing state");const b=o();l(b),ue.current=b,h(null),go(),E.current=null}else if(p.message.includes("already started")&&te.current){P.info("Game already started - showing alert and returning to menu"),alert("This game has already started.");const b=o();l(b),ue.current=b,h(null),go(),E.current=null,te.current=!1}else console.warn("Server Error:",p.message);else if(p.type==="HIGHLIGHT_TRIGGERED")k(p.highlightData);else if(p.type==="NO_TARGET_TRIGGERED")M({coords:p.coords,timestamp:p.timestamp});else if(p.type==="DECK_SELECTION_TRIGGERED")ee(b=>[...b,p.deckSelectionData]),setTimeout(()=>{ee(b=>b.filter(I=>I.timestamp!==p.deckSelectionData.timestamp))},1e3);else if(p.type==="HAND_CARD_SELECTION_TRIGGERED")Ie(b=>[...b,p.handCardSelectionData]),setTimeout(()=>{Ie(b=>b.filter(I=>I.timestamp!==p.handCardSelectionData.timestamp))},1e3);else if(p.type==="FLOATING_TEXT_TRIGGERED")l(b=>({...b,floatingTexts:[...b.floatingTexts,p.floatingTextData].filter(I=>Date.now()-I.timestamp<nt.FLOATING_TEXT_DURATION)}));else if(p.type==="FLOATING_TEXT_BATCH_TRIGGERED")l(b=>({...b,floatingTexts:[...b.floatingTexts,...p.batch].filter(I=>Date.now()-I.timestamp<nt.FLOATING_TEXT_DURATION)}));else if(p.type==="SYNC_VALID_TARGETS")p.playerId!==we.current&&(ke({playerId:p.playerId,validHandTargets:p.validHandTargets||[],isDeckSelectable:p.isDeckSelectable||!1}),setTimeout(()=>{ke(b=>(b==null?void 0:b.playerId)===p.playerId?null:b)},1e4));else if(p.type==="TARGET_SELECTION_TRIGGERED")p.effect&&p.playerId!==we.current&&(fe(b=>[...b,p.effect]),setTimeout(()=>{fe(b=>b.filter(I=>I.timestamp!==p.effect.timestamp))},1e3));else if(p.type==="TARGETING_MODE_SET"){const b=p.targetingMode;b&&(l(I=>({...I,targetingMode:b})),ue.current.targetingMode=b,P.info("[TargetingMode] Received targeting mode from server",{playerId:b.playerId,mode:b.action.mode}))}else if(p.type==="TARGETING_MODE_CLEARED")l(b=>({...b,targetingMode:null})),ue.current.targetingMode=null,P.debug("[TargetingMode] Cleared targeting mode from server");else if(p.type==="ABILITY_MODE_SET")p.abilityMode&&(l(b=>({...b,abilityMode:p.abilityMode})),P.info("[AbilityMode] Received ability mode from host",{playerId:p.abilityMode.playerId,mode:p.abilityMode.mode,sourceCard:p.abilityMode.sourceCardName}));else if(p.type==="ABILITY_TARGET_SELECTED")P.info("[Ability] Target selected",p.data);else if(p.type==="ABILITY_COMPLETED")l(b=>({...b,abilityMode:null})),P.info("[Ability] Ability completed",p.data);else if(p.type==="ABILITY_CANCELLED")l(b=>({...b,abilityMode:null})),P.info("[Ability] Ability cancelled");else if(p.type==="GAME_RESET")P.info("[GameReset] Received GAME_RESET message from server"),l(b=>{const I=p.activeGridSize||8,g=[];for(let S=0;S<I;S++){const z=[];for(let le=0;le<I;le++)z.push({card:null});g.push(z)}const N={...b,players:p.players||[],gameMode:p.gameMode,isPrivate:p.isPrivate,activeGridSize:p.activeGridSize,dummyPlayerCount:p.dummyPlayerCount,autoAbilitiesEnabled:p.autoAbilitiesEnabled,isGameStarted:p.isGameStarted,currentPhase:p.currentPhase,currentRound:p.currentRound,turnNumber:p.turnNumber,activePlayerId:p.activePlayerId,startingPlayerId:p.startingPlayerId,roundWinners:p.roundWinners||{},gameWinner:p.gameWinner,isRoundEndModalOpen:p.isRoundEndModalOpen,isReadyCheckActive:p.isReadyCheckActive,board:g,targetingMode:null,floatingTexts:[]};return ue.current=N,N});else if(!p.type&&p.players&&p.board){const b=Fs(p),I=ue.current;if(!I.isScoringStep&&b.isScoringStep&&b.currentPhase!==2){P.debug("Ignoring delayed scoring state update");return}if(I.isScoringStep&&(b.currentPhase!==I.currentPhase||b.activePlayerId!==I.activePlayerId||b.currentPhase!==4)&&(b.isScoringStep=!1),l(b),ue.current=b,we.current!==null&&b.gameId){let N;try{const S=localStorage.getItem(Ba);S&&(N=JSON.parse(S).playerToken)}catch{}if(!N&&b.players){const S=b.players.find(z=>z.id===we.current);S!=null&&S.playerToken&&(N=S.playerToken,Te.current=N)}jh(b,we.current,N)}}else console.warn("Unknown message type:",p.type,"keys:",Object.keys(p),"data:",p)}catch(p){console.error("Failed to parse message from server:",T.data,p)}},V.current.onclose=()=>{C("Disconnected"),U.current||(Ke.current&&clearTimeout(Ke.current),Ke.current=window.setTimeout(be,nt.RECONNECT_DELAY))},V.current.onerror=T=>console.error("WebSocket error event:",T)},[l,o]),De=m.useCallback(()=>{V.current&&(V.current.readyState===WebSocket.OPEN||V.current.readyState===WebSocket.CONNECTING)?V.current.close():be()},[be]),Ee=m.useCallback(u=>{var T;if(U.current=!1,((T=V.current)==null?void 0:T.readyState)===WebSocket.OPEN){E.current=u;let p=null;try{const I=localStorage.getItem(Ba);I&&(p=JSON.parse(I))}catch{go()}const b={type:"JOIN_GAME",gameId:u};(p==null?void 0:p.gameId)===u&&p.playerToken?(b.playerToken=p.playerToken,P.info(`JoinGame: Sending reconnection with token ${p.playerToken.substring(0,8)}... for player ${p.playerId}`)):P.info(`JoinGame: No reconnection data or gameId mismatch. storedGameId=${p==null?void 0:p.gameId}, requestedGameId=${u}`),V.current.send(JSON.stringify(b))}else be(),E.current=u},[be]),Pe=m.useCallback(u=>{te.current=!0,Ee(u)},[Ee]),Ae=m.useCallback((u,T="Player")=>{var p;U.current=!1,((p=V.current)==null?void 0:p.readyState)===WebSocket.OPEN?V.current.send(JSON.stringify({type:"JOIN_AS_INVITE",gameId:u,playerName:T})):(sessionStorage.setItem("pending_invite_game",u),sessionStorage.setItem("pending_invite_name",T),be())},[be]);m.useEffect(()=>{if(U.current=!1,sessionStorage.getItem("invite_game_id"))return be(),()=>{U.current=!0,Ke.current&&clearTimeout(Ke.current),V.current&&(V.current.onclose=null,V.current.close())};const T=performance.getEntriesByType("navigation"),p=T.length>0?T[0]:null,b=(p==null?void 0:p.type)??0,I=CC();return I&&(P.info(`Restoring saved game state (nav type: ${b}):`,I.gameState.gameId),l(I.gameState),h(I.localPlayerId),ue.current=I.gameState,we.current=I.localPlayerId,Te.current=I.playerToken),be(),()=>{U.current=!0,Ke.current&&clearTimeout(Ke.current),V.current&&(V.current.onclose=null,V.current.close())}},[]),m.useEffect(()=>{if(lr&&ue.current&&ue.current.gameId){const u=Fs(ue.current);u!==ue.current&&(l(u),ue.current=u)}},[]),m.useEffect(()=>{if(ie)return;const u=setInterval(()=>{if(lr&&ue.current&&ue.current.gameId){const T=Fs(ue.current);l({...T}),ue.current=T,ae(!0),clearInterval(u)}},100);return()=>clearInterval(u)},[ie]);const Ue=m.useCallback(()=>{U.current=!1,go();const u=Dh(),T={...o(),gameId:u,players:[a(1)]};ve.current=!0,L(T),setTimeout(()=>{var p;((p=V.current)==null?void 0:p.readyState)===WebSocket.OPEN&&(V.current.send(JSON.stringify({type:"SUBSCRIBE",gameId:u})),V.current.send(JSON.stringify({type:"UPDATE_DECK_DATA",deckData:lr})))},100)},[L,o,a]),Me=m.useCallback(()=>{var u;((u=V.current)==null?void 0:u.readyState)===WebSocket.OPEN&&V.current.send(JSON.stringify({type:"GET_GAMES_LIST"}))},[]),ut=m.useCallback(()=>{var p;if(pt.current)return;U.current=!0;const u=ue.current.gameId,T=we.current;u&&Z.current&&$x(u);try{za(),P.info("[exitGame] Cleared WebRTC persistence data")}catch(b){P.warn("[exitGame] Failed to clear WebRTC data:",b)}l(o()),h(null),go(),V.current&&(V.current.onclose=null),((p=V.current)==null?void 0:p.readyState)===WebSocket.OPEN&&u&&T!==null&&V.current.send(JSON.stringify({type:"EXIT_GAME",gameId:u,playerId:T})),V.current&&V.current.close(),setTimeout(()=>{U.current=!1,be()},100)},[o,be]),Ze=m.useCallback(()=>{var T;if(localStorage.getItem("webrtc_enabled")==="true"&&O.current&&Z.current){l(p=>({...p,isReadyCheckActive:!0,isPrivate:!0})),O.current.broadcastToGuests({type:"START_READY_CHECK",senderId:O.current.getPeerId(),data:{isReadyCheckActive:!0,isPrivate:!0},timestamp:Date.now()});return}((T=V.current)==null?void 0:T.readyState)===WebSocket.OPEN&&ue.current.gameId&&V.current.send(JSON.stringify({type:"START_READY_CHECK",gameId:ue.current.gameId}))},[Z]),at=m.useCallback(()=>{var T;if(localStorage.getItem("webrtc_enabled")==="true"&&O.current&&Z.current){l(p=>({...p,isReadyCheckActive:!1})),O.current.broadcastToGuests({type:"CANCEL_READY_CHECK",senderId:O.current.getPeerId(),data:{isReadyCheckActive:!1},timestamp:Date.now()});return}((T=V.current)==null?void 0:T.readyState)===WebSocket.OPEN&&ue.current.gameId?V.current.send(JSON.stringify({type:"CANCEL_READY_CHECK",gameId:ue.current.gameId})):l(p=>({...p,isReadyCheckActive:!1}))},[Z]),Gt=m.useCallback(()=>{var T;const u=localStorage.getItem("webrtc_enabled")==="true";if(u&&O.current&&Z.current&&we.current!==null){l(p=>{const b=p.players.map(S=>S.id===we.current?{...S,isReady:!0}:S),I={...p,players:b},g=I.players.filter(S=>!S.isDummy&&!S.isDisconnected);if(g.length>0&&g.every(S=>S.isReady)&&I.isReadyCheckActive&&!I.isGameStarted){const S=I.players.filter(ft=>!ft.isDisconnected),z=Math.floor(Math.random()*S.length),le=S[z].id,Xe={...I};Xe.isReadyCheckActive=!1,Xe.isGameStarted=!0,Xe.startingPlayerId=le,Xe.activePlayerId=le,Xe.currentPhase=0,Xe.players=Xe.players.map(ft=>{if(ft.hand.length===0&&ft.deck.length>0){const Vt=[...ft.hand],gt=[...ft.deck];for(let st=0;st<6&&st<gt.length;st++){const dt=gt[0];gt.splice(0,1),Vt.push(dt)}return P.info(`[playerReady] Drew initial ${Vt.length} cards for player ${ft.id}, deck now has ${gt.length} cards`),{...ft,hand:Vt,deck:gt}}return ft});const Et=Xe.players.find(ft=>ft.id===le);if(Et&&Et.deck.length>0){const ft=Et.deck[0],Qt=[...Et.deck.slice(1)],Vt=[...Et.hand,ft];Xe.players=Xe.players.map(gt=>gt.id===le?{...gt,deck:Qt,hand:Vt,readySetup:!1,readyCommit:!1}:gt),Xe.currentPhase=1,P.info(`[playerReady] Preparation phase: Starting player ${le} drew 7th card, now in Setup phase (${Xe.currentPhase})`)}const wt=ul(I,Xe,we.current||0);return P.info(`[playerReady] Created delta with ${Object.keys(wt.playerDeltas||{}).length} player changes, phaseDelta=${!!wt.phaseDelta}, roundDelta=${!!wt.roundDelta}`),P.info("[playerReady] Delta content:",JSON.stringify(wt,null,2)),P.info("[playerReady] isDeltaEmpty result:",ys(wt)),O.current.broadcastToGuests({type:"GAME_START",senderId:O.current.getPeerId(),data:{startingPlayerId:le,activePlayerId:le,isGameStarted:!0,isReadyCheckActive:!1},timestamp:Date.now()}),setTimeout(()=>{ys(wt)?P.warn("[playerReady] Delta is empty, NOT broadcasting!"):O.current.broadcastStateDelta(wt)},50),Xe}return O.current.broadcastToGuests({type:"HOST_READY",senderId:O.current.getPeerId(),playerId:we.current,timestamp:Date.now()}),I});return}if(u&&O.current&&!Z.current&&we.current!==null){O.current.sendMessageToHost({type:"PLAYER_READY",senderId:O.current.getPeerId(),playerId:we.current,timestamp:Date.now()}),l(p=>({...p,players:p.players.map(b=>b.id===we.current?{...b,isReady:!0}:b)}));return}((T=V.current)==null?void 0:T.readyState)===WebSocket.OPEN&&ue.current.gameId&&we.current!==null&&V.current.send(JSON.stringify({type:"PLAYER_READY",gameId:ue.current.gameId,playerId:we.current}))},[Z,Fe]),Rt=m.useCallback(u=>{var p;if(localStorage.getItem("webrtc_enabled")==="true"&&O.current&&Z.current){l(b=>{const I=b.players.map(g=>{let N=1;for(const[S,z]of Object.entries(u))if(z.includes(g.id)){N=parseInt(S);break}return{...g,teamId:N}});return{...b,players:I}}),O.current.broadcastToGuests({type:"ASSIGN_TEAMS",senderId:O.current.getPeerId(),data:{assignments:u},timestamp:Date.now()});return}((p=V.current)==null?void 0:p.readyState)===WebSocket.OPEN&&ue.current.gameId&&V.current.send(JSON.stringify({type:"ASSIGN_TEAMS",gameId:ue.current.gameId,assignments:u}))},[Z]),hn=m.useCallback(u=>{var p;if(localStorage.getItem("webrtc_enabled")==="true"&&O.current&&Z.current){l(b=>({...b,gameMode:u})),O.current.broadcastToGuests({type:"SET_GAME_MODE",senderId:O.current.getPeerId(),data:{mode:u},timestamp:Date.now()});return}((p=V.current)==null?void 0:p.readyState)===WebSocket.OPEN&&ue.current.gameId&&V.current.send(JSON.stringify({type:"SET_GAME_MODE",gameId:ue.current.gameId,mode:u}))},[Z]),rn=m.useCallback(u=>{var p;if(localStorage.getItem("webrtc_enabled")==="true"&&O.current&&Z.current){l(b=>({...b,isPrivate:u})),O.current.broadcastToGuests({type:"SET_GAME_PRIVACY",senderId:O.current.getPeerId(),data:{isPrivate:u},timestamp:Date.now()});return}((p=V.current)==null?void 0:p.readyState)===WebSocket.OPEN&&ue.current.gameId&&V.current.send(JSON.stringify({type:"SET_GAME_PRIVACY",gameId:ue.current.gameId,isPrivate:u}))},[Z]),an=m.useCallback(()=>{var u;if(((u=V.current)==null?void 0:u.readyState)===WebSocket.OPEN&&ue.current.gameId&&we.current===1){V.current.send(JSON.stringify({type:"UPDATE_DECK_DATA",deckData:lr}));const T=ue.current,p=Ct(T);p.players.forEach(b=>{if(["hand","deck","discard"].forEach(g=>{b[g]&&(b[g]=b[g].map(N=>{const S=pd(N.name);return S?{...N,...S}:N}))}),b.announcedCard){const g=pd(b.announcedCard.name);g&&(b.announcedCard={...b.announcedCard,...g})}}),p.board.forEach(b=>{b.forEach(I=>{if(I.card){const g=pd(I.card.name);g&&(I.card={...I.card,...g})}})}),V.current.send(JSON.stringify({type:"FORCE_SYNC",gameState:p})),l(p)}},[]),bt=m.useCallback(u=>{L(T=>{if(T.isGameStarted)return T;const p={...T,activeGridSize:u};if(T.board.length!==u){p.board=[];for(let I=0;I<u;I++){const g=[];for(let N=0;N<u;N++)g.push({card:null});p.board.push(g)}}else p.board=Cn(p);return p})},[L]),mr=m.useCallback(u=>{L(T=>{if(T.isGameStarted)return T;const p=T.players.filter(g=>!g.isDummy);if(p.length+u>Tu)return T;const b=[...p],I=Math.max(...p.map(g=>g.id),0);for(let g=0;g<u;g++){const N=I+g+1,S=a(N,!0);S.name=`Dummy ${g+1}`,b.push(S)}return{...T,players:b,dummyPlayerCount:u}})},[L,a]),gr=m.useCallback((u,T,p)=>{L(b=>{var N,S;if(!b.isGameStarted)return b;const I=Ct(b),g=I.board[u.row][u.col].card;if(g){if(T==="Stun"&&(g.baseId==="luciusTheImmortal"||g.name.includes("Lucius")&&((N=g.types)!=null&&N.includes("Hero")))||["Support","Threat","Revealed","Shield"].includes(T)&&((S=g.statuses)==null?void 0:S.some(le=>le.type===T&&le.addedByPlayerId===p)))return b;g.statuses||(g.statuses=[]),g.statuses.push({type:T,addedByPlayerId:p})}return I})},[L]),ro=m.useCallback((u,T)=>{L(p=>{if(!p.isGameStarted)return p;const b=Ct(p),I=b.board[u.row][u.col].card;if(I!=null&&I.statuses){const g=I.statuses.map(N=>N.type).lastIndexOf(T);g>-1&&I.statuses.splice(g,1)}return b.board=Cn(b),b})},[L]),yr=m.useCallback((u,T,p)=>{L(b=>{if(!b.isGameStarted)return b;const I=Ct(b),g=I.board[u.row][u.col].card;if(g!=null&&g.statuses){const N=g.statuses.findIndex(S=>S.type===T&&S.addedByPlayerId===p);N>-1&&g.statuses.splice(N,1)}return I.board=Cn(I),I})},[L]),_c=m.useCallback((u,T)=>{L(p=>{if(!p.isGameStarted)return p;const b=Ct(p),I=b.board[u.row][u.col].card;return I&&(I.powerModifier===void 0&&(I.powerModifier=0),I.powerModifier+=T),b})},[L]),ki=m.useCallback((u,T,p)=>{L(b=>{var N;if(!b.isGameStarted)return b;const I=Ct(b),g=I.players.find(S=>S.id===u);if(g!=null&&g.announcedCard){if(["Support","Threat","Revealed"].includes(T)&&((N=g.announcedCard.statuses)==null?void 0:N.some(z=>z.type===T&&z.addedByPlayerId===p)))return b;g.announcedCard.statuses||(g.announcedCard.statuses=[]),g.announcedCard.statuses.push({type:T,addedByPlayerId:p})}return I})},[L]),Ti=m.useCallback((u,T)=>{L(p=>{var g;if(!p.isGameStarted)return p;const b=Ct(p),I=b.players.find(N=>N.id===u);if((g=I==null?void 0:I.announcedCard)!=null&&g.statuses){const N=I.announcedCard.statuses.map(S=>S.type).lastIndexOf(T);N>-1&&I.announcedCard.statuses.splice(N,1)}return b})},[L]),Dc=m.useCallback((u,T)=>{L(p=>{if(!p.isGameStarted)return p;const b=Ct(p),I=b.players.find(g=>g.id===u);return I!=null&&I.announcedCard&&(I.announcedCard.powerModifier===void 0&&(I.announcedCard.powerModifier=0),I.announcedCard.powerModifier+=T),b})},[L]),Rc=m.useCallback((u,T,p,b)=>{L(I=>{var S;if(!I.isGameStarted)return I;const g=Ct(I),N=g.players.find(z=>z.id===u);if(N!=null&&N.hand[T]){const z=N.hand[T];if(["Support","Threat","Revealed","Shield","Resurrected"].includes(p)&&((S=z.statuses)==null?void 0:S.some(Xe=>Xe.type===p&&Xe.addedByPlayerId===b)))return I;z.statuses||(z.statuses=[]),z.statuses.push({type:p,addedByPlayerId:b})}return g})},[L]),Ea=m.useCallback((u,T,p)=>{L(b=>{if(!b.isGameStarted)return b;const I=Ct(b),g=I.players.find(S=>S.id===u),N=g==null?void 0:g.hand[T];if(N!=null&&N.statuses){const S=N.statuses.map(z=>z.type).lastIndexOf(p);S>-1&&N.statuses.splice(S,1),p==="Revealed"&&(N.statuses.some(le=>le.type==="Revealed")||delete N.revealedTo)}return I})},[L]),Ei=m.useCallback(u=>{L(T=>{if(!T.isGameStarted)return T;const p=Ct(T),b=p.board[u.row][u.col].card;return b&&(b.isFaceDown=!1),p.board=Cn(p),p})},[L]),jc=m.useCallback(u=>{L(T=>{if(!T.isGameStarted)return T;const p=Ct(T),b=p.board[u.row][u.col].card;return b&&(b.isFaceDown=!0),p.board=Cn(p),p})},[L]),Yn=m.useCallback((u,T,p)=>{L(b=>{const I=b.players.find(S=>S.id===u);if(!(I!=null&&I.hand[T]))return b;const g=Ct(b),N=g.players.find(S=>S.id===u).hand[T];if(p==="all")N.revealedTo="all",N.statuses||(N.statuses=[]),N.statuses.some(S=>S.type==="Revealed"&&S.addedByPlayerId===u)||N.statuses.push({type:"Revealed",addedByPlayerId:u});else{(!N.revealedTo||N.revealedTo==="all"||!Array.isArray(N.revealedTo))&&(N.revealedTo=[]);const S=p.filter(z=>!N.revealedTo.includes(z));N.revealedTo.push(...S)}return g})},[L]),on=m.useCallback((u,T)=>{L(p=>{if(!p.board[u.row][u.col].card)return p;const I=Ct(p),g=I.board[u.row][u.col].card,N=g.ownerId;if(T==="all")g.revealedTo="all",N!==void 0&&(g.statuses||(g.statuses=[]),g.statuses.some(S=>S.type==="Revealed"&&S.addedByPlayerId===N)||g.statuses.push({type:"Revealed",addedByPlayerId:N}));else{(!g.revealedTo||g.revealedTo==="all"||!Array.isArray(g.revealedTo))&&(g.revealedTo=[]);const S=T.filter(z=>!g.revealedTo.includes(z));g.revealedTo.push(...S)}return I})},[L]),_t=m.useCallback((u,T)=>{L(p=>{var N;const b=u.boardCoords?(N=p.board[u.boardCoords.row][u.boardCoords.col].card)==null?void 0:N.ownerId:u.ownerId;if(!b)return p;const I=Ct(p),g=I.revealRequests.find(S=>S.fromPlayerId===T&&S.toPlayerId===b);return g?g.cardIdentifiers.some(z=>JSON.stringify(z)===JSON.stringify(u))||g.cardIdentifiers.push(u):I.revealRequests.push({fromPlayerId:T,toPlayerId:b,cardIdentifiers:[u]}),I})},[L]),ao=m.useCallback((u,T)=>{L(p=>{const b=p.revealRequests.findIndex(N=>N.toPlayerId===we.current&&N.fromPlayerId===u);if(b===-1)return p;const I=Ct(p),g=I.revealRequests[b];if(T){const{cardIdentifiers:N}=g;for(const S of N){let z=null;if(S.source==="board"&&S.boardCoords)z=I.board[S.boardCoords.row][S.boardCoords.col].card;else if(S.source==="hand"&&S.ownerId&&S.cardIndex!==void 0){const le=I.players.find(Xe=>Xe.id===S.ownerId);le&&(z=le.hand[S.cardIndex])}z&&(z.statuses||(z.statuses=[]),z.statuses.some(le=>le.type==="Revealed"&&le.addedByPlayerId===u)||z.statuses.push({type:"Revealed",addedByPlayerId:u}))}}return I.revealRequests.splice(b,1),I})},[L]),oo=m.useCallback(u=>{L(T=>{const p=Ct(T);let b=null;if(u.source==="board"&&u.boardCoords)b=p.board[u.boardCoords.row][u.boardCoords.col].card;else if(u.source==="hand"&&u.playerId&&u.cardIndex!==void 0){const I=p.players.find(g=>g.id===u.playerId);I&&(b=I.hand[u.cardIndex])}return b&&(b.statuses&&(b.statuses=b.statuses.filter(I=>I.type!=="Revealed")),delete b.revealedTo),p})},[L]),Ia=m.useCallback((u,T)=>{L(p=>p.isGameStarted?p:{...p,players:p.players.map(b=>b.id===u?{...b,name:T}:b)})},[L]),mt=m.useCallback((u,T)=>{L(p=>p.isGameStarted||p.players.some(I=>I.id!==u&&!I.isDummy&&I.color===T)?p:{...p,players:p.players.map(I=>I.id===u?{...I,color:T}:I)})},[L]),In=m.useCallback((u,T)=>{var I;const p=ue.current;if(!p.isGameStarted){P.warn("[ScoreUpdate] Blocked: game not started");return}if(p.isRoundEndModalOpen){P.warn("[ScoreUpdate] Blocked: round end modal is open");return}if(T===0)return;const b=localStorage.getItem("webrtc_enabled")==="true";if(b?L(g=>({...g,players:g.players.map(N=>N.id===u?{...N,score:Math.max(0,(N.score||0)+T)}:N)})):l(g=>({...g,players:g.players.map(N=>N.id===u?{...N,score:Math.max(0,(N.score||0)+T)}:N)})),!b){if(((I=V.current)==null?void 0:I.readyState)!==WebSocket.OPEN){P.warn("[ScoreUpdate] Blocked: WebSocket not open");return}const g=Cr.get(u);if(g){clearTimeout(g.timerId);const N=g.delta+T,S=setTimeout(()=>{var le;const z=Cr.get(u);z&&((le=V.current)==null?void 0:le.readyState)===WebSocket.OPEN&&(P.info(`[ScoreUpdate] Sending accumulated delta: player=${u}, delta=${z.delta}`),V.current.send(JSON.stringify({type:"UPDATE_PLAYER_SCORE",gameId:ue.current.gameId,playerId:u,delta:z.delta}))),Cr.delete(u)},500);Cr.set(u,{delta:N,timerId:S})}else{const N=setTimeout(()=>{var z;const S=Cr.get(u);S&&((z=V.current)==null?void 0:z.readyState)===WebSocket.OPEN&&(P.info(`[ScoreUpdate] Sending delta: player=${u}, delta=${S.delta}`),V.current.send(JSON.stringify({type:"UPDATE_PLAYER_SCORE",gameId:ue.current.gameId,playerId:u,delta:S.delta}))),Cr.delete(u)},500);Cr.set(u,{delta:T,timerId:N})}}},[l,L]),Ii=m.useCallback((u,T)=>{const p=localStorage.getItem("webrtc_enabled")==="true";L(b=>b.isGameStarted?b:{...b,players:b.players.map(I=>I.id===u?{...I,deck:r(T,u,I.name),selectedDeck:T,hand:[],discard:[],announcedCard:null,boardHistory:[]}:I)}),p&&!Z.current&&X&&X("CHANGE_PLAYER_DECK",{playerId:u,deckType:T})},[L,r,X]),Sa=m.useCallback((u,T)=>{L(p=>{if(p.isGameStarted)return p;const b=p.players.find(N=>N.id===u);if(!b)return p;const I=[],g=new Map;for(const{cardId:N,quantity:S}of T.cards){const z=Wo(N);if(!z)continue;const le=Tl.has(N),Xe=le?it.Command:it.Custom,Et=le?"CMD":"CUS";for(let wt=0;wt<S;wt++){const ft=(g.get(N)||0)+1;g.set(N,ft),I.push({...z,id:`${Et}_${N.toUpperCase()}_${ft}`,baseId:N,deck:Xe,ownerId:u,ownerName:b.name})}}return{...p,players:p.players.map(N=>N.id===u?{...N,deck:Gs(I),selectedDeck:it.Custom,hand:[],discard:[],announcedCard:null,boardHistory:[]}:N)}})},[L]),ct=m.useCallback(u=>{L(T=>{if(!T.isGameStarted)return T;const p=T.players.find(N=>N.id===u);if(!p||p.deck.length===0)return T;const b=Ct(T),I=b.players.find(N=>N.id===u),g=I.deck.shift();return g&&I.hand.push(g),b})},[L]),_r=m.useCallback((u,T)=>{T<=0||L(p=>{if(!p.isGameStarted)return p;const b=p.players.find(S=>S.id===u);if(!b||b.deck.length===0)return p;const I=Ct(p),g=I.players.find(S=>S.id===u),N=Math.min(T,g.deck.length);for(let S=0;S<N;S++){const z=g.deck.shift();z&&g.hand.push(z)}return I})},[L]),so=m.useCallback(u=>{L(T=>{if(!T.isGameStarted||!T.players.find(g=>g.id===u))return T;const b=Ct(T),I=b.players.find(g=>g.id===u);return I.deck=Gs(I.deck),b})},[L]),ar=m.useCallback(u=>{localStorage.getItem("webrtc_enabled")==="true"&&O.current?Z.current?l(p=>{const b=Sh(p,u);return O.current&&O.current.broadcastToGuests({type:"ACTIVE_PLAYER_CHANGED",senderId:O.current.getPeerId(),data:{activePlayerId:b.activePlayerId,currentPhase:b.currentPhase,turnNumber:b.turnNumber},timestamp:Date.now()}),b}):O.current.sendMessageToHost({type:"TOGGLE_ACTIVE_PLAYER",senderId:void 0,data:{playerId:u},timestamp:Date.now()}):V.current&&V.current.readyState===WebSocket.OPEN&&(Cr.forEach((p,b)=>{clearTimeout(p.timerId),P.info(`[ScoreFlush] Flushing on toggle: player=${b}, delta=${p.delta}`),V.current.send(JSON.stringify({type:"UPDATE_PLAYER_SCORE",gameId:ue.current.gameId,playerId:b,delta:p.delta}))}),Cr.clear(),V.current.send(JSON.stringify({type:"TOGGLE_ACTIVE_PLAYER",gameId:ue.current.gameId,playerId:u})))},[]),qn=m.useCallback((u,T)=>{V.current&&V.current.readyState===WebSocket.OPEN&&V.current.send(JSON.stringify({type:"TOGGLE_AUTO_DRAW",gameId:ue.current.gameId,playerId:u,enabled:T}))},[]),Si=m.useCallback(u=>{const T=t&&n&&t.mode&&["SCORE_LAST_PLAYED_LINE","SELECT_LINE_END","INTEGRATOR_LINE_SELECT","ZIUS_LINE_SELECT"].includes(t.mode);T&&n(null),L(p=>{if(!p.isGameStarted)return p;const b=Math.max(1,Math.min(u,4));return{...p,currentPhase:b,...b===4&&!T?{isScoringStep:!0}:{},...T?{isScoringStep:!1}:{}}})},[L,t,n]),Xo=m.useCallback(()=>{var p;t&&n&&t.mode&&["SCORE_LAST_PLAYED_LINE","SELECT_LINE_END","INTEGRATOR_LINE_SELECT","ZIUS_LINE_SELECT"].includes(t.mode)&&n(null);const u=ue.current,T=localStorage.getItem("webrtc_enabled")==="true";if(u.isGameStarted&&u.currentPhase===4&&u.isScoringStep&&!T){((p=V.current)==null?void 0:p.readyState)===WebSocket.OPEN&&(Cr.forEach((b,I)=>{clearTimeout(b.timerId),P.info(`[ScoreFlush] Flushing pending score: player=${I}, delta=${b.delta}`),V.current.send(JSON.stringify({type:"UPDATE_PLAYER_SCORE",gameId:u.gameId,playerId:I,delta:b.delta}))}),Cr.clear(),V.current.send(JSON.stringify({type:"NEXT_PHASE",gameId:u.gameId})));return}if(T&&u.isGameStarted&&u.currentPhase===4&&u.isScoringStep){L(b=>dl(b));return}L(b=>{if(!b.isGameStarted)return b;const I=Ct(b),g=b.currentPhase+1;return b.preserveDeployAbilities||I.board.forEach(N=>{N.forEach(S=>{var z;(z=S.card)!=null&&z.statuses&&(S.card.statuses=S.card.statuses.filter(le=>le.type!=="readyDeploy"))})}),T&&g===4&&b.currentPhase===3?vC(b,b.activePlayerId)?(I.isScoringStep=!0,I.currentPhase=4,I):(P.info(`[nextPhase] Player ${b.activePlayerId} has no cards on board in Commit phase, auto-passing turn`),dl(b)):g===4&&b.currentPhase===3?(I.isScoringStep=!0,I.currentPhase=4,I):(I.board.forEach(N=>{N.forEach(S=>{var z;if((z=S.card)!=null&&z.statuses){const le=S.card.statuses.findIndex(Xe=>Xe.type==="Resurrected");if(le!==-1){const Xe=S.card.statuses[le].addedByPlayerId;S.card.statuses.splice(le,1),S.card.baseId!=="luciusTheImmortal"&&(S.card.statuses.push({type:"Stun",addedByPlayerId:Xe}),S.card.statuses.push({type:"Stun",addedByPlayerId:Xe}))}}})}),I.board=Cn(I),I.currentPhase=g,I)})},[L,t,n]),Zo=m.useCallback(()=>{L(u=>u.isGameStarted?(t&&n&&t.mode&&["SCORE_LAST_PLAYED_LINE","SELECT_LINE_END","INTEGRATOR_LINE_SELECT","ZIUS_LINE_SELECT"].includes(t.mode)&&n(null),u.isScoringStep?{...u,isScoringStep:!1,currentPhase:Math.max(1,u.currentPhase-1)}:{...u,currentPhase:Math.max(1,u.currentPhase-1)}):u)},[L,t,n]),Zt=m.useCallback(()=>{var T;localStorage.getItem("webrtc_enabled")==="true"?L(p=>({...p,isRoundEndModalOpen:!1,currentRound:(p.currentRound||1)+1,players:p.players.map(b=>({...b,score:0}))})):((T=V.current)==null?void 0:T.readyState)===WebSocket.OPEN&&ue.current.gameId&&(l(p=>({...p,isRoundEndModalOpen:!1,currentRound:(p.currentRound||1)+1,players:p.players.map(b=>({...b,score:0}))})),V.current.send(JSON.stringify({type:"START_NEXT_ROUND",gameId:ue.current.gameId})))},[l,L]),Sn=m.useCallback(()=>{l(u=>({...u,isRoundEndModalOpen:!1}))},[l]),Pc=m.useCallback(()=>{var T;if(localStorage.getItem("webrtc_enabled")==="true"){const p=ue.current,b=p.players.map(S=>{const z=S.selectedDeck||"SynchroTech";return{...S,hand:[],deck:r(z,S.id,S.name),discard:[],score:0,isReady:!1,announcedCard:null,boardHistory:[]}}),I=p.activeGridSize||8,g=[];for(let S=0;S<I;S++){const z=[];for(let le=0;le<I;le++)z.push({card:null});g.push(z)}const N={...p,players:b,board:g,isGameStarted:!1,currentPhase:0,currentRound:1,turnNumber:1,activePlayerId:null,startingPlayerId:null,roundWinners:{},gameWinner:null,roundEndTriggered:!1,isRoundEndModalOpen:!1,isReadyCheckActive:!1,targetingMode:null,floatingTexts:[]};l(N),ue.current=N,O.current&&O.current.broadcastToGuests({type:"GAME_RESET",senderId:O.current.getPeerId(),data:{players:b.map(S=>({id:S.id,name:S.name,color:S.color,selectedDeck:S.selectedDeck,isDummy:S.isDummy,isDisconnected:S.isDisconnected,autoDrawEnabled:S.autoDrawEnabled,handSize:S.hand.length,deckSize:S.deck.length,discardSize:S.discard.length,...S.isDummy&&{hand:S.hand.map(z=>({id:z.id,baseId:z.baseId,name:z.name,imageUrl:z.imageUrl,power:z.power,powerModifier:z.powerModifier,ability:z.ability,ownerId:z.ownerId,color:z.color,deck:z.deck,isFaceDown:z.isFaceDown,types:z.types,faction:z.faction,statuses:z.statuses})),deck:S.deck.map(z=>({id:z.id,baseId:z.baseId,name:z.name,imageUrl:z.imageUrl,power:z.power,powerModifier:z.powerModifier,ability:z.ability,ownerId:z.ownerId,color:z.color,deck:z.deck,isFaceDown:z.isFaceDown,types:z.types,faction:z.faction,statuses:z.statuses})),discard:S.discard.map(z=>({id:z.id,baseId:z.baseId,name:z.name,imageUrl:z.imageUrl,power:z.power,powerModifier:z.powerModifier,ability:z.ability,ownerId:z.ownerId,color:z.color,deck:z.deck,isFaceDown:z.isFaceDown,types:z.types,faction:z.faction,statuses:z.statuses}))},score:S.score,isReady:S.isReady,announcedCard:S.announcedCard})),gameMode:N.gameMode,isPrivate:N.isPrivate,activeGridSize:N.activeGridSize,dummyPlayerCount:N.dummyPlayerCount,autoAbilitiesEnabled:N.autoAbilitiesEnabled,isGameStarted:!1,currentPhase:0,currentRound:1,turnNumber:1,activePlayerId:null,startingPlayerId:null,roundWinners:{},gameWinner:null,isRoundEndModalOpen:!1,isReadyCheckActive:!1},timestamp:Date.now()})}else((T=V.current)==null?void 0:T.readyState)===WebSocket.OPEN&&V.current.send(JSON.stringify({type:"RESET_GAME",gameId:ue.current.gameId}))},[]),Qo=m.useCallback((u,T)=>{L(p=>{var le,Xe,Et,wt,ft,Qt,Vt,gt,st,dt;if(!p.isGameStarted||T.target==="board"&&T.boardCoords&&p.board[T.boardCoords.row][T.boardCoords.col].card!==null&&u.source!=="counter_panel")return p;let b=!1;try{const ge=localStorage.getItem("auto_abilities_enabled");b=ge===null?!0:ge==="true"}catch{b=!0}const I=b&&p.currentPhase===1&&u.source==="hand"&&T.target==="board"&&(((le=u.card.types)==null?void 0:le.includes("Unit"))||((Xe=u.card.types)==null?void 0:Xe.includes("Command"))),g=Ct(p);if(u.source==="board"&&["hand","deck","discard"].includes(T.target)&&!u.bypassOwnershipCheck){const ge=u.card.ownerId,Ne=g.players.find(Ve=>Ve.id===ge),Ge=ge===we.current,rt=!!(Ne!=null&&Ne.isDummy);if(!Ge&&!rt)return p}let N=null;if(u.source==="board"&&T.target==="board"&&u.boardCoords){const ge=g.board[u.boardCoords.row][u.boardCoords.col];ge.card&&(N=ge.card);const Ge=p.board[u.boardCoords.row][u.boardCoords.col].card||N;if(Ge&&((Et=Ge.statuses)==null?void 0:Et.some(Ve=>Ve.type==="Stun"))){const Ve=we.current,Ut=Ge.ownerId,Jt=p.players.find(ea=>ea.id===Ve),Kt=p.players.find(ea=>ea.id===Ut),Gr=Ve===Ut,co=(Jt==null?void 0:Jt.teamId)!==void 0&&(Kt==null?void 0:Kt.teamId)!==void 0&&Jt.teamId===Kt.teamId;if((Gr||co)&&!u.isManual)return p}}if(u.source==="counter_panel"&&u.statusType){const ge=Zr[u.statusType];if(!((ge==null?void 0:ge.allowedTargets)??["board","hand"]).includes(T.target))return p;let Ge=null;if(T.target==="board"&&T.boardCoords)Ge=g.board[T.boardCoords.row][T.boardCoords.col].card;else if(T.playerId!==void 0){const rt=g.players.find(Ve=>Ve.id===T.playerId);rt&&(T.target==="hand"&&T.cardIndex!==void 0&&(Ge=rt.hand[T.cardIndex]),T.target==="announced"&&(Ge=rt.announcedCard||null),T.target==="deck"&&rt.deck.length>0?T.deckPosition==="top"||!T.deckPosition?Ge=rt.deck[0]:Ge=rt.deck[rt.deck.length-1]:T.target==="discard"&&rt.discard.length>0&&(Ge=rt.discard[rt.discard.length-1]))}if(Ge){if(u.statusType==="Stun"&&(Ge.baseId==="luciusTheImmortal"||Ge.name.includes("Lucius")&&((wt=Ge.types)!=null&&wt.includes("Hero"))))return g;const rt=u.count||1;let Ve;if(u.ownerId!==void 0)Ve=u.ownerId;else if(u.card.ownerId!==void 0)Ve=u.card.ownerId;else{const Ut=g.players.find(Jt=>Jt.id===g.activePlayerId);Ve=Ut!=null&&Ut.isDummy?Ut.id:we.current!==null?we.current:0}if(u.statusType==="Power+")Ge.powerModifier===void 0&&(Ge.powerModifier=0),Ge.powerModifier+=1*rt;else if(u.statusType==="Power-")Ge.powerModifier===void 0&&(Ge.powerModifier=0),Ge.powerModifier-=1*rt;else if(Ge.statuses||(Ge.statuses=[]),u.replaceStatusType&&u.statusType)for(let Ut=0;Ut<rt;Ut++){const Jt=Ge.statuses.findIndex(Kt=>Kt.type===u.replaceStatusType&&Kt.addedByPlayerId===Ve);Jt!==-1?Ge.statuses[Jt]={type:u.statusType,addedByPlayerId:Ve}:Ge.statuses.push({type:u.statusType,addedByPlayerId:Ve})}else for(let Ut=0;Ut<rt;Ut++)["Support","Threat","Revealed"].includes(u.statusType)?Ge.statuses.some(Kt=>Kt.type===u.statusType&&Kt.addedByPlayerId===Ve)||Ge.statuses.push({type:u.statusType,addedByPlayerId:Ve}):Ge.statuses.push({type:u.statusType,addedByPlayerId:Ve});return T.target==="board"&&(g.board=Cn(g)),g}return p}const S=N?{...N}:{...u.card};if(u.source==="hand"&&u.playerId!==void 0&&u.cardIndex!==void 0){const ge=g.players.find(Ne=>Ne.id===u.playerId);if(ge){const Ne=ge.hand[u.cardIndex];if(Ne&&Ne.id===u.card.id&&Ne.ownerId===u.card.ownerId)ge.hand.splice(u.cardIndex,1);else{const Ge=ge.hand.findIndex(rt=>rt.id===u.card.id&&rt.ownerId===u.card.ownerId);if(Ge!==-1)ge.hand.splice(Ge,1);else return p}}}else if(u.source==="board"&&u.boardCoords){const ge=g.board[u.boardCoords.row][u.boardCoords.col];if(ge.card&&ge.card.id===u.card.id&&ge.card.ownerId===u.card.ownerId)g.board[u.boardCoords.row][u.boardCoords.col].card=null;else return p}else if(u.source==="discard"&&u.playerId!==void 0){const ge=g.players.find(Ne=>Ne.id===u.playerId);if(ge){let Ne=!1;if(u.cardIndex!==void 0){const Ge=ge.discard[u.cardIndex];Ge&&Ge.id===u.card.id&&Ge.ownerId===u.card.ownerId&&(ge.discard.splice(u.cardIndex,1),Ne=!0)}if(!Ne){const Ge=ge.discard.findIndex(rt=>rt.id===u.card.id&&rt.ownerId===u.card.ownerId);if(Ge!==-1)ge.discard.splice(Ge,1);else return p}}}else if(u.source==="deck"&&u.playerId!==void 0&&u.cardIndex!==void 0){const ge=g.players.find(Ne=>Ne.id===u.playerId);if(ge){const Ne=ge.deck[u.cardIndex];if(Ne&&Ne.id===u.card.id&&Ne.ownerId===u.card.ownerId)ge.deck.splice(u.cardIndex,1);else{const Ge=ge.deck.findIndex(rt=>rt.id===u.card.id&&rt.ownerId===u.card.ownerId);if(Ge!==-1)ge.deck.splice(Ge,1);else return p}}}else if(u.source==="announced"&&u.playerId!==void 0){const ge=g.players.find(Ne=>Ne.id===u.playerId);if(ge)if(ge.announcedCard&&ge.announcedCard.id===u.card.id)ge.announcedCard=null;else return p}if(["hand","deck","discard"].includes(T.target))S.statuses&&(S.statuses=S.statuses.filter(ge=>ge.type==="Revealed")),S.isFaceDown=!1,delete S.powerModifier,delete S.bonusPower,delete S.enteredThisTurn;else if(T.target==="board"&&(S.statuses||(S.statuses=[]),u.source!=="board"&&S.isFaceDown===void 0&&(S.isFaceDown=!1),u.source!=="board")){S.enteredThisTurn=!0;let ge=S.ownerId;ge===void 0&&(u.source==="token_panel"?ge=g.activePlayerId??we.current??0:u.playerId!==void 0?ge=u.playerId:ge=we.current??0,S.ownerId=ge),hd(S,ge),u.source==="discard"&&(S.baseId==="luciusTheImmortal"||S.name.includes("Lucius"))&&(S.powerModifier===void 0&&(S.powerModifier=0),S.powerModifier+=2)}if(T.target==="hand"&&T.playerId!==void 0){if((S.deck===it.Tokens||S.deck==="counter")&&(((ft=S.types)==null?void 0:ft.includes("Token"))||((Qt=S.types)==null?void 0:Qt.includes("Token Unit"))))return p;md(S);const Ne=g.players.find(rt=>rt.id===T.playerId);if(!Ne)return p;let Ge=T.cardIndex!==void 0?T.cardIndex:Ne.hand.length;if(u.source==="hand"&&u.playerId===T.playerId&&u.cardIndex!==void 0&&(u.cardIndex<Ge&&(Ge-=1),u.cardIndex===Ge))return p;Ne.hand.splice(Ge,0,S)}else if(T.target==="board"&&T.boardCoords){if(g.board[T.boardCoords.row][T.boardCoords.col].card===null){if(S.ownerId===void 0&&we.current!==null){const ge=g.players.find(Ne=>Ne.id===we.current);ge&&(S.ownerId=ge.id,S.ownerName=ge.name)}if(u.source!=="board"&&S.ownerId!==void 0){const ge=g.players.find(Ne=>Ne.id===S.ownerId);ge&&(ge.boardHistory||(ge.boardHistory=[]),ge.boardHistory.push(S.id))}g.board[T.boardCoords.row][T.boardCoords.col].card=S}}else if(T.target==="discard"&&T.playerId!==void 0){if(!(S.deck===it.Tokens||S.deck==="counter")){md(S),S.statuses&&(S.statuses=S.statuses.filter(Ne=>Ne.type!=="Revealed"));const ge=g.players.find(Ne=>Ne.id===T.playerId);ge&&(S.ownerId===void 0&&(S.ownerId=T.playerId,S.ownerName=ge.name),ge.discard.some(Ge=>Ge.id===S.id)||ge.discard.push(S))}}else if(T.target==="deck"&&T.playerId!==void 0){if((S.deck===it.Tokens||S.deck==="counter")&&(((Vt=S.types)==null?void 0:Vt.includes("Token"))||((gt=S.types)==null?void 0:gt.includes("Token Unit"))))return p;md(S),S.statuses&&(S.statuses=S.statuses.filter(Ge=>Ge.type!=="Revealed"));const Ne=g.players.find(Ge=>Ge.id===T.playerId);if(!Ne)return p;S.ownerId===void 0&&(S.ownerId=T.playerId,S.ownerName=Ne.name),T.deckPosition==="top"||!T.deckPosition?Ne.deck.unshift(S):Ne.deck.push(S)}else if(T.target==="announced"&&T.playerId!==void 0){const ge=g.players.find(Ne=>Ne.id===T.playerId);ge&&(ge.announcedCard&&(ge.announcedCard.statuses&&(ge.announcedCard.statuses=ge.announcedCard.statuses.filter(Ne=>Ne.type==="Revealed")),delete ge.announcedCard.enteredThisTurn,delete ge.announcedCard.powerModifier,delete ge.announcedCard.bonusPower,ge.hand.push(ge.announcedCard)),ge.announcedCard=S)}if(u.source==="board"&&T.target!=="board"&&S.ownerId!==void 0){const ge=g.players.find(Ne=>Ne.id===S.ownerId);ge&&(ge.boardHistory||(ge.boardHistory=[]),ge.boardHistory=ge.boardHistory.filter(Ne=>Ne!==S.id))}if((u.source==="board"||T.target==="board")&&S.ownerId!==void 0){const ge=g.players.find(Ne=>Ne.id===S.ownerId);ge&&Rh(g.board,ge)}if(u.source==="hand"&&T.target==="board"){const ge=S;if(ge.revealedTo==="all"||((st=ge.statuses)==null?void 0:st.some(Ge=>Ge.type==="Revealed"))){const Ge=g.board.length;for(let rt=0;rt<Ge;rt++)for(let Ve=0;Ve<Ge;Ve++){const Ut=g.board[rt][Ve].card;if(Ut&&Ut.name.toLowerCase().includes("vigilant spotter")&&Ut.ownerId!==ge.ownerId&&(g.board=Cn(g),(dt=g.board[rt][Ve].card.statuses)!=null&&dt.some(Kt=>Kt.type==="Support"))){const Kt=g.players.find(Gr=>Gr.id===Ut.ownerId);Kt&&setTimeout(()=>{In(Kt.id,2)},0)}}}}return(u.source==="board"||T.target==="board")&&(g.board=Cn(g)),I&&(g.currentPhase=2),g})},[L]),Nc=m.useCallback((u,T,p,b)=>{L(I=>{if(!I.isGameStarted||I.board[p.row][p.col].card!==null)return I;const g=Ct(I),N=g.players.find(S=>S.id===u);if(N&&N.discard.length>T){const[S]=N.discard.splice(T,1);S.enteredThisTurn=!0,hd(S,u),(S.baseId==="luciusTheImmortal"||S.name.includes("Lucius"))&&(S.powerModifier===void 0&&(S.powerModifier=0),S.powerModifier+=2),S.statuses||(S.statuses=[]),S.statuses.push({type:"Resurrected",addedByPlayerId:u}),b&&b.forEach(z=>{var le;z.type!=="Resurrected"&&((le=S.statuses)==null||le.push({type:z.type,addedByPlayerId:u}))}),N.boardHistory||(N.boardHistory=[]),N.boardHistory.push(S.id),g.board[p.row][p.col].card=S,Rh(g.board,N),g.board=Cn(g)}return g})},[L]),_i=m.useCallback((u,T)=>{L(p=>{const b=Ct(p),I=b.players.find(g=>g.id===u);if(I&&T.length>0){const g=new Set(T.map(S=>S.id)),N=I.deck.filter(S=>!g.has(S.id));I.deck=[...T,...N]}return b})},[L]),es=m.useCallback((u,T,p)=>{L(b=>{const I=Ct(b),g=I.players.find(N=>N.id===u);return g&&(p==="deck"?g.deck=T:p==="discard"&&(g.discard=T)),I})},[L]),Ac=m.useCallback(u=>{var p;const T={...u,timestamp:Date.now()};if(k(T),((p=V.current)==null?void 0:p.readyState)===WebSocket.OPEN&&ue.current.gameId)V.current.send(JSON.stringify({type:"TRIGGER_HIGHLIGHT",gameId:ue.current.gameId,highlightData:T}));else if(O.current){const b={type:"HIGHLIGHT_TRIGGERED",senderId:O.current.getPeerId(),data:T,timestamp:Date.now()};Z.current?O.current.broadcastToGuests(b):O.current.sendMessageToHost(b)}},[]),_a=m.useCallback(u=>{var I;const T=Array.isArray(u)?u:[u],p=Date.now(),b=T.map((g,N)=>({...g,timestamp:p+N}));if($(b),((I=V.current)==null?void 0:I.readyState)===WebSocket.OPEN&&ue.current.gameId)V.current.send(JSON.stringify({type:"TRIGGER_FLOATING_TEXT_BATCH",gameId:ue.current.gameId,batch:b}));else if(O.current){const g={type:"FLOATING_TEXT_BATCH_TRIGGERED",senderId:O.current.getPeerId(),data:{batch:b},timestamp:Date.now()};Z.current?O.current.broadcastToGuests(g):O.current.sendMessageToHost(g)}},[]),Dr=m.useCallback(u=>{var p;const T=Date.now();if(M({coords:u,timestamp:T}),((p=V.current)==null?void 0:p.readyState)===WebSocket.OPEN&&ue.current.gameId)V.current.send(JSON.stringify({type:"TRIGGER_NO_TARGET",gameId:ue.current.gameId,coords:u,timestamp:T}));else if(O.current){const b={type:"NO_TARGET_TRIGGERED",senderId:O.current.getPeerId(),data:{coords:u,timestamp:T},timestamp:Date.now()};Z.current?O.current.broadcastToGuests(b):O.current.sendMessageToHost(b)}},[]),Da=m.useCallback((u,T)=>{var b;const p={playerId:u,selectedByPlayerId:T,timestamp:Date.now()};if(ee(I=>[...I,p]),((b=V.current)==null?void 0:b.readyState)===WebSocket.OPEN&&ue.current.gameId){const I={type:"TRIGGER_DECK_SELECTION",gameId:ue.current.gameId,deckSelectionData:p};V.current.send(JSON.stringify(I))}else if(O.current){const I={type:"DECK_SELECTION_TRIGGERED",senderId:O.current.getPeerId(),data:p,timestamp:Date.now()};Z.current?O.current.broadcastToGuests(I):O.current.sendMessageToHost(I)}setTimeout(()=>{ee(I=>I.filter(g=>g.timestamp!==p.timestamp))},1e3)},[]),Oc=m.useCallback((u,T,p)=>{var I;const b={playerId:u,cardIndex:T,selectedByPlayerId:p,timestamp:Date.now()};if(Ie(g=>[...g,b]),((I=V.current)==null?void 0:I.readyState)===WebSocket.OPEN&&ue.current.gameId){const g={type:"TRIGGER_HAND_CARD_SELECTION",gameId:ue.current.gameId,handCardSelectionData:b};V.current.send(JSON.stringify(g))}else if(O.current){const g={type:"HAND_CARD_SELECTION_TRIGGERED",senderId:O.current.getPeerId(),data:b,timestamp:Date.now()};Z.current?O.current.broadcastToGuests(g):O.current.sendMessageToHost(g)}setTimeout(()=>{Ie(g=>g.filter(N=>N.timestamp!==b.timestamp))},1e3)},[]),ts=m.useCallback(u=>{var T;if(((T=V.current)==null?void 0:T.readyState)===WebSocket.OPEN&&ue.current.gameId)V.current.send(JSON.stringify({type:"SYNC_VALID_TARGETS",gameId:ue.current.gameId,playerId:we.current,...u}));else if(O.current){const p={type:"SYNC_VALID_TARGETS",senderId:O.current.getPeerId(),data:{playerId:we.current,...u},timestamp:Date.now()};Z.current?O.current.broadcastToGuests(p):O.current.sendMessageToHost(p)}},[]),Di=m.useCallback((u,T,p)=>{var I;if(we.current===null)return;const b={timestamp:Date.now(),location:u,boardCoords:T,handTarget:p,selectedByPlayerId:we.current};if(fe(g=>[...g,b]),((I=V.current)==null?void 0:I.readyState)===WebSocket.OPEN&&ue.current.gameId)V.current.send(JSON.stringify({type:"TRIGGER_TARGET_SELECTION",gameId:ue.current.gameId,effect:b}));else if(O.current)if(Z.current){const g={type:"TARGET_SELECTION_TRIGGERED",senderId:O.current.getPeerId(),data:b,timestamp:Date.now()};O.current.broadcastToGuests(g)}else{const g={type:"TRIGGER_TARGET_SELECTION",senderId:O.current.getPeerId(),data:b,timestamp:Date.now()};O.current.sendMessageToHost(g)}setTimeout(()=>{fe(g=>g.filter(N=>N.timestamp!==b.timestamp))},1e3)},[]),ns=m.useCallback((u,T,p,b,I)=>{var Xe,Et,wt,ft,Qt,Vt,gt;const g=ue.current;let N=[];b?N=b:N=hi(u,g,T,I);const S=[],z=u.mode==="SELECT_DECK";if((Xe=u.payload)!=null&&Xe.filter&&u.mode==="SELECT_TARGET"){const st=((Et=u.sourceCard)==null?void 0:Et.ownerId)||u.originalOwnerId||T,dt=g.players.find(ge=>ge.id===st);dt&&dt.hand&&dt.hand.forEach((ge,Ne)=>{try{u.payload.filter(ge)&&S.push({playerId:dt.id,cardIndex:Ne})}catch{}})}const le={playerId:T,action:u,sourceCoords:p,timestamp:Date.now(),boardTargets:N,handTargets:S.length>0?S:void 0,isDeckSelectable:z||void 0,originalOwnerId:u.originalOwnerId};l(st=>({...st,targetingMode:le})),ue.current.targetingMode=le,((wt=V.current)==null?void 0:wt.readyState)===WebSocket.OPEN&&g.gameId&&V.current.send(JSON.stringify({type:"SET_TARGETING_MODE",gameId:g.gameId,targetingMode:le})),O.current&&(Z.current?O.current.broadcastToGuests({type:"SET_TARGETING_MODE",senderId:((Qt=(ft=O.current).getPeerId)==null?void 0:Qt.call(ft))??void 0,data:{targetingMode:le},timestamp:Date.now()}):O.current.sendMessageToHost({type:"SET_TARGETING_MODE",senderId:((gt=(Vt=O.current).getPeerId)==null?void 0:gt.call(Vt))??void 0,data:{targetingMode:le},timestamp:Date.now()})),P.info(`[TargetingMode] Player ${T} activated targeting mode`,{mode:u.mode,boardTargetsCount:N.length})},[]),io=m.useCallback(()=>{var T,p,b,I,g;const u=ue.current;l(N=>({...N,targetingMode:null})),ue.current.targetingMode=null,((T=V.current)==null?void 0:T.readyState)===WebSocket.OPEN&&u.gameId&&V.current.send(JSON.stringify({type:"CLEAR_TARGETING_MODE",gameId:u.gameId})),O.current&&(Z.current?O.current.broadcastToGuests({type:"CLEAR_TARGETING_MODE",senderId:((b=(p=O.current).getPeerId)==null?void 0:b.call(p))??void 0,data:{timestamp:Date.now()},timestamp:Date.now()}):O.current.sendMessageToHost({type:"CLEAR_TARGETING_MODE",senderId:((g=(I=O.current).getPeerId)==null?void 0:g.call(I))??void 0,data:{timestamp:Date.now()},timestamp:Date.now()}))},[]),Lc=m.useCallback((u,T,p,b)=>{L(I=>{if(!I.isGameStarted)return I;const g=Ct(I),N=g.board[u.row][u.col].card;if(N){const S=N.statuses?N.statuses.map(z=>z.type):[];if(b&&N.statuses){N.statuses=N.statuses.filter(le=>le.type!==b);const z=N.statuses.map(le=>le.type);console.log(`[markAbilityUsed] Removed status '${b}' from ${N.name} at [${u.row},${u.col}]: [${S.join(", ")}] -> [${z.join(", ")}]`)}else console.log(`[markAbilityUsed] Called for ${N.name} at [${u.row},${u.col}] but no readyStatusToRemove specified. Current statuses: [${S.join(", ")}]`)}return g})},[L]),lo=m.useCallback(u=>{L(T=>{if(!T.isGameStarted)return T;const p=Ct(T),b=p.board[u.row][u.col].card;if(b&&(b.statuses||(b.statuses=[]),(b.ability||"").toLowerCase().includes("deploy:")&&!b.statuses.some(g=>g.type==="readyDeploy"))){const g=b.ownerId;if(g==null||g===0)return T;b.statuses.push({type:"readyDeploy",addedByPlayerId:g})}return p})},[L]),Ra=m.useCallback((u,T)=>{L(p=>{if(!p.isGameStarted)return p;const b=Ct(p),I=b.board[u.row][u.col].card;return I!=null&&I.statuses&&(I.statuses=I.statuses.filter(g=>g.type!==T)),b.board=Cn(b),b})},[L]),$r=m.useCallback((u,T,p,b,I)=>{L(g=>{if(!g.isGameStarted)return g;const N=Ct(g);return T.forEach(({row:S,col:z})=>{var Xe;const le=N.board[S][z].card;if(le){if(p==="Stun"&&(le.baseId==="luciusTheImmortal"||le.name.includes("Lucius")&&((Xe=le.types)!=null&&Xe.includes("Hero"))))return;le.statuses||(le.statuses=[]),["Support","Threat","Revealed"].includes(p)?le.statuses.some(wt=>wt.type===p&&wt.addedByPlayerId===b)||le.statuses.push({type:p,addedByPlayerId:b}):le.statuses.push({type:p,addedByPlayerId:b})}}),N})},[L]),Mc=m.useCallback((u,T)=>{L(p=>{if(!p.isGameStarted)return p;const b=Ct(p),I=b.board[u.row][u.col].card,g=b.board[T.row][T.col].card;return b.board[u.row][u.col].card=g,b.board[T.row][T.col].card=I,b.board=Cn(b),b})},[L]),Ri=m.useCallback((u,T,p)=>{L(b=>{if(!b.isGameStarted)return b;const I=Ct(b),g=I.board[u.row][u.col].card,N=I.board[T.row][T.col].card;if(g&&N&&g.statuses){const S=g.statuses.findIndex(z=>z.type===p);if(S>-1){const[z]=g.statuses.splice(S,1);N.statuses||(N.statuses=[]),N.statuses.push(z)}}return I.board=Cn(I),I})},[L]),or=m.useCallback((u,T)=>{L(p=>{if(!p.isGameStarted)return p;const b=Ct(p),I=b.board[u.row][u.col].card,g=b.board[T.row][T.col].card,N=["Support","Threat","LastPlayed"];if(I&&g&&I.statuses){const S=I.statuses.filter(le=>!N.includes(le.type)),z=I.statuses.filter(le=>N.includes(le.type));S.length>0&&(g.statuses||(g.statuses=[]),g.statuses.push(...S),I.statuses=z)}return b.board=Cn(b),b})},[L]),ja=m.useCallback((u,T)=>{L(p=>{if(!p.isGameStarted)return p;const b=Ct(p),I=b.players.find(g=>g.id===u);if(I&&I.discard.length>T){const[g]=I.discard.splice(T,1);I.hand.push(g)}return b})},[L]),zc=m.useCallback((u,T,p)=>{L(b=>{if(!b.isGameStarted)return b;const I=Ct(b);if(!lr)return b;const g=lr.tokenDatabase,N=Object.keys(g).find(le=>g[le].name===T);if(!N)return b;const S=g[N],z=I.players.find(le=>le.id===p);if(S&&I.board[u.row][u.col].card===null){const le={id:`TKN_${T.toUpperCase().replace(/\s/g,"_")}_${Date.now()}`,deck:it.Tokens,name:T,baseId:S.baseId||N,imageUrl:S.imageUrl,fallbackImage:S.fallbackImage,power:S.power,ability:S.ability,flavorText:S.flavorText,color:S.color,types:S.types||["Unit"],faction:"Tokens",ownerId:p,ownerName:z==null?void 0:z.name,enteredThisTurn:!0,statuses:[]};hd(le,p),I.board[u.row][u.col].card=le}return I.board=Cn(I),I})},[L]),rs=m.useCallback((u,T,p,b,I)=>{var Vt,gt;const g=ue.current;if(!g.isGameStarted||g.isRoundEndModalOpen)return;const N=g.board.some(st=>st.some(dt=>{var ge,Ne;return((ge=dt.card)==null?void 0:ge.ownerId)===I&&dt.card.name.toLowerCase().includes("data liberator")&&((Ne=dt.card.statuses)==null?void 0:Ne.some(Ge=>Ge.type==="Support"))})),S=g.board.length;let z=u,le=u,Xe=T,Et=T;if(u===p)z=u,le=u,Xe=0,Et=S-1;else if(T===b)Xe=T,Et=T,z=0,le=S-1;else return;let wt=0;const ft=[];for(let st=z;st<=le;st++)for(let dt=Xe;dt<=Et;dt++){const Ne=g.board[st][dt].card;if(Ne&&!((Vt=Ne.statuses)!=null&&Vt.some(Ge=>Ge.type==="Stun"))){const Ge=Ne.ownerId===I,rt=(gt=Ne.statuses)==null?void 0:gt.some(Ve=>Ve.type==="Exploit"&&Ve.addedByPlayerId===I);if(Ge||N&&rt&&Ne.ownerId!==I){const Ve=Math.max(0,Ne.power+(Ne.powerModifier||0)+(Ne.bonusPower||0));Ve>0&&(wt+=Ve,ft.push({row:st,col:dt,text:`+${Ve}`,playerId:I}))}}}ft.length>0&&_a(ft);const Qt=localStorage.getItem("webrtc_enabled")==="true";Qt?L(st=>({...st,players:st.players.map(dt=>dt.id===I?{...dt,score:Math.max(0,(dt.score||0)+wt)}:dt)})):In(I,wt),Qt||In(I,wt),wt>0&&g.currentPhase===4&&g.activePlayerId===I&&setTimeout(()=>{var st;Qt?L(dt=>dl(dt)):((st=V.current)==null?void 0:st.readyState)===WebSocket.OPEN&&V.current.send(JSON.stringify({type:"NEXT_PHASE",gameId:g.gameId}))},100)},[_a,In,L]),$c=m.useCallback((u,T,p,b,I,g)=>{var Qt,Vt;const N=ue.current;if(!N.isGameStarted||N.isRoundEndModalOpen)return;const S=p>u?1:-1,z=b>T?1:-1,le=Math.abs(u-p);let Xe=0,Et=0;const wt=[];for(let gt=0;gt<=le;gt++){const st=u+gt*S,dt=T+gt*z;if(st<0||st>=N.board.length||dt<0||dt>=N.board.length)continue;const Ne=N.board[st][dt].card;if(Ne&&!((Qt=Ne.statuses)!=null&&Qt.some(Ge=>Ge.type==="Stun"))&&Ne.ownerId===I){const rt=Math.max(0,Ne.power+(Ne.powerModifier||0)+(Ne.bonusPower||0));rt>0&&(Xe+=rt,wt.push({row:st,col:dt,text:`+${rt}`,playerId:I})),g&&((Vt=Ne.statuses)!=null&&Vt.some(Ve=>Ve.type==="Support"&&Ve.addedByPlayerId===I))&&(Et+=1)}}g==="point_per_support"&&Et>0&&(Xe+=Et),wt.length>0&&_a(wt);const ft=localStorage.getItem("webrtc_enabled")==="true";ft?L(gt=>({...gt,players:gt.players.map(st=>st.id===I?{...st,score:Math.max(0,(st.score||0)+Xe)}:st)})):In(I,Xe),ft||In(I,Xe),g==="draw_per_support"&&Et>0&&L(gt=>{const st=Ct(gt),dt=st.players.find(ge=>ge.id===I);if(dt&&dt.deck.length>0)for(let ge=0;ge<Et;ge++)dt.deck.length>0&&dt.hand.push(dt.deck.shift());return st}),Xe>0&&N.currentPhase===4&&N.activePlayerId===I&&setTimeout(()=>{var gt;ft?L(st=>dl(st)):((gt=V.current)==null?void 0:gt.readyState)===WebSocket.OPEN&&V.current.send(JSON.stringify({type:"NEXT_PHASE",gameId:N.gameId}))},500)},[_a,In,L]);return{gameState:s,localPlayerId:f,setLocalPlayerId:h,draggedItem:v,setDraggedItem:w,connectionStatus:_,gamesList:D,latestHighlight:y,latestFloatingTexts:j,latestNoTarget:A,latestDeckSelections:K,latestHandCardSelections:re,createGame:Ue,joinGame:Ee,joinGameViaModal:Pe,joinAsInvite:Ae,requestGamesList:Me,exitGame:ut,startReadyCheck:Ze,cancelReadyCheck:at,playerReady:Gt,assignTeams:Rt,setGameMode:hn,setGamePrivacy:rn,setActiveGridSize:bt,setDummyPlayerCount:mr,updatePlayerName:Ia,changePlayerColor:mt,updatePlayerScore:In,changePlayerDeck:Ii,loadCustomDeck:Sa,drawCard:ct,drawCardsBatch:_r,shufflePlayerDeck:so,moveItem:Qo,handleDrop:Qo,addBoardCardStatus:gr,removeBoardCardStatus:ro,removeBoardCardStatusByOwner:yr,modifyBoardCardPower:_c,addAnnouncedCardStatus:ki,removeAnnouncedCardStatus:Ti,modifyAnnouncedCardPower:Dc,addHandCardStatus:Rc,removeHandCardStatus:Ea,flipBoardCard:Ei,flipBoardCardFaceDown:jc,revealHandCard:Yn,revealBoardCard:on,requestCardReveal:_t,respondToRevealRequest:ao,syncGame:an,removeRevealedStatus:oo,toggleActivePlayer:ar,toggleAutoDraw:qn,forceReconnect:De,triggerHighlight:Ac,triggerFloatingText:_a,triggerNoTarget:Dr,triggerDeckSelection:Da,triggerHandCardSelection:Oc,triggerTargetSelection:Di,targetSelectionEffects:B,syncValidTargets:ts,remoteValidTargets:he,setTargetingMode:ns,clearTargetingMode:io,nextPhase:Xo,prevPhase:Zo,setPhase:Si,markAbilityUsed:Lc,applyGlobalEffect:$r,swapCards:Mc,transferStatus:Ri,transferAllCounters:or,recoverDiscardedCard:ja,resurrectDiscardedCard:Nc,spawnToken:zc,scoreLine:rs,closeRoundEndModal:Zt,closeRoundEndModalOnly:Sn,resetGame:Pc,resetDeployStatus:lo,scoreDiagonal:$c,removeStatusByType:Ra,reorderTopDeck:_i,reorderCards:es,updateState:L,webrtcHostId:H,webrtcIsHost:de,initializeWebrtcHost:me,connectAsGuest:Y,sendWebrtcAction:X,isReconnecting:Oe,reconnectProgress:Ce}},kC=({gameState:e,localPlayerId:t,abilityMode:n,setAbilityMode:r,cursorStack:a,setCursorStack:o,commandContext:s,setCommandContext:l,setViewingDiscard:c,triggerNoTarget:d,triggerTargetSelection:f,setPlayMode:h,setCounterSelectionData:v,interactionLock:w,onAbilityComplete:_,updateState:C,moveItem:D,drawCard:x,drawCardsBatch:y,updatePlayerScore:k,markAbilityUsed:j,applyGlobalEffect:$,swapCards:A,transferStatus:M,transferAllCounters:K,resurrectDiscardedCard:ee,spawnToken:re,scoreLine:Ie,nextPhase:B,modifyBoardCardPower:fe,addBoardCardStatus:he,removeBoardCardStatus:ke,removeBoardCardStatusByOwner:ie,resetDeployStatus:ae,scoreDiagonal:J,removeStatusByType:q,triggerFloatingText:H,triggerHandCardSelection:ne,clearValidTargets:de,setTargetingMode:xe,clearTargetingMode:Z})=>{const Oe=m.useCallback((E,U)=>{var Te,ve,O,et,ue,we,pt,Nt,Wt,ht,Fe,se,Q;if(E.type==="ABILITY_COMPLETE"){_==null||_();return}if(E.type==="REVEREND_SETUP_SCORE"){const me=((Te=E.sourceCard)==null?void 0:Te.ownerId)??0;let Y=0;for(let X=0;X<e.board.length;X++)for(let L=0;L<e.board[X].length;L++){const be=(ve=e.board[X][L])==null?void 0:ve.card;if(be!=null&&be.statuses){const De=be.statuses.filter(Ee=>Ee.type==="Exploit"&&Ee.addedByPlayerId===me);Y+=De.length}}Y>0?(k(me,Y),H([{row:U.row,col:U.col,text:`+${Y}`,playerId:me}])):H([{row:U.row,col:U.col,text:"+0",playerId:me}]),j(U,!!E.isDeployAbility,!1,E.readyStatusToRemove);return}if(E.type==="GLOBAL_AUTO_APPLY"){if(((O=E.payload)==null?void 0:O.customAction)==="FINN_SCORING"){let me=0;const Y=(et=E.sourceCard)==null?void 0:et.ownerId;if(Y===void 0){console.warn("[FINN_SCORING] Source card missing ownerId, skipping scoring"),j(E.sourceCoords||U,!!E.isDeployAbility,!1,E.readyStatusToRemove);return}if(e.players.forEach(X=>{X.id!==Y&&X.hand.forEach(L=>{var be;(be=L.statuses)!=null&&be.some(De=>De.type==="Revealed"&&De.addedByPlayerId===Y)&&me++})}),e.board.forEach(X=>{X.forEach(L=>{var De;const be=L.card;if(be&&be.ownerId!==Y){const Ee=((De=be.statuses)==null?void 0:De.filter(Pe=>Pe.type==="Revealed"&&Pe.addedByPlayerId===Y).length)||0;me+=Ee}})}),me>0){const X=E.sourceCoords||U;H({row:X.row,col:X.col,text:`+${me}`,playerId:Y}),k(Y,me)}j(E.sourceCoords||U,!!E.isDeployAbility,!1,E.readyStatusToRemove);return}if(((ue=E.payload)==null?void 0:ue.customAction)==="REMOVE_ALL_AIM_FROM_CONTEXT"){E.sourceCoords&&E.sourceCoords.row>=0?q(E.sourceCoords,"Aim"):s.lastMovedCardCoords?q(s.lastMovedCardCoords,"Aim"):U&&U.row>=0&&q(U,"Aim");return}if(E.payload&&!E.payload.cleanupCommand){const{tokenType:me,filter:Y}=E.payload,X=[],L=e.board.length;if(E.payload.contextReward&&E.sourceCard){let be=0;const De=U&&U.row>=0?U:s.lastMovedCardCoords;if(De){const{row:Ee,col:Pe}=De;let Ae=e.board[Ee][Pe].card;const Ue=E.payload._tempContextId||s.lastMovedCardId;if((!Ae||Ue&&Ae.id!==Ue)&&Ue)for(let Me=0;Me<L;Me++){for(let ut=0;ut<L;ut++)if(((we=e.board[Me][ut].card)==null?void 0:we.id)===Ue){Ae=e.board[Me][ut].card;break}if(Ae)break}Ae&&(be=Math.max(0,Ae.power+(Ae.powerModifier||0)+(Ae.bonusPower||0)))}if(be>0){const Ee=E.sourceCard.ownerId;if(Ee===void 0){console.error("Cannot apply reward: sourceCard has no ownerId");return}const Pe=E.payload.contextReward;Pe==="DRAW_MOVED_POWER"||Pe==="DRAW_EQUAL_POWER"?y(Ee,be):Pe==="SCORE_MOVED_POWER"&&(H({row:U.row,col:U.col,text:`+${be}`,playerId:Ee}),k(Ee,be))}if(E.payload.contextReward==="STUN_MOVED_UNIT"&&De){const Ee=E.sourceCard.ownerId;Ee!==void 0?he(De,"Stun",Ee):console.error("Cannot apply stun: sourceCard has no ownerId")}return}if(Y)for(let be=0;be<L;be++)for(let De=0;De<L;De++){const Ee=e.board[be][De].card;Ee&&Y(Ee)&&X.push({row:be,col:De})}else E.sourceCoords&&E.sourceCoords.row>=0?X.push(E.sourceCoords):U&&U.row>=0?X.push(U):s.lastMovedCardCoords&&X.push(s.lastMovedCardCoords);if(X.length>0){if(me){const be=E.payload.count||1,De=E.payload.ownerId!==void 0?E.payload.ownerId:((pt=E.sourceCard)==null?void 0:pt.ownerId)??t;for(let Ee=0;Ee<be;Ee++)$(U,X,me,De,!!E.isDeployAbility)}}else d(U),j(U,!!E.isDeployAbility,!1,E.readyStatusToRemove);return}}if(!Es(E,e,((Nt=E.sourceCard)==null?void 0:Nt.ownerId)||t,s)){d(U),E.chainedAction&&setTimeout(()=>{Oe(E.chainedAction,U)},500);return}if(E.type==="CREATE_STACK"&&E.tokenType){let me=E.count||0;if(E.dynamicCount){const{factor:Y,ownerId:X}=E.dynamicCount;let L=0;e.board.forEach(be=>be.forEach(De=>{var Ee;if((Ee=De.card)!=null&&Ee.statuses){const Pe=De.card.statuses.filter(Ae=>Ae.type===Y&&Ae.addedByPlayerId===X);L+=Pe.length}})),me=L}me>0?(r(null),o({type:E.tokenType,count:me,isDragging:!1,sourceCoords:U,sourceCard:E.sourceCard,originalOwnerId:E.originalOwnerId,excludeOwnerId:E.excludeOwnerId,onlyOpponents:E.onlyOpponents,onlyFaceDown:E.onlyFaceDown,targetType:E.targetType,isDeployAbility:E.isDeployAbility,readyStatusToRemove:E.readyStatusToRemove,requiredTargetStatus:E.requiredTargetStatus,requireStatusFromSourceOwner:E.requireStatusFromSourceOwner,mustBeAdjacentToSource:E.mustBeAdjacentToSource,mustBeInLineWithSource:E.mustBeInLineWithSource,maxDistanceFromSource:E.maxDistanceFromSource,maxOrthogonalDistance:E.maxOrthogonalDistance,placeAllAtOnce:E.placeAllAtOnce,chainedAction:E.chainedAction,...E.targetOwnerId!==void 0&&{targetOwnerId:E.targetOwnerId},recordContext:E.recordContext,replaceStatus:E.replaceStatus})):d(U)}else if(E.type==="ENTER_MODE"){if(E.mode==="SHIELD_SELF_THEN_SPAWN"){he(U,"Shield",E.sourceCard.ownerId),r({type:"ENTER_MODE",mode:"SPAWN_TOKEN",sourceCard:E.sourceCard,sourceCoords:U,isDeployAbility:E.isDeployAbility,payload:E.payload});return}if(E.mode==="SHIELD_SELF_THEN_RIOT_PUSH"){const L=E.sourceCard.ownerId;he(U,"Shield",L);const be=e.board.length,De=Math.floor((be-e.activeGridSize)/2),Ee=De,Pe=De+e.activeGridSize-1;let Ae=!1;const{row:Ue,col:Me}=U,ut=[[-1,0],[1,0],[0,-1],[0,1]];for(const[Ze,at]of ut){const Gt=Ue+Ze,Rt=Me+at;if(Gt<Ee||Gt>Pe||Rt<Ee||Rt>Pe)continue;const hn=e.board[Gt][Rt];if(!hn.card)continue;const rn=e.players.find(yr=>yr.id===hn.card.ownerId),an=e.players.find(yr=>yr.id===L),bt=(rn==null?void 0:rn.teamId)!==void 0&&(an==null?void 0:an.teamId)!==void 0&&rn.teamId===an.teamId;if(hn.card.ownerId===L||bt)continue;const mr=Gt+Ze,gr=Rt+at;if(mr<Ee||mr>Pe||gr<Ee||gr>Pe)continue;if(e.board[mr][gr].card===null){Ae=!0;break}}Ae?r({type:"ENTER_MODE",mode:"RIOT_PUSH",sourceCard:E.sourceCard,sourceCoords:U,isDeployAbility:E.isDeployAbility,payload:E.payload}):d(U);return}if(E.mode==="PRINCEPS_SHIELD_THEN_AIM"){const L=E.sourceCard.ownerId;he(U,"Shield",L);const be={type:"CREATE_STACK",tokenType:"Aim",mustBeInLineWithSource:!0,sourceCard:E.sourceCard,sourceCoords:U,isDeployAbility:E.isDeployAbility};Es(be,e,L,s)?o({type:"Aim",count:1,isDragging:!1,sourceCoords:U,sourceCard:E.sourceCard,originalOwnerId:E.originalOwnerId,mustBeInLineWithSource:!0,isDeployAbility:E.isDeployAbility,readyStatusToRemove:E.readyStatusToRemove}):d(U);return}if(E.mode==="GAWAIN_DEPLOY_SHIELD_AIM"){const L=E.sourceCard.ownerId;he(U,"Shield",L);const be={type:"CREATE_STACK",tokenType:"Aim",mustBeInLineWithSource:!0,sourceCard:E.sourceCard,sourceCoords:U,isDeployAbility:E.isDeployAbility};Es(be,e,L,s)?o({type:"Aim",count:1,isDragging:!1,sourceCoords:U,sourceCard:E.sourceCard,originalOwnerId:E.originalOwnerId,mustBeInLineWithSource:!0,isDeployAbility:E.isDeployAbility,readyStatusToRemove:E.readyStatusToRemove}):d(U);return}if(E.mode==="ABR_DEPLOY_SHIELD_AIM"){const L=E.sourceCard.ownerId;he(U,"Shield",L);const be={type:"CREATE_STACK",tokenType:"Aim",requiredTargetStatus:"Threat",requireStatusFromSourceOwner:!0,sourceCard:E.sourceCard,sourceCoords:U,isDeployAbility:E.isDeployAbility};Es(be,e,L,s)?o({type:"Aim",count:1,isDragging:!1,sourceCoords:U,sourceCard:E.sourceCard,originalOwnerId:E.originalOwnerId,targetOwnerId:L,requiredTargetStatus:"Threat",requireStatusFromSourceOwner:!0,isDeployAbility:E.isDeployAbility,readyStatusToRemove:E.readyStatusToRemove}):d(U);return}if(E.mode==="RIOT_PUSH"&&E.sourceCoords){const L=e.board.length,be=Math.floor((L-e.activeGridSize)/2),De=be,Ee=be+e.activeGridSize-1;let Pe=!1;const{row:Ae,col:Ue}=E.sourceCoords,Me=(Wt=E.sourceCard)==null?void 0:Wt.ownerId,ut=[[-1,0],[1,0],[0,-1],[0,1]];for(const[Ze,at]of ut){const Gt=Ae+Ze,Rt=Ue+at;if(Gt<De||Gt>Ee||Rt<De||Rt>Ee)continue;const hn=e.board[Gt][Rt];if(!hn.card||Me===void 0)continue;const rn=e.players.find(yr=>yr.id===hn.card.ownerId),an=e.players.find(yr=>yr.id===Me),bt=(rn==null?void 0:rn.teamId)!==void 0&&(an==null?void 0:an.teamId)!==void 0&&rn.teamId===an.teamId;if(hn.card.ownerId===Me||bt)continue;const mr=Gt+Ze,gr=Rt+at;if(mr<De||mr>Ee||gr<De||gr>Ee)continue;if(e.board[mr][gr].card===null){Pe=!0;break}}if(!Pe){d(E.sourceCoords);return}}if(E.mode==="SELECT_TARGET"&&((ht=E.payload)==null?void 0:ht.actionType)==="SELECT_HAND_FOR_DISCARD_THEN_SPAWN"&&E.sourceCard){const L=E.sourceCard.ownerId,be=e.players.find(De=>De.id===L);if(be&&be.hand.length<1){d(E.sourceCoords||U);return}}if(E.mode==="SELECT_TARGET"&&((Fe=E.payload)==null?void 0:Fe.actionType)==="LUCIUS_SETUP"&&E.sourceCard){const L=E.sourceCard.ownerId,be=e.players.find(De=>De.id===L);if(be&&be.hand.length<1){d(E.sourceCoords||U);return}}let me=E.sourceCard,Y=U;if(E.sourceCoords&&E.sourceCoords.row>=0&&(Y=E.sourceCoords),E.mode==="SELECT_CELL"&&s.lastMovedCardCoords&&s.lastMovedCardId&&((se=E.payload)!=null&&se.useContextCard)){const{row:L,col:be}=s.lastMovedCardCoords,De=e.board[L][be].card;De&&(me=De,Y=s.lastMovedCardCoords)}r({...E,sourceCard:me,sourceCoords:Y});const X=((Q=E.sourceCard)==null?void 0:Q.ownerId)??e.activePlayerId??t??1;xe(E,X,Y,void 0,s)}else if(E.type==="OPEN_MODAL")if(E.mode==="RETRIEVE_DEVICE"){const me=e.players.find(Y=>{var X;return Y.id===((X=E.sourceCard)==null?void 0:X.ownerId)});me&&(c({player:me,pickConfig:{filterType:"Device",action:"recover"}}),U.row>=0&&j(U,!!E.isDeployAbility,!1,E.readyStatusToRemove))}else if(E.mode==="IMMUNIS_RETRIEVE"){const me=e.players.find(Y=>{var X;return Y.id===((X=E.sourceCard)==null?void 0:X.ownerId)});me&&(c({player:me,pickConfig:{filterType:"Optimates",action:"resurrect"}}),r({type:"ENTER_MODE",mode:"IMMUNIS_RETRIEVE",sourceCard:E.sourceCard,sourceCoords:U,isDeployAbility:E.isDeployAbility,payload:E.payload}))}else if(E.mode==="SEARCH_DECK"){const me=e.players.find(Y=>{var X;return Y.id===((X=E.sourceCard)==null?void 0:X.ownerId)});me&&(c({player:me,pickConfig:{filterType:E.payload.filterType||"Unit",action:"recover",isDeck:!0}}),U.row>=0&&j(U,!!E.isDeployAbility,!1,E.readyStatusToRemove))}else E.mode==="ZIUS_LINE_SELECT"?s.lastMovedCardCoords?r({type:"ENTER_MODE",mode:"ZIUS_LINE_SELECT",sourceCard:E.sourceCard,sourceCoords:s.lastMovedCardCoords,isDeployAbility:E.isDeployAbility,payload:E.payload,chainedAction:E.chainedAction}):r({type:"ENTER_MODE",mode:"ZIUS_LINE_SELECT",sourceCard:E.sourceCard,sourceCoords:U,isDeployAbility:E.isDeployAbility,payload:E.payload,chainedAction:E.chainedAction}):E.mode==="SELECT_DECK"?r({type:"ENTER_MODE",mode:"SELECT_DECK",sourceCard:E.sourceCard,sourceCoords:U,isDeployAbility:E.isDeployAbility,payload:E.payload}):E.mode==="ZIUS_EXPLOIT_AND_SCORE"?r({type:"ENTER_MODE",mode:"ZIUS_EXPLOIT_AND_SCORE",sourceCard:E.sourceCard,sourceCoords:U,isDeployAbility:E.isDeployAbility,payload:E.payload}):E.mode==="REVEREND_DOUBLE_EXPLOIT"&&r({type:"ENTER_MODE",mode:"REVEREND_DOUBLE_EXPLOIT",sourceCard:E.sourceCard,sourceCoords:U,isDeployAbility:E.isDeployAbility,payload:E.payload})},[e,t,s,j,r,o,d,$,c,he,k,x,q,_,H,xe]);m.useEffect(()=>{(n==null?void 0:n.type)==="GLOBAL_AUTO_APPLY"&&(Oe(n,n.sourceCoords||{row:-1,col:-1}),r(null))},[n,Oe,r]),m.useEffect(()=>{n||Z()},[n,Z]);const Re=m.useCallback((E,U)=>{if(n||a||!e.isGameStarted||t===null)return;const te=e.players.find(O=>O.id===E.ownerId),Te=t===E.ownerId||(te==null?void 0:te.isDummy)&&t===1;if(e.activePlayerId!==E.ownerId||!Te||!Mf(E,e)||!Iu(E,e.currentPhase,e.activePlayerId,e))return;const ve=nx(E,e,E.ownerId,U);if(ve){ve.readyStatusToRemove&&j(U,!!ve.isDeployAbility,!1,ve.readyStatusToRemove);const O={...ve,chainedAction:ve.chainedAction?{...ve.chainedAction,chainedAction:{type:"ABILITY_COMPLETE"}}:{type:"ABILITY_COMPLETE"}};Oe(O,U)}},[n,a,e,t,Oe,j]),Ce=m.useCallback(E=>{var ue,we,pt,Nt,Wt;if(!n)return;const{mode:U,sourceCard:te,sourceCoords:Te,payload:ve,isDeployAbility:O,readyStatusToRemove:et}=n;if(U==="SCORE_LAST_PLAYED_LINE"&&n.sourceCoords){if(w.current)return;const{row:ht,col:Fe}=n.sourceCoords,{row:se,col:Q}=E;if(ht!==se&&Fe!==Q)return;w.current=!0;const me=e.activePlayerId,Y=e.board.length;let X=ht,L=ht,be=Fe,De=Fe;if(ht===se)X=ht,L=ht,be=0,De=Y-1;else if(Fe===Q)be=Q,De=Q,X=0,L=Y-1;else{w.current=!1;return}const Ee=e.board.some(Ue=>Ue.some(Me=>{var ut,Ze;return((ut=Me.card)==null?void 0:ut.ownerId)===me&&Me.card.name.toLowerCase().includes("data liberator")&&((Ze=Me.card.statuses)==null?void 0:Ze.some(at=>at.type==="Support"))}));let Pe=0;const Ae=[];for(let Ue=X;Ue<=L;Ue++)for(let Me=be;Me<=De;Me++){const Ze=e.board[Ue][Me].card;if(Ze&&!((ue=Ze.statuses)!=null&&ue.some(at=>at.type==="Stun"))){const at=Ze.ownerId===me,Gt=(we=Ze.statuses)==null?void 0:we.some(Rt=>Rt.type==="Exploit"&&Rt.addedByPlayerId===me);if(at||Ee&&Gt&&Ze.ownerId!==me){const Rt=Math.max(0,Ze.power+(Ze.powerModifier||0)+(Ze.bonusPower||0));Rt>0&&(Pe+=Rt,Ae.push({row:Ue,col:Me,text:`+${Rt}`,playerId:me}))}}}r(null),Ae.length>0&&H(Ae),Pe>0&&k(me,Pe),B(),setTimeout(()=>{w.current=!1},200);return}if(U==="SELECT_LINE_START"){r({type:"ENTER_MODE",mode:"SELECT_LINE_END",sourceCard:te,sourceCoords:Te,isDeployAbility:O,payload:{...ve,firstCoords:E}});return}if(U==="SELECT_LINE_END"&&(ve!=null&&ve.firstCoords)){const{row:ht,col:Fe}=ve.firstCoords,{row:se,col:Q}=E;if(ht!==se&&Fe!==Q)return;const me=ve.actionType,Y=(te==null?void 0:te.ownerId)??((pt=e.players.find(X=>X.id===e.activePlayerId))!=null&&pt.isDummy?e.activePlayerId:t||e.activePlayerId);if(me==="ZIUS_SCORING"){const X=s.lastMovedCardCoords;if(X){const Ue=ht===se&&X.row===ht,Me=Fe===Q&&X.col===Fe;if(!Ue&&!Me)return}const L=e.board.length;let be=0,De=L-1,Ee=0,Pe=L-1;if(ht===se)be=De=ht;else if(Fe===Q)Ee=Pe=Fe;else return;let Ae=0;for(let Ue=be;Ue<=De;Ue++)for(let Me=Ee;Me<=Pe;Me++){const ut=e.board[Ue][Me];ut.card&&(Ae+=((Nt=ut.card.statuses)==null?void 0:Nt.filter(Ze=>Ze.type==="Exploit"&&Ze.addedByPlayerId===Y).length)||0)}Ae>0&&Y&&(Te&&H({row:Te.row,col:Te.col,text:`+${Ae}`,playerId:Y}),k(Y,Ae)),Te&&Te.row>=0&&j(Te,O,!1,et)}else if(me==="CENTURION_BUFF"&&te&&Te&&Y){const X=e.board.length;let L=0,be=X-1,De=0,Ee=X-1;ht===se?L=be=ht:De=Ee=Fe;for(let Pe=L;Pe<=be;Pe++)for(let Ae=De;Ae<=Ee;Ae++){const Ue=e.board[Pe][Ae].card;if(Ue){const Me=Ue.id===te.id,ut=Ue.ownerId===Y,Ze=e.players.find(Rt=>Rt.id===Y),at=e.players.find(Rt=>Rt.id===Ue.ownerId),Gt=(Ze==null?void 0:Ze.teamId)!==void 0&&(at==null?void 0:at.teamId)!==void 0&&Ze.teamId===at.teamId;!Me&&(ut||Gt)&&fe({row:Pe,col:Ae},1)}}j(Te,O,!1,et)}else(me==="SCORE_LINE"||!me)&&(Ie(ht,Fe,se,Q,Y),ve.skipNextPhase||B());setTimeout(()=>r(null),nt.MODE_CLEAR_DELAY)}if(U==="SELECT_DIAGONAL"&&ve.actionType==="SCORE_DIAGONAL"){const ht=(te==null?void 0:te.ownerId)??((Wt=e.players.find(Fe=>Fe.id===e.activePlayerId))!=null&&Wt.isDummy?e.activePlayerId:t||e.activePlayerId);if(ve.firstCoords){const{row:Fe,col:se}=ve.firstCoords,{row:Q,col:me}=E;if(Math.abs(Fe-Q)!==Math.abs(se-me)){r(null);return}J(Fe,se,Q,me,ht,ve.bonusType),ve.skipNextPhase||B(),r(null);return}else{r({...n,payload:{...ve,firstCoords:E}});return}}},[n,e,t,Ie,B,r,fe,j,J,k,H,s,C]),Le=m.useCallback((E,U)=>{var te,Te,ve,O,et,ue,we,pt,Nt,Wt,ht,Fe;if(a&&h!==null&&h!==void 0){const se={targetOwnerId:a.targetOwnerId,excludeOwnerId:a.excludeOwnerId,onlyOpponents:a.onlyOpponents||a.targetOwnerId===-1,onlyFaceDown:a.onlyFaceDown,targetType:a.targetType,requiredTargetStatus:a.requiredTargetStatus,tokenType:a.type};va({card:E,ownerId:E.ownerId,location:"board"},se,e.activePlayerId,e.players)&&a.type==="Aim"&&(D({card:{id:"dummy",deck:"counter",name:"",imageUrl:"",fallbackImage:"",power:0,ability:"",types:[]},source:"counter_panel",statusType:"Aim",count:1},{target:"board",boardCoords:U}),a.sourceCoords&&a.sourceCoords.row>=0&&j(a.sourceCoords,a.isDeployAbility,!1,a.readyStatusToRemove),a.count>1?o(me=>me?{...me,count:me.count-1}:null):(a.chainedAction&&Oe(a.chainedAction,a.sourceCoords||{row:-1,col:-1}),o(null)));return}if(!w.current){if(n&&(n.mode==="SCORE_LAST_PLAYED_LINE"||n.mode==="SELECT_LINE_END")){Ce(U);return}if((n==null?void 0:n.type)==="ENTER_MODE"){if(n.sourceCard&&n.sourceCard.id===E.id&&n.mode!=="SELECT_LINE_START"&&n.mode!=="INTEGRATOR_LINE_SELECT"&&n.mode!=="ZIUS_LINE_SELECT"&&n.mode!=="SELECT_UNIT_FOR_MOVE"&&n.mode!=="SELECT_TARGET"&&n.mode!=="RIOT_PUSH"&&n.mode!=="RIOT_MOVE"&&n.mode!=="REVEREND_DOUBLE_EXPLOIT")return;const{mode:se,payload:Q,sourceCard:me,sourceCoords:Y,isDeployAbility:X,readyStatusToRemove:L,originalOwnerId:be,recordContext:De}=n;if(se==="SELECT_LINE_START"||se==="SELECT_LINE_END"){Ce(U);return}const Ee=(me==null?void 0:me.ownerId)??((te=e.players.find(Pe=>Pe.id===e.activePlayerId))!=null&&te.isDummy?e.activePlayerId:t||e.activePlayerId);if(se==="SELECT_TARGET"&&Q.tokenType){if(Q.filter&&!Q.filter(E,U.row,U.col))return;if(D({card:{id:"dummy",deck:"counter",name:"",imageUrl:"",fallbackImage:"",power:0,ability:"",types:[]},source:"counter_panel",statusType:Q.tokenType,count:Q.count||1},{target:"board",boardCoords:U}),f("board",U),De&&l({lastMovedCardCoords:U,lastMovedCardId:E.id}),Q.chainedAction){const Pe={...Q.chainedAction,sourceCard:Q.chainedAction.sourceCard??E,sourceCoords:Q.chainedAction.sourceCoords??U,isDeployAbility:X,recordContext:!0};Oe(Pe,U),setTimeout(()=>f("board",U),100),Pe.type!=="ENTER_MODE"&&r(null)}else Y&&Y.row>=0&&j(Y,X,!1,L),setTimeout(()=>r(null),nt.MODE_CLEAR_DELAY);return}if(se==="SELECT_TARGET"&&Q.actionType==="OPEN_COUNTER_MODAL"){if(Q.filter&&!Q.filter(E))return;v({card:E,callbackAction:Q.rewardType}),r(null);return}if(se==="SELECT_TARGET"&&Q.actionType==="SACRIFICE_AND_BUFF_LINES"){if(Q.filter&&!Q.filter(E,U.row,U.col))return;D({card:E,source:"board",boardCoords:U,bypassOwnershipCheck:!0},{target:"discard",playerId:E.ownerId});const Pe=e.board.length,{row:Ae,col:Ue}=U;for(let Me=0;Me<Pe;Me++){if(Me===Ue)continue;const Ze=e.board[Ae][Me].card;Ze&&(Ze.ownerId===Ee||((Te=e.players.find(at=>at.id===Ee))==null?void 0:Te.teamId)!==void 0&&((ve=e.players.find(at=>at.id===Ze.ownerId))==null?void 0:ve.teamId)===((O=e.players.find(at=>at.id===Ee))==null?void 0:O.teamId))&&fe({row:Ae,col:Me},1)}for(let Me=0;Me<Pe;Me++){if(Me===Ae)continue;const Ze=e.board[Me][Ue].card;Ze&&(Ze.ownerId===Ee||((et=e.players.find(at=>at.id===Ee))==null?void 0:et.teamId)!==void 0&&((ue=e.players.find(at=>at.id===Ze.ownerId))==null?void 0:ue.teamId)===((we=e.players.find(at=>at.id===Ee))==null?void 0:we.teamId))&&fe({row:Me,col:Ue},1)}Y&&Y.row>=0&&j(Y,X,!1,L),setTimeout(()=>r(null),nt.MODE_CLEAR_DELAY);return}if(se==="REVEREND_DOUBLE_EXPLOIT"){if(!Ee)return;const Pe=Ee,Ae=(E.statuses||[]).filter(Ue=>Ue.type==="Exploit"&&Ue.addedByPlayerId===Pe).length;for(let Ue=0;Ue<Ae;Ue++)D({card:{id:"dummy",deck:"counter",name:"",imageUrl:"",fallbackImage:"",power:0,ability:"",types:[]},source:"counter_panel",statusType:"Exploit",count:1},{target:"board",boardCoords:U});Y&&Y.row>=0&&j(Y,X,!1,L),setTimeout(()=>r(null),nt.MODE_CLEAR_DELAY);return}if(se==="SELECT_TARGET"&&Q.actionType==="DESTROY"){if(Q.handOnly||Q.filter&&!Q.filter(E,U.row,U.col))return;if(((pt=E.statuses)==null?void 0:pt.some(Ae=>Ae.type==="Shield"))?ke(U,"Shield"):D({card:E,source:"board",boardCoords:U,bypassOwnershipCheck:!0},{target:"discard",playerId:E.ownerId}),Q.chainedAction){const Ae={...Q.chainedAction,sourceCard:me,sourceCoords:Y,isDeployAbility:X};Oe(Ae,Y),Ae.type!=="ENTER_MODE"&&r(null)}else Y&&Y.row>=0&&j(Y,X,!1,L),setTimeout(()=>r(null),nt.MODE_CLEAR_DELAY);return}if(se==="SELECT_TARGET"&&Q.actionType==="DRAW_EQUAL_POWER"){if(Q.filter&&!Q.filter(E))return;const Pe=Math.max(0,E.power+(E.powerModifier||0));for(let Ae=0;Ae<Pe;Ae++)x(Ee);setTimeout(()=>r(null),nt.MODE_CLEAR_DELAY);return}if(se==="SELECT_TARGET"&&Q.actionType==="SCORE_EQUAL_POWER"){if(Q.filter&&!Q.filter(E))return;const Pe=Math.max(0,E.power+(E.powerModifier||0));Y&&H({row:Y.row,col:Y.col,text:`+${Pe}`,playerId:Ee}),k(Ee,Pe),setTimeout(()=>r(null),nt.MODE_CLEAR_DELAY);return}if(se==="SELECT_TARGET"&&Q.actionType==="RESET_DEPLOY"){if(Q.filter&&!Q.filter(E))return;ae(U),setTimeout(()=>r(null),nt.MODE_CLEAR_DELAY);return}if(se==="SELECT_TARGET"&&Q.actionType==="SHIELD_AND_REMOVE_AIM"){if(Q.filter&&!Q.filter(E))return;he(U,"Shield",Ee),q(U,"Aim"),setTimeout(()=>r(null),nt.MODE_CLEAR_DELAY);return}if(se==="SELECT_TARGET"&&Q.actionType==="MODIFY_POWER"){if(Q.filter&&!Q.filter(E))return;Q.amount&&fe(U,Q.amount),Y&&Y.row>=0&&j(Y,X,!1,L),setTimeout(()=>r(null),nt.MODE_CLEAR_DELAY);return}if(se==="RIOT_PUSH"&&Y&&Y.row>=0){if(U.row===Y.row&&U.col===Y.col){j(Y,X,!1,L),setTimeout(()=>r(null),nt.MODE_CLEAR_DELAY);return}const Pe=Math.abs(U.row-Y.row)+Math.abs(U.col-Y.col)===1,Ae=e.players.find(bt=>bt.id===E.ownerId),Ue=e.players.find(bt=>bt.id===Ee),Me=(Ae==null?void 0:Ae.teamId)!==void 0&&(Ue==null?void 0:Ue.teamId)!==void 0&&Ae.teamId===Ue.teamId;if(!Pe||E.ownerId===Ee||Me)return;const ut=U.row-Y.row,Ze=U.col-Y.col,at=U.row+ut,Gt=U.col+Ze,Rt=e.board.length,hn=Math.floor((Rt-e.activeGridSize)/2),rn=hn,an=hn+e.activeGridSize-1;if(at<rn||at>an||Gt<rn||Gt>an||e.board[at][Gt].card!==null)return;D({card:E,source:"board",boardCoords:U,bypassOwnershipCheck:!0},{target:"board",boardCoords:{row:at,col:Gt}}),r({type:"ENTER_MODE",mode:"RIOT_MOVE",sourceCard:me,sourceCoords:Y,isDeployAbility:X,payload:{vacatedCoords:U}});return}if(se==="SWAP_POSITIONS"&&Y&&Y.row>=0){const Pe=e.board[Y.row][Y.col].card;if(!Pe||Pe.id!==(me==null?void 0:me.id)){r(null);return}if(me&&me.id===E.id||Q.filter&&!Q.filter(E,U.row,U.col))return;A(Y,U),j(U,X,!1,L),setTimeout(()=>r(null),nt.MODE_CLEAR_DELAY);return}if(se==="TRANSFER_STATUS_SELECT"&&Y&&Y.row>=0){if(me&&me.id===E.id||Q.filter&&!Q.filter(E,U.row,U.col))return;E.statuses&&E.statuses.length>0&&(M(U,Y,E.statuses[0].type),j(Y,X,!1,L),setTimeout(()=>r(null),nt.MODE_CLEAR_DELAY));return}if(se==="TRANSFER_ALL_STATUSES"&&Y&&Y.row>=0){if(me&&me.id===E.id||Q.filter&&!Q.filter(E,U.row,U.col))return;K(U,Y),j(Y,X,!1,L),setTimeout(()=>r(null),nt.MODE_CLEAR_DELAY);return}if(se==="REVEAL_ENEMY"){if(me&&me.id===E.id||Q.filter&&!Q.filter(E,U.row,U.col))return;o({type:"Revealed",count:1,isDragging:!1,sourceCoords:Y,sourceCard:me,originalOwnerId:be,targetOwnerId:E.ownerId,onlyFaceDown:!0,onlyOpponents:!0,isDeployAbility:X,readyStatusToRemove:L}),setTimeout(()=>r(null),nt.MODE_CLEAR_DELAY);return}if(se==="CENSOR_SWAP"&&Y&&Y.row>=0){if(Q.filter&&!Q.filter(E))return;ie(U,"Exploit",Ee),he(U,"Stun",Ee),j(Y,X,!1,L),setTimeout(()=>r(null),nt.MODE_CLEAR_DELAY);return}if(se==="ZEALOUS_WEAKEN"&&Y&&Y.row>=0){if(Q.filter&&!Q.filter(E))return;fe(U,-1),j(Y,X,!1,L),setTimeout(()=>r(null),nt.MODE_CLEAR_DELAY);return}if(se==="CENTURION_BUFF"&&Y&&Y.row>=0){j(Y,X,!1,L),setTimeout(()=>r(null),nt.MODE_CLEAR_DELAY);return}if(se==="SELECT_UNIT_FOR_MOVE"&&Y&&Y.row>=0){if(Q.filter&&!Q.filter(E))return;r({type:"ENTER_MODE",mode:"SELECT_CELL",sourceCard:E,sourceCoords:U,isDeployAbility:X,recordContext:De,originalOwnerId:Ee??void 0,payload:{allowSelf:!1,abilitySourceCoords:Y,range:Q.range,chainedAction:Q.chainedAction,originalActorId:Ee??void 0}});return}if(se==="SELECT_UNIT_FOR_MOVE"&&!Y){if(Q.filter&&!Q.filter(E))return;r({type:"ENTER_MODE",mode:"SELECT_CELL",sourceCard:E,sourceCoords:U,recordContext:De,originalOwnerId:Ee??void 0,payload:{allowSelf:!1,range:Q.range,chainedAction:Q.chainedAction,originalActorId:Ee??void 0}});return}if(se==="INTEGRATOR_LINE_SELECT"&&Y&&Y.row>=0){if(U.row!==Y.row&&U.col!==Y.col)return;const Pe=e.board.length;let Ae=0;if(U.row===Y.row)for(let Ue=0;Ue<Pe;Ue++){const Me=e.board[U.row][Ue];Me.card&&(Ae+=((Nt=Me.card.statuses)==null?void 0:Nt.filter(ut=>ut.type==="Exploit"&&ut.addedByPlayerId===Ee).length)||0)}else for(let Ue=0;Ue<Pe;Ue++){const Me=e.board[Ue][U.col];Me.card&&(Ae+=((Wt=Me.card.statuses)==null?void 0:Wt.filter(ut=>ut.type==="Exploit"&&ut.addedByPlayerId===Ee).length)||0)}Ae>0&&(H({row:Y.row,col:Y.col,text:`+${Ae}`,playerId:Ee}),k(Ee,Ae)),j(Y,X,!1,L),setTimeout(()=>r(null),nt.MODE_CLEAR_DELAY);return}if(se==="ZIUS_LINE_SELECT"&&Y&&Y.row>=0){if(U.row!==Y.row&&U.col!==Y.col)return;const Pe=e.board.length;let Ae=0;const Ue=[];if(U.row===Y.row)for(let Me=0;Me<Pe;Me++){const ut=e.board[U.row][Me];if(ut.card){const Ze=((ht=ut.card.statuses)==null?void 0:ht.filter(at=>at.type==="Exploit"&&at.addedByPlayerId===Ee).length)||0;Ze>0&&(Ae+=Ze,Ue.push({row:U.row,col:Me,text:`+${Ze}`,playerId:Ee,timestamp:Date.now()}))}}else for(let Me=0;Me<Pe;Me++){const ut=e.board[Me][U.col];if(ut.card){const Ze=((Fe=ut.card.statuses)==null?void 0:Fe.filter(at=>at.type==="Exploit"&&at.addedByPlayerId===Ee).length)||0;Ze>0&&(Ae+=Ze,Ue.push({row:Me,col:U.col,text:`+${Ze}`,playerId:Ee,timestamp:Date.now()}))}}Ae>0&&(H(Ue),k(Ee,Ae)),j(Y,X,!1,L),setTimeout(()=>r(null),nt.MODE_CLEAR_DELAY);return}return}!n&&!a&&Re(E,U)}},[n,a,e,t,w,Ce,D,j,r,o,h,ke,ie,he,fe,A,M,K,k,x,Re,v,ae,q,Oe,l,H,f,va]),We=m.useCallback(E=>{var pt,Nt,Wt,ht,Fe,se;if(w.current||(n==null?void 0:n.type)!=="ENTER_MODE")return;const{mode:U,sourceCoords:te,sourceCard:Te,payload:ve,isDeployAbility:O,readyStatusToRemove:et,recordContext:ue}=n;if(U==="SCORE_LAST_PLAYED_LINE"||U==="SELECT_LINE_END"){Ce(E);return}if(U==="SELECT_LINE_START"){Ce(E);return}if(U==="SELECT_DIAGONAL"){Ce(E);return}const we=(Te==null?void 0:Te.ownerId)??((pt=e.players.find(Q=>Q.id===e.activePlayerId))!=null&&pt.isDummy?e.activePlayerId:t||e.activePlayerId);if(U==="PATROL_MOVE"&&te&&Te&&te.row>=0){const Q=E.row===te.row,me=E.col===te.col;if(E.row===te.row&&E.col===te.col){j(te,O,!1,et),setTimeout(()=>r(null),nt.MODE_CLEAR_DELAY);return}(Q||me)&&(j(te,O,!1,et),D({card:Te,source:"board",boardCoords:te},{target:"board",boardCoords:E}),setTimeout(()=>r(null),nt.MODE_CLEAR_DELAY));return}if(U==="RIOT_MOVE"&&te&&Te&&ve.vacatedCoords){if(E.row===ve.vacatedCoords.row&&E.col===ve.vacatedCoords.col){D({card:Te,source:"board",boardCoords:te},{target:"board",boardCoords:E}),j(E,O,!1,et),setTimeout(()=>r(null),nt.MODE_CLEAR_DELAY);return}j(te,O,!1,et),r(null);return}if(U==="SPAWN_TOKEN"&&te&&ve.tokenName&&te.row>=0){if(Math.abs(E.row-te.row)+Math.abs(E.col-te.col)===1){const me=(Te==null?void 0:Te.ownerId)??we;re(E,ve.tokenName,me),j(te,O,!1,et),setTimeout(()=>r(null),nt.MODE_CLEAR_DELAY)}return}if(U==="SELECT_CELL"&&Te){const Q=(()=>{var Y;if(ve.moveFromHand)return null;if(te&&te.row>=0)return te;for(let X=0;X<e.board.length;X++)for(let L=0;L<e.board.length;L++)if(((Y=e.board[X][L].card)==null?void 0:Y.id)===Te.id)return{row:X,col:L};return null})();if(ve.moveFromHand&&s.selectedHandCard){const{playerId:Y,cardIndex:X}=s.selectedHandCard,L=e.players.find(De=>De.id===Y),be=L==null?void 0:L.hand[X];be&&(D({card:be,source:"hand",playerId:Y,cardIndex:X,isManual:!0},{target:"board",boardCoords:E}),setTimeout(()=>r(null),nt.MODE_CLEAR_DELAY));return}let me=!1;if(Q)if(ve.range==="line")me=E.row===Q.row||E.col===Q.col;else if(ve.range==="global")me=!0;else if(ve.range===2){const Y=Math.abs(E.row-Q.row)+Math.abs(E.col-Q.col);if(Y===1)me=!0;else if(Y===2){const X=Q.row,L=Q.col,be=E.row,De=E.col;me=[{r:be,c:L},{r:X,c:De},{r:(X+be)/2,c:(L+De)/2}].some(Pe=>{if(!Number.isInteger(Pe.r)||!Number.isInteger(Pe.c))return!1;const Ae=Math.floor((e.board.length-e.activeGridSize)/2),Ue=Ae,Me=Ae+e.activeGridSize-1;return Pe.r<Ue||Pe.r>Me||Pe.c<Ue||Pe.c>Me||Math.abs(Pe.r-X)+Math.abs(Pe.c-L)!==1?!1:!e.board[Pe.r][Pe.c].card})}}else me=Math.abs(E.row-Q.row)+Math.abs(E.col-Q.col)===1;if(me&&Q){const Y=ve.allowSelf&&E.row===Q.row&&E.col===Q.col;if(!Y){const X=e.board[Q.row][Q.col].card;X&&D({card:X,source:"board",boardCoords:Q,bypassOwnershipCheck:!0},{target:"board",boardCoords:E})}if(ue&&l({lastMovedCardCoords:E,lastMovedCardId:Te.id}),ve.chainedAction){const X={...ve.chainedAction};X.targetOwnerId===-2&&(X.targetOwnerId=Te.ownerId),ue&&(X.payload||(X.payload={}),X.payload._tempContextId=Te.id),r(null),de(),setTimeout(()=>{Oe(X,E)},1)}else{if(ve.abilitySourceCoords)j(ve.abilitySourceCoords,O,!1,et);else{const X=Y?te:E;X&&X.row>=0&&(ve.originalActorId===void 0||Te.ownerId===ve.originalActorId)&&j(X,O,!1,et)}setTimeout(()=>r(null),nt.MODE_CLEAR_DELAY)}return}return}if(U==="IMMUNIS_RETRIEVE"&&te&&te.row>=0){if(ve.selectedCardIndex!==void 0&&((Nt=ve.filter)!=null&&Nt.call(ve,E.row,E.col))){ee(we,ve.selectedCardIndex,E),j(te,O,!1,et),setTimeout(()=>r(null),nt.MODE_CLEAR_DELAY);return}if(ve.selectedCardIndex===void 0)return}if(U==="INTEGRATOR_LINE_SELECT"&&te&&te.row>=0){if(E.row!==te.row&&E.col!==te.col)return;const Q=e.board.length;let me=0;if(E.row===te.row)for(let Y=0;Y<Q;Y++){const X=e.board[E.row][Y];X.card&&(me+=((Wt=X.card.statuses)==null?void 0:Wt.filter(L=>L.type==="Exploit"&&L.addedByPlayerId===we).length)||0)}else for(let Y=0;Y<Q;Y++){const X=e.board[Y][E.col];X.card&&(me+=((ht=X.card.statuses)==null?void 0:ht.filter(L=>L.type==="Exploit"&&L.addedByPlayerId===we).length)||0)}me>0&&(H({row:te.row,col:te.col,text:`+${me}`,playerId:we}),k(we,me)),j(te,O,!1,et),setTimeout(()=>r(null),nt.MODE_CLEAR_DELAY);return}if(U==="ZIUS_LINE_SELECT"&&te&&te.row>=0){if(E.row!==te.row&&E.col!==te.col)return;const Q=e.board.length;let me=0;const Y=[];if(E.row===te.row)for(let X=0;X<Q;X++){const L=e.board[E.row][X];if(L.card){const be=((Fe=L.card.statuses)==null?void 0:Fe.filter(De=>De.type==="Exploit"&&De.addedByPlayerId===we).length)||0;be>0&&(me+=be,Y.push({row:E.row,col:X,text:`+${be}`,playerId:we,timestamp:Date.now()}))}}else for(let X=0;X<Q;X++){const L=e.board[X][E.col];if(L.card){const be=((se=L.card.statuses)==null?void 0:se.filter(De=>De.type==="Exploit"&&De.addedByPlayerId===we).length)||0;be>0&&(me+=be,Y.push({row:X,col:E.col,text:`+${be}`,playerId:we,timestamp:Date.now()}))}}me>0&&(H(Y),k(we,me)),j(te,O,!1,et),setTimeout(()=>r(null),nt.MODE_CLEAR_DELAY);return}},[w,n,e,t,Ce,D,j,r,re,l,ee,k,s,Oe,H,de]),V=m.useCallback((E,U,te)=>{var Te;if(!w.current){if(a&&h!==null&&h!==void 0){const ve={targetOwnerId:a.targetOwnerId,excludeOwnerId:a.excludeOwnerId,onlyOpponents:a.onlyOpponents||a.targetOwnerId===-1,onlyFaceDown:a.onlyFaceDown,targetType:a.targetType,requiredTargetStatus:a.requiredTargetStatus,tokenType:a.type};if(va({card:U,ownerId:E.id,location:"hand"},ve,e.activePlayerId,e.players)&&a.type==="Revealed"){const et=((Te=a.sourceCard)==null?void 0:Te.ownerId)??e.activePlayerId??t??1;U.statuses||(U.statuses=[]),U.statuses.some(we=>we.type==="Revealed"&&we.addedByPlayerId===et)||(U.statuses.push({type:"Revealed",addedByPlayerId:et}),D({card:{id:"stack",deck:"counter",name:"",imageUrl:"",fallbackImage:"",power:0,ability:"",types:[]},source:"counter_panel",statusType:"Revealed",count:1},{target:"hand",playerId:E.id,cardIndex:te}),a.sourceCoords&&a.sourceCoords.row>=0&&j(a.sourceCoords,a.isDeployAbility,!1,a.readyStatusToRemove),a.count>1?o(we=>we?{...we,count:we.count-1}:null):(a.chainedAction&&Oe(a.chainedAction,a.sourceCoords||{row:-1,col:-1}),o(null)))}return}if((n==null?void 0:n.type)==="ENTER_MODE"&&n.mode==="SELECT_TARGET"){const{payload:ve,sourceCoords:O,isDeployAbility:et,sourceCard:ue,readyStatusToRemove:we}=n;if(ne(E.id,te,e.activePlayerId??t??1),ve.actionType==="SELECT_HAND_FOR_DEPLOY"){if(ve.filter&&!ve.filter(U))return;l(pt=>({...pt,selectedHandCard:{playerId:E.id,cardIndex:te}})),r({type:"ENTER_MODE",mode:"SELECT_CELL",sourceCard:U,payload:{range:"global",moveFromHand:!0}});return}if(ve.actionType==="SELECT_HAND_FOR_DISCARD_THEN_SPAWN"){if(ve.filter&&!ve.filter(U)||E.id!==(ue==null?void 0:ue.ownerId))return;D({card:U,source:"hand",playerId:E.id,cardIndex:te,bypassOwnershipCheck:!0},{target:"discard",playerId:E.id}),r({type:"ENTER_MODE",mode:"SPAWN_TOKEN",sourceCard:ue,sourceCoords:O,isDeployAbility:et,payload:{tokenName:ve.tokenName}});return}if(ve.actionType==="LUCIUS_SETUP"){if(E.id!==(ue==null?void 0:ue.ownerId))return;D({card:U,source:"hand",playerId:E.id,cardIndex:te,bypassOwnershipCheck:!0},{target:"discard",playerId:E.id}),Oe({type:"OPEN_MODAL",mode:"SEARCH_DECK",sourceCard:ue,sourceCoords:O,isDeployAbility:et,payload:{filterType:"Command"}},O||{row:-1,col:-1}),r(null);return}if(ve.actionType==="DESTROY"){if(ve.filter&&!ve.filter(U))return;D({card:U,source:"hand",playerId:E.id,cardIndex:te,bypassOwnershipCheck:!0},{target:"discard",playerId:E.id}),O&&O.row>=0&&j(O,et,!1,we),setTimeout(()=>r(null),nt.MODE_CLEAR_DELAY)}}}},[w,n,D,j,r,l,Oe,e,t,ne,a,o,h]),Ke=m.useCallback((E,U)=>{n||a||w.current||e.isGameStarted&&e.activePlayerId===E.id&&Iu(U,e.currentPhase,e.activePlayerId,e)&&Re(U,{row:-1,col:-1})},[n,a,w,e,Re]);return{activateAbility:Re,executeAction:Oe,handleLineSelection:Ce,handleBoardCardClick:Le,handleEmptyCellClick:We,handleHandCardClick:V,handleAnnouncedCardDoubleClick:Ke}},jl=(e,t,n,r,a)=>{const o=(n.baseId||e.split("_")[1]||e).toLowerCase(),s=t===-1,l=[];o==="overwatch"?s?l.push({type:"CREATE_STACK",tokenType:"Aim",count:1,sourceCard:n}):t===0?l.push({type:"CREATE_STACK",tokenType:"Revealed",dynamicCount:{factor:"Aim",ownerId:a},targetOwnerId:-1,onlyOpponents:!0,sourceCard:n}):t===1&&l.push({type:"GLOBAL_AUTO_APPLY",payload:{dynamicResource:{type:"draw",factor:"Aim",ownerId:a,baseCount:0}},sourceCard:n}):o==="tacticalmaneuver"?t===0?l.push({type:"ENTER_MODE",mode:"SELECT_UNIT_FOR_MOVE",recordContext:!0,sourceCard:n,payload:{range:"line",filter:d=>d.ownerId===a,chainedAction:{type:"GLOBAL_AUTO_APPLY",payload:{contextReward:"DRAW_MOVED_POWER"},sourceCard:n}}}):t===1&&l.push({type:"ENTER_MODE",mode:"SELECT_UNIT_FOR_MOVE",recordContext:!0,sourceCard:n,payload:{range:"line",filter:d=>d.ownerId===a,chainedAction:{type:"GLOBAL_AUTO_APPLY",payload:{contextReward:"SCORE_MOVED_POWER"},sourceCard:n}}}):o==="inspiration"?s&&l.push({type:"ENTER_MODE",mode:"SELECT_TARGET",sourceCard:n,payload:{actionType:"OPEN_COUNTER_MODAL",filter:d=>d.ownerId===a}}):o==="datainterception"?s?l.push({type:"CREATE_STACK",tokenType:"Exploit",count:1,sourceCard:n}):t===0?l.push({type:"CREATE_STACK",tokenType:"Revealed",dynamicCount:{factor:"Exploit",ownerId:a},onlyFaceDown:!0,onlyOpponents:!0,targetOwnerId:-1,sourceCard:n}):t===1&&l.push({type:"ENTER_MODE",mode:"SELECT_UNIT_FOR_MOVE",sourceCard:n,payload:{range:2,filter:d=>{var f;return((f=d.statuses)==null?void 0:f.some(h=>h.type==="Exploit"&&h.addedByPlayerId===a))||!1}}}):o==="falseorders"?s?l.push({type:"CREATE_STACK",tokenType:"Exploit",count:1,sourceCard:n,targetType:"Unit",onlyOpponents:!0,recordContext:!0}):t===0?l.push({type:"ENTER_MODE",mode:"SELECT_CELL",sourceCard:n,recordContext:!0,payload:{range:2,useContextCard:!0,chainedAction:{type:"CREATE_STACK",tokenType:"Revealed",count:2,onlyOpponents:!0,onlyFaceDown:!0,excludeOwnerId:a,sourceCard:n,originalOwnerId:n.ownerId}}}):t===1&&l.push({type:"ENTER_MODE",mode:"SELECT_CELL",sourceCard:n,recordContext:!0,payload:{range:2,useContextCard:!0,chainedAction:{type:"GLOBAL_AUTO_APPLY",payload:{tokenType:"Stun",count:2,ownerId:a}}}}):o==="experimentalstimulants"?t===0?l.push({type:"ENTER_MODE",mode:"SELECT_TARGET",sourceCard:n,payload:{actionType:"RESET_DEPLOY",filter:d=>{var f;return d.ownerId===a&&((f=d.types)==null?void 0:f.includes("Unit"))}}}):t===1&&l.push({type:"ENTER_MODE",mode:"SELECT_UNIT_FOR_MOVE",sourceCard:n,payload:{range:"line",filter:d=>d.ownerId===a}}):o==="logisticschain"?t===0?l.push({type:"ENTER_MODE",mode:"SELECT_DIAGONAL",sourceCard:n,payload:{actionType:"SCORE_DIAGONAL",bonusType:"point_per_support",skipNextPhase:!0}}):t===1&&l.push({type:"ENTER_MODE",mode:"SELECT_DIAGONAL",sourceCard:n,payload:{actionType:"SCORE_DIAGONAL",bonusType:"draw_per_support",skipNextPhase:!0}}):o==="quickresponseteam"?t===0?l.push({type:"ENTER_MODE",mode:"SELECT_TARGET",sourceCard:n,payload:{actionType:"SELECT_HAND_FOR_DEPLOY",filter:d=>{var f;return d.ownerId===a&&((f=d.types)==null?void 0:f.includes("Unit"))}}}):t===1&&l.push({type:"OPEN_MODAL",mode:"SEARCH_DECK",sourceCard:n,payload:{filterType:"Unit"}}):o==="temporaryshelter"?t===0?l.push({type:"CREATE_STACK",tokenType:"Shield",count:1,targetOwnerId:a,recordContext:!0,sourceCard:n,chainedAction:{type:"GLOBAL_AUTO_APPLY",payload:{customAction:"REMOVE_ALL_AIM_FROM_CONTEXT"}}}):t===1&&l.push({type:"CREATE_STACK",tokenType:"Shield",count:1,targetOwnerId:a,recordContext:!0,sourceCard:n,chainedAction:{type:"ENTER_MODE",mode:"SELECT_CELL",payload:{range:2,useContextCard:!0}}}):o==="enhancedinterrogation"?s?l.push({type:"CREATE_STACK",tokenType:"Aim",count:1,sourceCard:n}):t===0?l.push({type:"CREATE_STACK",tokenType:"Revealed",dynamicCount:{factor:"Aim",ownerId:a},onlyFaceDown:!0,onlyOpponents:!0,targetOwnerId:-1,sourceCard:n}):t===1&&l.push({type:"ENTER_MODE",mode:"SELECT_UNIT_FOR_MOVE",sourceCard:n,payload:{range:2,filter:d=>{var f;return((f=d.statuses)==null?void 0:f.some(h=>h.type==="Aim"&&h.addedByPlayerId===a))||!1}}}):(o==="mobilization1"||o==="linebreach")&&s&&l.push({type:"ENTER_MODE",mode:"SELECT_LINE_START",sourceCard:n,payload:{actionType:"SCORE_LINE"}});const c=n.ownerId||a;return l.forEach(d=>{d.originalOwnerId=c,d.sourceCard&&!d.sourceCard.ownerId&&(d.sourceCard.ownerId=c)}),l},TC=({gameState:e,localPlayerId:t,setActionQueue:n,setCommandContext:r,setCommandModalCard:a,setCounterSelectionData:o,moveItem:s,updatePlayerScore:l,updateState:c})=>{const d=m.useCallback((v,w)=>{if(t===null)return;const _=e.players.find(y=>y.id===w.playerId);if(!(w.playerId===t||(_==null?void 0:_.isDummy)))return;s(w,{target:"announced",playerId:w.playerId}),r({});const D=(v.baseId||v.id.split("_")[1]||v.id).toLowerCase();if(["overwatch","tacticalmaneuver","repositioning","inspiration","datainterception","falseorders","experimentalstimulants","logisticschain","quickresponseteam","temporaryshelter","enhancedinterrogation"].some(y=>D.includes(y)))a(v);else{const y=jl(v.id,-1,v,e,w.playerId);y.length>0?n([...y,{type:"GLOBAL_AUTO_APPLY",payload:{cleanupCommand:!0,card:v,ownerId:w.playerId},sourceCard:v}]):n([{type:"GLOBAL_AUTO_APPLY",payload:{cleanupCommand:!0,card:v,ownerId:w.playerId},sourceCard:v}])}},[e,t,s,n,r,a]),f=m.useCallback((v,w)=>{var k,j;if(!w||t===null)return;const _=w.ownerId||t,C=[],D=jl(w.id,-1,w,e,_);let x;(k=w.baseId)!=null&&k.toLowerCase().includes("inspiration")&&(x=v===0?"DRAW_REMOVED":"SCORE_REMOVED",D.length>0&&D[0].type==="ENTER_MODE"&&(D[0]={...D[0],payload:{...D[0].payload,rewardType:x}})),D.forEach($=>{C.push($)}),jl(w.id,v,w,e,_).forEach($=>{C.push($)}),(j=w.baseId)!=null&&j.toLowerCase().includes("inspiration")||C.push({type:"GLOBAL_AUTO_APPLY",payload:{cleanupCommand:!0,card:w,ownerId:_},sourceCard:w}),n(C),a(null)},[e,t,n,a]),h=m.useCallback((v,w)=>{var x;if(t===null)return;const _=w.card.ownerId||t;let C=null;for(let y=0;y<e.board.length;y++){for(let k=0;k<e.board[y].length;k++)if(((x=e.board[y][k].card)==null?void 0:x.id)===w.card.id){C={row:y,col:k};break}if(C)break}if(!C){console.warn(`Card ${w.card.id} not found on board during counter removal`),o(null);return}if(c(y=>{if(!y.isGameStarted)return y;const k=Ct(y),j=k.board[C.row][C.col].card;let $=0;const A=(j==null?void 0:j.statuses)??[];if(Object.entries(v).forEach(([M,K])=>{for(let ee=0;ee<K;ee++){const re=A.map(Ie=>Ie.type).lastIndexOf(M);re>-1&&(j!=null&&j.statuses)&&(j.statuses.splice(re,1),$++)}}),!(j!=null&&j.statuses)&&j&&(j.statuses=[]),k.board=Cn(k),$>0&&w.callbackAction==="DRAW_REMOVED"){const M=k.players.find(K=>K.id===_);if(M){const K=Math.min($,M.deck.length);for(let ee=0;ee<K;ee++){const re=M.deck.shift();re&&M.hand.push(re)}}}return k}),w.callbackAction==="SCORE_REMOVED"){const y=Object.values(v).reduce((k,j)=>k+j,0);y>0&&l(_,y)}const D=e.players.find(y=>y.id===_);D!=null&&D.announcedCard&&n([{type:"GLOBAL_AUTO_APPLY",payload:{cleanupCommand:!0,card:D.announcedCard,ownerId:_},sourceCard:D.announcedCard}]),o(null)},[t,l,n,o,e,c]);return{playCommandCard:d,handleCommandConfirm:f,handleCounterSelectionConfirm:h}},EC=({gameState:e,localPlayerId:t,handleDrop:n,markAbilityUsed:r,requestCardReveal:a,interactionLock:o,setCommandContext:s,onAction:l,cursorStack:c,setCursorStack:d,setAbilityMode:f,triggerTargetSelection:h})=>{const v=m.useRef(null),w=m.useRef({x:0,y:0});return m.useLayoutEffect(()=>{if(c&&v.current){const{x:C,y:D}=w.current;v.current.style.transform=`translate(${C-24}px, ${D-24}px)`}},[c]),m.useEffect(()=>{const C=D=>{w.current={x:D.clientX,y:D.clientY},v.current&&(v.current.style.transform=`translate(${D.clientX-24}px, ${D.clientY-24}px)`)};return window.addEventListener("mousemove",C),()=>window.removeEventListener("mousemove",C)},[]),m.useEffect(()=>{const C=D=>{var j,$,A,M,K,ee,re,Ie;if(D.button!==0||!c)return;const x=document.elementFromPoint(D.clientX,D.clientY);let y=t;if(c.originalOwnerId!==void 0)y=c.originalOwnerId;else if((j=c.sourceCard)!=null&&j.ownerId)y=c.sourceCard.ownerId;else if(c.sourceCoords&&c.sourceCoords.row>=0){const{row:B,col:fe}=c.sourceCoords;if(B>=0&&B<e.board.length&&fe>=0&&fe<(($=e.board[B])==null?void 0:$.length)){const he=e.board[B][fe].card;he&&(y=he.ownerId||t)}}else if(e.activePlayerId){const B=e.players.find(fe=>fe.id===e.activePlayerId);B!=null&&B.isDummy&&(y=B.id)}let k=x==null?void 0:x.closest("[data-hand-card]");if(!k&&x)if(x.getAttribute("data-hand-card"))k=x;else{const B=x.querySelectorAll("[data-hand-card]");if(B.length>0){let fe=1/0,he=null;const ke=D.clientX,ie=D.clientY;for(const ae of Array.from(B)){const J=ae.getBoundingClientRect();if(ke>=J.left&&ke<=J.right&&ie>=J.top&&ie<=J.bottom){const q=J.left+J.width/2,H=J.top+J.height/2,ne=Math.hypot(ke-q,ie-H);ne<fe&&(fe=ne,he=ae)}}k=he}}if(k){const B=k.getAttribute("data-hand-card");if(B){const[fe,he]=B.split(","),ke=parseInt(fe,10),ie=parseInt(he,10),ae=e.players.find(q=>q.id===ke),J=ae==null?void 0:ae.hand[ie];if(ae&&J){if(c.type==="Revealed"&&!ae.isDummy){if((A=J.statuses)==null?void 0:A.some(xe=>xe.type==="Revealed"&&xe.addedByPlayerId===y))return;n({card:{id:"stack",deck:"counter",name:"",imageUrl:"",fallbackImage:"",power:0,ability:"",types:[]},source:"counter_panel",ownerId:c.originalOwnerId??((M=c.sourceCard)==null?void 0:M.ownerId)??y??void 0,statusType:c.type,count:1},{target:"hand",playerId:ke,cardIndex:ie,boardCoords:void 0}),c.sourceCoords&&c.sourceCoords.row>=0&&r(c.sourceCoords,c.isDeployAbility),c.count>1?d(xe=>xe?{...xe,count:xe.count-1}:null):(c.chainedAction&&l(c.chainedAction,c.sourceCoords||{row:-1,col:-1}),d(null)),o.current=!0,setTimeout(()=>{o.current=!1},300);return}const H={targetOwnerId:c.targetOwnerId,excludeOwnerId:c.excludeOwnerId,onlyOpponents:c.onlyOpponents||c.targetOwnerId===-1,onlyFaceDown:c.onlyFaceDown,targetType:c.targetType,requiredTargetStatus:c.requiredTargetStatus,tokenType:c.type};if(!va({card:J,ownerId:ke,location:"hand"},H,y,e.players))return;n({card:{id:"stack",deck:"counter",name:"",imageUrl:"",fallbackImage:"",power:0,ability:"",types:[]},source:"counter_panel",ownerId:c.originalOwnerId??((K=c.sourceCard)==null?void 0:K.ownerId),statusType:c.type,replaceStatusType:c.replaceStatus?c.requiredTargetStatus:void 0,count:1},{target:"hand",playerId:ke,cardIndex:ie,boardCoords:void 0}),c.sourceCoords&&c.sourceCoords.row>=0&&r(c.sourceCoords,c.isDeployAbility),c.count>1?d(de=>de?{...de,count:de.count-1}:null):(c.chainedAction&&l(c.chainedAction,c.sourceCoords||{row:-1,col:-1}),d(null)),o.current=!0,setTimeout(()=>{o.current=!1},300);return}}}if(!k){const B=x==null?void 0:x.closest("[data-board-coords]");if(B){const fe=B.getAttribute("data-board-coords");if(fe){const[he,ke]=fe.split(","),ie=parseInt(he,10),ae=parseInt(ke,10);if(!isNaN(ie)&&!isNaN(ae)&&ie>=0&&ie<e.board.length&&e.board[ie]&&ae>=0&&ae<e.board[ie].length&&e.board[ie][ae]){const J=e.board[ie][ae].card;if((J==null?void 0:J.ownerId)!==void 0){const q={targetOwnerId:c.targetOwnerId,excludeOwnerId:c.excludeOwnerId,onlyOpponents:c.onlyOpponents||c.targetOwnerId===-1,onlyFaceDown:c.onlyFaceDown,targetType:c.targetType,requiredTargetStatus:c.requiredTargetStatus,mustBeAdjacentToSource:c.mustBeAdjacentToSource,mustBeInLineWithSource:c.mustBeInLineWithSource,sourceCoords:c.sourceCoords,tokenType:c.type};if(!va({card:J,ownerId:J.ownerId,location:"board",boardCoords:{row:ie,col:ae}},q,y,e.players))return;const ne=e.players.find(de=>de.id===J.ownerId);if(c.type==="Revealed"&&!(ne!=null&&ne.isDummy)){if((ee=J.statuses)==null?void 0:ee.some(xe=>xe.type==="Revealed"&&xe.addedByPlayerId===y))return;J.isFaceDown?t!==null&&a({source:"board",ownerId:J.ownerId,boardCoords:{row:ie,col:ae}},t):(n({card:{id:"stack",deck:"counter",name:"",imageUrl:"",fallbackImage:"",power:0,ability:"",types:[]},source:"counter_panel",ownerId:c.originalOwnerId??((re=c.sourceCard)==null?void 0:re.ownerId)??y??void 0,statusType:c.type,count:1},{target:"board",boardCoords:{row:ie,col:ae}}),h("board",{row:ie,col:ae})),c.sourceCoords&&c.sourceCoords.row>=0&&r(c.sourceCoords,c.isDeployAbility),c.count>1?d(xe=>xe?{...xe,count:xe.count-1}:null):(c.chainedAction&&l(c.chainedAction,c.sourceCoords||{row:-1,col:-1}),d(null)),o.current=!0,setTimeout(()=>{o.current=!1},300);return}}if(J){const q=c.placeAllAtOnce?c.count:1;n({card:{id:"stack",deck:"counter",name:"",imageUrl:"",fallbackImage:"",power:0,ability:"",types:[]},source:"counter_panel",ownerId:c.originalOwnerId??((Ie=c.sourceCard)==null?void 0:Ie.ownerId),statusType:c.type,replaceStatusType:c.replaceStatus?c.requiredTargetStatus:void 0,count:q},{target:"board",boardCoords:{row:ie,col:ae}}),h("board",{row:ie,col:ae}),c.recordContext&&s(ne=>({...ne,lastMovedCardCoords:{row:ie,col:ae},lastMovedCardId:J.id})),c.sourceCoords&&c.sourceCoords.row>=0&&r(c.sourceCoords,c.isDeployAbility);const H=c.count-q;if(H>0)d(ne=>ne?{...ne,count:H}:null);else{if(c.chainedAction){const ne={...c.chainedAction};c.recordContext&&(ne.mode==="SELECT_CELL"&&(ne.sourceCard=J,ne.sourceCoords={row:ie,col:ae},ne.recordContext=!0),ne.type==="GLOBAL_AUTO_APPLY"&&(ne.sourceCoords={row:ie,col:ae}),ne.type==="CREATE_STACK"&&(ne.sourceCoords={row:ie,col:ae},ne.originalOwnerId||(ne.sourceCard=J)),ne.mode==="ZIUS_LINE_SELECT"&&(ne.sourceCoords={row:ie,col:ae})),ne.type==="CREATE_STACK"&&f(null),l(ne,{row:ie,col:ae})}d(null)}o.current=!0,setTimeout(()=>{o.current=!1},300)}}}}else{const fe=x==null?void 0:x.closest(".counter-modal-content"),he=(x==null?void 0:x.closest("[data-board-coords]"))!==null,ke=(x==null?void 0:x.closest("[data-hand-card]"))!==null;c.isDragging?fe?d(ie=>ie?{...ie,isDragging:!1}:null):!he&&!ke&&d(null):!fe&&!he&&!ke&&d(null)}}};return window.addEventListener("mouseup",C),()=>{window.removeEventListener("mouseup",C)}},[c,n,e,t,a,r,o,s,l,d,f,h]),m.useEffect(()=>{const C=D=>{c&&(D.preventDefault(),d(null))};return window.addEventListener("contextmenu",C),()=>{window.removeEventListener("contextmenu",C)}},[c,d]),{cursorFollowerRef:v,handleCounterMouseDown:(C,D)=>{w.current={x:D.clientX,y:D.clientY},d(x=>(x==null?void 0:x.type)===C?{type:C,count:x.count+1,isDragging:!0,sourceCoords:x.sourceCoords}:{type:C,count:1,isDragging:!0})}}},IC="https://res.cloudinary.com/dxxh6meej/image/upload/v1763653192/background_counter_socvss.png",SC=m.memo(function(){var Rr,Jn,Pa,uo,Fi;const{t}=un(),[n,r]=m.useState(null),a=wC({abilityMode:n,setAbilityMode:r}),{gameState:o,localPlayerId:s,setLocalPlayerId:l,createGame:c,joinGameViaModal:d,joinAsInvite:f,startReadyCheck:h,cancelReadyCheck:v,playerReady:w,assignTeams:_,setGameMode:C,setGamePrivacy:D,setActiveGridSize:x,setDummyPlayerCount:y,updatePlayerName:k,changePlayerColor:j,updatePlayerScore:$,changePlayerDeck:A,loadCustomDeck:M,drawCard:K,drawCardsBatch:ee,handleDrop:re,draggedItem:Ie,setDraggedItem:B,connectionStatus:fe,gamesList:he,requestGamesList:ke,exitGame:ie,moveItem:ae,updateState:J,shufflePlayerDeck:q,addBoardCardStatus:H,removeBoardCardStatus:ne,removeBoardCardStatusByOwner:de,modifyBoardCardPower:xe,addAnnouncedCardStatus:Z,removeAnnouncedCardStatus:Oe,modifyAnnouncedCardPower:Re,addHandCardStatus:Ce,removeHandCardStatus:Le,flipBoardCard:We,flipBoardCardFaceDown:V,revealHandCard:Ke,revealBoardCard:E,requestCardReveal:U,respondToRevealRequest:te,syncGame:Te,toggleActivePlayer:ve,toggleAutoDraw:O,forceReconnect:et,triggerHighlight:ue,latestHighlight:we,latestFloatingTexts:pt,latestNoTarget:Nt,triggerNoTarget:Wt,triggerDeckSelection:ht,triggerHandCardSelection:Fe,triggerTargetSelection:se,targetSelectionEffects:Q,syncValidTargets:me,remoteValidTargets:Y,setTargetingMode:X,clearTargetingMode:L,nextPhase:be,prevPhase:De,setPhase:Ee,markAbilityUsed:Pe,applyGlobalEffect:Ae,swapCards:Ue,transferStatus:Me,transferAllCounters:ut,recoverDiscardedCard:Ze,resurrectDiscardedCard:at,spawnToken:Gt,scoreLine:Rt,closeRoundEndModal:hn,closeRoundEndModalOnly:rn,resetGame:an,resetDeployStatus:bt,scoreDiagonal:mr,removeStatusByType:gr,reorderTopDeck:ro,reorderCards:yr,triggerFloatingText:_c,latestDeckSelections:ki,latestHandCardSelections:Ti,webrtcHostId:Dc,initializeWebrtcHost:Rc,connectAsGuest:Ea,isReconnecting:Ei,reconnectProgress:jc}=a,[Yn,on]=m.useState({isJoinModalOpen:!1,isDeckBuilderOpen:!1,isSettingsModalOpen:!1,isTokensModalOpen:!1,isCountersModalOpen:!1,isRulesModalOpen:!1,isTeamAssignOpen:!1}),[_t,ao]=m.useState(null),[oo,Ia]=m.useState(null),[mt,In]=m.useState(null),[Ii,Sa]=m.useState({tokensModalAnchor:null,countersModalAnchor:null}),[ct,_r]=m.useState(null),[so,ar]=m.useState(null),[qn,Si]=m.useState(()=>{try{const F=localStorage.getItem("image_refresh_data");if(F){const{version:Se,timestamp:ze}=JSON.parse(F),ye=12*60*60*1e3;if(Date.now()-ze<ye)return Se}}catch(F){console.error("Error parsing image refresh data",F)}const R=Date.now();return localStorage.setItem("image_refresh_data",JSON.stringify({version:R,timestamp:R})),R}),[Xo,Zo]=m.useState(null),[Zt,Sn]=m.useState(null),[Pc,Qo]=m.useState(null),[Nc,_i]=m.useState([]),[es,Ac]=m.useState(()=>{try{const R=localStorage.getItem("auto_abilities_enabled");return R===null?!0:R==="true"}catch{return!0}});m.useEffect(()=>{try{localStorage.setItem("auto_abilities_enabled",String(es))}catch{}},[es]);const _a=m.useMemo(()=>{if(!s||!o)return!1;const R=o.players.find(F=>F.id===s);return(R==null?void 0:R.autoDrawEnabled)??!0},[o,s]),Dr=m.useMemo(()=>{var R;return((R=o==null?void 0:o.board)==null?void 0:R.length)??6},[(Rr=o==null?void 0:o.board)==null?void 0:Rr.length]);m.useEffect(()=>{if(!s||!o)return;const R=o.players.find(F=>F.id===s);if(R&&R.autoDrawEnabled!==void 0)try{localStorage.setItem("auto_draw_enabled",String(R.autoDrawEnabled))}catch{}},[s,o]);const[Da,Oc]=m.useState(()=>{try{const R=localStorage.getItem("hide_dummy_cards");return R===null?!1:R==="true"}catch{return!1}});m.useEffect(()=>{try{localStorage.setItem("hide_dummy_cards",String(Da))}catch{}},[Da]);const[ts,Di]=m.useState(!1),[ns,io]=m.useState([]),[Lc,lo]=m.useState([]),[Ra,$r]=m.useState([]),[Mc,Ri]=m.useState(null),[or,ja]=m.useState({}),[zc,rs]=m.useState(0),$c=m.useRef(null),u=m.useRef(null),[T,p]=m.useState(void 0),b=m.useRef(!1),I=m.useRef(!1),[g,N]=m.useState(null),S=m.useMemo(()=>{var R,F,Se;return(n==null?void 0:n.originalOwnerId)!==void 0?n.originalOwnerId:((R=n==null?void 0:n.sourceCard)==null?void 0:R.ownerId)!==void 0?n.sourceCard.ownerId:(g==null?void 0:g.originalOwnerId)!==void 0?g.originalOwnerId:((F=g==null?void 0:g.sourceCard)==null?void 0:F.ownerId)!==void 0?g.sourceCard.ownerId:((Se=Zt==null?void 0:Zt.card)==null?void 0:Se.ownerId)!==void 0?Zt.card.ownerId:(_t==null?void 0:_t.ownerId)!==void 0?_t.ownerId:(o==null?void 0:o.activePlayerId)??0},[n,g,Zt,_t,o==null?void 0:o.activePlayerId]),z=m.useMemo(()=>{var R;return!s||!o?null:(R=o.revealRequests)==null?void 0:R.find(F=>F.toPlayerId===s)},[o,s]),{playCommandCard:le,handleCommandConfirm:Xe,handleCounterSelectionConfirm:Et}=TC({gameState:o,localPlayerId:s,setActionQueue:io,setCommandContext:ja,setCommandModalCard:ao,setCounterSelectionData:Ia,moveItem:ae,updatePlayerScore:$,updateState:J}),wt=m.useCallback(()=>{Di(!0),be()},[be]),{executeAction:ft,handleBoardCardClick:Qt,handleEmptyCellClick:Vt,handleHandCardClick:gt}=kC({gameState:o,localPlayerId:s,abilityMode:n,setAbilityMode:r,cursorStack:g,setCursorStack:N,commandContext:or,setCommandContext:ja,setViewingDiscard:_r,setPlayMode:Sn,triggerNoTarget:Wt,triggerTargetSelection:se,setCounterSelectionData:Ia,interactionLock:b,onAbilityComplete:()=>rs(R=>R+1),updateState:J,moveItem:ae,drawCard:K,drawCardsBatch:ee,updatePlayerScore:$,markAbilityUsed:Pe,applyGlobalEffect:Ae,swapCards:Ue,transferStatus:Me,transferAllCounters:ut,resurrectDiscardedCard:at,spawnToken:Gt,scoreLine:Rt,nextPhase:wt,modifyBoardCardPower:xe,addBoardCardStatus:H,removeBoardCardStatus:ne,removeBoardCardStatusByOwner:de,resetDeployStatus:bt,scoreDiagonal:mr,removeStatusByType:gr,triggerFloatingText:_c,triggerHandCardSelection:Fe,clearValidTargets:()=>lo([]),setTargetingMode:X,clearTargetingMode:L}),st=(R,F)=>{if(n||g||b.current)return;const Se=R.id===s,ze=!!R.isDummy;if(Se||ze){if(F.deck===it.Command){_n(),le(F,{card:F,source:"announced",playerId:R.id});return}_n();const lt={card:F,source:"announced",playerId:R.id};Sn({card:F,sourceItem:lt,faceDown:!1})}else ar({card:F,player:R})},{cursorFollowerRef:dt,handleCounterMouseDown:ge}=EC({gameState:o,localPlayerId:s,handleDrop:re,markAbilityUsed:Pe,requestCardReveal:U,interactionLock:b,setCommandContext:ja,onAction:ft,cursorStack:g,setCursorStack:N,setAbilityMode:r,triggerTargetSelection:se}),Ne=m.useMemo(()=>s===null&&o.gameId!==null,[s,o.gameId]),Ge=m.useMemo(()=>{var R;return((R=o.players)==null?void 0:R.filter(F=>!F.isDummy).length)||0},[o.players]),rt=m.useMemo(()=>s===1,[s]),Ve=m.useMemo(()=>{var R;return(R=o==null?void 0:o.players)==null?void 0:R.find(F=>F.id===s)},[o==null?void 0:o.players,s]),Ut=m.useMemo(()=>{var F;const R=(o==null?void 0:o.gameId)&&(Ve||Ne);return localStorage.getItem("webrtc_enabled")==="true"&&console.log("[isGameActive] Check:",{hasGameId:!!(o!=null&&o.gameId),gameId:o==null?void 0:o.gameId,hasLocalPlayer:!!Ve,hasIsSpectator:Ne,localPlayerId:s,playersCount:((F=o==null?void 0:o.players)==null?void 0:F.length)||0,isActive:R}),R},[o==null?void 0:o.gameId,Ve,Ne,s]),Jt=m.useMemo(()=>{var F;const R=new Map;return(F=o==null?void 0:o.players)==null||F.forEach(Se=>R.set(Se.id,Se.color)),R},[o==null?void 0:o.players]),Kt=m.useMemo(()=>!!n||!!g,[n,g]),Gr=m.useCallback(R=>{(n==null?void 0:n.mode)==="SELECT_DECK"&&(ht(R,o.activePlayerId??s??1),In({targetPlayerId:R,isLocked:!0,initialCount:3,...n.sourceCard&&{sourceCard:n.sourceCard},...n.isDeployAbility!==void 0&&{isDeployAbility:n.isDeployAbility},...n.sourceCoords&&{sourceCoords:n.sourceCoords}}),r(null))},[n,o.activePlayerId,s,ht]),co=m.useCallback((R,F)=>{ro(R,F)},[ro]),ea=m.useCallback(R=>{if(!mt)return;const F=o.players.find(ze=>ze.id===mt.targetPlayerId);if(!F||F.deck.length<=R)return;const Se=F.deck[R];Se&&ae({card:Se,source:"deck",playerId:mt.targetPlayerId,cardIndex:R},{target:"deck",playerId:mt.targetPlayerId,deckPosition:"bottom"})},[mt,o.players,ae]),ji=m.useCallback(R=>{if(!mt)return;const F=o.players.find(ze=>ze.id===mt.targetPlayerId);if(!F||F.deck.length<=R)return;const Se=F.deck[R];Se&&ae({card:Se,source:"deck",playerId:mt.targetPlayerId,cardIndex:R},{target:"hand",playerId:mt.targetPlayerId})},[mt,o.players,ae]),Pi=m.useCallback(R=>{if(!mt)return;const F=o.players.find(ze=>ze.id===mt.targetPlayerId);if(!F||F.deck.length<=R)return;const Se=F.deck[R];Se&&ae({card:Se,source:"deck",playerId:mt.targetPlayerId,cardIndex:R},{target:"discard",playerId:mt.targetPlayerId})},[mt,o.players,ae]),Ni=m.useCallback(R=>{if(!mt)return;const F=o.players.find(ye=>ye.id===mt.targetPlayerId);if(!F||F.deck.length<=R)return;const Se=F.deck[R];if(!Se)return;In(null);const ze={card:Se,source:"deck",playerId:mt.targetPlayerId,cardIndex:R};Sn({card:Se,sourceItem:ze,faceDown:!1})},[mt,o.players,Sn]),Ai=m.useCallback(()=>{mt&&mt.isLocked&&mt.sourceCard&&(mt.sourceCard.ownerId!==void 0&&K(mt.sourceCard.ownerId),mt.sourceCoords&&Pe(mt.sourceCoords,mt.isDeployAbility)),In(null)},[mt,K,Pe]),as=m.useMemo(()=>mt?o.players.find(R=>R.id===mt.targetPlayerId):null,[mt,o.players]);m.useLayoutEffect(()=>{const R=()=>{const ze=window.innerHeight-56,lt=(window.innerWidth-ze)/2;p(Math.max(0,lt))};return window.addEventListener("resize",R),R(),()=>window.removeEventListener("resize",R)},[]),m.useEffect(()=>{let R=!0;return $b().then(()=>{R&&Object.keys(Zr).length>0&&Si(F=>F+1)}).catch(F=>{console.error("Failed to load content database:",F)}),()=>{R=!1}},[]),m.useEffect(()=>{const R=F=>{b.current&&(F.stopPropagation(),F.preventDefault())};return window.addEventListener("click",R,!0),()=>window.removeEventListener("click",R,!0)},[]),m.useEffect(()=>{const R=()=>{n!=null&&n.sourceCoords&&n.sourceCoords.row>=0&&Pe(n.sourceCoords,n.isDeployAbility,!1,n.readyStatusToRemove),g!=null&&g.sourceCoords&&g.sourceCoords.row>=0&&Pe(g.sourceCoords,g.isDeployAbility),o.players.forEach(ze=>{(ze.id===s||ze.isDummy)&&ze.announcedCard&&ae({card:ze.announcedCard,source:"announced",playerId:ze.id},{target:"discard",playerId:ze.id})}),N(null),Sn(null),r(null),_r(null),ao(null),io([]),ja({}),Ia(null),In(null)},F=ze=>{["INPUT","TEXTAREA","SELECT"].includes(ze.target.tagName)||(ze.code==="Space"&&(ze.preventDefault(),o.isGameStarted&&be()),ze.key==="Escape"&&R())},Se=ze=>{(g||Zt||n)&&(ze.preventDefault(),R())};return window.addEventListener("keydown",F),window.addEventListener("contextmenu",Se),()=>{window.removeEventListener("keydown",F),window.removeEventListener("contextmenu",Se)}},[g,Zt,n,Pe,o.isGameStarted,be,Ve,ae,o.players,s]),m.useEffect(()=>{if(Nt){Ri(Nt.coords);const R=setTimeout(()=>Ri(null),nt.NO_TARGET_DURATION);return()=>clearTimeout(R)}},[Nt]);const os=m.useRef("");m.useEffect(()=>{Di(!1)},[o==null?void 0:o.currentPhase]),m.useEffect(()=>{rs(R=>R+1)},[o==null?void 0:o.currentPhase]),m.useEffect(()=>{if(!o)return;const R=o.activePlayerId;if(R===void 0)return;let F="";o.board.forEach(Se=>{Se.forEach(ze=>{var ye;if(((ye=ze.card)==null?void 0:ye.ownerId)===R&&ze.card.statuses){const lt=ze.card.statuses.filter(jt=>jt.type==="Support").length,It=ze.card.statuses.filter(jt=>jt.type==="Threat").length,ln=ze.card.statuses.filter(jt=>jt.type==="Stun").length;F+=`${ze.card.id}:${lt}:${It}:${ln};`}})}),os.current!==F&&(os.current=F,rs(Se=>Se+1))},[o]),m.useEffect(()=>{var ln,jt,sr,vr,ot,Na,je,$e,kt,At;let R=n;g&&!n&&(R={type:"CREATE_STACK",tokenType:g.type,count:g.count,...g.sourceCard&&{sourceCard:g.sourceCard},...g.onlyFaceDown!==void 0&&{onlyFaceDown:g.onlyFaceDown},...g.onlyOpponents!==void 0&&{onlyOpponents:g.onlyOpponents},...g.targetOwnerId!==void 0&&{targetOwnerId:g.targetOwnerId},...g.excludeOwnerId!==void 0&&{excludeOwnerId:g.excludeOwnerId},...g.targetType&&{targetType:g.targetType},...g.requiredTargetStatus&&{requiredTargetStatus:g.requiredTargetStatus},...g.requireStatusFromSourceOwner!==void 0&&{requireStatusFromSourceOwner:g.requireStatusFromSourceOwner},...g.mustBeAdjacentToSource&&{mustBeAdjacentToSource:g.mustBeAdjacentToSource},...g.mustBeInLineWithSource&&{mustBeInLineWithSource:g.mustBeInLineWithSource},...g.maxDistanceFromSource!==void 0&&{maxDistanceFromSource:g.maxDistanceFromSource},...g.maxOrthogonalDistance!==void 0&&{maxOrthogonalDistance:g.maxOrthogonalDistance},...g.sourceCoords&&{sourceCoords:g.sourceCoords}});let F=s||o.activePlayerId||null;if((ln=R==null?void 0:R.sourceCard)!=null&&ln.ownerId)F=R.sourceCard.ownerId;else if(R!=null&&R.sourceCoords&&R.sourceCoords.row>=0&&R.sourceCoords.row<Dr&&R.sourceCoords.col>=0&&R.sourceCoords.col<o.board[R.sourceCoords.row].length){const Je=o.board[R.sourceCoords.row][R.sourceCoords.col],Qe=Je==null?void 0:Je.card;Qe!=null&&Qe.ownerId&&(F=Qe.ownerId)}else if(o.activePlayerId){const Je=o.players.find(Qe=>Qe.id===o.activePlayerId);Je!=null&&Je.isDummy&&(F=Je.id)}const Se=hi(R,o,F??null,or),ze=[];if(Zt&&!n&&!g){const Je=Zt.card;((jt=Je==null?void 0:Je.types)==null?void 0:jt.includes("Unit"))&&o.board.slice(0,Dr).forEach((Dt,en)=>{Dt.slice(0,Dt.length).forEach((vn,$n)=>{vn.card||Se.push({row:en,col:$n})})})}if(_t&&!n&&!g){const Je=o.players.find(Qe=>Qe.id===_t.ownerId);if(((sr=Je==null?void 0:Je.announcedCard)==null?void 0:sr.id)===_t.id){const Qe=(_t.baseId||_t.id.split("_")[1]||_t.id).toLowerCase();if(["overwatch","tacticalmaneuver","repositioning","inspiration","datainterception","falseorders","experimentalstimulants","logisticschain","quickresponseteam","temporaryshelter","enhancedinterrogation"].some(Dt=>Qe.includes(Dt)))try{jl(_t.id,0,_t,o,_t.ownerId).forEach(en=>{hi(en,o,_t.ownerId,or).forEach(vn=>{Se.some($n=>$n.row===vn.row&&$n.col===vn.col)||Se.push(vn)})})}catch{}}}if((n==null?void 0:n.type)==="ENTER_MODE"&&n.mode==="SELECT_TARGET"&&(n.payload.actionType==="SELECT_HAND_FOR_DEPLOY"||n.payload.filter)&&o.players.forEach(Je=>{Je.hand.forEach((Qe,xt)=>{var Dt,en;(en=(Dt=n.payload).filter)!=null&&en.call(Dt,Qe)&&(n.payload.actionType==="SELECT_HAND_FOR_DEPLOY"?Je.id===F&&ze.push({playerId:Je.id,cardIndex:xt}):ze.push({playerId:Je.id,cardIndex:xt}))})}),ze.length>0||(n==null?void 0:n.type)==="ENTER_MODE"&&n.mode==="SELECT_TARGET"&&((vr=n.payload)!=null&&vr.filter)?$r(ze):$r([]),g){const Je=Zr[g.type];(g.type==="Revealed"||((ot=Je==null?void 0:Je.allowedTargets)==null?void 0:ot.includes("hand")))&&o.players.forEach(xt=>{xt.hand.forEach((Dt,en)=>{const jr={...g.targetOwnerId!==void 0&&{targetOwnerId:g.targetOwnerId},...g.excludeOwnerId!==void 0&&{excludeOwnerId:g.excludeOwnerId},onlyOpponents:g.onlyOpponents||g.targetOwnerId===-1,...g.onlyFaceDown!==void 0&&{onlyFaceDown:g.onlyFaceDown},...g.targetType&&{targetType:g.targetType},...g.requiredTargetStatus&&{requiredTargetStatus:g.requiredTargetStatus},tokenType:g.type};va({card:Dt,ownerId:xt.id,location:"hand"},jr,F,o.players)&&ze.push({playerId:xt.id,cardIndex:en})})})}if(n&&(n.mode==="SCORE_LAST_PLAYED_LINE"||n.mode==="SELECT_LINE_END"||n.mode==="INTEGRATOR_LINE_SELECT"||n.mode==="ZIUS_LINE_SELECT")){const Je=Dr;if(n.sourceCoords){for(let Qe=0;Qe<Je;Qe++)Se.push({row:n.sourceCoords.row,col:Qe});for(let Qe=0;Qe<Je;Qe++)Se.push({row:Qe,col:n.sourceCoords.col})}else for(let Qe=0;Qe<Je;Qe++)for(let xt=0;xt<Je;xt++)Se.push({row:Qe,col:xt})}lo(Se),$r(ze);const ye=Zt&&((je=(Na=Zt.card)==null?void 0:Na.types)==null?void 0:je.includes("Unit")),It=n||g||ye||!!_t;if(It&&Se.length>0){let Je=null;if(n)Je=n;else if(g){const Qe=g.targetType;Je={type:"ENTER_MODE",mode:"SELECT_TARGET",sourceCoords:g.sourceCoords,payload:{filter:Qe?xt=>{var Dt;return(Dt=xt.types)==null?void 0:Dt.includes(Qe)}:void 0,...g.maxDistanceFromSource!==void 0&&{range:g.maxDistanceFromSource}},originalOwnerId:g.originalOwnerId}}else Zt?Je={type:"ENTER_MODE",mode:"SELECT_TARGET"}:_t&&(Je={type:"ENTER_MODE",mode:"SELECT_TARGET"});if(Je&&F!==null){let Qe=null;if((_t==null?void 0:_t.ownerId)!==void 0&&(Qe=_t.ownerId),Qe===null&&(n!=null&&n.sourceCoords)){const{row:xt,col:Dt}=n.sourceCoords;if(xt>=0&&xt<Dr&&Dt>=0&&Dt<o.board[xt].length){const en=($e=o.board[xt][Dt])==null?void 0:$e.card;(en==null?void 0:en.ownerId)!==void 0&&(Qe=en.ownerId)}}Qe===null&&((kt=g==null?void 0:g.sourceCard)==null?void 0:kt.ownerId)!==void 0&&(Qe=g.sourceCard.ownerId),Qe=Qe??o.activePlayerId??s??F,X(Je,Qe,(n==null?void 0:n.sourceCoords)||(g==null?void 0:g.sourceCoords),Se,or)}}else It||(((At=o.targetingMode)==null?void 0:At.playerId)===s&&L(),$r([]))},[n,g,Zt,_t,o.board,o.players,s,or,o.activePlayerId,X,L]),m.useEffect(()=>{const R=o.activePlayerId;if(!R||R!==s)return;const F=Ra.length>0,Se=(n==null?void 0:n.mode)==="SELECT_DECK";!F&&!Se||me({validHandTargets:Ra,isDeckSelectable:Se})},[n,n==null?void 0:n.mode,Ra,o.activePlayerId,s,me]),m.useEffect(()=>{if(we){Qo(we);const R=setTimeout(()=>Qo(null),nt.HIGHLIGHT_DURATION);return()=>clearTimeout(R)}},[we]),m.useEffect(()=>{if(pt&&pt.length>0){const R=pt.map(Se=>({...Se,id:`float_${Date.now()}_${Math.random()}`}));_i(Se=>[...Se,...R]);const F=setTimeout(()=>{_i(Se=>Se.filter(ze=>!R.find(ye=>ye.id===ze.id)))},2e3);return()=>clearTimeout(F)}},[pt]),m.useEffect(()=>{var R,F;if((R=o.targetingMode)!=null&&R.boardTargets){const Se=o.targetingMode.boardTargets;lo(Se),o.targetingMode.handTargets&&$r(o.targetingMode.handTargets),I.current=!0}else if(!n&&!g&&!Zt){if(I.current&&((F=o.targetingMode)==null?void 0:F.playerId)!==s)return;I.current&&(lo([]),$r([]),I.current=!1)}},[o.targetingMode,n,g,Zt,s]),m.useEffect(()=>{var R,F;if(!o.isScoringStep&&(n==null?void 0:n.mode)==="SCORE_LAST_PLAYED_LINE"){r(null);return}if(o.isScoringStep&&!n){const Se=o.activePlayerId,ze=o.players.find(lt=>lt.id===Se);if(ze&&(ze.id===s||ze.isDummy)){let lt=!1,It=null;for(let ln=0;ln<Dr;ln++){for(let jt=0;jt<Dr;jt++){const sr=(R=o.board[ln])==null?void 0:R[jt],vr=sr==null?void 0:sr.card;if((F=vr==null?void 0:vr.statuses)!=null&&F.some(ot=>ot.type==="LastPlayed"&&ot.addedByPlayerId===Se)){It={row:ln,col:jt},lt=!0;break}}if(lt)break}lt&&It?r({type:"ENTER_MODE",mode:"SCORE_LAST_PLAYED_LINE",sourceCoords:It}):(Se===s||ze!=null&&ze.isDummy&&s===1)&&be()}}},[o==null?void 0:o.isScoringStep,o==null?void 0:o.activePlayerId,s,o==null?void 0:o.board,n,be,o==null?void 0:o.players,Dr]),m.useEffect(()=>{var R,F,Se,ze,ye,lt,It,ln,jt,sr;if(ns.length>0&&!n&&!g){const vr=ns[0];io(je=>je.slice(1));const ot={...vr};if(ot.mode==="SELECT_CELL"&&or.lastMovedCardCoords&&((R=ot.payload)!=null&&R.useContextCard)){const{row:je,col:$e}=or.lastMovedCardCoords;if(typeof je=="number"&&typeof $e=="number"&&je>=0&&je<Dr&&o.board[je]&&$e>=0&&$e<o.board[je].length&&o.board[je][$e]){const kt=o.board[je][$e].card;kt&&(ot.sourceCard=kt,ot.sourceCoords=or.lastMovedCardCoords,ot.recordContext=!0)}}const Na=(je,$e,kt=0)=>{let At=kt;return je==="Aim"?o.board.forEach(Je=>Je.forEach(Qe=>{var xt;(xt=Qe.card)!=null&&xt.statuses&&(At+=Qe.card.statuses.filter(Dt=>Dt.type==="Aim"&&Dt.addedByPlayerId===$e).length)})):je==="Exploit"&&o.board.forEach(Je=>Je.forEach(Qe=>{var xt;(xt=Qe.card)!=null&&xt.statuses&&(At+=Qe.card.statuses.filter(Dt=>Dt.type==="Exploit"&&Dt.addedByPlayerId===$e).length)})),At};if(ot.type==="GLOBAL_AUTO_APPLY")if((F=ot.payload)!=null&&F.cleanupCommand){const je=ot.payload.ownerId!==void 0?ot.payload.ownerId:(Se=ot.sourceCard)==null?void 0:Se.ownerId;if(je!==void 0){const $e=o.players.find(At=>At.id===je),kt=($e==null?void 0:$e.announcedCard)||ot.sourceCard;kt&&kt.id!=="dummy"&&ae({card:kt,source:"announced",playerId:je},{target:"discard",playerId:je})}}else if((ze=ot.payload)!=null&&ze.dynamicResource){const{type:je,factor:$e,baseCount:kt,ownerId:At}=ot.payload.dynamicResource,Je=((ye=ot.sourceCard)==null?void 0:ye.ownerId)??ot.originalOwnerId??At??s,Qe=Na($e,Je,kt);je==="draw"&&Qe>0&&ee(Je,Qe)}else if((lt=ot.payload)!=null&&lt.resourceChange){const{draw:je,score:$e}=ot.payload.resourceChange,kt=((It=ot.sourceCard)==null?void 0:It.ownerId)||o.activePlayerId;kt!=null&&(je&&ee(kt,typeof je=="number"?je:1),$e&&$(kt,$e))}else(ln=ot.payload)!=null&&ln.contextReward&&ot.sourceCard?ft(ot,ot.sourceCoords||{row:-1,col:-1}):(jt=ot.payload)!=null&&jt.customAction&&ot.sourceCard&&ft(ot,ot.sourceCoords||{row:-1,col:-1});else if(ot.type==="CREATE_STACK"||ot.type==="OPEN_MODAL")ft(ot,ot.sourceCoords||{row:-1,col:-1});else{const je=((sr=ot.sourceCard)==null?void 0:sr.ownerId)||s;Es(ot,o,je,or)?r(ot):ot.sourceCoords&&ot.sourceCoords.row>=0&&Wt(ot.sourceCoords)}}},[ns,n,g,s,K,$,o.activePlayerId,o.board,ae,or,H,o.players,ft,Wt]);const _n=m.useCallback(()=>{on(R=>({...R,isTokensModalOpen:!1,isCountersModalOpen:!1,isRulesModalOpen:!1})),_r(null),ar(null),ao(null),Ia(null),In(null),Sa({tokensModalAnchor:null,countersModalAnchor:null})},[]),Oi=m.useCallback(()=>{rt&&(D(!0),o.gameMode===Kr.FreeForAll?h():on(R=>({...R,isTeamAssignOpen:!0})))},[rt,o.gameMode,h,D]),Li=m.useCallback(R=>{_(R),on(F=>({...F,isTeamAssignOpen:!1})),h()},[_,h]),Mi=m.useCallback(R=>{d(R),on(F=>({...F,isJoinModalOpen:!1}))},[d]),zi=m.useCallback(()=>{c(),l(1)},[c,l]),$i=m.useCallback(()=>{ke(),on(R=>({...R,isJoinModalOpen:!0}))},[ke]),Gi=m.useCallback(R=>{const F=R.trim(),Se=localStorage.getItem("custom_ws_url")||"";F!==Se&&(localStorage.setItem("custom_ws_url",F),et()),on(ze=>({...ze,isSettingsModalOpen:!1}))},[et]);m.useEffect(()=>{const R=sessionStorage.getItem("invite_host_id"),F=sessionStorage.getItem("invite_auto_join");console.log("[App] WebRTC Invite Check - inviteHostId:",R,"autoJoinFlag:",F,"connectAsGuest exists:",typeof Ea),R&&F&&typeof Ea=="function"&&(console.log("[App] Auto-connecting to WebRTC host:",R),sessionStorage.removeItem("invite_host_id"),sessionStorage.removeItem("invite_auto_join"),Ea(R).then(Se=>{Se?console.log("[App] Successfully connected to WebRTC host"):console.error("[App] Failed to connect to WebRTC host")}).catch(Se=>{console.error("[App] Error connecting to WebRTC host:",Se)}))},[Ea]),m.useEffect(()=>{const R=sessionStorage.getItem("invite_game_id"),F=sessionStorage.getItem("invite_auto_join");if(R&&F&&fe==="Connected")if(!o.gameId||o.gameId!==R){console.warn("[App] Auto-joining game from invite link:",R),sessionStorage.removeItem("invite_game_id"),sessionStorage.removeItem("invite_auto_join");const ze=`Player ${Math.floor(Math.random()*1e3)}`;f(R,ze)}else sessionStorage.removeItem("invite_game_id"),sessionStorage.removeItem("invite_auto_join")},[fe,o.gameId,f]);const Ui=m.useCallback(()=>{const R=Date.now();Si(R),localStorage.setItem("image_refresh_data",JSON.stringify({version:R,timestamp:R})),Te()},[Te]),G=m.useCallback(R=>{s!==null&&ue({...R,playerId:s})},[s,ue]),W=m.useCallback(()=>Zo(null),[]),ce=m.useCallback((R,F,Se)=>{R.preventDefault(),!(n||g||Zt)&&(R.stopPropagation(),s!==null&&Zo({x:R.clientX,y:R.clientY,type:F,data:Se}))},[n,g,Zt,s]),oe=(R,F)=>{var It,ln;if(n||g||b.current)return;const Se=R.ownerId===s;if(Se&&R.isFaceDown){We(F);return}const ze=R.ownerId?(It=o==null?void 0:o.players)==null?void 0:It.find(jt=>jt.id===R.ownerId):void 0,ye=(ln=R.statuses)==null?void 0:ln.some(jt=>jt.type==="Revealed"&&jt.addedByPlayerId===s);!R.isFaceDown||R.revealedTo==="all"||Array.isArray(R.revealedTo)&&R.revealedTo.includes(s)||ye||Se?ar({card:R,player:ze}):s!==null&&U({source:"board",ownerId:R.ownerId,boardCoords:F},s)},tt=R=>{n||g||b.current||G({type:"cell",row:R.row,col:R.col})},pe=(R,F,Se)=>{var ze;if(!(n||g)&&!b.current){if(R.id===s||R.isDummy){if(F.deck===it.Command){_n(),le(F,{card:F,source:"hand",playerId:R.id,cardIndex:Se});return}_n();const ye={card:F,source:"hand",playerId:R.id,cardIndex:Se};Sn({card:F,sourceItem:ye,faceDown:!1})}else if(s!==null){const ye=F.revealedTo==="all",lt=Array.isArray(F.revealedTo)&&F.revealedTo.includes(s),It=(ze=F.statuses)==null?void 0:ze.some(jt=>jt.type==="Revealed"&&jt.addedByPlayerId===s);ye||lt||It||!!R.isDummy||!!R.isDisconnected?ar({card:F,player:R}):U({source:"hand",ownerId:R.id,cardIndex:Se},s)}}},Ye=m.useCallback(R=>{_r({player:R,isDeckView:!0})},[]),yt=m.useCallback(R=>{_r({player:R,isDeckView:!1})},[]),qe=m.useMemo(()=>ct?o.players.find(R=>R.id===ct.player.id)||ct.player:null,[ct,o.players]),Yt=m.useMemo(()=>{var R,F,Se,ze;if(((R=ct==null?void 0:ct.pickConfig)==null?void 0:R.filterType)==="Unit")return ye=>{var lt;return!!((lt=ye.types)!=null&&lt.includes("Unit"))};if(((F=ct==null?void 0:ct.pickConfig)==null?void 0:F.filterType)==="Command")return ye=>{var lt;return ye.deck===it.Command||!!((lt=ye.types)!=null&&lt.includes("Command"))};if(((Se=ct==null?void 0:ct.pickConfig)==null?void 0:Se.filterType)==="Device")return ye=>{var lt;return!!((lt=ye.types)!=null&&lt.includes("Device"))};if(((ze=ct==null?void 0:ct.pickConfig)==null?void 0:ze.filterType)==="Optimates")return ye=>{var lt,It;return!!((lt=ye.types)!=null&&lt.includes("Unit"))&&!!((It=ye.types)!=null&&It.includes("Optimates"))}},[(Jn=ct==null?void 0:ct.pickConfig)==null?void 0:Jn.filterType]),Mn=R=>{if(!(ct!=null&&ct.pickConfig))return;const{action:F,isDeck:Se}=ct.pickConfig;F==="recover"?(Se?(ae({card:qe.deck[R],source:"deck",playerId:qe.id,cardIndex:R},{target:"hand",playerId:qe.id}),n!=null&&n.sourceCard&&(n.sourceCard.name.includes("Mr. Pearl")||n.sourceCard.name.includes("Lucius")||n.sourceCard.name.includes("Quick Response")||n.sourceCard.name.includes("Michael Falk"))&&J(ye=>{const lt=ye.players.find(It=>It.id===qe.id);return lt&&(lt.deck=Gs(lt.deck)),ye})):Ze(qe.id,R),_r(null)):F==="resurrect"&&(n==null?void 0:n.mode)==="IMMUNIS_RETRIEVE"&&(r(ze=>({...ze,payload:{...ze.payload,selectedCardIndex:R}})),_r(null))},Dn=(R,F)=>{var It;if(!ct||!qe)return;const Se=ct.isDeckView||((It=ct.pickConfig)==null?void 0:It.isDeck),ze=Se?"deckCard":"discardCard",lt=(Se?qe.deck:qe.discard)[F];lt&&ce(R,ze,{card:lt,player:qe,cardIndex:F})},sn=m.useMemo(()=>{var lt,It,ln,jt,sr,vr,ot,Na;if(!Xo||s===null||!o)return null;const{type:R,data:F,x:Se,y:ze}=Xo;let ye=[];if(R==="emptyBoardCell")ye.push({label:t("highlightCell"),onClick:()=>G({type:"cell",row:F.boardCoords.row,col:F.boardCoords.col})}),ye.push({label:t("highlightColumn"),onClick:()=>G({type:"col",col:F.boardCoords.col})}),ye.push({label:t("highlightRow"),onClick:()=>G({type:"row",row:F.boardCoords.row})});else if(R==="boardItem"||R==="announcedCard"){const je=R==="boardItem";let $e=je?o.board[F.boardCoords.row][F.boardCoords.col].card:F.card,kt=je?null:F.player;if(!je&&kt){const Mt=(lt=o.players)==null?void 0:lt.find(Ur=>Ur.id===kt.id);Mt&&(kt=Mt,$e=Mt.announcedCard||$e)}if(!$e)return Zo(null),null;const At=$e.ownerId?(It=o.players)==null?void 0:It.find(Mt=>Mt.id===$e.ownerId):void 0,Je=$e.ownerId===s,Qe=!!(At!=null&&At.isDummy),xt=Je||Qe,Dt=(ln=$e.statuses)==null?void 0:ln.some(Mt=>Mt.type==="Revealed"&&Mt.addedByPlayerId===s),en=!$e.isFaceDown||$e.revealedTo==="all"||Array.isArray($e.revealedTo)&&$e.revealedTo.includes(s)||Dt;(en||Je&&$e.isFaceDown)&&ye.push({label:t("view"),isBold:!0,onClick:()=>ar({card:$e,player:At})}),!je&&xt&&$e.deck===it.Command&&ye.push({label:t("play"),isBold:!0,onClick:()=>{le($e,{card:$e,source:"announced",playerId:kt.id})}}),je&&xt&&($e.isFaceDown?ye.push({label:t("flipUp"),isBold:!0,onClick:()=>We(F.boardCoords)}):ye.push({label:t("flipDown"),onClick:()=>V(F.boardCoords)}));const jr=je?{card:$e,source:"board",boardCoords:F.boardCoords}:{card:$e,source:"announced",playerId:kt.id},vn=$e.ownerId,$n=($e==null?void 0:$e.deck)===it.Tokens||($e==null?void 0:$e.deck)==="counter";if(je&&(xt&&$e.isFaceDown&&ye.push({label:t("revealToAll"),onClick:()=>E(F.boardCoords,"all")}),!Je&&!en&&ye.push({label:t("requestReveal"),onClick:()=>U({source:"board",ownerId:$e.ownerId,boardCoords:F.boardCoords},s)})),ye.length>0&&ye.push({isDivider:!0}),xt&&en&&(ye.push({label:t("toHand"),disabled:$n,onClick:()=>ae(jr,{target:"hand",playerId:vn})}),vn)){const Mt=t($n?"remove":"toDiscard");ye.push({label:Mt,onClick:()=>ae(jr,{target:"discard",playerId:vn})}),ye.push({label:t("toDeckTop"),disabled:$n,onClick:()=>ae(jr,{target:"deck",playerId:vn,deckPosition:"top"})}),ye.push({label:t("toDeckBottom"),disabled:$n,onClick:()=>ae(jr,{target:"deck",playerId:vn,deckPosition:"bottom"})})}if(je&&(ye.push({isDivider:!0}),ye.push({label:t("highlightCell"),onClick:()=>G({type:"cell",row:F.boardCoords.row,col:F.boardCoords.col})}),ye.push({label:t("highlightColumn"),onClick:()=>G({type:"col",col:F.boardCoords.col})}),ye.push({label:t("highlightRow"),onClick:()=>G({type:"row",row:F.boardCoords.row})})),en&&(xt||je)){const Mt=["Aim","Exploit","Stun","Shield","Support","Threat","Revealed"],Ur=[];Mt.forEach(br=>{var fo;(((fo=$e.statuses)==null?void 0:fo.filter(s0=>s0.type===br).length)||0)>0&&Ur.push({type:"statusControl",label:br,onAdd:()=>je?H(F.boardCoords,br,s):Z(kt.id,br,s),onRemove:()=>je?ne(F.boardCoords,br):Oe(kt.id,br),removeDisabled:!1})}),Ur.length>0&&(ye.length>0&&!("isDivider"in ye[ye.length-1])&&ye.push({isDivider:!0}),ye.push(...Ur)),ye.length>0&&!("isDivider"in ye[ye.length-1])&&ye.push({isDivider:!0}),ye.push({type:"statusControl",label:t("power"),onAdd:()=>je?xe(F.boardCoords,1):Re(kt.id,1),onRemove:()=>je?xe(F.boardCoords,-1):Re(kt.id,-1),removeDisabled:!1})}}else if(R==="token_panel_item"){const{card:je}=F,$e={card:je,source:"token_panel"};ye.push({label:t("view"),isBold:!0,onClick:()=>ar({card:je})}),ye.push({isDivider:!0}),ye.push({label:t("play"),isBold:!0,onClick:()=>{_n(),Sn({card:je,sourceItem:$e,faceDown:!1})}}),ye.push({label:t("playFaceDown"),onClick:()=>{_n(),Sn({card:je,sourceItem:$e,faceDown:!0})}})}else if(["handCard","discardCard","deckCard"].includes(R)){let{card:je,player:$e}=F;const{boardCoords:kt,cardIndex:At}=F,Je=(jt=o.players)==null?void 0:jt.find(jn=>jn.id===$e.id);Je&&($e=Je,R==="handCard"?je=Je.hand[At]||je:R==="discardCard"?je=Je.discard[At]||je:R==="deckCard"&&(je=Je.deck[At]||je));const Qe=$e.id===s||!!$e.isDummy,xt=(sr=o.players)==null?void 0:sr.find(jn=>jn.id===s),Dt=(xt==null?void 0:xt.teamId)!==void 0&&$e.teamId===xt.teamId,en=je.revealedTo==="all"||Array.isArray(je.revealedTo)&&je.revealedTo.includes(s),jr=(vr=je.statuses)==null?void 0:vr.some(jn=>jn.type==="Revealed"&&jn.addedByPlayerId===s),vn=R!=="handCard"?!0:$e.id===s||Dt||!!$e.isDummy||!!$e.isDisconnected||en||jr;let $n;R==="handCard"?$n="hand":R==="discardCard"?$n="discard":$n="deck";const Mt={card:je,source:$n,playerId:$e==null?void 0:$e.id,cardIndex:At,boardCoords:kt},Ur=je.ownerId,br=(je==null?void 0:je.deck)===it.Tokens||(je==null?void 0:je.deck)==="counter";if(vn){const jn=je.ownerId?(ot=o==null?void 0:o.players)==null?void 0:ot.find(fo=>fo.id===je.ownerId):void 0;ye.push({label:t("view"),isBold:!0,onClick:()=>ar({card:je,player:jn})})}if(Qe){if(je.deck===it.Command?ye.push({label:t("play"),isBold:!0,onClick:()=>{_n(),le(je,Mt)}}):R==="handCard"?(ye.push({label:t("play"),isBold:!0,onClick:()=>{_n(),Sn({card:je,sourceItem:Mt,faceDown:!1})}}),ye.push({label:t("playFaceDown"),onClick:()=>{_n(),Sn({card:je,sourceItem:Mt,faceDown:!0})}})):vn&&["discardCard","deckCard"].includes(R)&&(ye.push({label:t("play"),isBold:!0,onClick:()=>{_n(),Sn({card:je,sourceItem:Mt,faceDown:!1})}}),ye.push({label:t("playFaceDown"),onClick:()=>{_n(),Sn({card:je,sourceItem:Mt,faceDown:!0})}})),ye.length>0&&ye.push({isDivider:!0}),R==="handCard"&&ye.push({label:t("revealToAll"),onClick:()=>Ke($e.id,At,"all")}),ye.length>0&&!("isDivider"in ye[ye.length-1])&&ye.push({isDivider:!0}),R==="discardCard"){const jn=Ur??$e.id;ye.push({label:t("toHand"),disabled:br,onClick:()=>ae(Mt,{target:"hand",playerId:jn})})}else R==="handCard"&&ye.push({label:t("toDiscard"),onClick:()=>ae(Mt,{target:"discard",playerId:Ur})});if(["handCard","discardCard"].includes(R)){const jn=Ur??$e.id;ye.push({label:t("toDeckTop"),disabled:br,onClick:()=>ae(Mt,{target:"deck",playerId:jn,deckPosition:"top"})}),ye.push({label:t("toDeckBottom"),disabled:br,onClick:()=>ae(Mt,{target:"deck",playerId:jn,deckPosition:"bottom"})})}R==="deckCard"&&(ye.push({label:t("toHand"),disabled:br,onClick:()=>ae(Mt,{target:"hand",playerId:$e.id})}),ye.push({label:t("toDiscard"),onClick:()=>ae(Mt,{target:"discard",playerId:$e.id})})),R==="handCard"&&(((Na=je.statuses)==null?void 0:Na.filter(fo=>fo.type==="Revealed").length)||0)>0&&(ye.length>0&&!("isDivider"in ye[ye.length-1])&&ye.push({isDivider:!0}),ye.push({type:"statusControl",label:t("revealed"),onAdd:()=>Ce($e.id,At,"Revealed",s),onRemove:()=>Le($e.id,At,"Revealed"),removeDisabled:!1}))}else R==="handCard"&&!vn&&ye.push({label:t("requestReveal"),onClick:()=>U({source:"hand",ownerId:$e.id,cardIndex:At},s)})}else if(R==="deckPile"){const{player:je}=F;(je.id===s||!!je.isDummy)&&(ye.push({label:t("drawCard"),onClick:()=>K(je.id)}),ye.push({label:t("drawStartingHand"),onClick:()=>{for(let kt=0;kt<6;kt++)K(je.id)}}),ye.push({label:t("viewTopCards"),onClick:()=>In({targetPlayerId:je.id,isLocked:!1,initialCount:1})}),ye.push({label:t("shuffle"),onClick:()=>q(je.id)})),ye.push({label:t("view"),onClick:()=>Ye(je)})}else if(R==="discardPile"){const{player:je}=F;ye.push({label:t("view"),onClick:()=>yt(je)})}return ye=ye.filter((je,$e)=>"isDivider"in je?!($e===0||$e===ye.length-1||"isDivider"in ye[$e-1]):!0),i.jsx(fy,{x:Se,y:ze,items:ye,onClose:W})},[o,s,ae,G,H,ne,xe,Z,Oe,Re,Ce,Le,K,q,We,V,Ke,E,U,t,le,Xo,_n,W,Ye,yt]);m.useEffect(()=>{window.addEventListener("click",W);const R=F=>{F.target.closest("[data-interactive]")||W()};return window.addEventListener("contextmenu",R),()=>{window.removeEventListener("click",W),window.removeEventListener("contextmenu",R)}},[W]),m.useEffect(()=>{Ie&&W()},[Ie,W]);const zn=m.useCallback(R=>{if(Yn.isTokensModalOpen)on(F=>({...F,isTokensModalOpen:!1})),Sa(F=>({...F,tokensModalAnchor:null}));else{on(Se=>({...Se,isTokensModalOpen:!0,isCountersModalOpen:!1}));const F=R.currentTarget.getBoundingClientRect();Sa({tokensModalAnchor:{top:F.top,left:F.left},countersModalAnchor:null})}},[Yn.isTokensModalOpen]),Rn=m.useCallback(R=>{if(Yn.isCountersModalOpen)on(F=>({...F,isCountersModalOpen:!1})),Sa(F=>({...F,countersModalAnchor:null}));else{on(Se=>({...Se,isCountersModalOpen:!0,isTokensModalOpen:!1}));const F=R.currentTarget.getBoundingClientRect();Sa({countersModalAnchor:{top:F.top,left:F.left},tokensModalAnchor:null})}},[Yn.isCountersModalOpen]);return Ut?i.jsxs("div",{className:`relative w-screen h-screen overflow-hidden ${g?"cursor-none cursor-stack-active":""}`,children:[i.jsx(cx,{gameId:o.gameId,isGameStarted:o.isGameStarted,onStartGame:Oi,onResetGame:an,activeGridSize:o.activeGridSize,onGridSizeChange:x,dummyPlayerCount:o.dummyPlayerCount,onDummyPlayerCountChange:y,realPlayerCount:Ge,connectionStatus:fe,onExitGame:ie,onOpenTokensModal:zn,onOpenCountersModal:Rn,gameMode:o.gameMode,onGameModeChange:C,isPrivate:o.isPrivate,onPrivacyChange:D,isHost:rt,hostId:Dc,onSyncGame:Ui,currentPhase:o.currentPhase,onSetPhase:Ee,onNextPhase:be,onPrevPhase:De,activePlayerId:o.activePlayerId,playerColorMap:Jt,isAutoAbilitiesEnabled:es,onToggleAutoAbilities:Ac,isAutoDrawEnabled:_a,onToggleAutoDraw:R=>{s&&O(s,R)},hideDummyCards:Da,onToggleHideDummyCards:Oc,currentRound:o.currentRound,turnNumber:o.turnNumber,isReconnecting:Ei,reconnectProgress:jc}),i.jsx(Ux,{isOpen:Ei}),o.isRoundEndModalOpen&&i.jsx(Nx,{gameState:o,onContinueGame:rn,onStartNextRound:hn,onExit:ie}),Yn.isTeamAssignOpen&&i.jsx(hx,{players:o.players,gameMode:o.gameMode,onCancel:()=>on(R=>({...R,isTeamAssignOpen:!1})),onConfirm:Li}),o.isReadyCheckActive&&Ve&&i.jsx(mx,{players:o.players,localPlayer:Ve,onReady:w,onCancel:v}),z&&i.jsx(gx,{fromPlayer:o.players.find(R=>R.id===z.fromPlayerId),cardCount:z.cardIdentifiers.length,onAccept:()=>te(z.fromPlayerId,!0),onDecline:()=>te(z.fromPlayerId,!1)}),_t&&i.jsx(yx,{isOpen:!!_t,card:_t,playerColorMap:new Map(o.players.map(R=>[R.id,R.color])),onConfirm:R=>Xe(R,_t),onCancel:()=>{ao(null),io([]),ja({})}}),oo&&i.jsx(Ax,{isOpen:!!oo,data:oo,onConfirm:R=>Et(R,oo),onCancel:()=>{Ia(null),r(null)}}),mt&&as&&i.jsx(Ox,{isOpen:!!mt,player:as,onClose:Ai,onReorder:co,onMoveToBottom:ea,onViewCard:R=>ar({card:R}),onMoveToHand:ji,onMoveToDiscard:Pi,onPlayCard:Ni,playerColorMap:Jt,localPlayerId:s,imageRefreshVersion:qn,initialCount:mt.initialCount,isLocked:mt.isLocked}),so&&i.jsx(uy,{card:so.card,ownerPlayer:so.player,onClose:()=>ar(null),statusDescriptions:ac,allPlayers:o.players,imageRefreshVersion:qn}),ct&&qe&&i.jsx(dx,{isOpen:!!ct,onClose:()=>{_r(null),r(null)},title:ct.isDeckView||(Pa=ct.pickConfig)!=null&&Pa.isDeck?ct.pickConfig?t("selectCardFromDeck"):t("deckView"):ct.pickConfig?t("selectCardFromDiscard"):t("discardView"),player:qe,cards:ct.isDeckView||(uo=ct.pickConfig)!=null&&uo.isDeck?qe.deck:qe.discard,setDraggedItem:B,canInteract:!!ct.pickConfig||qe.id===s||!!qe.isDummy,onCardClick:Mn,onCardDoubleClick:Mn,onCardContextMenu:Dn,onReorder:(R,F)=>{var ze;const Se=ct.isDeckView||(ze=ct.pickConfig)!=null&&ze.isDeck?"deck":"discard";yr(R,F,Se)},isDeckView:ct.isDeckView||((Fi=ct.pickConfig)==null?void 0:Fi.isDeck),playerColorMap:Jt,localPlayerId:s,imageRefreshVersion:qn,highlightFilter:Yt,cursorStack:g}),i.jsx(ux,{isOpen:Yn.isTokensModalOpen,onClose:()=>on(R=>({...R,isTokensModalOpen:!1})),setDraggedItem:B,openContextMenu:ce,canInteract:!!s&&!Ne,anchorEl:Ii.tokensModalAnchor,imageRefreshVersion:qn}),i.jsx(px,{isOpen:Yn.isCountersModalOpen,onClose:()=>on(R=>({...R,isCountersModalOpen:!1})),canInteract:!!s&&!Ne,anchorEl:Ii.countersModalAnchor,imageRefreshVersion:qn,onCounterMouseDown:ge,cursorStack:g}),sn,g&&i.jsx("div",{ref:dt,className:"fixed top-0 left-0 pointer-events-none z-[99999] flex items-center justify-center",style:{willChange:"transform"},children:i.jsxs("div",{className:"w-12 h-12 rounded-full border-2 border-white flex items-center justify-center relative bg-gray-900",style:{backgroundImage:`url(${IC})`,backgroundSize:"contain",backgroundPosition:"center",backgroundRepeat:"no-repeat"},children:[Vo[g.type]?i.jsx("img",{src:`${Vo[g.type]}${qn?`?v=${qn}`:""}`,alt:g.type,className:"w-8 h-8 object-contain"}):i.jsx("span",{className:`font-bold text-white drop-shadow-md ${g.type.startsWith("Power")?"text-sm":"text-lg"}`,children:g.type.startsWith("Power")?g.type:g.type.charAt(0)}),g.count>1&&i.jsx("div",{className:"absolute -top-2 -right-2 bg-red-600 text-white text-xs font-bold w-6 h-6 flex items-center justify-center rounded-full border-2 border-white shadow-sm z-10",children:g.count})]})}),i.jsxs("div",{className:"relative h-full w-full pt-14 overflow-hidden bg-gray-900",children:[Ve&&i.jsx("div",{ref:$c,className:"absolute left-0 top-14 bottom-[2px] z-30 bg-panel-bg shadow-xl flex flex-col w-fit min-w-0 pl-[2px] py-[2px] pr-0 transition-all duration-100 overflow-hidden",style:{width:T},children:i.jsx(fh,{player:Ve,isLocalPlayer:!0,localPlayerId:s,isSpectator:Ne,isGameStarted:o.isGameStarted,onNameChange:R=>k(Ve.id,R),onColorChange:R=>j(Ve.id,R),onScoreChange:R=>$(Ve.id,R),onDeckChange:R=>A(Ve.id,R),onLoadCustomDeck:R=>M(Ve.id,R),onDrawCard:()=>K(Ve.id),handleDrop:re,draggedItem:Ie,setDraggedItem:B,openContextMenu:ce,onHandCardDoubleClick:pe,playerColorMap:Jt,allPlayers:o.players,localPlayerTeamId:Ve==null?void 0:Ve.teamId,activePlayerId:o.activePlayerId,onToggleActivePlayer:ve,imageRefreshVersion:qn,layoutMode:"list-local",onCardClick:gt,validHandTargets:Ra,onAnnouncedCardDoubleClick:st,currentPhase:o.currentPhase,disableActiveHighlights:Kt,preserveDeployAbilities:ts,roundWinners:o.roundWinners,startingPlayerId:o.startingPlayerId,currentRound:o.currentRound,onDeckClick:Gr,isDeckSelectable:(n==null?void 0:n.mode)==="SELECT_DECK",hideDummyCards:Da,deckSelections:ki,handCardSelections:Ti,cursorStack:g,remoteValidTargets:Y,highlightOwnerId:S},Ve.id)}),i.jsx("div",{className:"absolute top-14 bottom-0 z-10 flex items-center justify-center pointer-events-none w-full left-0",children:i.jsx("div",{ref:u,className:"pointer-events-auto h-full aspect-square flex items-center justify-center py-[2px]",children:i.jsx(ny,{board:o.board,isGameStarted:o.isGameStarted,activeGridSize:o.activeGridSize,handleDrop:re,draggedItem:Ie,setDraggedItem:B,openContextMenu:ce,playMode:Zt,setPlayMode:Sn,highlight:Pc,playerColorMap:Jt,localPlayerId:s,onCardDoubleClick:oe,onEmptyCellDoubleClick:tt,imageRefreshVersion:qn,cursorStack:g,currentPhase:o.currentPhase,activePlayerId:o.activePlayerId,onCardClick:Qt,onEmptyCellClick:Vt,validTargets:Lc,targetingMode:o.targetingMode,noTargetOverlay:Mc,disableActiveHighlights:Kt,preserveDeployAbilities:ts,activeFloatingTexts:Nc,abilitySourceCoords:(n==null?void 0:n.sourceCoords)||null,abilityCheckKey:zc,targetSelectionEffects:Q})})}),i.jsx("div",{className:"absolute right-0 top-14 bottom-[2px] z-30 bg-panel-bg shadow-xl flex flex-col min-w-0 pr-[2px] py-[2px] pl-0 transition-all duration-100 overflow-hidden",style:{width:T},children:i.jsx("div",{className:"flex flex-col h-full w-full",children:o.players.filter(R=>R.id!==s).sort((R,F)=>{const Se=(Ve==null?void 0:Ve.position)??0,ze=R.position??0,ye=F.position??0,lt=(ze-Se+o.players.length)%o.players.length,It=(ye-Se+o.players.length)%o.players.length;return lt-It}).map(R=>i.jsx("div",{className:"w-full flex-1 min-h-0 flex flex-col",children:i.jsx(fh,{player:R,isLocalPlayer:!1,localPlayerId:s,isSpectator:Ne,isGameStarted:o.isGameStarted,onNameChange:F=>k(R.id,F),onColorChange:F=>j(R.id,F),onScoreChange:F=>$(R.id,F),onDeckChange:F=>A(R.id,F),onLoadCustomDeck:F=>M(R.id,F),onDrawCard:()=>K(R.id),handleDrop:re,draggedItem:Ie,setDraggedItem:B,openContextMenu:ce,onHandCardDoubleClick:pe,playerColorMap:Jt,allPlayers:o.players,localPlayerTeamId:Ve==null?void 0:Ve.teamId,activePlayerId:o.activePlayerId,onToggleActivePlayer:ve,imageRefreshVersion:qn,layoutMode:"list-remote",onCardClick:gt,currentPhase:o.currentPhase,validHandTargets:Ra,onAnnouncedCardDoubleClick:st,disableActiveHighlights:Kt,preserveDeployAbilities:ts,roundWinners:o.roundWinners,startingPlayerId:o.startingPlayerId,currentRound:o.currentRound,onDeckClick:Gr,isDeckSelectable:(n==null?void 0:n.mode)==="SELECT_DECK",hideDummyCards:Da,deckSelections:ki,handCardSelections:Ti,cursorStack:g,remoteValidTargets:Y,highlightOwnerId:S})},R.id))})})]})]}):i.jsx(jx,{handleCreateGame:zi,setSettingsModalOpen:R=>on(F=>({...F,isSettingsModalOpen:R})),handleOpenJoinModal:$i,setDeckBuilderOpen:R=>on(F=>({...F,isDeckBuilderOpen:R})),setRulesModalOpen:R=>on(F=>({...F,isRulesModalOpen:R})),isJoinModalOpen:Yn.isJoinModalOpen,setJoinModalOpen:R=>on(F=>({...F,isJoinModalOpen:R})),handleJoinGame:Mi,gamesList:he,requestGamesList:ke,isDeckBuilderOpen:Yn.isDeckBuilderOpen,setViewingCard:ar,isSettingsModalOpen:Yn.isSettingsModalOpen,handleSaveSettings:Gi,isRulesModalOpen:Yn.isRulesModalOpen,viewingCard:so,gameState:o,imageRefreshVersion:qn,t,connectionStatus:fe,forceReconnect:et,gameId:o.gameId,isGameStarted:o.isGameStarted,isPrivate:o.isPrivate,initializeWebrtcHost:Rc,connectAsGuest:Ea})}),Ci=new URLSearchParams(window.location.search),wi=new URLSearchParams(window.location.hash.slice(1));console.log("[index.tsx] URL params:",{search:window.location.search,hash:window.location.hash,urlParams:Object.fromEntries(Ci.entries()),hashParams:Object.fromEntries(wi.entries())});const Bs=Ci.get("game")||wi.get("game"),lc=Ci.get("server")||wi.get("server"),cc=Ci.get("s")||wi.get("s"),Hs=Ci.get("hostId")||wi.get("hostId");console.log("[index.tsx] Parsed invite params:",{inviteGameId:Bs,inviteServerUrl:lc,encodedServerUrl:cc,inviteHostId:Hs});Bs&&(sessionStorage.setItem("invite_game_id",Bs),sessionStorage.setItem("invite_auto_join","true"),console.log("[index.tsx] Stored invite_game_id:",Bs));Hs&&(sessionStorage.setItem("invite_host_id",Hs),sessionStorage.setItem("invite_auto_join","true"),localStorage.setItem("webrtc_enabled","true"),console.log("[index.tsx] Stored invite_host_id:",Hs));lc&&localStorage.setItem("websocket_url",lc);if(cc)try{const e=decodeURIComponent(atob(cc));e&&(e.startsWith("ws://")||e.startsWith("wss://"))&&(localStorage.setItem("websocket_url",e),localStorage.setItem("custom_ws_url",e))}catch(e){console.error("Failed to decode server URL:",e)}(Bs||lc||cc||Hs)&&window.history.replaceState({},"",window.location.pathname);localStorage.getItem("webrtc_enabled")===null&&localStorage.setItem("webrtc_enabled","true");class _C extends ca.Component{constructor(t){super(t),this.state={hasError:!1}}static getDerivedStateFromError(t){return{hasError:!0}}componentDidCatch(t,n){console.error("Uncaught error:",t,n)}render(){return this.state.hasError?i.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-gray-900 text-white p-4 text-center",children:[i.jsx("h1",{className:"text-3xl font-bold mb-4",children:"Something went wrong"}),i.jsx("p",{className:"mb-6 text-gray-400",children:"The application encountered an unexpected error."}),i.jsx("button",{onClick:()=>window.location.reload(),className:"bg-indigo-600 px-6 py-3 rounded-lg hover:bg-indigo-700 transition font-bold shadow-lg",children:"Reload Game"})]}):this.props.children}}const o0=document.getElementById("root");if(!o0)throw new Error("Could not find root element to mount to");const DC=Id.createRoot(o0);DC.render(i.jsx(_C,{children:i.jsx(Qb,{children:i.jsx(SC,{})})}));
