import{r as o,j as e}from"./vendor-react-JYPVbgc1-0.2.11.js";import{j as ne,u as Q,V as oe,W as L,f as k,i as _}from"./game-logic-Zvvmx0sq-0.2.11.js";import{u as ae,C as q,M as N,p as le,e as ie}from"./index-Cw-Z3_q5-0.2.11.js";import"./vendor-BPR6uEV2-0.2.11.js";import"./vendor-webrtc-BBsnVRmn-0.2.11.js";const he=({isOpen:K,onClose:V,setViewingCard:T})=>{const{getCardTranslation:C,t:c}=ae(),[,X]=o.useState(0);o.useEffect(()=>{const t=()=>{const s=Q();if(s.size>0){X(s.size);return}else{const n=setTimeout(t,100);return()=>clearTimeout(n)}};return t()},[]);const v=o.useMemo(()=>ne().filter(({card:t})=>{var r;return(r=t.allowedPanels)==null?void 0:r.includes("DECK_BUILDER")}),[Q().size]),Z=oe(),[R,M]=o.useState("My Custom Deck"),[f,w]=o.useState(new Map),[m,A]=o.useState("All"),[y,F]=o.useState(""),[p,S]=o.useState(""),[h,E]=o.useState([]),[B,P]=o.useState(!1),U=o.useRef(null),D=o.useRef(null);o.useEffect(()=>{const t=r=>{D.current&&!D.current.contains(r.target)&&P(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]);const G=o.useMemo(()=>{const t=new Set;return v.forEach(({card:r})=>{var s;return(s=r.types)==null?void 0:s.forEach(n=>t.add(n))}),Array.from(t).sort()},[v]),z=o.useMemo(()=>v.filter(({id:r,card:s})=>{var i;const n=C(r),l=(n==null?void 0:n.name)||s.name,d=(n==null?void 0:n.ability)||s.ability||"";if(y){const a=y.toLowerCase();if(!l.toLowerCase().includes(a)&&!d.toLowerCase().includes(a))return!1}if(p!==""&&s.power!==Number(p))return!1;if(h.length>0){const a=s.types||[];if(!h.every(g=>a.includes(g)))return!1}if(m!=="All"){if(m==="Command")return L.has(r)||((i=s.types)==null?void 0:i.includes("Command"));if(m==="Neutral")return s.faction==="Neutral";if(s.faction!==m)return!1}return!0}),[v,m,y,p,h,C]),j=o.useMemo(()=>{let t=0;return f.forEach(r=>t+=r),t},[f]),W=t=>{var i,a,x;if(j>=N){alert(`Deck cannot exceed ${N} cards.`);return}const r=_(t),s=(i=r==null?void 0:r.types)==null?void 0:i.includes("Hero"),n=(a=r==null?void 0:r.types)==null?void 0:a.includes("Rarity"),l=L.has(t)||((x=r==null?void 0:r.types)==null?void 0:x.includes("Command")),d=s||n?1:l?2:3;w(g=>{const u=new Map(g),b=u.get(t)||0;return b>=d||u.set(t,b+1),u})},J=t=>{w(r=>{const s=new Map(r),n=s.get(t)||0;return n>1?s.set(t,n-1):s.delete(t),s})},Y=()=>{confirm("Are you sure you want to clear the current deck?")&&(w(new Map),M("My Custom Deck"))},H=t=>{S(r=>{const n=(r===""?0:r)+t;return n<0?0:n})},I=t=>{E(r=>r.includes(t)?r.filter(s=>s!==t):r.length>=10?r:[...r,t])},ee=()=>{if(j===0){alert(c("cannotSaveEmptyDeck")||"Cannot save an empty deck.");return}const t={deckName:R.trim()||"Untitled Deck",cards:Array.from(f.entries()).map(([d,i])=>({cardId:d,quantity:i}))},r=ie(t),s=new Blob([r],{type:"text/plain;charset=utf-8"}),n=URL.createObjectURL(s),l=document.createElement("a");l.href=n,l.download=`${t.deckName.replace(/[^a-z0-9]/gi,"_").toLowerCase()}.txt`,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(n)},te=()=>{var t;(t=U.current)==null||t.click()},re=t=>{var n;const r=(n=t.target.files)==null?void 0:n[0];if(!r)return;const s=new FileReader;s.onload=l=>{var d;try{const i=(d=l.target)==null?void 0:d.result,a=le(i);if(!a.isValid){alert(a.error);return}const{deckFile:x}=a;M(x.deckName);const g=new Map;x.cards.forEach(u=>g.set(u.cardId,u.quantity)),w(g)}catch{alert(c("failedToParseDeckFile")||"Failed to parse deck file.")}finally{t.target&&(t.target.value="")}},s.readAsText(r)};return K?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-900 w-full h-full md:w-[95vw] md:h-[90vh] md:rounded-xl flex flex-col overflow-hidden shadow-2xl border border-gray-700",children:[e.jsxs("div",{className:"bg-gray-800 p-4 border-b border-gray-700 flex justify-between items-center flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:c("deckBuilding")}),e.jsx("input",{type:"text",value:R,onChange:t=>M(t.target.value),className:"bg-gray-700 text-white px-3 py-1 rounded border border-gray-600 focus:outline-none focus:border-indigo-500 font-bold",placeholder:"Deck Name"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:Y,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded text-sm font-bold transition-colors",children:c("clear")}),e.jsx("button",{onClick:te,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded text-sm font-bold transition-colors",children:c("loadTextDeck")}),e.jsx("input",{type:"file",ref:U,onChange:re,accept:".txt",className:"hidden"}),e.jsx("button",{onClick:ee,className:"px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded text-sm font-bold transition-colors",children:c("saveText")}),e.jsx("div",{className:"w-px h-8 bg-gray-600 mx-2"}),e.jsx("button",{onClick:V,className:"px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded text-sm font-bold transition-colors",children:c("close")})]})]}),e.jsxs("div",{className:"flex flex-grow overflow-hidden",children:[e.jsxs("div",{className:"flex-grow flex flex-col p-4 overflow-hidden border-r border-gray-700 bg-gray-900/50",children:[e.jsxs("div",{className:"mb-4 flex flex-wrap items-center gap-4 bg-gray-800 p-2 rounded-lg border border-gray-700 relative z-40",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-2 flex items-center pointer-events-none",children:e.jsx("svg",{className:"h-4 w-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",value:y,onChange:t=>F(t.target.value),placeholder:"Search...",className:"pl-8 pr-6 py-1 bg-gray-700 text-white border border-gray-600 rounded text-sm focus:outline-none focus:border-indigo-500 w-32 md:w-48"}),y&&e.jsx("button",{onClick:()=>F(""),className:"absolute inset-y-0 right-0 pr-2 flex items-center text-gray-400 hover:text-white",title:"Clear Search",children:e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-400 text-sm font-bold",children:"Pow:"}),e.jsxs("div",{className:"flex items-center bg-gray-700 rounded border border-gray-600 overflow-hidden",children:[e.jsx("button",{onClick:()=>H(-1),className:"px-2 py-1 hover:bg-gray-600 text-white font-bold border-r border-gray-600 active:bg-gray-500",children:"-"}),e.jsx("div",{className:"w-8 text-center text-sm font-bold text-white select-none",children:p===""?"-":p}),e.jsx("button",{onClick:()=>H(1),className:"px-2 py-1 hover:bg-gray-600 text-white font-bold border-l border-gray-600 active:bg-gray-500",children:"+"})]}),p!==""&&e.jsx("button",{onClick:()=>S(""),className:"p-1 bg-gray-700 hover:bg-red-600 text-gray-400 hover:text-white rounded transition-colors",title:"Reset Power Filter",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("div",{className:"relative",ref:D,children:[e.jsxs("button",{onClick:()=>P(!B),className:`px-3 py-1 bg-gray-700 text-white border border-gray-600 rounded text-sm flex items-center gap-2 focus:outline-none hover:bg-gray-600 ${h.length>0?"border-indigo-500 text-indigo-300":""}`,children:[e.jsxs("span",{children:["Types ",h.length>0?`(${h.length})`:""]}),e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),B&&e.jsxs("div",{className:"absolute top-full left-0 mt-1 w-48 bg-gray-800 border border-gray-600 rounded shadow-xl z-50 max-h-60 overflow-y-auto p-1",children:[e.jsx("div",{className:"px-2 py-1 text-xs text-gray-400 border-b border-gray-700 mb-1",children:"Match ALL selected"}),G.map(t=>e.jsxs("label",{className:"flex items-center px-2 py-1.5 hover:bg-gray-700 rounded cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:h.includes(t),onChange:()=>I(t),className:"form-checkbox h-4 w-4 text-indigo-600 rounded border-gray-500 bg-gray-700 focus:ring-indigo-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-200",children:t})]},t))]})]}),h.length>0&&e.jsx("button",{onClick:()=>E([]),className:"p-1 bg-gray-700 hover:bg-red-600 text-gray-400 hover:text-white rounded transition-colors",title:"Clear Types",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("select",{value:m,onChange:t=>A(t.target.value),className:`bg-gray-700 text-white border border-gray-600 rounded px-2 py-1 text-sm focus:outline-none focus:border-indigo-500 max-w-[140px] ${m!=="All"?"border-indigo-500 text-indigo-300":""}`,children:[e.jsx("option",{value:"All",children:"All Factions"}),Z.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id)),e.jsx("option",{value:"Neutral",children:"Neutral"}),e.jsx("option",{value:"Command",children:"Command Cards"})]}),m!=="All"&&e.jsx("button",{onClick:()=>A("All"),className:"p-1 bg-gray-700 hover:bg-red-600 text-gray-400 hover:text-white rounded transition-colors",title:"Reset Faction",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("span",{className:"ml-auto text-gray-500 text-xs hidden xl:inline",children:"Right-click to view card details"})]}),e.jsx("div",{className:"flex-grow overflow-y-auto pr-2",children:e.jsxs("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 xl:grid-cols-7 gap-2",children:[z.map(({id:t,card:r})=>{const s={...r,id:t,baseId:t,deck:r.faction==="Neutral"?k.Neutral:r.faction||k.Custom,ownerId:0};return e.jsxs("div",{className:"relative group cursor-pointer",onClick:()=>W(t),onContextMenu:n=>{n.preventDefault(),T({card:s})},children:[e.jsx("div",{className:"w-full aspect-square transition-transform duration-100 hover:scale-105 hover:shadow-lg hover:z-[100]",children:e.jsx(q,{card:s,isFaceUp:!0,playerColorMap:new Map,extraPowerSpacing:!0})}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black/80 text-white text-[10px] text-center py-0.5 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none truncate px-1",children:c("clickToAdd")})]},t)}),z.length===0&&e.jsx("div",{className:"col-span-full text-center text-gray-500 py-10",children:"No cards match your filters."})]})})]}),e.jsxs("div",{className:"w-80 md:w-96 bg-gray-800 flex flex-col border-l border-gray-700 flex-shrink-0",children:[e.jsxs("div",{className:"p-4 bg-gray-800 border-b border-gray-600",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:c("currentDeck")}),e.jsxs("p",{className:`text-sm font-bold mt-1 ${j>N?"text-red-500":"text-indigo-400"}`,children:[j," / ",N," Cards"]})]}),e.jsxs("div",{className:"flex-grow overflow-y-auto p-2 space-y-2",children:[f.size===0&&e.jsxs("div",{className:"text-center text-gray-500 mt-10",children:[e.jsx("p",{children:c("emptyDeck")}),e.jsx("p",{className:"text-xs mt-2",children:c("clickToAdd")})]}),Array.from(f.entries()).map(([t,r])=>{var b,$,O;const s=_(t);if(!s)return null;const n={...s,id:t,baseId:t,deck:s.faction==="Neutral"?k.Neutral:s.faction||k.Custom,ownerId:0},l=C(t),d=l?l.name:s.name,i=(b=s.types)==null?void 0:b.includes("Hero"),a=($=s.types)==null?void 0:$.includes("Rarity"),x=L.has(t)||((O=s.types)==null?void 0:O.includes("Command")),g=i||a?1:x?2:3,u=i||a?"Max 1 (Rarity/Hero)":x?"Max 2 (Command)":"Max 3";return e.jsxs("div",{className:"flex items-center bg-gray-700 rounded p-2 group hover:bg-gray-600 transition-colors select-none",children:[e.jsx("div",{className:"w-12 h-12 flex-shrink-0 mr-3 cursor-pointer",onContextMenu:se=>{se.preventDefault(),T({card:n})},children:e.jsx(q,{card:n,isFaceUp:!0,playerColorMap:new Map,hidePower:!0})}),e.jsxs("div",{className:"flex-grow min-w-0",children:[e.jsx("div",{className:"font-bold text-sm text-white truncate",children:d}),e.jsxs("div",{className:"text-xs text-gray-400 truncate",children:[s.faction," ",i||a?"(Hero/Rarity)":""]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-2",children:[e.jsx("button",{onClick:()=>J(t),className:"w-6 h-6 flex items-center justify-center bg-gray-800 hover:bg-red-900 text-gray-300 rounded text-sm font-bold",title:"Remove one",children:"-"}),e.jsx("span",{className:"font-bold text-white w-4 text-center",children:r}),e.jsx("button",{onClick:()=>W(t),className:"w-6 h-6 flex items-center justify-center bg-gray-800 hover:bg-green-900 text-gray-300 rounded text-sm font-bold disabled:opacity-30 disabled:cursor-not-allowed",title:u,disabled:r>=g,children:"+"})]})]},t)})]})]})]})]})}):null};export{he as DeckBuilderModal};
