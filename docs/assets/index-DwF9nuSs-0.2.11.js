const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/RulesModal-LCSizd2Y-0.2.11.js","assets/vendor-react-JYPVbgc1-0.2.11.js","assets/vendor-BPR6uEV2-0.2.11.js","assets/game-logic-B2U9FGpm-0.2.11.js","assets/vendor-webrtc-BBsnVRmn-0.2.11.js","assets/SettingsModal-DoqlDE4Z-0.2.11.js","assets/JoinGameModal-Bo0JYWTe-0.2.11.js","assets/DeckBuilderModal-ChBig7oL-0.2.11.js"])))=>i.map(i=>d[i]);
import{r,j as e,R as Ot,a as Zn,c as ur}from"./vendor-react-JYPVbgc1-0.2.11.js";import{P as ua,c as mr,t as pr,a as Yn,b as ot,S as ma,d as gr,h as Xn,D as Fa,e as Qe,f as da,r as Dt,T as Ht,F as An,g as Va,i as fr,j as zn,G as Rn,k as Zt,l as Ke,M as Mn,m as ca,n as Da,o as hr,p as br,q as yr,s as xr,u as Ta,v as vr,w as jr,x as kr,y as wr,z as Cr,A as Dr,B as Qn,C as Tr,E as Ir,H as Sr,I as Nr,J as Pr,K as Er,L as On,N as Ar,O as zr,Q as Rr,R as Mr,U as Or,V as Lr}from"./game-logic-B2U9FGpm-0.2.11.js";import"./vendor-BPR6uEV2-0.2.11.js";import"./vendor-webrtc-BBsnVRmn-0.2.11.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))l(d);new MutationObserver(d=>{for(const a of d)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&l(i)}).observe(document,{childList:!0,subtree:!0});function o(d){const a={};return d.integrity&&(a.integrity=d.integrity),d.referrerPolicy&&(a.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?a.credentials="include":d.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function l(d){if(d.ep)return;d.ep=!0;const a=o(d);fetch(d.href,a)}})();const Ga=({timestamp:t,playerColor:n,onComplete:o})=>{const[l,d]=r.useState(0),a=ua[n]||{r:255,g:255,b:255};r.useEffect(()=>{const u=Date.now(),f=600,y=()=>{const x=Date.now()-u;d(x),x<f?requestAnimationFrame(y):o&&o()};requestAnimationFrame(y)},[t,o]);const i=[{id:1,startTime:0},{id:2,startTime:150},{id:3,startTime:300}],m=u=>{const f=l-u.startTime;if(f<0)return null;const C=Math.min(f/300,1),x=1+C*.2,p=.8-C*.8,v=Math.max(.5,3-C*2);return{opacity:p,scale:x,borderWidth:v}},b=`rgba(${a.r}, ${a.g}, ${a.b}`;return e.jsx("div",{className:"click-wave",style:{position:"absolute",top:0,left:0,right:0,bottom:0,pointerEvents:"none",zIndex:100},children:i.map(u=>{const f=m(u);return f?e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,borderRadius:"8px",border:`${f.borderWidth}px solid ${b}, ${f.opacity})`,transform:`scale(${f.scale})`,transformOrigin:"center",opacity:f.opacity,boxShadow:`0 0 ${8*f.opacity}px ${b}, ${f.opacity*.3})`}},u.id):null})})},$r=(t,n)=>{const o={bold:["deploy","setup","commit","support","pass","pas"],italic:["threat","aim","exploit","stun","shield","gain","point","points","reveal","move","draw","push","sacrifice","discard"]};return t.split(/(\s+|[.,:⇒()])/).map((d,a)=>{if(!d)return null;const i=d.replace(/[.,:()]/g,"").toLowerCase(),m=o.bold.find(u=>u.toLowerCase()===i),b=o.italic.find(u=>u.toLowerCase()===i);if(m){const u=n[m]||d;return Ot.createElement("strong",{key:a,className:"text-white"},u)}if(b){const u=n[b]||d;return Ot.createElement("em",{key:a,className:"text-white italic font-semibold"},u)}return d})},qa=(t,n)=>t?t.split(`
`).map((o,l)=>{const d=[];return l>0&&d.push(Ot.createElement("br",{key:`br-${l}`})),d.push(...$r(o,n)),Ot.createElement(Ot.Fragment,{key:l},...d.filter(Boolean))}):"",_r={abilityKeywords:{deploy:"Деплой",setup:"Сетап",commit:"Коммит",support:"Поддержка",threat:"Угроза",pass:"Пасс",aim:"Прицел",exploit:"Эксплойт",stun:"Оглушение",shield:"Щит",gain:"Получить",point:"Очко",points:"Очка",reveal:"Раскрыть",move:"Переместить",draw:"Взять",push:"Толкнуть",sacrifice:"Пожертвовать",discard:"Сбросить"},cardTypes:{unit:"Юнит",command:"Команда",hero:"Герой",rarity:"Редкость",structure:"Структура",gear:"Снаряжение",event:"Событие",attachment:"Приспособление"},ui:{startGame:"Начать игру",imReady:"Я готов",joinGame:"Присоединиться",deckBuilding:"Конструктор колод",rules:"Правила и обучение",settings:"Настройки",language:"Язык",serverAddress:"Адрес сервера",saveApply:"Сохранить",cancel:"Отмена",close:"Закрыть",tokens:"Токены",counters:"Жетон",phase:"Фаза",scoring:"СЧЁТ...",autoAbility:"Авто-абилки",autoDraw:"Авто-дров",newGame:"Новая игра",resetGame:"Сброс игры",exit:"Выход",surrender:"Сдаться",mode:"Режим",size:"Размер",dummies:"Боты",spectatorMode:"Режим наблюдателя",spectatorMsg:"Вы наблюдаете за игрой.",readyCheck:"Готовы начать?",waiting:"Ожидание...",cancelStart:"Отмена",assignTeams:"Распределить команды",confirmTeams:"Подтвердить и начать",unassigned:"Нераспределенные",team:"Команда",deck:"КОЛОДА",discard:"СБРОС",showcase:"Витрина",customDeck:"Своя колода",loadDeck:"Загрузить",clear:"Очистить",save:"Сохранить",filter:"Фильтр",currentDeck:"Текущая колода",emptyDeck:"Ваша колода пуста.",clickToAdd:"Нажмите на карты слева, чтобы добавить их.",view:"Просмотр",play:"Сыграть",playFaceDown:"Сыграть в закрытую",toHand:"В руку",toDiscard:"В сброс",revealToAll:"Показать всем",requestReveal:"Запросить вскрытие",flipUp:"Перевернуть",flipDown:"Рубашкой вверх",connected:"Подключено",disconnected:"Отключено",hiddenGameTooltip:"Скрытые игры не появляются в списке 'Присоединиться'",gameOver:"Игра окончена",roundComplete:"Раунд завершен",complete:"Завершен",winner:"Победитель",roundWinner:"Победитель раунда",move:"Переместить",moveToBottom:"Переместить вниз",selectCard:"Выбрать карту",deckView:"Колода",topDeckView:"Верх колоды",discardView:"Сброс",selectFromDeck:"Выбрать карту из колоды",selectFromDiscard:"Выбрать карту из сброса",power:"Сила",owner:"Владелец",noDescription:"Нет описания",comingSoon:"Скоро",revealed:"Раскрыт",connecting:"Подключение...",reconnecting:"Переподключение...",reconnectingDescription:"Попытка восстановить соединение...",pleaseWait:"Пожалуйста, подождите...",doNotClose:"Не закрывайте это окно во время переподключения",error:"Ошибка",loading:"Загрузка...",create:"Создать",createGame:"Создать игру",gameCode:"Код игры",playerName:"Имя игрока",join:"Присоединиться",back:"Назад",customGame:"Настраиваемая игра",privateGame:"Приватная игра",publicGame:"Публичная игра",freeForAll:"Каждый сам за себя",teamBattle:"Командная битва",startingPlayer:"Начинающий игрок",turn:"Ход",round:"Раунд",score:"Счет",hand:"РУКА",announced:"АНОНС",effects:"Эффекты",status:"Статус",deploy:"Деплой",ability:"Способность",recover:"Вернуть",resurrect:"Воскресить",destroy:"Уничтожить",returnToHand:"Вернуть в руку",shuffle:"Перемешать",drawCard:"Взять карту",drawStartingHand:"Взять стартовую руку (6)",viewTopCards:"Просмотреть верхние карты",highlight:"Подсветить",highlightCell:"Подсветить клетку",highlightRow:"Подсветить ряд",highlightColumn:"Подсветить колонку",emptyHand:"Пустая рука",hidden:"Скрытая",newAvalon:"New Avalon",cards:"Карт",scorePoints:"очков",toWinRound:"для победы в раунде.",checkedAtFirstPlayer:"Проверяется в фазе подготовки первого игрока.",roundVictoryCondition:"Условие победы в раунде",reach:"Достигните",ffa:"FFA",team2v2:"2v2",team3v1:"3v1",drawCards:"Взять карту",activeGames:"Активные игры",noActiveGames:"Активных игр не найдено.",createOne:"Почему бы не создать одну?",orJoinWithCode:"Или присоединиться по коду",enterGameId:"Введите ID игры",dragToReorder:"Перетаскивайте для изменения порядка.",rightClickForActions:"Правый клик для действий.",deckEmpty:"Колода пуста.",done:"Готово",remove:"Удалить",toDeckTop:"Наверх колоды",toDeckBottom:"Вниз колоды",storyMode:"Режим истории",puzzles:"Головоломки",changeColor:"Изменить цвет",firstPlayer:"Первый игрок",activePlayer:"Активный игрок",clearSearch:"Очистить поиск",resetPowerFilter:"Сбросить фильтр силы",clearTypes:"Очистить типы",resetFaction:"Сбросить фракцию",removeOne:"Удалить одну",waitingForOthers:"Ожидание других игроков",deckNamePlaceholder:"Название колоды",searchPlaceholder:"Поиск карт...",myCustomDeck:"Моя колода",untitledDeck:"Безымянная колода",max1RarityHero:"Максимум 1 (Редкость/Герой)",max2Command:"Максимум 2 (Команда)",finalRoundMaxTurns:"Финальный раунд! Максимум 10 ходов.",max5Rounds:"Максимум 5 раундов.",noTarget:"Нет цели",confirmClearDeck:"Вы уверены, что хотите очистить текущую колоду?",selectCardFromDeck:"Выберите карту из колоды",selectCardFromDiscard:"Выберите карту из сброса",languageDisabled:"Выбор языка в данный момент отключен.",autoAbilitiesTooltip:"Авто-абилки: Включить автоматическую активацию способностей",autoDrawTooltip:"Авто-сбор: Включить автоматический сбор карт (6 карт в стартовой руке + сбор в фазу Setup)",endedOnTurn:"Завершено на ходу",nextRound:"Далее:",victoryCondition:"Условие победы:",win2RoundsMatch:"* Победите в 2 раундах, чтобы выиграть матч. ",max5RoundsInfo:"Максимум 5 раундов.",matchComplete:"Матч завершен",thankYouPlaying:"Спасибо за игру в New Avalon: Skirmish.",returnToMenu:"Вернуться в меню",continueGame:"Показать поле боя",startRound:"Начать раунд",youLabel:"(Вы)",readyToStart:"Готовы начать?",gameWillBegin:"Игра начнется, когда все игроки будут готовы. Вы всё ещё можете изменить имя и колоду.",dragCardsReorder:"Перетаскивайте карты для изменения порядка. Перетащите наружу, чтобы переместить карту в другую зону.",dragOutsideAnotherZone:"Перетащите наружу, чтобы переместить карту в другую зону.",ready:"Готов",dragOutsideToMove:"Перетащите наружу, чтобы переместить карту в другую зону.",empty:"Пусто",dragOutsideToPlaceToken:"Перетащите наружу, чтобы разместить токен на доске.",holdRightClickViewHints:"Удерживайте правую кнопку мыши для просмотра подсказок",gameSettings:"Настройки игры",invitePlayer:"Invite Player",hiddenGame:"Приватность",private:"Приватная",public:"Публичная",copyInviteLink:"Скопировать ссылку приглашения",copyGameLink:"Скопировать ссылку на игру",copied:"Скопировано!",inviteLinkDesc:"Отправьте ссылку другу. Адрес сервера настроится автоматически.",copyGameLinkDesc:"Поделитесь этой ссылкой, чтобы друзья могли присоединиться с предустановленными настройками сервера.",on:"ВКЛ",off:"ВЫКЛ",copy:"Копировать",dummyPlayers:"Боты",gridSize:"Размер поля",autoAbilities:"Авто-абилки",gameMode:"Режим игры","2v2":"2v2","3v1":"3v1",reconnect:"Переподключиться",hideDummyCards:"Скрыть карты ботов",hideDummyCardsTooltip:"Скрывать карты в руках бот-игроков, как у реальных игроков",clearCache:"Сбросить кеш",clearCacheDesc:"Удалить все сохранённые данные и перезагрузить страницу",cacheCleared:"Кеш очищен! Перезагрузка...",saveJson:"Сохранить JSON",saveText:"Сохранить текст",loadTextDeck:"Загр. текст",cannotSaveEmptyDeck:"Нельзя сохранить пустую колоду.",failedToParseDeckFile:"Не удалось разобрать файл колоды.",webrtcMode:"Режим WebRTC",webrtcModeDesc:"Включить прямое соединение между игроками без центрального сервера (Хост выступает сервером)",peerToPeer:"Peer-to-Peer",directConnection:"Прямое соединение между браузерами",hostGame:"Создать игру",hostGameDesc:"Хост игры через WebRTC - центральный сервер не нужен",copyHostLink:"Скопировать ссылку хоста",hostLinkCopied:"Ссылка хоста скопирована!",joinAsGuest:"Присоединиться к игре (P2P)",enterHostId:"Введите Host ID или ссылку",invalidHostId:"Неверный Host ID",connectingToHost:"Подключение к хосту...",connectedToHost:"Подключено к хосту",hostDisconnected:"Хост отключился",guestDisconnected:"Гость отключился",guestConnected:"Гость подключился"},rules:{title:'Правила Игры "New Avalon: Skirmish"',conceptTitle:"I. Общая Концепция",conceptText:`**Жанр и Роль Игроков:** New Avalon: Skirmish — это динамичная тактическая карточная игра, действие которой происходит на ограниченном поле-сетке. Игроки выступают в роли лидеров фракций, развертывая Юниты и Команды для захвата контроля над ключевыми линиями поля боя.

**Разъяснение:** Игра фокусируется на позиционном контроле и тайминге активации способностей, а не только на прямой атаке. Победа достигается за счет набора Победных Очков (ПО), основанных на силе юнитов в выбранных линиях.`,winConditionTitle:"II. Условия Победы",winConditionText:`**Условия Победы в Матче:** Матч играется до 2 побед в раундах. Игрок, первым одержавший 2 победы в раундах, немедленно выигрывает матч.
**Разъяснение Ничьей в Матче:** Если по завершении любого раунда несколько игроков достигают 2 побед в раундах одновременно, все они объявляются победителями матча.

**Условия Победы в Раунде (Пороги и Лимит Ходов):** Раунд завершается, как только один или несколько игроков достигают порогового значения Победных Очков (ПО), или после завершения 5-го хода.
**Лимит Ходов:** Каждый раунд ограничен 5 полными ходами для каждого игрока. Если порог ПО не достигнут, в конце 5-го хода происходит финальный подсчет и определение победителя.

**Пороговые Значения:**
- Раунд 1: 20 Победных Очков (ПО).
- Раунд 2: 30 Победных Очков (ПО).
- Раунд 3 и далее: Порог увеличивается на +10 ПО от предыдущего раунда (например, Раунд 3 — 40 ПО).

**Определение Победителя Раунда и Ничья:** Победителем раунда объявляется игрок, достигший порогового значения, или игрок с наибольшим количеством ПО после лимита ходов.
**Разъяснение Ничьей в Раунде:** Если по завершении раунда два или более игрока имеют одинаковое и самое высокое количество очков, все они объявляются победителями раунда.`,fieldTitle:"III. Игровое Поле и Компоненты",fieldText:`**Поле Боя (Сетка):** Игра происходит на квадратной сетке, размер которой зависит от общего числа участвующих игроков.
**Разъяснение Размеров:**
- 2 игрока: Поле 5x5 клеток.
- 3 игрока: Поле 6x6 клеток.
- 4 игрока: Поле 7x7 клеток.

**Определение Позиций:**
- **Линия:** Это весь горизонтальный ряд или вертикальная колонка. Используется для механики подсчета очков (Scoring).
- **Соседство:** Клетки считаются соседними только по горизонтали и вертикали (ортогонально). Диагональное соседство не учитывается, если в карте не указано иное.

**Карты:** В игре используются два основных типа карт, разыгрываемых из Руки:
- **Юниты (Units):** Основные боевые единицы, обладающие Силой (Power) и Способностями. Остаются на поле боя до уничтожения.
- **Команды (Commands):** Карты мгновенного действия. Разыгрываются, выполняют эффект (часто предлагая выбор "2 из 3 опций") и отправляются в Сброс.

**Игровые Зоны:**
- **Рука (Hand):** Карты, скрытые от оппонентов.
- **Сброс (Discard):** Зона, куда уходят уничтоженные Юниты и сыгранные Команды.
- **Витрина (Showcase/Announced):** Временная зона, куда выкладывается карта Команды перед её розыгрышем.`,setupTitle:"IV. Начало Игры (Подготовка)",setupText:`**Формирование Колоды:** Перед началом матча каждый игрок выбирает фракцию или собирает колоду согласно правилам конструирования (не менее 30 карт).
**Разъяснение:** Карты в колоде перемешиваются.

**Начальная Рука:** Каждый игрок берет 6 карт из своей колоды, формируя стартовую руку.
**Разъяснение Скрытой Информации:** Карты в руке скрыты от оппонентов.

**Муллиган:** В начале игры, получив стартовую руку (6 карт), игрок имеет право 1 раз замешать любое количество карт из руки обратно в колоду и взять столько же новых карт сверху.

**Определение Первого Игрока:** Определите первого активного игрока любым удобным способом (например, броском монеты).
**Разъяснение:** Игра ведется поочередно, начиная с первого игрока. Первый игрок начинает свой первый ход сразу с Фазы Setup.`,abilitiesTitle:"V. Способности Карт",abilitiesText:`**Типы Способностей:**
- **Deploy:** Срабатывает автоматически и немедленно, когда карта выкладывается из руки на поле в открытую.
- **Setup:** Срабатывает автоматически в начале Фазы Setup каждого вашего хода (перед добором карты), если карта уже лежит на поле лицевой стороной вверх.
- **Commit:** Срабатывает автоматически в начале Фазы Commit каждого вашего хода, если карта уже лежит на поле лицевой стороной вверх.
- **Пасс (Пассивная):** Эффект действует постоянно, пока карта находится на поле в открытом состоянии.

**Условия Выполнения (⇒):**
Многие способности имеют требование, обозначенное стрелкой (например, **Support ⇒ Deploy:** ...).
- Это означает "ПРОВЕРКА УСЛОВИЯ ⇒ ЭФФЕКТ".
- Если условие слева от стрелки (например, наличие статуса Support) не выполнено в момент активации, способность **не срабатывает** вообще.

**Важные Правила:**
- **Stun:** Оглушенные карты (с жетоном Stun) **не активируют** свои способности (ни Deploy, ни фазовые, ни пассивные).
- **Face-down:** Карты, лежащие рубашкой вверх, не имеют способностей.
- **Обязательность:** Если способность сработала (условия выполнены), вы **обязаны** применить её эффект, если есть легальные цели. Если легальных целей нет, способность применяется впустую (сгорает).`,statusesTitle:"VI. Динамические Статусы (Позиционирование)",statusesText:`Динамические статусы рассчитываются автоматически и постоянно при любом изменении на доске. Юниты со статусом Stun не могут давать или участвовать в расчете этих статусов.

**Поддержка (Support):** Юнит имеет статус Support, если хотя бы в одной соседней клетке (по горизонтали или вертикали) находится союзный юнит.
**Разъяснение Stun/Support:** Юнит, имеющий жетон Stun, не учитывается при расчете Support для соседних союзников.
**Значение:** Наличие Support является условием для активации многих мощных способностей, обозначенных синтаксисом Support ⇒ [Эффект].

**Угроза (Threat):** Юнит получает статус Threat, если он находится в опасном положении, созданном вражескими юнитами.
**Разъяснение Условий:** Статус Threat присваивается в одном из двух случаев:
1. **Клещи:** Юнит зажат картами одного оппонента с любых двух сторон (двух смежных или двух противоположных).
2. **Прижатие:** Юнит находится на краю поля боя и имеет хотя бы одну карту оппонента по соседству.
**Разъяснение Stun/Threat:** Юнит, имеющий жетон Stun, не учитывается при расчете Threat для соседних врагов.
**Значение:** Юниты под Threat являются уязвимыми целями для мощных способностей контроля и уничтожения.`,countersTitle:"VII. Жетоны (Counters)",countersText:`Жетоны — это постоянные маркеры, накладываемые способностями карт. Они остаются на юните до тех пор, пока не будут сняты или юнит не будет уничтожен.

**Оглушение (Stun):**
- **Эффект:** Юнит со Stun не приносит Победных Очков в Фазу Scoring, не может активировать свои способности и не может быть перемещен своим владельцем (но может быть перемещен оппонентом).
- **Снятие:** В конце Фазы Commit с каждого юнита активного игрока автоматически снимается 1 жетон Stun.

**Щит (Shield):**
- **Эффект:** Если способность пытается уничтожить (Destroy) этот юнит, эффект уничтожения предотвращается, а с юнита вместо этого снимается 1 жетон Щита. Юнит остается на поле.

**Раскрыт (Revealed) и Скрытые Карты (Face-down):**
- **Revealed:** Позволяет игроку-владельцу жетона видеть скрытую информацию о карте.
- **Разъяснение Face-down:** Карта, разыгранная рубашкой вверх (Face-down), не имеет Силы и Способностей и дает 0 очков. Если такая карта получает жетон Revealed, ее информация (лицо) становится видна оппоненту, но карта продолжает считаться Face-down для всех игровых целей (сила, способности).

**Специальные Жетоны (Aim, Exploit):**
- **Aim (Прицел) и Exploit (Уязвимость):** Эти жетоны являются маркерами для взаимодействия фракционных способностей (например, снайперы или хакеры). Сами по себе они не имеют игрового эффекта.

**Последний сыгранный (Last Played):**
- **Эффект:** Временный статус, который автоматически присваивается карте, последней разыгранной на поле активным игроком в текущем ходу. Этот статус определяет линию, которую игрок должен выбрать для подсчета очков (Scoring).`,turnTitle:"VIII. Структура Хода и Тайминг",turnText:`Ход передается от игрока к игроку. Способности карт срабатывают только в ход их владельца. Ход активного игрока состоит из четырех последовательных фаз:

**1. Фаза Setup (Подготовка):**
- **Добор Карты:** Активный игрок берет 1 карту из колоды в руку.
- **Способности:** Срабатывают способности всех карт на поле с ключевым словом **Setup:**.
**Разъяснение:** Эта фаза предназначена для пополнения руки и начального позиционирования юнитов.

**2. Фаза Main (Действие / Развертывание):**
- **Основное Действие:** Активный игрок может выполнить одно из следующих действий:
  - Разыграть карту Юнита (**Deploy:**) из руки на любую свободную клетку поля. При этом немедленно срабатывает его Deploy: способность.
  - Разыграть карту Команды из руки.
  - Спасовать.
**Разъяснение Команд:** Карты Команд можно играть в любом количестве в этой фазе — до, после или между развертыванием юнитов.

**3. Фаза Commit (Завершение / Закрепление):**
- **Способности:** Срабатывают способности всех карт на поле с ключевым словом **Commit:**.
- **Снятие Stun:** В конце этой фазы с каждого юнита активного игрока автоматически снимается 1 жетон Stun.
**Разъяснение:** Фаза используется для применения эффектов контроля и получения ресурсов перед подсчетом.

**4. Фаза Scoring (Подсчет Очков):**
- **Выбор Линии:** Активный игрок должен выбрать одну Линию (Ряд или Колонку), которая проходит через его карту со статусом **Last Played**.
- **Подсчет:** Суммируется Сила всех юнитов активного игрока в выбранной линии, и полученная сумма прибавляется к общему счету игрока.`,mechanicsTitle:"IX. Разрешение Конфликтов и Ключевые Механики",mechanicsText:`**Stun и Подсчет Очков:**
- **Эффект:** Юнит со статусом Stun или лежащий Face-down дает 0 очков в Фазе Scoring, вне зависимости от его базовой Силы, постоянных модификаторов силы или пассивных способностей, дающих очки (например, Spotter).

**Передача Статуса Last Played:**
- **Уничтожение:** Если карта со статусом Last Played покидает поле боя (уничтожена, возвращена в руку/колоду) до Фазы Scoring, статус передается предыдущей сыгранной карте этого игрока (той, что была Last Played в прошлый ход).
- **Перемещение:** Если карта с Last Played перемещается на другую клетку, игрок выбирает ее новые линии в Фазе Scoring.
- **Отсутствие:** Если у игрока нет ни одной карты со статусом Last Played, игрок не может выбрать линию и не получает очки в этом ходу.

**Перемещение Юнитов (Push, Swap):**
- **Push (Толчок):** Юнит заставляет другую карту переместиться на соседнюю клетку. Толчок блокируется (не происходит), если за целью находится занятая клетка или край поля. Остальные эффекты способности применяются к цели.
- **Swap (Обмен):** Позволяет двум картам поменяться местами, даже если обе клетки заняты.

**Воскрешение (Resurrect):**
- **Механика "Выгорания":** Карта, возвращенная на поле боя из Сброса (воскрешенная), немедленно получает статус **Resurrected** в момент Deploy. В начале следующей фазы (при смене фаз) этот статус снимается, и карта получает два жетона Stun.`,creditsTitle:"X. Авторы игры",creditsText:`**Автор:** Никита Анахорет

**Использованные нейросети:**
Google AI Studio, Claude Code, Gemini, ChatGPT

**Особые благодарности:**
- Василиса Версус
- Кирилл Томачук
- Андрей Маркосов
- Митя Шепелин

По всем вопросам и предложениям пишите в [Telegram](https://t.me/NeurohoretApp) или [Discord](https://discord.gg/U5zKADsZZY).
Поддержать развитие игры и авторов можно через [DonationAlerts](https://www.donationalerts.com/r/anahoret) и [Patreon](https://www.patreon.com/AnchoriteComics).`},counters:{Aim:{name:"Прицел",description:`Этот жетон сам по себе не имеет эффекта, но может изменять способности карт.
Эту карту легче уничтожить.`},Exploit:{name:"Эксплойт",description:`Этот жетон сам по себе не имеет эффекта, но может изменять способности карт.
Карты хакеров и программистов будут иметь больший эффект на эту карту.`},LastPlayed:{name:"ПоследнийСыгранный",description:"Эта карта была сыграна последней своим владельцем."},Revealed:{name:"Раскрыт",description:"Лицо этой карты видимо владельцу жетона revealed. Можно помещать на карты в руке."},Stun:{name:"Оглушение",description:`Оглушенная карта не может активировать способности или приносить очки. Эффекты её владельца не могут её перемещать, но эффекты оппонента могут.
Снимите 1 жетон оглушения с карты после фазы подсчета очков (Scoring).`},Shield:{name:"Щит",description:"Если эффект пытается уничтожить эту карту, вместо этого снимите с неё 1 жетон щита."},Support:{name:"Поддержка",description:`Этот жетон сам по себе не имеет эффекта, но может изменять способности карт.
Эта карта находится рядом с союзником.`},Threat:{name:"Угроза",description:`Этот жетон сам по себе не имеет эффекта, но может изменять способности карт.
Эта карта окружена и прижата к краю поля картами противника.`},"Power+":{name:"Сила+",description:"Увеличивает силу карты на 1."},"Power-":{name:"Сила-",description:"Уменьшает силу карты на 1."},Resurrected:{name:"Воскресший",description:"Этот юнит недавно вернулся из сброса. Он получит Оглушение в начале следующей фазы."}},deckNames:{SynchroTech:"СинхроТех",Hoods:"Капюшоны",Optimates:"Оптиматы",Fusion:"Фьюжн"},cards:{ipDeptAgent:{name:"Агент Отдела IP",ability:`Deploy: Помещает 2 жетона Оглушения на карту с вашей Угрозой.
Setup (требует Поддержку): Получает 2 очка за каждую вашу Угрозу в выбранной линии.`,flavorText:'- "Вы нарушили авторские права. Откройте дверь. У нас ордер на обыск."'},tacticalAgent:{name:"Тактический Агент",ability:`Deploy: Помещает жетон Прицела на карту с вашей Угрозой.
Setup: Уничтожает карту с вашим жетоном Прицела.`,flavorText:'- "Никому не двигаться! Служба безопасности SynchroTech!"'},patrolAgent:{name:"Патрульный Агент",ability:`Setup: Перемещается в свободную ячейку линии.
Commit: Помещает жетон Оглушения на соседнюю карту оппонента с вашей Угрозой.`,flavorText:"Говорят, город никогда не спит. Мы следим, чтобы он даже не моргал."},riotAgent:{name:"Агент Подавления",ability:`Deploy: Толкает соседнюю карту оппонента на 1 клетку и может занять её место.
Commit: Помещает жетон Оглушения на соседнюю карту оппонента с вашей Угрозой.`,flavorText:'- "Граждане, разойдитесь! Это собрание не санкционировано SynchroTech."'},threatAnalyst:{name:"Аналитик Угроз",ability:`Deploy: Помещает жетон Эксплойта на любую карту.
Pass (требует Поддержку): Ваши юниты могут в одиночку угрожать картам оппонента с вашим жетоном Эксплойта.`,flavorText:""},recklessProvocateur:{name:"Беспечный Провокатор",ability:`Deploy: Меняется местами с соседней картой.
Commit: Перемещает все жетоны с выбранной союзной карты на эту карту.`,flavorText:'- "Терпение — это оружие. Месть — это искусство."'},dataLiberator:{name:"Освободитель Данных",ability:`Pass (требуется Поддержка): Карты с вашими жетонами Эксплойта приносят вам очки.
Deploy: Помещает жетон Эксплойта на любую карту.`,flavorText:'- "Информация не хочет быть свободной. Она должна быть."'},cautiousAvenger:{name:"Осторожный Мститель",ability:`Deploy: Помещает жетон Прицела на карту в пределах 2 клеток.
Setup (требует Поддержку): Уничтожает карту с вашим жетоном Прицела.`,flavorText:'- "Терпение — это оружие. Месть — это искусство."'},vigilantSpotter:{name:"Бдительный Наблюдатель",ability:`Pass (требуется Поддержка): Когда раскрытая (Revealed) карта противника выходит на поле, получите 2 очка.
Commit: Раскройте 1 карту из руки противника.`,flavorText:'- "Терпение — это оружие. Месть — это искусство."'},inventiveMaker:{name:"Изобретательный Создатель",ability:`Deploy: Создаёт токен Дрон-Разведчик в соседней пустой клетке.
Setup (требует Поддержку): Возвращает карту Девайса из сброса в руку.`,flavorText:'- "Терпение — это оружие. Месть — это искусство."'},faber:{name:"Фабер",ability:"Deploy: Сбросьте 1 карту из своей руки ⇒ Создаёт токен Шагающая Турель в соседней пустой клетке.",flavorText:"В позолоченных залах Оптиматов даже орудия войны — произведения искусства."},censor:{name:"Цензор",ability:`Deploy: Помещает жетон Эксплойта на любую карту.
Commit (требует Поддержку): Заменяет ваш жетон Эксплойта на жетон Оглушения.`,flavorText:"В позолоченных залах Оптиматов даже орудия войны — произведения искусства."},princeps:{name:"Принцепс",ability:`Deploy: Получает жетон Щита. Помещает жетон Прицела на карту в своей линии.
Setup: Уничтожает карту с вашим жетоном Прицела.`,flavorText:"Порядок не просят. Его насаждают."},immunis:{name:"Иммунис",ability:`Deploy (требует Поддержку): Возвращает карту Оптимата из вашего сброса на соседнюю пустую клетку с жетоном Воскресения.
В конце фазы жетон Воскресения заменяется на 2 жетона Оглушения.`,flavorText:"В позолоченных залах Оптиматов даже орудия войны — произведения искусства."},centurion:{name:"Центурион",ability:"Commit: Пожертвуйте союзного юнита ⇒ Все союзные карты в его линиях получают +1 к силе.",flavorText:"В позолоченных залах Оптиматов даже орудия войны — произведения искусства."},codeKeeper:{name:"Хранитель Кода",ability:`Deploy: Помещает по 1 жетону Эксплойта на все карты оппонентов в линиях с любой Угрозой.
Commit (требует Поддержку): Перемещает карту оппонента с вашим жетоном Эксплойта на 1 клетку.`,flavorText:"Сигнал — это истина. Всё остальное — шум."},devoutSynthetic:{name:"Преданный Синтетик",ability:`Deploy: Толкает соседнюю карту оппонента на 1 клетку и может занять её место.
Setup: Уничтожает соседнюю карту оппонента с Угрозой или Оглушением.`,flavorText:"Плоть — это баг. Сигнал — это патч."},unwaveringIntegrator:{name:"Непоколебимый Интегратор",ability:`Deploy: Помещает жетон Эксплойта на любую карту.
Setup (требует Поддержку): Получает 1 очко за каждый ваш жетон Эксплойта в выбранной линии.`,flavorText:"Сигнал — это истина. Всё остальное — шум."},signalProphet:{name:"Пророк Сигнала",ability:`Deploy: Помещает по 1 жетону Эксплойта на все свои карты с Поддержкой в линиях.
Commit (требует Поддержку): Перемещает свою карту с жетоном Эксплойта на 1 клетку.`,flavorText:"Сигнал — это истина. Всё остальное — шум."},zealousMissionary:{name:"Ревностный Миссионер",ability:`Deploy: Помещает жетон Эксплойта на любую карту.
Commit (требует Поддержку): Даёт -1 к силе карте с вашим жетоном Эксплойта.`,flavorText:"Сигнал — это истина. Всё остальное — шум."},overwatch:{name:"Наблюдение",ability:`● Поместите 1 жетон Прицела на любую карту. Раскройте 1 карту из руки оппонента за каждый ваш жетон Прицела на поле боя.
● Поместите 1 жетон Прицела на любую карту. Возьмите 1 карту за каждый ваш жетон Прицела на поле боя.`},tacticalManeuver:{name:"Тактический Маневр",ability:`● Переместите вашего юнита в свободную ячейку в его линии. Возьмите количество карт, равное силе перемещённого юнита.
● Переместите вашего юнита в свободную ячейку в его линии. Получите количество очков, равное силе перемещённого юнита.`},inspiration:{name:"Вдохновение",ability:`● Удалите любое количество жетонов с вашего юнита. Возьмите 1 карту за каждый удалённый жетон.
● Удалите любое количество жетонов с вашего юнита. Получите 1 очко за каждый удалённый жетон.`},dataInterception:{name:"Перехват Данных",ability:`● Поместите 1 жетон Эксплойта на любую карту. Раскройте 1 карту в руке оппонента за каждый ваш жетон Эксплойта на поле боя.
● Поместите 1 жетон Эксплойта на любую карту. Переместите юнита с вашим жетоном Эксплойта на 1 или 2 ячейки.`},falseOrders:{name:"Ложные Приказы",ability:`● Поместите 1 жетон Эксплойта на карту оппонента. Переместите юнита оппонента с вашим жетоном Эксплойта на 1 или 2 ячейки. Раскройте до 2 карт в руке этого оппонента.
● Поместите 1 жетон Эксплойта на карту оппонента. Переместите юнита оппонента с вашим жетоном Эксплойта на 1 или 2 ячейки. Поместите на него 2 жетона Оглушения.`},experimentalStimulants:{name:"Экспериментальные Стимуляторы",ability:`● Юнит под вашим контролем на поле боя может активировать свою способность Deploy ещё один раз.
● Переместите вашего юнита в свободную ячейку в его линии.`},logisticsChain:{name:"Логистическая Цепь",ability:`● Получите очки в диагонали. Получите +1 очко за каждую вашу карту с Поддержкой в этой диагонали.
● Получите очки в диагонали. Возьмите 1 карту за каждую вашу карту с Поддержкой в этой диагонали.`},quickResponseTeam:{name:"Группа Быстрого Реагирования",ability:`● Разыграйте юнита из руки в пустую ячейку.
● Найдите в колоде карту юнита и поместите её в руку. Перемешайте колоду.`},temporaryShelter:{name:"Временное Убежище",ability:`● Поместите 1 жетон Щита на вашу карту. Удалите все жетоны Прицела с этой карты.
● Поместите 1 жетон Щита на вашу карту. Переместите эту карту на 1 или 2 ячейки.`},enhancedInterrogation:{name:"Усиленный Допрос",ability:`● Поместите 1 жетон Прицела на любую карту. Раскройте 1 карту из руки оппонента за каждый ваш жетон Прицела на поле боя.
● Поместите 1 жетон Прицела на любую карту. Переместите любую карту с вашим жетоном Прицела на 1 или 2 ячейки.`},mobilization1:{name:"Прорыв Линии",ability:"Получите очки в выбранной линии поля боя."},mobilization2:{name:"Захват Сектора",ability:"Получите очки от 4 соседних союзных карт."},mobilization3:{name:"Прорыв Диагонали",ability:"Получите очки в выбранной диагонали."},reconDrone:{name:"Разведдрон",ability:`Setup: Перемещается в любую ячейку поля боя.
Commit: Выберите карту оппонента в соседней ячейке. Раскройте карту в руке этого оппонента.`,flavorText:"SynchroTech создали легких дронов для патрулирования улиц, но у Hoods на них другие планы."},walkingTurret:{name:"Шагающая Турель",ability:`Deploy: Помещает жетон Прицела на карту в своей линии.
Setup: Даёт -1 к силе карте с жетоном Прицела.`,flavorText:"Этому военному монстру явно не место на городских улицах."},reclaimedGawain:{name:'Восстановленный "Гавейн"',ability:`Deploy: Получает жетон Щита. Толкает соседнюю карту оппонента на 1 клетку и может занять её место.
Setup: Уничтожает соседнюю карту оппонента с Угрозой или Оглушением.`,flavorText:"Когда-то рыцарь системы, теперь призрак в машине."},FalkPD:{name:"Майкл Фальк, Частный Детектив",ability:`Deploy: Находит в вашей колоде любую карту. Положите её в свою руку и перемешайте колоду.
Commit: Раскрывает карту соперника.`,flavorText:"Он находит вещи. Иногда вещи, которые должны оставаться потерянными."},edithByron:{name:"Эдит Байрон, Экстремальный Инженер",ability:`Setup: Перемещается в свободную ячейку линии.
Deploy: Получает жетон Щита. Создаёт токен Дрон-Разведчик в соседней пустой клетке.`,flavorText:"Строит будущее, один взрыв за раз."},pinkunonekoSV:{name:"Пинкунонеко, Уличный Вигилант",ability:`Deploy: Помещает жетон Оглушения на соседнюю карту оппонента.
Setup: Уничтожает соседнюю карту оппонента с Угрозой или Оглушением.`,flavorText:"Неоновые когти в темном переулке."},EleftheriaMD:{name:'Мария "Элефтерия" Даманаки',ability:`Deploy: Помещает жетон Прицела на любую карту.
Setup: Уничтожает карту с вашим жетоном Прицела.`,flavorText:"У свободы есть цена. Она её взимает."},ziusIJ:{name:"Зиус, Независимый Журналист",ability:`Deploy: Помещает жетон Эксплойта на любую карту.
Setup (требует Поддержку): Помещает жетон Эксплойта на любую карту и получает 1 очко за каждый жетон Эксплойта в линии этой карты.`,flavorText:"Истина где-то рядом, и он ведет прямую трансляцию."},abrGawain:{name:'АБР "Гавейн"',ability:`Deploy: Получает жетон Щита. Помещает жетон Прицела на карту в своей линии.
Setup: Уничтожает карту с вашим жетоном Прицела.`,flavorText:"Протокол инициирован. Оценка угрозы: Экстремальная."},reverendOfTheChoir:{name:"Преподобный Хора",ability:`Setup (требует Поддержку): Получает 1 очко за каждый ваш жетон Эксплойта на поле боя.
Deploy: Удваивает количество жетонов Эксплойта на любой карте.`,flavorText:"Гул серверов — это гимн для посвященных."},mrPearlDoF:{name:"Мистер Перл, Директор Bio-Synch",ability:`Pass: Другие ваши юниты в линиях получают +1 к силе.
Deploy: Находит в вашей колоде карту юнита. Положите карту в свою руку и перемешайте колоду.`,flavorText:"Эффективность — единственная метрика, которая имеет значение."},finnMW:{name:"Финн, Особо Опасен",ability:`Setup: Переместите любую вашу карту на 1 или 2 клетки.
Commit: Получите 1 очко за каждую раскрытую карту в руках оппонентов.`,flavorText:"Поймай меня, если сможешь. Спойлер: Ты не сможешь."},luciusTheImmortal:{name:"Люциус, Бессмертный",ability:`Pass: Иммунитет к Оглушению. Если вышел из сброса, получает +2 к силе.
Setup: Сбросьте карту ⇒ Найдите в своей колоде карту команды. Положите её в свою руку и перемешайте колоду.`,flavorText:"Смерть подразумевает прекращение функций. Я просто оптимизировал это."},secretInformant:{name:"Тайный Информатор",ability:"Deploy: Смотрит 3 верхние карты любой колоды. Положите любое количество из них на низ колоды. Возьмите 1 карту.",flavorText:"Знание - сила. И рычаг давления."}}},Ur={abilityKeywords:{deploy:"Deploy",setup:"Setup",commit:"Commit",support:"Podrška",threat:"Pretnja",pass:"Pass",aim:"Nišanjenje",exploit:"Exploit",stun:"Oglušenje",shield:"Štit",gain:"Dobij",point:"Bod",points:"Bodova",reveal:"Otkrij",move:"Pomeri",draw:"Vuci",push:"Gurni",sacrifice:"Žrtvuj",discard:"Baci"},cardTypes:{unit:"Jedinica",command:"Komanda",hero:"Heroj",rarity:"Retkost",structure:"Struktura",gear:"Oprema",event:"Događaj",attachment:"Dodatak"},ui:{startGame:"Započni igru",imReady:"Spreman",joinGame:"Pridruži se",deckBuilding:"Graditelj špila",rules:"Pravila i uputstvo",settings:"Podešavanja",language:"Jezik",serverAddress:"Adresa servera",saveApply:"Sačuvaj",cancel:"Otkaži",close:"Zatvori",tokens:"Tokeni",counters:"Brojači",phase:"Faza",scoring:"BODOVANJE...",autoAbility:"Auto-sposobnost",autoDraw:"Auto-drovanje",newGame:"Nova igra",resetGame:"Poništi igru",exit:"Izlaz",surrender:"Predaj se",mode:"Režim",size:"Veličina",dummies:"Lutke",spectatorMode:"Režim posmatrača",spectatorMsg:"Posmatrate igru.",readyCheck:"Spremni za početak?",waiting:"Čekanje...",cancelStart:"Otkaži početak",assignTeams:"Dodeli timove",confirmTeams:"Potvrdi timove i započni",unassigned:"Nedodeljene igrače",team:"Tim",deck:"ŠPIL",discard:"BAČENI",showcase:"Izlog",customDeck:"Prilagođeni špil",loadDeck:"Učitaj",clear:"Obriši",save:"Sačuvaj",filter:"Filter",currentDeck:"Trenutni špil",emptyDeck:"Vaš špil je prazan.",clickToAdd:"Kliknite na karte sa leve strane da biste ih dodali.",view:"Pogledaj",play:"Igraj",playFaceDown:"Igraj zatvoreno",toHand:"U ruku",toDiscard:"U bačene",revealToAll:"Otkrij svima",requestReveal:"Zatraži otkrivanje",flipUp:"Okreni licem nagore",flipDown:"Okreni licem nadole",connected:"Povezano",disconnected:"Prekinuta veza",hiddenGameTooltip:"Skrivene igre se ne pojavljuju na listi 'Pridruži se'",gameOver:"Kraj igre",roundComplete:"Runda završena",complete:"Završena",winner:"Pobednik",roundWinner:"Pobednik runde",move:"Pomeri",moveToBottom:"Pomeri na dno",selectCard:"Izaberi kartu",deckView:"Špil",topDeckView:"Vrh špila",discardView:"Bačene karte",selectFromDeck:"Izaberi kartu iz špila",selectFromDiscard:"Izaberi kartu iz bačenih",power:"Snaga",owner:"Vlasnik",noDescription:"Nema opisa",comingSoon:"Uskoro",revealed:"Otkriveno",connecting:"Povezivanje...",reconnecting:"Ponovno povezivanje...",reconnectingDescription:"Pokušaj obnove konekciju...",pleaseWait:"Molim sa sačekajte...",doNotClose:"Ne zatvaraj ovaj prozor dok se ponovo povezujete",error:"Greška",loading:"Učitavanje...",create:"Kreiraj",createGame:"Kreiraj igru",gameCode:"Kod igre",playerName:"Ime igrača",join:"Pridruži se",back:"Nazad",customGame:"Prilagođena igra",privateGame:"Privatna igra",publicGame:"Javna igra",freeForAll:"Svi protiv svih",teamBattle:"Timska borba",startingPlayer:"Početni igrač",turn:"Potez",round:"Runda",score:"Rezultat",hand:"RUKA",announced:"NAJAVLJENO",effects:"Efekti",status:"Status",deploy:"Razmesti",ability:"Sposobnost",recover:"Oporavi",resurrect:"Vaskrsi",destroy:"Uništi",returnToHand:"Vrati u ruku",shuffle:"Promešaj",drawCard:"Vuci kartu",drawStartingHand:"Vuci početnu ruku (6)",viewTopCards:"Pogledaj gornje karte",highlight:"Istakni",highlightCell:"Istakni ćeliju",highlightRow:"Istakni red",highlightColumn:"Istakni kolonu",emptyHand:"Isprazni ruku",hidden:"Skriveno",newAvalon:"New Avalon",cards:"Karata",scorePoints:"bodova",toWinRound:"za pobedu u rundi.",checkedAtFirstPlayer:"Proverava se u fazi postavljanja prvog igrača.",roundVictoryCondition:"Uslov pobede u rundi",reach:"Dostigni",ffa:"Svi protiv svih",team2v2:"2 protiv 2",team3v1:"3 protiv 1",drawCards:"Vuci karte",activeGames:"Aktivne igre",noActiveGames:"Nema aktivnih igara.",createOne:"Zašto ne biste kreirali jednu?",orJoinWithCode:"Ili se pridružite kodom",enterGameId:"Unesite ID igre",dragToReorder:"Prevucite za ređanje.",rightClickForActions:"Desni klik za radnje.",deckEmpty:"Špil je prazan.",done:"Gotovo",remove:"Ukloni",toDeckTop:"Na vrh špila",toDeckBottom:"Na dno špila",storyMode:"Režim priče",puzzles:"Slagalice",changeColor:"Promeni boju",firstPlayer:"Prvi igrač",activePlayer:"Aktivan igrač",clearSearch:"Obriši pretragu",resetPowerFilter:"Resetuj filter snage",clearTypes:"Obriši tipove",resetFaction:"Resetuj frakciju",removeOne:"Ukloni jednu",waitingForOthers:"Čekanje na ostale...",deckNamePlaceholder:"Naziv špila",searchPlaceholder:"Pretraga...",myCustomDeck:"Moj prilagođeni špil",untitledDeck:"Bezimeni špil",max1RarityHero:"Maksimum 1 (Retkost/Heroj)",max2Command:"Maksimum 2 (Komanda)",finalRoundMaxTurns:"Konačna runda! Maksimum 10 poteza.",max5Rounds:"Maksimum 5 rundi.",selectCardFromDeck:"Izaberi kartu iz špila",selectCardFromDiscard:"Izaberi kartu iz bačenih",noTarget:"Nema cilja",confirmClearDeck:"Da li ste sigurni da želite da obrišete trenutni špil?",languageDisabled:"Izbor jezika je trenutno onemogućen.",autoAbilitiesTooltip:"Auto-sposobnosti: Omogućite automatsku aktivaciju sposobnosti",autoDrawTooltip:"Auto-deljenje: Omogućite automatsko deljenje karata (6 karata u početnoj ruci + deljenje u Setup fazi)",endedOnTurn:"Završeno u potezu",nextRound:"Sledeće:",victoryCondition:"Uslov pobede:",win2RoundsMatch:"* Pobedite u 2 rundе da biste osvojili meč. ",max5RoundsInfo:"Maksimum 5 rundi.",matchComplete:"Meč završen",thankYouPlaying:"Hvala što ste igrali New Avalon: Skirmish.",returnToMenu:"Povratak u meni",continueGame:"Prikaži bojište",startRound:"Započni rundu",youLabel:"(Vi)",readyToStart:"Spremni za početak?",gameWillBegin:"Igra će početi kada svi igrači budu spremni. I dalje možete promeniti ime i špil.",dragCardsReorder:"Prevucite karte za ređanje. Prevucite napolje da biste premestili kartu u drugu zonu.",dragOutsideAnotherZone:"Prevucite napolje da biste premestili kartu u drugu zonu.",ready:"Spreman",dragOutsideToMove:"Prevucite napolje da biste premestili kartu u drugu zonu.",empty:"Prazno",dragOutsideToPlaceToken:"Prevucite napolje da biste postavili token na tablu.",holdRightClickViewHints:"Držite desni taster za prikaz saveta",gameSettings:"Podešavanja igre",invitePlayer:"Pozovi Igrača",hiddenGame:"Privatnost",private:"Privatna",public:"Javna",copyInviteLink:"Kopiraj link za pozivnicu",copyGameLink:"Kopiraj link na igru",copied:"Kopirano!",inviteLinkDesc:"Pošaljite link prijatelju. Adresa servera će se podesiti automatski.",copyGameLinkDesc:"Podelite se ovim linkom kako biste prijatelji mogli da se pridruže sa podešenim podešavanjima servera.",copy:"Kopiraj",on:"UKLJ",off:"ISKLJ",dummyPlayers:"Botovi",gridSize:"Veličina polja",autoAbilities:"Auto-sposobnosti",gameMode:"Režim igre","2v2":"2v2","3v1":"3v1",reconnect:"Poveži ponovo",hideDummyCards:"Sakri karte botova",hideDummyCardsTooltip:"Sakrij karte u rukama bot-igrača kao kod pravih igrača",clearCache:"Obriši keš",clearCacheDesc:"Obriši sve sačuvane podatke i ponovo učitaj stranicu",cacheCleared:"Keš obrisan! Ponovno učitavanje...",saveJson:"Sačuvaj JSON",saveText:"Sačuvaj tekst",loadTextDeck:"Učitaj tekst",cannotSaveEmptyDeck:"Ne možete sačuvati prazan špil.",failedToParseDeckFile:"Nije uspelo raščlanjivanje datoteke špila.",webrtcMode:"WebRTC Režim",webrtcModeDesc:"Omogućite direktnu vezu između igrača bez centralnog servera (Domaćin deluje kao server)",peerToPeer:"Peer-to-Peer",directConnection:"Direktna veza između pregledača",hostGame:"Domaćin igre",hostGameDesc:"Domaćin igre putem WebRTC - centralni server nije potreban",copyHostLink:"Kopiraj vezu domaćina",hostLinkCopied:"Veza domaćina kopirana!",joinAsGuest:"Pridruži se igri (P2P)",enterHostId:"Unesite Host ID ili vezu",invalidHostId:"Nevažeći Host ID",connectingToHost:"Povezivanje na domaćina...",connectedToHost:"Povezano sa domaćinom",hostDisconnected:"Domaćin se odjavio",guestDisconnected:"Gost se odjavio",guestConnected:"Gost povezan"},rules:{title:'Pravila igre "New Avalon: Skirmish"',conceptTitle:"I. Osnovni Koncept",conceptText:`**Žanr i uloga igrača:** New Avalon: Skirmish je dinamička taktička kartaška igra koja se odvija na ograničenom mrežastom polju. Igrači preuzimaju uloge vođa frakcija, raspoređujući Jedinice i Komande kako bi preuzeli kontrolu nad ključnim linijama bojišta.

**Objašnjenje:** Igra se fokusira na pozicionu kontrolu i vreme aktiviranja sposobnosti, a ne samo na direktan napad. Pobeda se postiže ostvarivanjem Poena Za Pobedu (PZP), koji se baziraju na snazi jedinica u izabranim linijama.`,winConditionTitle:"II. Uslovi za pobedu",winConditionText:`**Uslovi za pobedu u meču:** Meč se igra do 2 pobede u rundama. Igrač koji prvi ostvari 2 pobede u rundama, odmah pobeduje meč.
**Objašnjenje nerešenog:** ako se po završetku bilo koje runde više igrača istovremeno domogne 2 pobede u rundama, svi se proglašavaju pobednicima meča.

**Uslovi za pobedu u rundi (Pragovi i ograničenje poteza):** Runda se završava čim jedan ili više igrača dostigne prag Poena Za Pobedu (PZP) ili nakon završetka 5. poteza.
**Ograničenje poteza:** Svaka runda je ograničena na 5 potpunih poteza za svakog igrača. Ako prag PZP nije dostignut, na kraju 5. poteza vrši se konačno bodovanje i određivanje pobednika.

**Vrednosti praga:**
- Runda 1: 20 Poena Za Pobedu (PZP).
- Runda 2: 30 Poena Za Pobedu (PZP).
- Runda 3 i dalje: Prag se povećava za +10 PZP u odnosu na prethodnu rundu (npr. Runda 3 — 40 PZP).

**Određivanje pobednika rundе i nerešeno:** Pobednik rundе je igrač koji je dostigao prag vrednost ili igrač sa najvećim brojem PZP posle ograničenja poteza.
**Objašnjenje nerešenog u rundi:** Ako se po završetku rundе dva ili više igrača imaju isti i najveći broj poena, svi se proglašavaju pobednicima rundе.`,fieldTitle:"III. Bojište i komponente",fieldText:`**Bojište (Mreža):** Igra se odvija na kvadratnoj mreži čija se veličina menja u zavisnosti od ukupnog broja učesnika.
**Objašnjenje veličina:**
- 2 igrača: Polje 5x5 ćelija.
- 3 igrača: Polje 6x6 ćelija.
- 4 igrača: Polje 7x7 ćelija.

**Određivanje pozicija:**
- **Linija:** To je ceo horizontalni red ili vertikalna kolona. Koristi se za mehaniku bodovanja (Scoring).
- **Susedstvo:** Ćelije se smatraju susednim samo horizontalno i vertikalno (ortogonalno). Dijagonalno susedstvo se ne uzima u obzir, osim ako je u karti drugačije navedeno.

**Karte:** U igri se koriste dva glavna tipa karata koje se igraju iz Ruke:
- **Jedinice (Units):** Osnovne borbene jedinice koje poseduju Snagu (Power) i Sposobnosti. Ostaju na bojištu do uništenja.
- **Komande (Commands):** Karte trenutnog dejstva. Igraju se, izvrše efekat (često nudeći izbor "2 od 3 opcije") i odlaze u Bačene.

**Zone za igru:**
- **Ruka (Hand):** Karte skrivene od protivnika.
- **Bačene (Discard):** Zona u koju odlaze uništene Jedinice i odigrane Komande.
- **Izlog (Showcase/Announced):** Privremena zona u koju se stavlja karta Komande pre njenog igranja.`,setupTitle:"IV. Početak igre (Postavljanje)",setupText:`**Formiranje špila:** Pre početka meča svaki igrač bira frakciju ili sastavlja špil prema pravilima izgradnje (najmanje 30 karata).
**Objašnjenje:** KArte u špilu se promešaju.

**Početna ruka:** Svaki igrač vuče 6 karata iz svog špila, formirajući početnu ruku.
**Objašnjenje skrivene informacije:** KArte u ruci su skrivene od protivnika.

**Mulingan:** Na početku igre, nakon što dobije početnu ruku (6 karata), igrač ima pravo 1 put da promeša bilo koji broj karata iz ruku nazad u špil i vuče isti broj novih karata sa vrha.

**Određivanje prvog igrača:** Odredite prvog aktivnog igrača bilo kojim pogodnim načinom (npr. bacanjem novčića).
**Objašnjenje:** Igra se vidi naizmenično, počevši od prvog igrača. Prvi igrač započinje svoj prvi potez odmah sa Faze Setup.`,abilitiesTitle:"V. Sposobnosti karata",abilitiesText:`**Tipovi sposobnosti:**
- **Deploy:** Aktivira se automatski i odmah kada se karta stavlja iz ruke na polje otvoreno.
- **Setup:** Aktivira se automatski na početku Faze Setup svakog vašeg poteza (pre vučenja karte), ako karta već leži na polju licem nagore.
- **Commit:** Aktivira se automatski na početku Faze Commit svakog vašeg poteza, ako karta već leži na polju licem nagore.
- **Pas (Pasivna):** Efekat deluje trajno dok je karta na polju u otvorenom stanju.

**Uslovi izvršenja (⇒):**
Mnoge sposobnosti imaju zahtev označen strelicom (npr. **Support ⇒ Deploy:** ...).
- To znači "PROVERA USLOVA ⇒ EFEKAT".
- Ako uslov levo od strelice (npr. prisustvo statusa Support) nije ispunjen u momentu aktiviranja, sposobnost **se ne aktivira** uopšte.

**Važna pravila:**
- **Stun:** Oglušene karte (sa žetonom Stun) **ne aktiviraju** svoje sposobnosti (ni Deploy, ni fazne, ni pasivne).
- **Face-down:** KArte koje leže licem nadole nemaju sposobnosti.
- **Obaveznost:** Ako se sposobnost aktivirala (uslovi su ispunjeni), vi **obavezni** da primenite njen efekat ako postoje legalne mete. Ako legalne mete nema, sposobnost se primenjuje uzalud (gori).`,statusesTitle:"VI. Dinamički statusi (Pozicioniranje)",statusesText:`Dinamički statusi se računaju automatski i kontinuirano pri bilo kojoj promeni na tabli. Jedinice sa statusom Stun ne mogu davati ili učestvovati u proračunu ovih statusa.

**Podrška (Support):** Jedinica ima status Support ako se u bar jednoj susednoj ćeliji (horizontalno ili vertikalno) nalazi saveznička jedinica.
**Objašnjenje Stun/Support:** Jedinica sa žetonom Stun se ne uzima u obzir pri proračunu Support za susedne saveznike.
**Vrednost:** Prisustvo Support je uslov za aktiviranje mnogih moćnih sposobnosti, označenih sintaksom Support ⇒ [Efekat].

**Pretnja (Threat):** Jedinica dobija status Threat ako se nalazi u opasnoj poziciji, stvorenoj neprijateljskim jedinicama.
**Objašnjenje uslova:** Status Threat se dodeljuje u jednoj od dve situacije:
1. **Klešta:** Jedinica je zakaćena kartama jednog protivnika sa bilo koje dve strane (dve susedne ili dve suprotnje).
2. **Pritisak:** Jedinica se nalazi na ivici bojišta i ima bar jednu kartu protivnika za susedom.
**Objašnjenje Stun/Threat:** Jedinica sa žetonom Stun se ne uzima u obzir pri proračunu Threat za susedne neprijatelje.
**Vrednost:** Jedinice pod Threat su ranjive mete za moćne sposobnosti kontrole i uništenja.`,countersTitle:"VII. Žetoni (Counters)",countersText:`Žetoni su trajni markeri koji se nameću sposobnostima karata. Ostaju na jedinici dok se ne skinu ili dok jedinica ne bude uništena.

**Oglušenje (Stun):**
- **Efekat:** Jedinica sa Stun donosi 0 Poena Za Pobedu u fazi Scoring, ne može da aktivira svoje sposobnosti i ne može biti pomerena od strane svog vlasnika (ali može biti pomerena od strane protivnika).
- **Skidanje:** Na kraju faze Commit sa svake jedinice aktivnog igrača automatski se skida 1 žeton Stun.

**Štit (Shield):**
- **Efekat:** Ako sposobnost pokuša da uništi (Destroy) ovu jedinicu, efekat uništenja se sprečava, a sa jedinice se umesto toga skida 1 žeton Štita. Jedinica ostaje na polju.

**Otkriveno (Revealed) i Skrivene karte (Face-down):**
- **Revealed:** Omogućava igraču-vlasniku žetona da vidi skrivenu informaciju o karti.
- **Objašnjenje Face-down:** Karta odigrana licem nadole (Face-down) nema Snagu ni Sposobnosti i donosi 0 poena. Ako takva karta dobije žeton Revealed, njene informacije (lice) postaju vidljive protivniku, ali karta se i dalje smatra Face-down za sve svrhe igre (snaga, sposobnosti).

**Specijalni žetoni (Aim, Exploit):**
- **Aim (Nišanjenje) i Exploit (Iskorišćenost):** Ovi žetoni su markeri za interakciju frakcijskih sposobnosti (npr. snajperi ili hakeri). Sami po sebi nemaju igrački efekat.

**Poslednja odigrana (Last Played):**
- **Efekat:** Privremeni status koji se automatski dodeljuje karti koju je poslednji odigrao na polje aktivni igrač u tekućem potezu. Ovaj status određuje liniju koju igrač mora da izabere za bodovanje (Scoring).`,turnTitle:"VIII. Struktura poteza i vreme",turnText:`Potez se prenosi s igrača na igrača. Sposobnosti karata se aktiviraju samo u potezu njihovog vlasnika. Potez aktivnog igrača sastoji se od četiri sekvencijalne faze:

**1. Faza Setup (Postavljanje):**
- **Vučenje karte:** Aktivni igrač vuče 1 kartu iz špila u ruku.
- **Sposobnosti:** Aktiviraju se sposobnosti svih karata na polju sa ključnom reči **Setup:**.
**Objašnjenje:** Ova faza je namenjena dopuni ruke i početnom pozicioniranju jedinica.

**2. Faza Main (Delovanje / Razmeštanje):**
- **Glavno delovanje:** Aktivni igrač može da izvrši jedno od sledećih dejstava:
  - Odigra kartu Jedinice (**Deploy:**) iz ruku na bilo koju slobodnu ćeliju polja. Pri tome se odmah aktivira njena Deploy: sposobnost.
  - Odigra kartu Komande iz ruke.
  - Pasira.
**Objašnjenje Komandi:** KArte Komandi se može igrati u bilo kojem broju u ovoj fazi — pre, posle ili između razmeštanja jedinica.

**3. Faza Commit (Završavanje / Učvršćivanje):**
- **Sposobnosti:** Aktiviraju se sposobnosti svih karata na polju sa ključnom reči **Commit:**.
- **Skidanje Stun:** Na kraju ove faze sa svake jedinice aktivnog igrača automatski se skida 1 žeton Stun.
**Objašnjenje:** Faza se koristi za primenu efekata kontrole i dobijanje resursa pre bodovanja.

**4. Faza Scoring (Bodovanje):**
- **Ibor linije:** Aktivni igrač mora da izabere jednu Liniju (Red ili Kolonu) koja prolazi kroz njegovu kartu sa statusom **Last Played**.
- **Proračun:** Sabira se Snaga svih jedinica aktivnog igrača u izabranoj liniji i dobijeni zbir dodaje se ukupnom rezultatu igrača.`,mechanicsTitle:"IX. Rešavanje konflikata i ključne mehanike",mechanicsText:`**Stun i bodovanje:**
- **Efekat:** Jedinica sa statusom Stun ili koja leži Face-down donosi 0 poena u fazi Scoring, nezavisno od njene osnovne Snage, stalnih modifikatora snage ili pasivnih sposobnosti koje donose poene (npr. Spotter).

**Prenošenje statusa Last Played:**
- **Uništenje:** Ako karta sa statusom Last Played napusti bojište (uništena, vraćena u ruku/špil) pre Faze Scoring, status se prenosi na prethodnu odigranu kartu ovog igrača (onu koja je bila Last Played u prošlom potezu).
- **Pomeranje:** Ako se karta sa Last Played pomera na drugu ćeliju, igrač bira njene nove linije u Fazi Scoring.
- **Odsustvo:** Ako igrač nema nijednu kartu sa statusom Last Played, igrač ne može da izabere liniju i ne dobija poene u ovom potezu.

**Pomeranje jedinica (Push, Swap):**
- **Push (Guranje):** Jedinica forsira drugu kartu da se pomera za susednu ćeliju. Guranje se blokira (ne dešava se) ako se meti nalazi zauzeta ćelija ili ivica polja. Ostali efekti sposobnosti se primenjuju na metu.
- **Swap (Zamena):** Omogućava dvema kartama da zamene mesta, čak i ako su obe ćelije zauzete.

**Vaskrsenje (Resurrect):**
- **Mehanika "izgaranja":** Karta vraćena na bojište iz Bačenih (vaskrsnuta) odmah dobija status **Resurrected** u momentu Deploya. Na početku sledeće faze (pri promeni faza) ovaj status se skida i karta dobija dva žetona Stun.`,creditsTitle:"X. Autori igre",creditsText:`**Autor:** Nikita Anahoret

**Korišćene neuronske mreže:**
Google AI Studio, Claude Code, Gemini, ChatGPT

**Posebna zahvalnost:**
- Vasilisa Versus
- Kirill Tomačuk
- Andrej Markosov
- Mitya Šepelin

Za sva pitanja i predloge pišite na [Telegram](https://t.me/NeurohoretApp) ili [Discord](https://discord.gg/U5zKADsZZY).
Podržite razvoj igre i autore možete kroz [DonationAlerts](https://www.donationalerts.com/r/anahoret) i [Patreon](https://www.patreon.com/AnchoriteComics).`},counters:{Aim:{name:"Nišanjenje",description:`Ovaj žeton sam po sebi nema efekta, ali može da menja sposobnosti karata.
Ovu kartu je lakše uništiti.`},Exploit:{name:"Exploit",description:`Ovaj žeton sam po sebi nema efekta, ali može da menja sposobnosti karata.
Karte hakera i programera će imati veći efekat na ovu kartu.`},LastPlayed:{name:"PoslednjaOdigrana",description:"Ova karta je odigrana poslednja od strane svog vlasnika."},Revealed:{name:"Otkriveno",description:"Lice ove karte je vidljivo vlasniku žetona revealed. Može se stavljati na karte u ruci."},Stun:{name:"Oglušenje",description:`Oglušena karta ne može da aktivira sposobnosti ili donosi poene. Efekti njenog vlasnika je ne mogu da pomeraju, ali efekti protivnika mogu.
Skinite 1 žeton oglušenja sa karte posle faze bodovanja (Scoring).`},Shield:{name:"Štit",description:"Ako efekat pokuša da uništi ovu kartu, umesto toga skinite sa nje 1 žeton štita."},Support:{name:"Podrška",description:`Ovaj žeton sam po sebi nema efekta, ali može da menja sposobnosti karata.
Ova karta se nalazi pored saveznika.`},Threat:{name:"Pretnja",description:`Ovaj žeton sam po sebi nema efekta, ali može da menja sposobnosti karata.
Ova karta je okružena i pritisnuta na ivicu polja kartama protivnika.`},"Power+":{name:"Snaga+",description:"Povećava snagu karte za 1."},"Power-":{name:"Snaga-",description:"Smanjuje snagu karte za 1."},Resurrected:{name:"Vaskrsnut",description:"Ova jedinica se nedavno vratila iz bačenih. Biće oglušena na početku sledeće faze."}},deckNames:{SynchroTech:"SynchroTech",Hoods:"Kapuljače",Optimates:"Optimati",Fusion:"Fuzija"},cards:{ipDeptAgent:{name:"Agent IP Odeljenja",ability:`Deploy: Pomešta 2 žetona Oglušеnja na kartu s vašom Ugrozom.
Setup (zahteva Podršku): Dobija 2 poena za svaku vašu Ugrozu u izabranoj liniji.`,flavorText:'- "Kršili ste autorska prava. Otvorite vrata. Imamo nalog za pretragu."'},tacticalAgent:{name:"Taktički Agent",ability:`Deploy: Pomešta žeton Pricela na kartu s vašom Ugrozom.
Setup: Uništava kartu s vašim žetonom Pricela.`,flavorText:'- "Neko se ne kreće! Bezbednosna služba SynchroTech!"'},patrolAgent:{name:"Patrolni Agent",ability:`Setup: Pomera se u slobodnu jаčiju linije.
Commit: Pomešta žeton Oglušеnja na susednu kartu oponenta s vašom Ugrozom.`,flavorText:"Kažu da grad nikada ne spava. Mi pazimo da čak ni ne trepće."},riotAgent:{name:"Agent za Suzbijanje Nereda",ability:`Deploy: Gura susednu kartu oponenta za 1 polje i može zauzeti njeno mesto.
Commit: Pomešta žeton Oglušеnja na susednu kartu oponenta s vašom Ugrozom.`,flavorText:'- "Građani, raziđite se! Ovaj skup nije odobren od strane SynchroTech."'},threatAnalyst:{name:"Analitičar Pretnji",ability:`Deploy: Pomešta žeton Eksploita na bilo koju kartu.
Pass (zahteva Podršku): Vaše jedinice mogu da ugroze karte protivnika sa vašim žetonom Eksploita.`,flavorText:""},recklessProvocateur:{name:"Nemarni Provokator",ability:`Deploy: Menja se mestima sa susednom kartom.
Commit: Pomera sve žetone sa odabrane savezničke karte na ovu kartu.`,flavorText:'- "Strpljenje je oružje. Osveta je umetnost."'},dataLiberator:{name:"Oslobodilac Podataka",ability:`Pass (zahteva Podršku): Karte s vašim žetonima Eksploita donose vam poene.
Deploy: Pomešta žeton Eksploita na bilo koju kartu.`,flavorText:'- "Informacija ne želi da bude slobodna. Ona mora biti."'},cautiousAvenger:{name:"Oprezni Osvetač",ability:`Deploy: Pomešta žeton Pricela na kartu u dometu od 2 polja.
Setup (zahteva Podršku): Uništava kartu s vašim žetonom Pricela.`,flavorText:'- "Strpljenje je oružje. Osveta je umetnost."'},vigilantSpotter:{name:"Bedni Nadzornik",ability:`Pass (zahteva Podršku): Kada otkrivena (Revealed) karta protivnika izađe na polje, dobij 2 boda.
Commit: Otkrij 1 kartu iz ruke protivnika.`,flavorText:'- "Strpljenje je oružje. Osveta je umetnost."'},inventiveMaker:{name:"Izumitelj Kreator",ability:`Deploy: Stvara token Dron-Razvednik u susednom praznom polju.
Setup (zahteva Podršku): Vraća kartu Devajsa iz odbačenih karata u ruku.`,flavorText:'- "Strpljenje je oružje. Osveta je umetnost."'},finnMW:{name:"Fin, Najtraženiji",ability:`Setup: Pomera bilo koju vašu kartu za 1 ili 2 polja.
Commit: Za svaku vama otkrivenu kartu u rukama oponenata ili na bojnom polju dobijate 1 poen.`,flavorText:"Uhvati me ako možeš. Spoiler: Ne možeš."},faber:{name:"Faber",ability:"Deploy: Odbacite 1 kartu iz svoje ruke ⇒ Stvara token Šetajuća Turel u susednom praznom polju.",flavorText:"U pozlaćenim dvoranama Optimata čak i alati ratovanja su umetnička dela."},censor:{name:"Cenzor",ability:`Deploy: Pomešta žeton Eksploita na bilo koju kartu.
Commit (zahteva Podršku): Zamenjuje vaš žeton Eksploita žetonom Oglušеnja.`,flavorText:"U pozlaćenim dvoranama Optimata čak i alati ratovanja su umetnička dela."},princeps:{name:"Princeps",ability:`Deploy: Dobija žeton Štita. Pomešta žeton Pricela na kartu u svojoj liniji.
Setup: Uništava kartu s vašim žetonom Pricela.`,flavorText:"Red se ne traži. On se nametne."},immunis:{name:"Immunis",ability:`Deploy (zahteva Podršku): Vraća kartu Optimata iz vaših odbačenih karata u susedno prazno polje sa žetonom Vaskrsenja.
Na kraju faze žeton Vaskrsenja zamenjuje se sa 2 žetona Oglušеnja.`,flavorText:"U pozlaćenim dvoranama Optimata čak i alati ratovanja su umetnička dela."},centurion:{name:"Centurion",ability:"Commit: Žrtvujte savezničkog junita ⇒ Sve savezničke karte u njegovim linijama dobijaju +1 na snagu.",flavorText:"U pozlaćenim dvoranama Optimata čak i alati ratovanja su umetnička dela."},codeKeeper:{name:"Čuvar Koda",ability:`Deploy: Pomešta po 1 žeton Eksploita na sve karte oponenata u linijama s bilo kojom Ugrozom.
Commit (zahteva Podršku): Pomera kartu oponenta s vašim žetonom Eksploita za 1 polje.`,flavorText:"Signal je istina. Sve ostalo je šum."},devoutSynthetic:{name:"Pobožni Sintetičar",ability:`Deploy: Gura susednu kartu oponenta za 1 polje i može zauzeti njeno mesto.
Setup: Uništava susednu kartu oponenta s Ugrozom ili Oglušеnjem.`,flavorText:"Telo je bag. Signal je zakrpa."},unwaveringIntegrator:{name:"Nepokolebljivi Integrator",ability:`Deploy: Pomešta žeton Eksploita na bilo koju kartu.
Setup (zahteva Podršku): Dobija 1 poen za svaki vaš žeton Eksploita u izabranoj liniji.`,flavorText:"Signal je istina. Sve ostalo je šum."},signalProphet:{name:"Prorok Signala",ability:`Deploy: Pomešta po 1 žeton Eksploita na sve svoje karte s Podrškom u linijama.
Commit (zahteva Podršku): Pomera svoju kartu sa žetonom Eksploita za 1 polje.`,flavorText:"Signal je istina. Sve ostalo je šum."},zealousMissionary:{name:"Revni Misionar",ability:`Deploy: Pomešta žeton Eksploita na bilo koju kartu.
Commit (zahteva Podršku): Daje -1 na snagu karti s vašim žetonom Eksploita.`,flavorText:"Signal je istina. Sve ostalo je šum."},overwatch:{name:"Nadzor",ability:`● Postavi 1 žeton Pricela na bilo koju kartu. Otkrij 1 kartu iz ruke oponenta za svaki tvoj žeton Pricela na bojištu.
● Postavi 1 žeton Pricela na bilo koju kartu. Vuci 1 kartu za svaki tvoj žeton Pricela na bojištu.`},tacticalManeuver:{name:"Taktički Manevar",ability:`● Pomeri tvoju jedinicu u praznu ćeliju u njenoj liniji. Vuci broj karata jednak snazi premeštene jedinice.
● Pomeri tvoju jedinicu u praznu ćeliju u njenoj liniji. Dobij broj poena jednak snazi premeštene jedinice.`},inspiration:{name:"Inspiracija",ability:`● Ukloni bilo koji broj žetona sa tvoje jedinice. Vuci 1 kartu za svaki uklonjeni žeton.
● Ukloni bilo koji broj žetona sa tvoje jedinice. Dobij 1 poen za svaki uklonjeni žeton.`},dataInterception:{name:"Presretanje Podataka",ability:`● Postavi 1 žeton Eksploita na bilo koju kartu. Otkrij 1 kartu u ruci oponenta za svaki tvoj žeton Eksploita na bojištu.
● Postavi 1 žeton Eksploita na bilo koju kartu. Pomeri jedinicu sa tvojim žetonom Eksploita za 1 ili 2 polja.`},falseOrders:{name:"Lažni Naredbe",ability:`● Postavi 1 žeton Eksploita na kartu oponenta. Pomeri jedinicu oponenta sa tvojim žetonom Eksploita za 1 ili 2 polja. Otkrij do 2 karata u ruci tog oponenta.
● Postavi 1 žeton Eksploita na kartu oponenta. Pomeri jedinicu oponenta sa tvojim žetonom Eksploita za 1 ili 2 polja. Postavi 2 žetona Oglušеnja na nju.`},experimentalStimulants:{name:"Eksperimentalni Stimulatori",ability:`● Jednica pod tvojom kontrolom na bojištu može aktivirati svoju Deploy sposobnost još jednom.
● Pomeri tvoju jedinicu u praznu ćeliju u njenoj liniji.`},logisticsChain:{name:"Lanac Logistike",ability:`● Dobij poene u dijagonali. Dobij +1 poen za svaku tvoju kartu sa Podrškom u toj dijagonali.
● Dobij poene u dijagonali. Vuci 1 kartu za svaku tvoju kartu sa Podrškom u toj dijagonali.`},quickResponseTeam:{name:"Tim za Brzo Reagovanje",ability:`● Odigraj jedinicu iz ruke u prazno polje.
● Pronađi kartu jedinice u špilu i stavi je u ruku. Promešaj špil.`},temporaryShelter:{name:"Privremeno Sklonište",ability:`● Postavi 1 žeton Štita na tvoju kartu. Ukloni sve žetone Pricela sa te karte.
● Postavi 1 žeton Štita na tvoju kartu. Pomeri tu kartu za 1 ili 2 polja.`},enhancedInterrogation:{name:"Pojačano Ispitivanje",ability:`● Postavi 1 žeton Pricela na bilo koju kartu. Otkrij 1 kartu iz ruke oponenta za svaki tvoj žeton Pricela na bojištu.
● Postavi 1 žeton Pricela na bilo koju kartu. Pomeri bilo koju kartu sa tvojim žetonom Pricela za 1 ili 2 polja.`},mobilization1:{name:"Probijanje Linije",ability:"Dobij poene u izabranoj liniji bojišta."},mobilization2:{name:"Osvojavanje Sektora",ability:"Dobij poene od 4 susednih savezničkih karata."},mobilization3:{name:"Proboj Dijagonale",ability:"Dobij poene u izabranoj dijagonali bojišta."},reconDrone:{name:"Izvidnički Dron",ability:`Setup: Pomera se u bilo koje polje bojnog polja.
Commit: Izaberite kartu oponenta u susednom polju. Otkrivajte kartu u ruci tog oponenta.`,flavorText:"SynchroTech je kreirao lake dronove za patrolu ulica, ali Hoodsi imaju druge planove."},walkingTurret:{name:"Šetajuća Turel",ability:`Deploy: Pomešta žeton Pricela na kartu u svojoj liniji.
Setup: Daje -1 na snagu karti sa žetonom Pricela.`,flavorText:"Ovom ratnoj čudovištu očigledno nije mesto na gradskim ulicama."},reclaimedGawain:{name:'Povraćeni "Gawain"',ability:`Deploy: Dobija žeton Štita. Gura susednu kartu oponenta za 1 polje i može zauzeti njeno mesto.
Setup: Uništava susednu kartu oponenta s Ugrozom ili Oglušеnjem.`,flavorText:"Nekada viteš sistema, sada duh u mašini."},FalkPD:{name:"Majkl Folk, Privatni Detektiv",ability:`Deploy: Nalazi u vašem špilu bilo koju kartu. Stavite je u svoju ruku i promiešajte špil.
Commit: Otkriva kartu protivnika.`,flavorText:"On pronalazi stvari. Ponekad stvari koje treba da ostanu izgubljene."},edithByron:{name:"Edit Bajron, Ekstremni Inženjer",ability:`Setup: Pomera se u slobodno polje u liniji.
Deploy: Dobija žeton Štita. Stvara token Dron-Razvednik u susednom praznom polju.`,flavorText:"Gradi budućnost, jedna eksplozija za drugom."},pinkunonekoSV:{name:"Pinkunoneko, Ulični Čuvar",ability:`Deploy: Pomešta žeton Oglušеnja na susednu kartu oponenta.
Setup: Uništava susednu kartu oponenta s Ugrozom ili Oglušеnjem.`,flavorText:"Neonske kandže u mračnoj ulici."},EleftheriaMD:{name:'Marija "Elefterija" Damanaki',ability:`Deploy: Pomešta žeton Pricela na bilo koju kartu.
Setup: Uništava kartu s vašim žetonom Pricela.`,flavorText:"Sloboda ima cenu. Ona naplaćuje."},ziusIJ:{name:"Zius, Nezavisni Novinar",ability:`Deploy: Pomešta žeton Eksploita na bilo koju kartu.
Setup (zahteva Podršku): Pomešta žeton Eksploita na bilo koju kartu i dobija 1 poen za svaki žeton Eksploita u liniji te karte.`,flavorText:"Istina je negde u blizini, i on emituje direktni prenos."},abrGawain:{name:'ABR "Gawain"',ability:`Deploy: Dobija žeton Štita. Pomešta žeton Pricela na kartu u svojoj liniji.
Setup: Uništava kartu s vašim žetonom Pricela.`,flavorText:"Protokol iniciran. Procena pretnje: Ekstremna."},reverendOfTheChoir:{name:"Časni Hor",ability:`Setup (zahteva Podršku): Dobija 1 poen za svaki vaš žeton Eksploita na bojnom polju.
Deploy: Udvostručuje broj žetona Eksploita na bilo kojoj karti.`,flavorText:"Hučanje servera je himna za posvećene."},mrPearlDoF:{name:"Gospodin Perl, Direktor BioSincha",ability:`Pass: Drugi vaši juniti u linijama dobijaju +1 na snagu.
Deploy: Nalazi u vašem špilu kartu junita. Stavite kartu u svoju ruku i promiešajte špil.`,flavorText:"Efikasnost je jedina metrika koja ima značaj."},luciusTheImmortal:{name:"Lucije, Besmrtni",ability:`Pass: Imunitet na Oglušеnje. Ako je izašao iz odbačenih karata, dobija +2 na snagu.
Setup: Odbacite kartu ⇒ Nađite u svom špilu kartu tima. Stavite je u svoju ruku i promiešajte špil.`,flavorText:"Smrt podrazumeva prestanak funkcija. Ja sam samo optimizovao to."},secretInformant:{name:"Sikrеt Informant",ability:"Deploy: Gleda 3 gornje karte bilo kog špila. Stavite bilo koji broj njih na dno špila. Uzmite 1 kartu.",flavorText:"Znanje je snaga. I sredstvo pritiska."}}},Fr={startGame:"Start Game",imReady:"I'm ready",joinGame:"Join Game",deckBuilding:"Deck Building",rules:"Rules & Tutorial",settings:"Settings",language:"Language",serverAddress:"Server Address",saveApply:"Save & Apply",cancel:"Cancel",close:"Close",tokens:"Tokens",counters:"Counters",phase:"Phase",scoring:"SCORING...",autoAbility:"Auto-Ability",autoDraw:"Auto-Draw",newGame:"New Game",resetGame:"Reset Game",exit:"Exit",surrender:"Surrender",mode:"Mode",size:"Size",dummies:"Dummies",spectatorMode:"Spectator Mode",spectatorMsg:"You are watching the game.",readyCheck:"Ready to Start?",waiting:"Waiting...",cancelStart:"Cancel Start",assignTeams:"Assign Teams",confirmTeams:"Confirm Teams & Start",unassigned:"Unassigned Players",team:"Team",deck:"DECK",discard:"DISCARD",showcase:"Showcase",customDeck:"Custom Deck",loadDeck:"Load",clear:"Clear",save:"Save",filter:"Filter",currentDeck:"Current Deck",emptyDeck:"Your deck is empty.",clickToAdd:"Click cards on the left to add them.",view:"View",play:"Play",playFaceDown:"Play Face Down",toHand:"To Hand",toDiscard:"To Discard",revealToAll:"Reveal to All",requestReveal:"Request Reveal",flipUp:"Flip Face Up",flipDown:"Flip Face Down",connected:"Connected",disconnected:"Disconnected",hiddenGameTooltip:"Hidden games do not appear in the 'Join Game' list",gameOver:"Game Over",roundComplete:"Round Complete",complete:"Complete",winner:"Winner",roundWinner:"Round Winner",move:"Move",moveToBottom:"Move to Bottom",selectCard:"Select Card",deckView:"Deck",topDeckView:"Top Deck",discardView:"Discard Pile",selectFromDeck:"Select Card from Deck",selectFromDiscard:"Select Card from Discard",power:"Power",owner:"Owner",noDescription:"No description available",comingSoon:"Coming Soon",revealed:"Revealed",connecting:"Connecting...",reconnecting:"Reconnecting...",reconnectingDescription:"Attempting to restore connection...",pleaseWait:"Please wait...",doNotClose:"Do not close this window while reconnecting",error:"Error",loading:"Loading...",create:"Create",createGame:"Create Game",gameCode:"Game Code",playerName:"Player Name",join:"Join",back:"Back",customGame:"Custom Game",privateGame:"Private Game",publicGame:"Public Game",freeForAll:"Free For All",teamBattle:"Team Battle",startingPlayer:"Starting Player",turn:"Turn",round:"Round",score:"Score",hand:"HAND",announced:"ANNOUNCED",effects:"Effects",status:"Status",deploy:"Deploy",ability:"Ability",recover:"Recover",resurrect:"Resurrect",destroy:"Destroy",returnToHand:"Return to Hand",shuffle:"Shuffle",drawCard:"Draw Card",drawStartingHand:"Draw Starting Hand (6)",viewTopCards:"View Top Cards",highlight:"Highlight",highlightCell:"Highlight Cell",highlightRow:"Highlight Row",highlightColumn:"Highlight Column",emptyHand:"Empty Hand",hidden:"Hidden",newAvalon:"New Avalon",cards:"Cards",scorePoints:"points",toWinRound:"to win round.",checkedAtFirstPlayer:"Checked at First Player's Setup Phase.",roundVictoryCondition:"Round Victory Condition",reach:"Reach",ffa:"FFA",team2v2:"2v2",team3v1:"3v1",drawCards:"Draw Card",activeGames:"Active Games",noActiveGames:"No active games found.",createOne:"Why not create one?",orJoinWithCode:"Or Join with Code",enterGameId:"Enter Game ID",dragToReorder:"Drag to reorder.",rightClickForActions:"Right click for actions.",deckEmpty:"Deck is empty.",done:"Done",remove:"Remove",toDeckTop:"To Deck Top",toDeckBottom:"To Deck Bottom",storyMode:"Story Mode",puzzles:"Puzzles",changeColor:"Change Color",firstPlayer:"First Player",activePlayer:"Active Player",clearSearch:"Clear Search",resetPowerFilter:"Reset Power Filter",clearTypes:"Clear Types",resetFaction:"Reset Faction",removeOne:"Remove one",waitingForOthers:"Waiting for others...",deckNamePlaceholder:"Deck Name",searchPlaceholder:"Search...",myCustomDeck:"My Custom Deck",untitledDeck:"Untitled Deck",max1RarityHero:"Max 1 (Rarity/Hero)",max2Command:"Max 2 (Command)",finalRoundMaxTurns:"Final Round! Max 10 Turns.",max5Rounds:"Max 5 Rounds.",selectCardFromDeck:"Select Card from Deck",selectCardFromDiscard:"Select Card from Discard",noTarget:"No Target",confirmClearDeck:"Are you sure you want to clear the current deck?",languageDisabled:"Language selection is currently disabled.",autoAbilitiesTooltip:"Auto-Abilities: Enable automatic ability activation",autoDrawTooltip:"Auto-Draw: Enable automatic card drawing (6 card starting hand + draw at Setup phase)",endedOnTurn:"Ended on Turn",nextRound:"Next:",victoryCondition:"Victory Condition:",win2RoundsMatch:"* Win 2 rounds to win the match. ",max5RoundsInfo:"Max 5 Rounds.",matchComplete:"Match Complete",thankYouPlaying:"Thank you for playing New Avalon: Skirmish.",returnToMenu:"Return to Menu",continueGame:"View Battlefield",startRound:"Start Round",youLabel:"(You)",readyToStart:"Ready to Start?",gameWillBegin:"The game will begin once all players are ready. You can still change your name and deck.",dragCardsReorder:"Drag cards to reorder. Drag outside to move card to another zone.",dragOutsideAnotherZone:"Drag outside to move card to another zone.",ready:"Ready",dragOutsideToMove:"Drag outside to move card to another zone.",empty:"Empty",dragOutsideToPlaceToken:"Drag outside to place token on the board.",holdRightClickViewHints:"Hold right click to view hints",gameSettings:"Game Settings",invitePlayer:"Invite Player",hiddenGame:"Privacy",private:"Private",public:"Public",copyInviteLink:"Copy invite link",copyGameLink:"Copy Game Link",copied:"Copied!",inviteLinkDesc:"Send link to a friend. Server address will configure automatically.",copyGameLinkDesc:"Share this link so friends can join with your server settings pre-configured.",on:"ON",off:"OFF",dummyPlayers:"Dummies",gridSize:"Grid Size",autoAbilities:"Auto Abilities",gameMode:"Game Mode","2v2":"2v2","3v1":"3v1",copy:"Copy",reconnect:"Reconnect",hideDummyCards:"Hide Dummy Cards",hideDummyCardsTooltip:"Hide cards in dummy players hands like real players",clearCache:"Clear Cache",clearCacheDesc:"Clear all saved data and reload the page",cacheCleared:"Cache cleared! Reloading...",saveJson:"Save JSON",saveText:"Save Text",loadTextDeck:"Load Text",cannotSaveEmptyDeck:"Cannot save an empty deck.",failedToParseDeckFile:"Failed to parse deck file.",webrtcMode:"WebRTC Mode",webrtcModeDesc:"Enable peer-to-peer connection to play without a central server (Host acts as server)",peerToPeer:"Peer-to-Peer",directConnection:"Direct connection between browsers",hostGame:"Host Game",hostGameDesc:"Host a game using WebRTC - no central server needed",copyHostLink:"Copy Host Link",hostLinkCopied:"Host link copied!",joinAsGuest:"Join Game (P2P)",enterHostId:"Enter Host ID or link",invalidHostId:"Invalid Host ID",connectingToHost:"Connecting to host...",connectedToHost:"Connected to host",hostDisconnected:"Host disconnected",guestDisconnected:"Guest disconnected",guestConnected:"Guest connected"},Vr={title:"New Avalon: Skirmish Game Rules",conceptTitle:"I. Basic Concept",conceptText:`**Genre and Player Role:** New Avalon: Skirmish is a dynamic tactical card game played on a limited grid field. Players take on the roles of faction leaders, deploying Units and Commands to capture control over key battle lines.

**Explanation:** The game focuses on positional control and ability activation timing, not just direct attacks. Victory is achieved by earning Victory Points (VP), based on the strength of units in selected lines.`,winConditionTitle:"II. Victory Conditions",winConditionText:`**Match Victory Conditions:** The match is played to 2 round wins. The first player to achieve 2 round wins immediately wins the match.
**Draw Explanation:** If, at the end of any round, multiple players simultaneously reach 2 round wins, all are declared match winners.

**Round Victory Conditions (Thresholds and Turn Limit):** A round ends as soon as one or more players reach the Victory Point (VP) threshold or after completion of turn 5.
**Turn Limit:** Each round is limited to 5 full turns per player. If the VP threshold is not reached, final scoring occurs at the end of turn 5.

**Threshold Values:**
- Round 1: 20 Victory Points (VP).
- Round 2: 30 Victory Points (VP).
- Round 3 onwards: Threshold increases by +10 VP relative to previous round (e.g., Round 3 — 40 VP).

**Determining Round Winner and Draw:** The round winner is the player who reached the threshold value or the player with the most VPs after the turn limit.
**Round Draw Explanation:** If, at the end of the round, two or more players have the same and highest point total, all are declared round winners.`,fieldTitle:"III. Battlefield and Components",fieldText:`**Battlefield (Grid):** The game is played on a square grid whose size changes based on total participants.
**Size Explanation:**
- 2 players: 5x5 cell field.
- 3 players: 6x6 cell field.
- 4 players: 7x7 cell field.

**Position Determination:**
- **Line:** An entire horizontal row or vertical column. Used for scoring mechanics.
- **Adjacency:** Cells are considered adjacent only horizontally and vertically (orthogonally). Diagonal adjacency is not considered unless otherwise stated on a card.

**Cards:** The game uses two main card types played from Hand:
- **Units:** Basic combat units with Power and Abilities. Remain on battlefield until destroyed.
- **Commands:** Instant action cards. Played, execute effect (often offering "2 of 3 options"), and go to Discard.

**Play Zones:**
- **Hand:** Cards hidden from opponents.
- **Discard:** Zone where destroyed Units and played Commands go.
- **Showcase (Announced):** Temporary zone where a Command card is placed before being played.`,setupTitle:"IV. Game Start (Setup)",setupText:`**Deck Formation:** Before match start, each player chooses a faction or builds a deck according to building rules (minimum 30 cards).
**Explanation:** Cards in deck are shuffled.

**Starting Hand:** Each player draws 6 cards from their deck, forming the starting hand.
**Hidden Information Explanation:** Cards in hand are hidden from opponents.

**Mulligan:** At game start, after receiving starting hand (6 cards), player has the right to shuffle any number of cards from hand back into deck and draw same number of new cards from top.

**Determining First Player:** Determine first active player by any convenient method (e.g., coin toss).
**Explanation:** Play proceeds alternately, starting with first player. First player begins their first turn immediately with Setup Phase.`,abilitiesTitle:"V. Card Abilities",abilitiesText:`**Ability Types:**
- **Deploy:** Activates automatically and immediately when card is placed from hand onto field face-up.
- **Setup:** Activates automatically at start of Setup Phase of each of your turns (before drawing), if card already lies on field face-up.
- **Commit:** Activates automatically at start of Commit Phase of each of your turns, if card already lies on field face-up.
- **Pass (Passive):** Effect applies continuously while card is on field in face-up state.

**Execution Conditions (⇒):**
Many abilities have requirement marked by arrow (e.g., **Support ⇒ Deploy:** ...).
- This means "CONDITION CHECK ⇒ EFFECT".
- If condition left of arrow (e.g., presence of Support status) is not met at activation time, ability **does not activate** at all.

**Important Rules:**
- **Stun:** Stunned cards (with Stun token) **do not activate** their abilities (neither Deploy, nor phase, nor passive).
- **Face-down:** Cards lying face-down have no abilities.
- **Obligation:** If ability activated (conditions met), you **must** apply its effect if legal targets exist. If no legal targets, ability applies fruitlessly (burns).`,statusesTitle:"VI. Dynamic Statuses (Positioning)",statusesText:`Dynamic statuses are calculated automatically and continuously upon any board change. Units with Stun status cannot give or participate in calculation of these statuses.

**Support:** Unit has Support status if in at least one adjacent cell (horizontally or vertically) there is an allied unit.
**Stun/Support Explanation:** Unit with Stun token is not considered in Support calculation for adjacent allies.
**Value:** Presence of Support is condition for activating many powerful abilities, marked by syntax Support ⇒ [Effect].

**Threat:** Unit gains Threat status if located in dangerous position created by enemy units.
**Condition Explanation:** Threat status is assigned in one of two situations:
1. **Pincers:** Unit is caught by cards of one opponent from any two sides (two adjacent or two opposite).
2. **Pressure:** Unit is on battlefield edge and has at least one opponent card adjacent.
**Stun/Threat Explanation:** Unit with Stun token is not considered in Threat calculation for adjacent enemies.
**Value:** Units under Threat are vulnerable targets for powerful control and destruction abilities.`,countersTitle:"VII. Tokens (Counters)",countersText:`Tokens are permanent markers placed by card abilities. Remain on unit until removed or unit destroyed.

**Stun:**
- **Effect:** Unit with Stun gives 0 Victory Points in scoring phase, cannot activate its abilities and cannot be moved by its owner (but can be moved by opponents).
- **Removal:** At end of Commit phase, 1 Stun token is automatically removed from each unit of active player.

**Shield:**
- **Effect:** If ability attempts to Destroy this unit, destruction effect is prevented, and 1 Shield token is removed from unit instead. Unit remains on field.

**Revealed and Face-down Cards:**
- **Revealed:** Enables token owner to see hidden card information.
- **Face-down Explanation:** Card played face-down has no Power or Abilities and gives 0 points. If such card receives Revealed token, its information (face) becomes visible to opponent, but card is still considered face-down for all game purposes (power, abilities).

**Special Tokens (Aim, Exploit):**
- **Aim and Exploit:** These tokens are markers for faction ability interaction (e.g., snipers or hackers). Have no gameplay effect by themselves.

**Last Played:**
- **Effect:** Temporary status automatically assigned to card last played onto field by active player in current turn. This status determines line player must choose for scoring.`,turnTitle:"VIII. Turn Structure and Timing",turnText:`Turn passes from player to player. Card abilities activate only in their owner's turn. Active player's turn consists of four sequential phases:

**1. Setup Phase:**
- **Draw:** Active player draws 1 card from deck into hand.
- **Abilities:** Activate abilities of all cards on field with keyword **Setup:**.
**Explanation:** This phase is for hand replenishment and initial unit positioning.

**2. Main Phase (Action/Deployment):**
- **Main Action:** Active player may perform one of following actions:
  - Play Unit card (**Deploy:**) from hand onto any free field cell. Immediately activates its Deploy: ability.
  - Play Command card from hand.
  - Pass.
**Command Explanation:** Command cards can be played in any number during this phase — before, after, or between unit deployments.

**3. Commit Phase (Finalization):**
- **Abilities:** Activate abilities of all cards on field with keyword **Commit:**.
- **Stun Removal:** At end of this phase, 1 Stun token is automatically removed from each unit of active player.
**Explanation:** Phase used for applying control effects and gaining resources before scoring.

**4. Scoring Phase:**
- **Line Selection:** Active player must choose one Line (Row or Column) passing through their card with **Last Played** status.
- **Calculation:** Sum Power of all active player's units in selected line and add total to player's overall score.`,mechanicsTitle:"IX. Conflict Resolution and Key Mechanics",mechanicsText:`**Stun and Scoring:**
- **Effect:** Unit with Stun status or lying Face-down gives 0 points in scoring phase, regardless of its base Power, permanent power modifiers, or passive abilities that give points (e.g., Spotter).

**Last Played Status Transfer:**
- **Destruction:** If card with Last Played status leaves battlefield (destroyed, returned to hand/deck) before Scoring Phase, status transfers to previous played card of this player (the one that was Last Played in previous turn).
- **Movement:** If card with Last Played moves to another cell, player chooses its new lines in Scoring Phase.
- **Absence:** If player has no card with Last Played status, player cannot choose line and gets no points this turn.

**Unit Movement (Push, Swap):**
- **Push:** Unit forces another card to move to adjacent cell. Push is blocked (does not happen) if target cell is occupied or field edge. Other ability effects apply to target.
- **Swap:** Enables two cards to exchange places, even if both cells are occupied.

**Resurrection:**
- **"Burning" Mechanic:** Card returned to battlefield from Discard (resurrected) immediately gains **Resurrected** status at moment of Deploy. At start of next phase (on phase change) this status is removed and card receives two Stun tokens.`,creditsTitle:"X. Game Authors",creditsText:`**Author:** Nikita Anahoret

**AI Used:**
Google AI Studio, Claude Code, Gemini, ChatGPT

**Special Thanks:**
- Vasilisa Versus
- Kirill Tomashchuk
- Andrey Markosov
- Mitya Shepelin

For questions and suggestions write on [Telegram](https://t.me/NeurohoretApp) or [Discord](https://discord.gg/U5zKADsZZY).
You can support game development and authors through [DonationAlerts](https://www.donationalerts.com/r/anahoret) and [Patreon](https://www.patreon.com/AnchoriteComics).`},Ja={};mr.forEach((t,n)=>{Ja[n]={name:t.name,ability:t.ability,flavorText:t.flavorText}});pr.forEach((t,n)=>{Ja[n]={name:t.name,ability:t.ability,flavorText:t.flavorText}});const eo={};Object.entries(Yn).forEach(([t,n])=>{eo[t]={name:n.name,description:n.description}});const Gr={deploy:"Deploy",setup:"Setup",commit:"Commit",support:"Support",threat:"Threat",pass:"Pass",aim:"Aim",exploit:"Exploit",stun:"Stun",shield:"Shield",gain:"Gain",point:"Point",points:"Points",reveal:"Reveal",move:"Move",draw:"Draw",push:"Push",sacrifice:"Sacrifice",discard:"Discard"},Br={unit:"Unit",command:"Command",hero:"Hero",rarity:"Rarity",structure:"Structure",gear:"Gear",event:"Event",attachment:"Attachment"},Hr={SynchroTech:"SynchroTech",Hoods:"Hoods",Optimates:"Optimates",Fusion:"Fusion"},bt={abilityKeywords:Gr,cardTypes:Br,ui:Fr,rules:Vr,cards:Ja,counters:eo,deckNames:Hr},mt={en:bt,ru:_r,sr:Ur,de:bt,fr:bt,it:bt,pt:bt,zh:bt,hi:bt,es:bt,ar:bt,uk:bt,be:bt,tt:bt},Ks=["en","ru","sr"],qs={en:"English",ru:"Русский",de:"Deutsch",fr:"Français",it:"Italiano",pt:"Português",zh:"中文",hi:"हिन्दी",es:"Español",ar:"العربية",uk:"Українська",be:"Беларуская",tt:"Татарча",sr:"Srpski"},to=r.createContext(void 0),Wr=({children:t})=>{const[n,o]=r.useState("en");r.useEffect(()=>{const u=localStorage.getItem("app_language");u&&u in mt&&o(u)},[]);const l=u=>{o(u),localStorage.setItem("app_language",u)},d=u=>mt[n].ui[u]||mt.en.ui[u]||u,a=u=>mt[n].cards[u]||mt.en.cards[u],i=u=>mt[n].counters[u]||mt.en.counters[u],m=u=>{const f=mt[n].deckNames,y=mt.en.deckNames;return f[u]||y[u]};return e.jsx(to.Provider,{value:{language:n,setLanguage:l,t:d,getCardTranslation:a,getCounterTranslation:i,getDeckTranslation:m,resources:mt[n],isRTL:!1},children:e.jsx("div",{dir:"ltr",children:t})})},rt=()=>{const t=r.useContext(to);if(!t)throw new Error("useLanguage must be used within a LanguageProvider");return t},ao=({x:t,y:n,children:o})=>{const l=r.useRef(null),[d,a]=r.useState({top:n+20,left:t+20});return r.useLayoutEffect(()=>{if(l.current){const{innerWidth:i,innerHeight:m}=window,{offsetWidth:b,offsetHeight:u}=l.current;let f=t+20;f+b>i&&(f=t-b-20),f<5&&(f=5);let y=n+20;y+u>m&&(y=n-u-20),y<5&&(y=5),a({top:y,left:f})}},[t,n,o]),Zn.createPortal(e.jsx("div",{ref:l,className:"fixed bg-gray-900 border border-gray-700 rounded-md shadow-lg z-[99999] p-3 text-white text-base pointer-events-none transition-opacity duration-100",style:{top:d.top,left:d.left,opacity:1},children:o}),document.body)},Za=({card:t,statusDescriptions:n,className:o,hideOwner:l=!1,powerPosition:d="default"})=>{var g;const{resources:a,getCardTranslation:i}=rt(),m=a.abilityKeywords,b=a.cardTypes,u=t.baseId?i(t.baseId):void 0,f=(u==null?void 0:u.name)||t.name,y=(u==null?void 0:u.ability)||t.ability,C=(g=t.types)!=null&&g.length?t.types.map(P=>b[P]||P).join(", "):t.deck==="counter"?"":`${t.deck} Card`,x=["readyDeploy","readySetup","readyCommit","setupUsedThisTurn","commitUsedThisTurn"],p=(t.statuses??[]).reduce((P,z)=>(x.includes(z.type)||(P[z.type]=(P[z.type]||0)+1),P),{}),v=Object.keys(p).length>0,h=t.ownerName||(t.ownerId?`Player ${t.ownerId}`:null),O=t.ability?t.ability.length:0,T=v?Object.keys(p).length*10:0,A=O>35||T>35,U=o||"relative flex flex-col text-left w-max max-w-[90vw]",S=d==="inner"?{powerContainer:"absolute top-[2px] right-[2px] w-4 h-4 rounded-full bg-gray-700 border border-gray-500 flex items-center justify-center text-xs font-bold"}:null;return e.jsxs("div",{className:U,children:[e.jsxs("div",{className:"mb-1 pr-1 relative min-w-0",children:[e.jsx("div",{className:"font-bold text-white text-lg leading-tight mb-0.5 truncate",children:f}),C&&e.jsx("div",{className:"text-xs text-gray-400 font-semibold truncate",children:C}),S&&t.power&&t.power>0&&e.jsx("div",{className:S.powerContainer,children:t.power})]}),e.jsxs("div",{className:`flex flex-col ${!o&&A?"w-[16rem]":"w-full"} whitespace-normal break-words`,children:[y&&e.jsx("hr",{className:"border-gray-600 mt-[0px] mb-[2px]"}),y&&e.jsx("div",{className:"text-sm text-gray-200 leading-snug",children:qa(y,m)}),y&&e.jsx("hr",{className:"border-gray-600 my-[4px]"}),v&&e.jsx("div",{className:"text-xs text-gray-200 leading-snug",children:Object.entries(p).map(([P,z],R,$)=>e.jsxs("span",{children:[e.jsx("span",{className:"font-bold text-indigo-300",children:P}),z>1&&e.jsxs("span",{className:"text-gray-400 ml-1",children:["(x",z,")"]}),(n==null?void 0:n[P])&&e.jsxs("span",{className:"text-gray-400 ml-1",children:["(",n[P],")"]}),R<$.length-1?e.jsx("span",{className:"text-gray-400 mr-1",children:", "}):""]},P))}),v&&h&&!l&&e.jsx("hr",{className:"border-gray-600 my-[2px]"}),h&&!l&&e.jsxs("div",{className:"text-xs text-gray-500 font-semibold",children:["Owner: ",e.jsx("span",{className:"text-gray-300",children:h})]})]})]})},Kr="res.cloudinary.com/dxxh6meej";function Tt(t){return t.includes(Kr)}function qr(t){if(!t||!Tt(t))return!1;const n=t.indexOf("/image/upload/");if(n===-1)return!1;const o=t.substring(n+14),l=o.indexOf("/");if(l===-1)return!1;const d=o.substring(0,l);return!/^v\d+/.test(d)}function Ya(t,n){if(!t||!Tt(t)||qr(t))return t;const o=(n==null?void 0:n.quality)??"auto",l=(n==null?void 0:n.format)??"auto",d=[`q_${o}`,`f_${l}`];n!=null&&n.width&&d.push(`w_${n.width}`),n!=null&&n.height&&d.push(`h_${n.height}`),n!=null&&n.blur&&d.push(`e_blur:${n.blur}`);const a=t.indexOf("/image/upload/");if(a===-1)return t;const i=t.substring(0,a+14),m=t.substring(a+14);return`${i}${d.join(",")}/${m}`}function Pt(t,n=200){return!t||!Tt(t)?t:Ya(t,{quality:"auto",format:"auto",width:n})}function nt(t,n){if(!t||!n)return t;const o=t.includes("?")?"&":"?";return`${t}${o}v=${n}`}class Jr{constructor(){this.loadAttempts=new Map,this.loadedUrls=new Set,this.failedUrls=new Set}isLoaded(n){return this.loadedUrls.has(n)}hasFailed(n){return this.failedUrls.has(n)}getAttemptCount(n){return this.loadAttempts.get(n)||0}markLoaded(n){this.loadedUrls.add(n),this.failedUrls.delete(n)}markFailed(n){this.failedUrls.add(n)}incrementAttempts(n){const o=(this.loadAttempts.get(n)||0)+1;return this.loadAttempts.set(n,o),o}reset(n){this.loadedUrls.delete(n),this.failedUrls.delete(n),this.loadAttempts.delete(n)}clear(){this.loadAttempts.clear(),this.loadedUrls.clear(),this.failedUrls.clear()}}const St=new Jr,Ca=r.memo(({type:t,playerId:n,count:o,refreshVersion:l,playerColorMap:d,smallStatusIcons:a=!1})=>{const i=d.get(n),m=i&&ot[i]?ot[i].bg:"bg-gray-500",[b,u]=r.useState("loading"),[f,y]=r.useState(null),C=r.useMemo(()=>{let S=ma[t];if(S){S=Ya(S,{width:64});const g=S.includes("?")?"&":"?";S=`${S}${g}v=${l}`}return S},[t,l]);r.useEffect(()=>{y(C),u("loading")},[C]);const x=r.useCallback(()=>{u("loaded")},[]),p=r.useCallback(()=>{const g=St.incrementAttempts(f||"");if(g<=2){const P=Math.min(500*Math.pow(2,g-1),2e3);setTimeout(()=>{if(f){const z=f.includes("?")?"&":"?";y(`${f}${z}retry=${Date.now()}`)}},P)}else u("failed")},[f]),v=["Support","Threat","Revealed","LastPlayed"].includes(t),h=!v&&o>1,O=h?"p-1.5":"p-1",T=a?"w-6 h-6":"w-8 h-8",A=a?h?"text-xs":"text-base":h?"text-base":"text-lg",U=a?"text-[10px]":"text-xs";return e.jsxs("div",{className:`relative ${T} flex items-center justify-center ${m} bg-opacity-80 rounded-sm shadow-md flex-shrink-0`,title:`${t} (Player ${n}) ${!v&&o>0?`x${o}`:""}`,children:[f&&b!=="failed"?e.jsx("img",{src:f,onLoad:x,onError:p,alt:t,className:`object-contain w-full h-full transition-all duration-150 ${O}`}):e.jsx("span",{className:`text-white font-black transition-all duration-150 ${A}`,style:{textShadow:"0 0 2px black"},children:t.charAt(0)}),h&&e.jsx("span",{className:`absolute top-0 right-0.5 text-white font-bold ${U} leading-none`,style:{textShadow:"1px 1px 2px black"},children:o})]})}),Zr=r.memo(({card:t,isFaceUp:n,playerColorMap:o,localPlayerId:l,imageRefreshVersion:d,disableTooltip:a=!1,smallStatusIcons:i=!1,activePhaseIndex:m,activePlayerId:b,disableActiveHighlights:u=!1,extraPowerSpacing:f=!1,hidePower:y=!1,loadPriority:C="high",disableImageTransition:x=!1,playerColor:p,preserveDeployAbilities:v=!1,activeAbilitySourceCoords:h=null,boardCoords:O=null,abilityCheckKey:T,onCardClick:A,targetingMode:U=!1,triggerClickWave:S})=>{var ut;const{getCardTranslation:g}=rt(),[P,z]=r.useState(!1),[R,$]=r.useState({x:0,y:0}),G=r.useRef(null),[pe,je]=r.useState(!1),Ne=C==="high",_=Ne?384:128,oe=Ne?128:64,ee=r.useRef(null),[te,De]=r.useState(()=>{if(!t.imageUrl)return t.imageUrl||"";const H=Tt(t.imageUrl)?Pt(t.imageUrl,oe):t.imageUrl;return nt(H,d)}),[J,we]=r.useState(()=>{const H=nt(t.imageUrl||"",d);return H&&St.isLoaded(H)?"loaded":H&&St.hasFailed(H)?"failed":"loading"}),Te=r.useRef(null),[V,L]=r.useState(!1),q=t.baseId?g(t.baseId):void 0,X=q?{...t,...q}:t;r.useEffect(()=>{L(!1)},[m,T]),r.useEffect(()=>{u||L(!1)},[u]),r.useEffect(()=>{if(!t.imageUrl)return;if(!Tt(t.imageUrl)){const de=nt(t.imageUrl,d);De(Oe=>Oe===de?Oe:de),we("loaded"),ee.current=de;return}const H=Pt(t.imageUrl,oe),ie=Pt(t.imageUrl,_),Q=nt(H,d),W=nt(ie,d),I=St.isLoaded(W)||ee.current===W,K=()=>{De(de=>de===W?de:W),we("loaded"),ee.current=W,W&&St.markLoaded(W)};if(I){De(de=>de===W?de:W),we("loaded"),ee.current=W;return}De(de=>de===W||de===Q?de:Q);const Ce=new Image;return Ce.onload=K,Ce.onerror=()=>{console.warn("Failed to load target image:",W),we("loaded")},Ce.src=W,Ce.complete&&Ce.naturalWidth>0&&K(),()=>{Ce.onload=null,Ce.onerror=null}},[t.imageUrl,t.id,d,C,Ne,_,oe]);const M=te,B=r.useCallback(()=>{we("loaded"),M&&St.markLoaded(M)},[M]),ve=r.useCallback(()=>{const ie=St.incrementAttempts(M);if(ie<=3){const Q=Math.min(1e3*Math.pow(2,ie-1),5e3);Te.current&&clearTimeout(Te.current),Te.current=window.setTimeout(()=>{const W=M.includes("?")?"&":"?";De(`${M}${W}retry=${Date.now()}`)},Q)}else{let Q=t.fallbackImage;d&&Q&&(Q=nt(Q,d)),M!==Q&&Q?(De(Q),St.reset(Q)):(we("failed"),St.markFailed(M))}},[M,t.fallbackImage,d]);r.useEffect(()=>()=>{Te.current&&clearTimeout(Te.current)},[]);const he=(ut=t.types)==null?void 0:ut.includes("Hero");r.useEffect(()=>{if(!he||!n){je(!1);return}let H,ie;const Q=()=>{const W=3e3+Math.random()*500;H=window.setTimeout(()=>{je(!0),ie=window.setTimeout(()=>{je(!1),Q()},750)},W)};return Q(),()=>{H!==void 0&&window.clearTimeout(H),ie!==void 0&&window.clearTimeout(ie)}},[he,n]);const ce=r.useCallback(H=>{a||((H.clientX!==0||H.clientY!==0)&&$({x:H.clientX,y:H.clientY}),!P&&!G.current&&(G.current=window.setTimeout(()=>{z(!0)},250)))},[a,P]),se=r.useCallback(H=>{if(!a){if((H.clientX!==0||H.clientY!==0)&&$({x:H.clientX,y:H.clientY}),t.imageUrl&&Tt(t.imageUrl)){const ie=Ya(t.imageUrl,{width:300}),Q=nt(ie,d);gr.preload(Q,"normal")}G.current&&clearTimeout(G.current),G.current=window.setTimeout(()=>{z(!0)},250)}},[a,t.imageUrl,d]),lt=r.useCallback(()=>{G.current&&(clearTimeout(G.current),G.current=null),z(!1)},[]),yt=r.useCallback(()=>{G.current&&(clearTimeout(G.current),G.current=null),z(!1)},[]),Ee=Xn(t,m??0,b),qe=O&&h&&O.row===h.row&&O.col===h.col,ke=!u&&!V&&Ee&&!qe&&!U,xt=r.useCallback(H=>{(A||ke)&&H.stopPropagation(),S&&O&&l!==null&&S("board",O),ke&&l===t.ownerId&&L(!0),A&&O&&A(t,O)},[ke,l,t,A,O,S]),et=r.useMemo(()=>{const H=["readyDeploy","readySetup","readyCommit","setupUsedThisTurn","commitUsedThisTurn"];return(t.statuses??[]).reduce((ie,Q)=>{if(H.includes(Q.type))return ie;const W=`${Q.type}_${Q.addedByPlayerId}`;return ie[W]||(ie[W]={type:Q.type,playerId:Q.addedByPlayerId,count:0}),ie[W].count++,ie},{})},[t.statuses]),Ae=r.useMemo(()=>{if(p)return ot[p]||null;const H=t.ownerId?o.get(t.ownerId):null;return t.ownerId&&!H&&console.warn(`[Card] Owner color not found for card ${t.id}, ownerId: ${t.ownerId}, playerColorMap size: ${o.size}`),H&&ot[H]?ot[H]:null},[t.ownerId,o,p]),ne=r.useMemo(()=>Object.values(et).sort((H,ie)=>H.type!==ie.type?H.type.localeCompare(ie.type):H.playerId-ie.playerId),[et]),{currentPower:Je,powerTextColor:dt}=r.useMemo(()=>{const H=(t.powerModifier||0)+(t.bonusPower||0),ie=Math.max(0,t.power+H);let Q="text-white";return H>0?Q="text-green-400":H<0&&(Q="text-red-500"),{currentPower:ie,powerTextColor:Q}},[t.power,t.powerModifier,t.bonusPower]),Ze=r.useMemo(()=>P&&n&&!a&&R.x>0&&R.y>0,[P,n,a,R.x,R.y]);if(t.deck==="counter")return e.jsx("div",{title:X.name,className:`w-full h-full ${t.color} shadow-md`,style:{clipPath:"polygon(30% 0%, 70% 0%, 100% 30%, 100% 70%, 70% 100%, 30% 100%, 0% 70%, 0% 30%)"}});const ct=f?"bottom-[10px] right-[10px]":"bottom-[5px] right-[5px]";return e.jsxs(e.Fragment,{children:[n?(()=>{var st;const H=Ae?Ae.border:((st=Fa[t.deck])==null?void 0:st.color)||"border-gray-300",ie=t.deck===Qe.Tokens?typeof t.color=="string"?t.color:"bg-gray-500":"bg-card-face",Q=(t.deck===Qe.Tokens,"text-black"),W=["Support","Shield"],I=ne.filter(Pe=>W.includes(Pe.type)),K=ne.filter(Pe=>!W.includes(Pe.type)&&Pe.type!=="LastPlayed"),Ce=ne.find(Pe=>Pe.type==="LastPlayed"),de=Ce?[Ce,...I]:I,Oe=Ae?Ae.glow:"shadow-[0_0_15px_#ffffff]",Ie=ke?`border-[5px] shadow-2xl ${Oe}`:"border-4",Ye=t.ownerId?o.get(t.ownerId):null,le=Ye?ua[Ye]||{r:255,g:255,b:255}:null,_e=le?{r:Math.min(255,Math.round(le.r*1.3)),g:Math.min(255,Math.round(le.g*1.3)),b:Math.min(255,Math.round(le.b*1.3))}:null,vt=ke&&le?{background:`radial-gradient(circle at center, transparent 20%, rgba(${le.r}, ${le.g}, ${le.b}, 0.5) 100%)`,boxShadow:_e?`inset 0 0 12px rgba(${_e.r}, ${_e.g}, ${_e.b}, 0.5)`:void 0,border:"5px solid",borderColor:"rgb(255, 255, 255)"}:{},Ge=ke&&le?e.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{background:`radial-gradient(circle at center, transparent 37.5%, rgba(${le.r}, ${le.g}, ${le.b}, 0.5) 100%)`,mixBlendMode:"normal",filter:"brightness(1.35)"}}):null;return e.jsxs("div",{onMouseEnter:se,onMouseLeave:lt,onMouseMove:ce,onMouseDown:yt,onClick:xt,style:vt,className:`relative w-full h-full ${ie} rounded-md shadow-md ${Ie} ${H} ${Q} flex-shrink-0 select-none overflow-hidden transition-all duration-300 ${ke?"scale-[1.10] z-10":""}`,children:[M?e.jsxs(e.Fragment,{children:[J==="failed"?e.jsx("div",{className:"absolute inset-0 w-full h-full bg-gradient-to-br from-gray-700 to-gray-900 flex items-center justify-center p-2",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:t.deck}),e.jsx("span",{className:"text-center text-sm font-bold text-white break-words",children:X.name}),t.power>0&&!y&&e.jsx("div",{className:"text-lg font-bold text-white mt-1",children:t.power})]})}):e.jsx("img",{src:M,onLoad:B,onError:ve,alt:X.name,className:`absolute inset-0 w-full h-full object-cover ${J==="loading"?"opacity-0":"opacity-100"}`,style:x?void 0:{transition:"opacity 0.15s ease-out"}}),Ge,he&&e.jsx("div",{className:`absolute inset-0 hero-foil-overlay ${pe?"animating":""}`})]}):e.jsx("div",{className:"w-full h-full p-1 flex items-center justify-center",children:e.jsx("span",{className:"text-center text-sm font-bold",children:X.name})}),ne.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute top-[3px] left-[3px] right-[3px] flex flex-row-reverse flex-wrap justify-start items-start z-10 pointer-events-none",children:K.map(Pe=>e.jsx(Ca,{type:Pe.type,playerId:Pe.playerId,count:Pe.count,refreshVersion:d,playerColorMap:o,smallStatusIcons:i},`${Pe.type}_${Pe.playerId}`))}),e.jsx("div",{className:"absolute bottom-[3px] left-[3px] right-[30px] flex flex-wrap-reverse content-start items-end z-10 pointer-events-none",children:de.map(Pe=>e.jsx(Ca,{type:Pe.type,playerId:Pe.playerId,count:Pe.count,refreshVersion:d,playerColorMap:o,smallStatusIcons:i},`${Pe.type}_${Pe.playerId}`))})]}),t.power>0&&!y&&e.jsx("div",{className:`absolute ${ct} w-8 h-8 rounded-full ${Ae?Ae.bg:"bg-gray-600"} border-[3px] border-white flex items-center justify-center z-20 shadow-md`,children:e.jsx("span",{className:`${dt} font-bold text-lg leading-none`,style:{textShadow:"0 0 2px black"},children:Je})})]})})():(()=>{const H=Ae?Ae.bg:"bg-card-back",ie=Ae?Ae.border:"border-blue-300",Q=ne.find(I=>I.type==="LastPlayed"),W=ne.filter(I=>I.type==="Revealed");return e.jsxs("div",{onMouseEnter:se,onMouseLeave:lt,onMouseMove:ce,onMouseDown:yt,className:`relative w-full h-full ${H} rounded-md shadow-md border-2 ${ie} flex-shrink-0 transition-transform duration-300 ${ke?"scale-[1.10] z-10":""}`,children:[W.length>0&&e.jsx("div",{className:"absolute top-[3px] left-[3px] flex flex-wrap gap-0.5 pointer-events-none",children:W.map(I=>e.jsx(Ca,{type:I.type,playerId:I.playerId,count:I.count,refreshVersion:d,playerColorMap:o,smallStatusIcons:i},I.type+"_"+I.playerId))}),Q&&e.jsx("div",{className:"absolute bottom-[3px] left-[3px] pointer-events-none",children:e.jsx(Ca,{type:Q.type,playerId:Q.playerId,count:Q.count,refreshVersion:d,playerColorMap:o,smallStatusIcons:i})})]})})(),Ze&&e.jsx(ao,{x:R.x,y:R.y,children:e.jsx(Za,{card:X})})]})}),Yr=(t,n)=>{var i,m,b,u,f,y,C,x;if(t.card.id!==n.card.id||t.isFaceUp!==n.isFaceUp||t.card.imageUrl!==n.card.imageUrl||t.card.fallbackImage!==n.card.fallbackImage||t.card.name!==n.card.name||t.card.deck!==n.card.deck||t.card.color!==n.card.color||t.card.baseId!==n.card.baseId)return!1;const o=t.card.types||[],l=n.card.types||[];if(o.length!==l.length)return!1;for(let p=0;p<o.length;p++)if(o[p]!==l[p])return!1;if(t.imageRefreshVersion!==n.imageRefreshVersion||t.smallStatusIcons!==n.smallStatusIcons||t.extraPowerSpacing!==n.extraPowerSpacing||t.hidePower!==n.hidePower||t.loadPriority!==n.loadPriority||t.disableImageTransition!==n.disableImageTransition||t.disableTooltip!==n.disableTooltip||t.disableActiveHighlights!==n.disableActiveHighlights||t.preserveDeployAbilities!==n.preserveDeployAbilities||t.activePhaseIndex!==n.activePhaseIndex||t.activePlayerId!==n.activePlayerId||t.localPlayerId!==n.localPlayerId||((i=t.activeAbilitySourceCoords)==null?void 0:i.row)!==((m=n.activeAbilitySourceCoords)==null?void 0:m.row)||((b=t.activeAbilitySourceCoords)==null?void 0:b.col)!==((u=n.activeAbilitySourceCoords)==null?void 0:u.col)||((f=t.boardCoords)==null?void 0:f.row)!==((y=n.boardCoords)==null?void 0:y.row)||((C=t.boardCoords)==null?void 0:C.col)!==((x=n.boardCoords)==null?void 0:x.col)||t.abilityCheckKey!==n.abilityCheckKey||t.targetingMode!==n.targetingMode)return!1;const d=t.card.statuses||[],a=n.card.statuses||[];if(d.length!==a.length)return!1;for(let p=0;p<d.length;p++){const v=d[p],h=a[p];if(!h||v.type!==h.type||v.addedByPlayerId!==h.addedByPlayerId)return!1}return!(t.card.power!==n.card.power||t.card.powerModifier!==n.card.powerModifier||t.card.bonusPower!==n.card.bonusPower||t.card.ownerId!==n.card.ownerId||t.card.ownerId&&n.card.ownerId&&t.playerColorMap.get(t.card.ownerId)!==n.playerColorMap.get(n.card.ownerId)||t.playerColor!==n.playerColor)},Nt=r.memo(Zr,Yr),no=r.memo(t=>{const{row:n,col:o,cell:l,isGameStarted:d,handleDrop:a,draggedItem:i,setDraggedItem:m,openContextMenu:b,playMode:u,setPlayMode:f,playerColorMap:y,localPlayerId:C,onCardDoubleClick:x,onEmptyCellDoubleClick:p,imageRefreshVersion:v,cursorStack:h,currentPhase:O,activePlayerId:T,onCardClick:A,onEmptyCellClick:U,isValidTarget:S,isTargetingModeValidTarget:g,targetingModePlayerId:P,targetingModeOriginalOwnerId:z,showNoTarget:R,disableActiveHighlights:$,preserveDeployAbilities:G,abilitySourceCoords:pe,abilityCheckKey:je,setCursorStack:Ne,onCancelAllModes:_,triggerClickWave:oe}=t,[ee,te]=r.useState(!1),De=r.useCallback(ne=>{ne.preventDefault(),i&&a(i,{target:"board",boardCoords:{row:n,col:o}}),te(!1)},[i,a,n,o]),J=r.useCallback(()=>{if(!l.card&&oe&&C!==null&&oe("board",{row:n,col:o}),u){const ne={...u.sourceItem,card:{...u.sourceItem.card}};ne.card.isFaceDown=!!u.faceDown,a(ne,{target:"board",boardCoords:{row:n,col:o}}),f(null)}else l.card&&A?A(l.card,{row:n,col:o}):!l.card&&U&&U({row:n,col:o})},[u,l.card,A,U,a,f,n,o,oe,C]),we=r.useCallback(ne=>{ne.preventDefault();const Je=(i==null?void 0:i.source)==="counter_panel";(!l.card||l.card&&Je)&&te(!0)},[i,l.card]),Te=r.useCallback(()=>{te(!1)},[]),V=r.useCallback(ne=>{_&&_(),l.card||b(ne,"emptyBoardCell",{boardCoords:{row:n,col:o}})},[l.card,b,n,o,_]),L=r.useCallback(()=>{l.card||p({row:n,col:o})},[l.card,p,n,o]),q=r.useCallback(()=>{h||l.card&&m({card:l.card,source:"board",boardCoords:{row:n,col:o},isManual:!0,bypassOwnershipCheck:!0})},[l.card,m,n,o,h]),X=r.useCallback(ne=>{_&&_(),l.card&&b(ne,"boardItem",{card:l.card,boardCoords:{row:n,col:o}})},[l.card,b,n,o,_]),M=r.useCallback(ne=>{ne.stopPropagation(),!h&&l.card?x(l.card,{row:n,col:o}):J()},[h,l.card,x,J,n,o]),B=!!u,ve=!!h,he=!!l.card,ce="w-full h-full rounded-lg transition-colors duration-200 flex items-center justify-center relative",se=!!i&&(!he||he&&i.source==="counter_panel"),Ee=S||B&&!he||ve&&S,qe=l.card&&Xn(l.card,O??0,T),ke=S||qe,et=`bg-board-cell-active ${ee&&se?"bg-indigo-400 opacity-80":""} ${B&&he?"cursor-not-allowed":""} ${Ee?"cursor-pointer z-10":""}`,Ae=r.useMemo(()=>{var ut;const ne=l.card;if(!ne)return!1;const Je=ne.revealedTo==="all",dt=C!==null&&Array.isArray(ne.revealedTo)&&ne.revealedTo.includes(C),Ze=C!==null&&((ut=ne.statuses)==null?void 0:ut.some(H=>H.type==="Revealed"&&H.addedByPlayerId===C)),ct=ne.ownerId===C;return!ne.isFaceDown||Je||dt||Ze||ct||!1},[l.card,C]);return e.jsxs("div",{onDrop:De,onDragOver:we,onDragLeave:Te,onClick:J,onContextMenu:V,onDoubleClick:L,className:`${ce} ${et}`,"data-interactive":!l.card,"data-board-coords":`${n},${o}`,children:[R&&e.jsx("div",{className:"absolute inset-0 z-50 flex items-center justify-center pointer-events-none",children:e.jsx("img",{src:"https://res.cloudinary.com/dxxh6meej/image/upload/v1771365317/no_tarket_lndzoc.webp",alt:"No Target",className:"w-24 h-24 object-contain animate-fade-out drop-shadow-[0_0_5px_rgba(255,0,0,0.8)]"})}),g&&(P||z)&&(()=>{const ne=z??P,Je=ne!==void 0?y.get(ne):void 0,dt=Je&&ua[Je]?ua[Je]:{r:37,g:99,b:235},Ze=da(dt);return e.jsx("div",{className:"absolute inset-0 rounded-md pointer-events-none animate-glow-pulse",style:{zIndex:50,boxShadow:`0 0 12px 2px ${Dt(Ze,.5)}`,border:"3px solid",borderColor:"rgb(255, 255, 255)",background:`radial-gradient(circle at center, transparent 20%, ${Dt(dt,.5)} 100%)`}},`targeting-mode-${ne}`)})(),l.card&&e.jsx("div",{draggable:d&&!h,onDragStart:q,onDragEnd:()=>{setTimeout(()=>m(null),Ht.DRAG_END_FALLBACK)},onContextMenu:X,onDoubleClick:M,className:`w-full h-full ${d&&!h?"cursor-grab":"cursor-default"} relative ${ke?"z-40":"z-30"}`,"data-interactive":"true",children:e.jsx(Nt,{card:l.card,isFaceUp:Ae,playerColorMap:y,localPlayerId:C,imageRefreshVersion:v,loadPriority:"high",disableImageTransition:!0,activePhaseIndex:O,activePlayerId:T,disableActiveHighlights:$,preserveDeployAbilities:G,activeAbilitySourceCoords:pe,boardCoords:{row:n,col:o},abilityCheckKey:je,onCardClick:A,targetingMode:!!P,triggerClickWave:oe})},l.card.id)]})});no.displayName="GridCell";const Ln={4:"grid-cols-4 grid-rows-4",5:"grid-cols-5 grid-rows-5",6:"grid-cols-6 grid-rows-6",7:"grid-cols-7 grid-rows-7"},oo=r.memo(({textData:t,playerColorMap:n})=>{const o=r.useMemo(()=>{const l=n.get(t.playerId);return l&&An[l]?An[l]:"text-white"},[n,t.playerId]);return e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none z-[60] animate-float-up",children:e.jsx("span",{className:`text-4xl font-black ${o}`,style:{textShadow:"2px 2px 0 #000"},children:t.text})})});oo.displayName="FloatingTextOverlay";const ro=r.memo(({board:t,isGameStarted:n,activeGridSize:o,handleDrop:l,draggedItem:d,setDraggedItem:a,openContextMenu:i,playMode:m,setPlayMode:b,highlight:u,playerColorMap:f,localPlayerId:y,onCardDoubleClick:C,onEmptyCellDoubleClick:x,imageRefreshVersion:p,cursorStack:v,currentPhase:h,activePlayerId:O,onCardClick:T,onEmptyCellClick:A,validTargets:U,noTargetOverlay:S,disableActiveHighlights:g,preserveDeployAbilities:P=!1,activeFloatingTexts:z,abilitySourceCoords:R=null,abilityCheckKey:$,targetingMode:G,clickWaves:pe})=>{const je=r.useMemo(()=>{const oe=t.length,ee=Math.floor((oe-o)/2);return t.slice(ee,ee+o).map(te=>te.slice(ee,ee+o))},[t,o]),Ne=r.useMemo(()=>{if(!u)return null;const{type:oe,row:ee,col:te,playerId:De}=u,J=f.get(De),Te=`outline outline-[8px] ${J&&ot[J]?ot[J].outline:"outline-yellow-400"} rounded-lg`,V=t.length,L=Math.floor((V-o)/2);if(oe==="row"&&ee!==void 0&&ee>=L&&ee<L+o){const q=ee-L+1;return e.jsx("div",{className:Te,style:{gridArea:`${q} / 1 / ${q+1} / ${o+1}`}})}if(oe==="col"&&te!==void 0&&te>=L&&te<L+o){const q=te-L+1;return e.jsx("div",{className:Te,style:{gridArea:`1 / ${q} / ${o+1} / ${q+1}`}})}if(oe==="cell"&&ee!==void 0&&te!==void 0&&ee>=L&&ee<L+o&&te>=L&&te<L+o){const q=ee-L+1,X=te-L+1;return e.jsx("div",{className:Te,style:{gridArea:`${q} / ${X} / ${q+1} / ${X+1}`}})}return null},[u,f,o,t.length]),_=r.useMemo(()=>{const oe=t.length,ee=Math.floor((oe-o)/2),te=Array.isArray(U)?U:[],De=new Set(te.map(V=>`${V.row}-${V.col}`)),J=Array.isArray(G==null?void 0:G.boardTargets)?G.boardTargets:[],we=new Set(J.map(V=>`${V.row}-${V.col}`)),Te=(V,L)=>De.has(`${V}-${L}`)||we.has(`${V}-${L}`);return je.map((V,L)=>V.map((q,X)=>{const M=L+ee,B=X+ee,ve=`${M}-${B}`,he=we.has(ve);return{cellKey:ve,originalRowIndex:M,originalColIndex:B,cell:q,isValidTarget:Te(M,B),isTargetingModeValidTarget:he,isNoTarget:(S==null?void 0:S.row)===M&&S.col===B,cellFloatingTexts:(z==null?void 0:z.filter(ce=>ce.row===M&&ce.col===B))||[],cellClickWaves:(pe==null?void 0:pe.filter(ce=>{var se,lt;return ce.location==="board"&&((se=ce.boardCoords)==null?void 0:se.row)===M&&((lt=ce.boardCoords)==null?void 0:lt.col)===B}))||[]}}))},[je,t.length,o,U,G,S,z,pe]);return e.jsx("div",{className:"relative p-2 bg-board-bg rounded-xl h-full aspect-square transition-all duration-300",children:e.jsxs("div",{className:`grid ${Ln[o]} gap-0.5 h-full w-full`,children:[_.map(oe=>oe.map(({cellKey:ee,originalRowIndex:te,originalColIndex:De,cell:J,isValidTarget:we,isTargetingModeValidTarget:Te,isNoTarget:V,cellFloatingTexts:L,cellClickWaves:q})=>e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx(no,{row:te,col:De,cell:J,isGameStarted:n,handleDrop:l,draggedItem:d,setDraggedItem:a,openContextMenu:i,playMode:m,setPlayMode:b,playerColorMap:f,localPlayerId:y,onCardDoubleClick:C,onEmptyCellDoubleClick:x,imageRefreshVersion:p,cursorStack:v,currentPhase:h,activePlayerId:O,onCardClick:T,onEmptyCellClick:A,isValidTarget:we,isTargetingModeValidTarget:Te,targetingModePlayerId:G==null?void 0:G.playerId,targetingModeOriginalOwnerId:G==null?void 0:G.originalOwnerId,showNoTarget:V,disableActiveHighlights:g,preserveDeployAbilities:P,abilitySourceCoords:R,abilityCheckKey:$}),L.map(X=>e.jsx(oo,{textData:X,playerColorMap:f},X.id||`${X.row}-${X.col}-${X.timestamp}`)),q.map(X=>e.jsx(Ga,{timestamp:X.timestamp,playerColor:X.playerColor},X.timestamp))]},ee))),"      ",u&&e.jsxs("div",{className:`absolute top-2 right-2 bottom-2 left-2 grid ${Ln[o]} gap-0.5 pointer-events-none z-20`,children:["          ",Ne,"        "]})]})})});ro.displayName="GameBoard";const $n=60,_n=200,Un=10*1024,_a={HERO:1,COMMAND:2,DEFAULT:3},Xr=/^(\d{1,2})x\s+([\p{L}\p{N}\p{M}\s'"\-.,&()]+)$/u;function Qr(t){let n=t.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g,"");return n=n.replace(/\0/g,""),n.trim()}function Fn(t){return[/<script/i,/javascript:/i,/on\w+\s*=/i,/<iframe/i,/<object/i,/<embed/i,/eval\s*\(/i,/expression\s*\(/i,/@import/i,/\$\{/,/__proto__/i,/constructor\s*\[/].some(o=>o.test(t))}function so(){if(typeof window>"u")return"en";const t=localStorage.getItem("app_language");return t&&t in mt?t:"en"}function Xa(t,n){const l=(mt[n]||mt.en).cards[t],d=Va(t);return d?(l==null?void 0:l.name)||d.name:""}function es(t){var l;const n=new Map,o=fr();for(const{id:d,card:a}of o){if(!((l=a.allowedPanels)!=null&&l.includes("DECK_BUILDER")))continue;const m=Xa(d,t).toLowerCase().trim().replace(/\s+/g," ");n.set(m,d);const b=a.name.toLowerCase().trim().replace(/\s+/g," ");b!==m&&n.set(b,d)}return n}function ts(t){var f,y,C,x;if(new Blob([t]).size>Un)return{isValid:!1,error:`File too large. Maximum size is ${Un/1024}KB.`};if(Fn(t))return{isValid:!1,error:"File contains invalid content."};const o=t.split(/\r?\n/),l=[];for(const p of o){const v=p.trim();if(v.length!==0){if(v.length>_n)return{isValid:!1,error:`Line too long (maximum ${_n} characters).`};if(Fn(v))return{isValid:!1,error:`Invalid content in line: "${v.substring(0,30)}..."`};l.push(v)}}if(l.length===0)return{isValid:!1,error:"File is empty or contains no valid cards."};const d=so(),a=es(d),i=new Map;let m=0;for(let p=0;p<l.length;p++){const v=l[p],h=v.match(Xr);if(!h)return{isValid:!1,error:`Invalid format on line ${p+1}: "${v}". Expected format: "Nx Card Name"`};const O=h[1],T=Qr(h[2]),A=parseInt(O,10);if(isNaN(A)||A<1||A>99)return{isValid:!1,error:`Invalid quantity on line ${p+1}: "${O}". Must be between 1 and 99.`};if(T.length===0)return{isValid:!1,error:`Empty card name on line ${p+1}.`};const U=T.toLowerCase().trim().replace(/\s+/g," "),S=a.get(U);if(!S)return{isValid:!1,error:`Card not found: "${T}"`};const g=Va(S);if(!g)return{isValid:!1,error:`Card definition error: "${T}"`};if(i.has(S))return{isValid:!1,error:`Duplicate card entry: "${T}"`};if(!((f=g.allowedPanels)!=null&&f.includes("DECK_BUILDER")))return{isValid:!1,error:`Card not allowed in decks: "${T}"`};if(i.set(S,A),m+=A,m>$n)return{isValid:!1,error:`Deck exceeds ${$n} card limit.`}}for(const[p,v]of i.entries()){const h=Va(p);if(!h)continue;const O=(y=h.types)==null?void 0:y.includes("Hero"),T=(C=h.types)==null?void 0:C.includes("Rarity"),A=(x=h.types)==null?void 0:x.includes("Command");let U=_a.DEFAULT,S="";if(O||T?(U=_a.HERO,S=O?"Hero":"Rarity"):A&&(U=_a.COMMAND,S="Command"),v>U)return{isValid:!1,error:`Invalid quantity for "${Xa(p,d)}" (${S}): ${v} (maximum ${U} per deck)`}}return{isValid:!0,deckFile:{deckName:"Imported Deck",cards:Array.from(i.entries()).map(([p,v])=>({cardId:p,quantity:v}))}}}function Js(t){const n=[],o=so(),l=[];for(const{cardId:d,quantity:a}of t.cards){const i=Xa(d,o);i&&l.push({name:i,quantity:a})}l.sort((d,a)=>d.name.localeCompare(a.name,void 0,{sensitivity:"base"}));for(const{name:d,quantity:a}of l)n.push(`${a}x ${d}`);return n.join(`
`)}const Gt=new Map,Vn=r.memo(({player:t,canEditSettings:n,selectedColors:o,onColorChange:l,compact:d=!1})=>{const[a,i]=r.useState(!1),m=r.useRef(null);r.useEffect(()=>{const x=p=>{m.current&&!m.current.contains(p.target)&&i(!1)};return a&&document.addEventListener("mousedown",x),()=>{document.removeEventListener("mousedown",x)}},[a]);const b=d?"w-4 h-4":"w-9 h-9",u=d?"rounded-sm":"rounded-md",f=d?"border":"border-2",y=d?"border-white/40":"border-gray-600";return e.jsxs("div",{className:"relative",ref:m,children:[e.jsx("button",{onClick:()=>n&&i(!a),className:`${b} p-0 ${u} ${ot[t.color].bg} ${f} ${y} ${n?"hover:border-white cursor-pointer":"cursor-default"} transition-all shadow-md flex items-center justify-center group flex-shrink-0`,title:n?"Change Color":t.color,children:!d&&n&&e.jsx("svg",{className:"w-4 h-4 text-white/60 group-hover:text-white transition-colors drop-shadow-md",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M19 9l-7 7-7-7"})})}),a&&e.jsx("div",{className:"absolute top-full left-0 mt-2 p-2 bg-gray-800 border border-gray-600 rounded-lg shadow-xl z-50 grid grid-cols-4 gap-2 w-max animate-fade-in",children:Object.keys(ot).map(x=>{const p=x,v=o.has(p)&&t.color!==p,h=t.color===p;return e.jsx("button",{onClick:()=>{v||(l(p),i(!1))},disabled:v,className:`w-8 h-8 rounded-md ${ot[p].bg} border-2 ${h?"border-white ring-1 ring-white scale-110":v?"border-transparent opacity-20 cursor-not-allowed":"border-transparent hover:border-white hover:scale-110 hover:shadow-lg"} transition-all duration-150`,title:p},p)})})]})}),Bt=({onDrop:t,className:n,isOverClassName:o,children:l,onContextMenu:d})=>{const[a,i]=r.useState(!1);return e.jsx("div",{onDragOver:m=>{m.preventDefault(),m.stopPropagation(),i(!0)},onDragLeave:m=>{m.stopPropagation(),i(!1)},onDrop:m=>{m.preventDefault(),i(!1),t()},onContextMenu:d,className:`${n||""} ${a?`relative z-10 ${o||""}`:""}`,children:l})},Gn=({score:t,onChange:n,canEdit:o})=>{const[l,d]=r.useState(0),[a,i]=r.useState(0),[m,b]=r.useState(0),u=r.useRef(null),f=r.useRef(0),y=r.useRef(t),C=r.useRef(!1);r.useEffect(()=>{if(y.current!==t){const O=t-y.current;let T;if(C.current?C.current=!1:(b(O),i(A=>A+1),T=setTimeout(()=>{b(0)},1500)),y.current=t,T)return()=>clearTimeout(T)}},[t]);const x=O=>{if(!o)return;const T=f.current+O;f.current=T,d(T),i(A=>A+1),u.current&&clearTimeout(u.current),u.current=setTimeout(()=>{const A=f.current;A!==0&&(C.current=!0,n(A)),f.current=0,d(0)},250)};r.useEffect(()=>()=>{u.current&&clearTimeout(u.current)},[]);const p=l!==0||m!==0,v=m!==0?m:l,h=m!==0;return e.jsxs("div",{className:"w-full h-full aspect-square bg-gray-800 rounded flex flex-col items-center text-white select-none overflow-hidden",children:[e.jsx("button",{onClick:()=>x(1),disabled:!o,className:"h-1/3 w-full flex items-center justify-center bg-gray-700 hover:bg-gray-600 active:bg-gray-500 transition-colors text-base sm:text-xl font-bold disabled:opacity-50 disabled:cursor-default leading-none",children:"+"}),e.jsxs("div",{className:"h-1/3 flex items-center justify-center font-bold text-base sm:text-xl w-full px-px relative",children:[e.jsx("span",{className:"absolute left-1/2 -translate-x-1/2",children:t}),p&&e.jsx("span",{className:`absolute right-1 text-base sm:text-lg font-bold ${v>0?"text-green-400":"text-red-400"} ${h?"animate-fade-out":""}`,children:v>0?`+${v}`:v},a)]}),e.jsx("button",{onClick:()=>x(-1),disabled:!o,className:"h-1/3 w-full flex items-center justify-center bg-gray-700 hover:bg-gray-600 active:bg-gray-500 transition-colors text-base sm:text-xl font-bold disabled:opacity-50 disabled:cursor-default leading-none",children:"-"})]})},Bn=({label:t,count:n,onClick:o,children:l,className:d,style:a,delta:i})=>e.jsx("div",{onClick:o,className:`w-full h-full rounded flex flex-col items-center justify-center cursor-pointer hover:ring-2 ring-indigo-400 transition-all shadow-sm select-none text-white border border-gray-600 relative overflow-hidden ${d||""}`,style:a,children:l||e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-[9px] font-bold mb-0.5 opacity-80 uppercase tracking-tighter",children:t}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"text-base font-bold",children:n}),i!=null&&e.jsx("span",{className:`absolute left-full top-0 ml-0.5 text-base font-bold animate-fade-out ${i>0?"text-green-400":"text-red-400"}`,children:i>0?`+${i}`:i})]})]})}),Hn=r.memo(({player:t,isLocalPlayer:n,localPlayerId:o,isGameStarted:l,onNameChange:d,onColorChange:a,onScoreChange:i,onDeckChange:m,onLoadCustomDeck:b,onDrawCard:u,handleDrop:f,draggedItem:y,setDraggedItem:C,openContextMenu:x,onHandCardDoubleClick:p,playerColorMap:v,allPlayers:h,localPlayerTeamId:O,activePlayerId:T,onToggleActivePlayer:A,imageRefreshVersion:U,layoutMode:S,onCardClick:g,validHandTargets:P,onAnnouncedCardDoubleClick:z,currentPhase:R,disableActiveHighlights:$,preserveDeployAbilities:G=!1,roundWinners:pe,startingPlayerId:je,onDeckClick:Ne,isDeckSelectable:_,hideDummyCards:oe=!1,deckSelections:ee=[],handCardSelections:te=[],cursorStack:De=null,targetingMode:J=null,highlightOwnerId:we,onCancelAllModes:Te,clickWaves:V=[],triggerClickWave:L})=>{const{t:q,resources:X}=rt(),M=r.useRef(null),B=r.useCallback((W,I,K)=>{Te&&Te(),x(W,I,K)},[x,Te]),ve=()=>t.deck.length??0,he=r.useRef(ve()),[ce,se]=r.useState(null),[lt,yt]=r.useState(0),Ee=n||!!t.isDummy,qe=Ee&&!De,ke=T===t.id,xt=O!==void 0&&t.teamId===O&&!n,et=!!t.isDisconnected,Ae=r.useMemo(()=>zn.filter(W=>W.isSelectable),[zn]),ne=r.useMemo(()=>new Set(h.map(W=>W.color)),[h]),Je=pe?Object.values(pe).filter(W=>W.includes(t.id)).length:0,dt=je===t.id,Ze=Rn.FIRST_PLAYER,ct=Rn.ROUND_WIN_MEDAL;r.useEffect(()=>{const W=he.current,I=ve();if(W!==I){const K=I-W;he.current=I;const Ce=Gt.get(t.id);if(Ce){clearTimeout(Ce.timerId);const de=Ce.delta+K;se(de),yt(Ie=>Ie+1);const Oe=setTimeout(()=>{se(null),Gt.delete(t.id)},500);Gt.set(t.id,{delta:de,timerId:Oe})}else{se(K),yt(Oe=>Oe+1);const de=setTimeout(()=>{se(null),Gt.delete(t.id)},500);Gt.set(t.id,{delta:K,timerId:de})}}},[t.deck.length,t.id,ve]),r.useEffect(()=>()=>{const W=Gt.get(t.id);W&&(clearTimeout(W.timerId),Gt.delete(t.id))},[t.id]);const ut=W=>{m(W.target.value)},H=W=>{var Ce;const I=(Ce=W.target.files)==null?void 0:Ce[0];if(!I)return;const K=new FileReader;K.onload=de=>{var Oe;try{const Ie=(Oe=de.target)==null?void 0:Oe.result,Ye=ts(Ie);if(!Ye.isValid){Ke.error("Failed to load deck:",Ye.error),alert(Ye.error);return}const{deckFile:le}=Ye;b(le)}catch(Ie){Ke.error("Failed to parse deck file",Ie),alert("Failed to parse deck file.")}},K.readAsText(I)},ie=()=>{var W;(W=M.current)==null||W.click()},Q=()=>{_&&Ne?Ne(t.id):Ee&&u()};if(S==="list-local"){const W=ke?"border-yellow-400":"border-gray-700";return e.jsxs("div",{className:`w-full h-full flex flex-col p-4 bg-panel-bg border-2 ${W} rounded-lg shadow-2xl ${et?"opacity-60":""} relative`,children:[e.jsxs("div",{className:"absolute top-4 right-4 flex items-center gap-[2px] z-50",children:[Je>0&&Array.from({length:Je}).map((I,K)=>e.jsx("img",{src:ct,alt:"Round Winner",className:"w-6 h-6 drop-shadow-md flex-shrink-0",title:"Round Winner"},`win-${K}`)),dt&&e.jsx("img",{src:Ze,alt:"First Player",className:"w-6 h-6 drop-shadow-md flex-shrink-0",title:"First Player"}),e.jsx("div",{className:"flex-shrink-0 transition-all duration-200",title:ke?"Active Player":"Inactive Player",children:e.jsxs("svg",{width:"28",height:"28",viewBox:"0 0 28 28",className:`transition-all duration-200 ${ke?"drop-shadow-[0_0_8px_rgba(250,204,21,0.8)]":"opacity-40"}`,children:[e.jsx("circle",{cx:"14",cy:"14",r:"12",fill:"none",strokeWidth:"2.5",className:ke?"stroke-yellow-400":"stroke-gray-500"}),e.jsx("circle",{cx:"14",cy:"14",r:"6",className:ke?"fill-yellow-400":"fill-gray-600"}),ke&&e.jsx("circle",{cx:"14",cy:"14",r:"9",fill:"none",strokeWidth:"1",className:"stroke-yellow-300 opacity-50 animate-pulse"})]})})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-[3px] flex-shrink-0 pr-[100px]",children:[e.jsx(Vn,{player:t,canEditSettings:!l&&Ee,selectedColors:ne,onColorChange:a}),e.jsx("div",{className:"flex-grow relative flex items-center min-w-0",children:e.jsx("input",{type:"text",value:t.name,onChange:I=>d(I.target.value),readOnly:l||!Ee,className:"bg-transparent font-bold text-xl p-1 flex-grow focus:bg-gray-800 rounded focus:outline-none border-b border-gray-600 text-white truncate"})})]}),e.jsx("div",{className:"bg-gray-800 p-1 rounded-lg mb-1 flex-shrink-0",children:e.jsxs("div",{className:"grid grid-cols-4 gap-1 sm:gap-2",children:[e.jsx(Bt,{className:"relative",onDrop:()=>y&&f(y,{target:"deck",playerId:t.id,deckPosition:"top"}),onContextMenu:I=>B(I,"deckPile",{player:t}),isOverClassName:"rounded ring-2 ring-white",children:(()=>{const I=_,K=(J==null?void 0:J.isDeckSelectable)??!1,Ce=I||K,de=(J==null?void 0:J.playerId)??T,Oe=de!=null?v.get(de):null,Ie=Zt(Oe,{r:37,g:99,b:235}),Ye=Ce?{boxShadow:`0 0 12px 2px ${Dt(da(Ie),.5)}`,border:"3px solid rgb(255, 255, 255)"}:{},le=Date.now(),_e=ee==null?void 0:ee.find(st=>st.playerId===t.id&&le-st.timestamp<1e3),vt=_e!=null&&_e.selectedByPlayerId?v.get(_e.selectedByPlayerId):null,Ge=Zt(vt,Ie);return e.jsxs("div",{className:"relative aspect-square",children:[Ce&&e.jsx("div",{className:"absolute inset-0 rounded pointer-events-none animate-glow-pulse",style:{zIndex:10,background:`radial-gradient(circle at center, transparent 30%, ${Dt(Ie,.4)} 100%)`}}),_e&&e.jsx("div",{className:"absolute inset-0 rounded pointer-events-none animate-deck-selection",style:{zIndex:15,border:"3px solid",borderColor:`rgb(${Ge.r}, ${Ge.g}, ${Ge.b})`,background:`radial-gradient(circle at center, transparent 20%, ${Dt(Ge,.6)} 100%)`}}),e.jsxs("div",{onClick:Q,className:"absolute inset-0 bg-card-back rounded flex flex-col items-center justify-center cursor-pointer hover:ring-2 ring-indigo-400 transition-all shadow-md select-none text-white",style:Ye,children:[e.jsx("span",{className:"text-[10px] sm:text-xs font-bold mb-0.5 uppercase tracking-tight relative z-20",children:q("deck")}),e.jsxs("div",{className:"relative z-20",children:[e.jsx("span",{className:"text-base sm:text-lg font-bold",children:ve()}),ce!==null&&e.jsx("span",{className:`absolute left-full top-0 ml-1 text-base sm:text-lg font-bold animate-fade-out ${ce>0?"text-green-400":"text-red-400"}`,children:ce>0?`+${ce}`:ce},lt)]})]})]})})()}),e.jsx(Bt,{onDrop:()=>y&&f(y,{target:"discard",playerId:t.id}),onContextMenu:I=>B(I,"discardPile",{player:t}),isOverClassName:"rounded ring-2 ring-white",children:e.jsxs("div",{className:"aspect-square bg-gray-700 rounded flex flex-col items-center justify-center cursor-pointer hover:bg-gray-600 transition-all shadow-md border border-gray-600 select-none text-white",children:[e.jsx("span",{className:"text-[10px] sm:text-xs font-bold mb-0.5 text-gray-400 uppercase tracking-tight",children:q("discard")}),e.jsx("span",{className:"text-base sm:text-lg font-bold",children:t.discard.length})]})}),e.jsx(Bt,{onDrop:()=>y&&f(y,{target:"announced",playerId:t.id}),isOverClassName:"rounded ring-2 ring-white",children:e.jsx("div",{className:"aspect-square bg-gray-800 border border-dashed border-gray-600 rounded flex items-center justify-center relative overflow-hidden",children:t.announcedCard?e.jsx("div",{className:"w-full h-full p-1 cursor-pointer",draggable:qe,onDragStart:()=>qe&&C({card:t.announcedCard,source:"announced",playerId:t.id,isManual:!0}),onDragEnd:()=>{setTimeout(()=>C(null),Ht.DRAG_END_FALLBACK)},onContextMenu:I=>Ee&&t.announcedCard&&B(I,"announcedCard",{card:t.announcedCard,player:t}),onDoubleClick:()=>z==null?void 0:z(t,t.announcedCard),children:e.jsx(Nt,{card:t.announcedCard,isFaceUp:!0,playerColorMap:v,playerColor:t.color,imageRefreshVersion:U,loadPriority:n?"high":"low",activePhaseIndex:R,activePlayerId:T,disableActiveHighlights:$,preserveDeployAbilities:G})}):e.jsx("span",{className:"text-[10px] sm:text-xs font-bold text-gray-500 select-none uppercase tracking-tight",children:q("showcase")})})}),e.jsx(Gn,{score:t.score,onChange:i,canEdit:Ee})]})}),!l&&Ee&&Ae.length>0&&e.jsxs("div",{className:"mb-[3px] flex-shrink-0 text-white",children:[e.jsx("input",{type:"file",ref:M,onChange:H,accept:".txt",className:"hidden"}),t.selectedDeck===Qe.Custom?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:ie,className:"bg-transparent border border-gray-500 hover:bg-gray-700 px-4 py-1.5 rounded font-bold",children:q("loadDeck")}),e.jsxs("select",{value:t.selectedDeck,onChange:ut,className:"flex-grow bg-gray-700 border border-gray-600 rounded p-1",children:[Ae.map(I=>e.jsx("option",{value:I.id,children:X.deckNames[I.id]||I.name},I.id)),e.jsx("option",{value:Qe.Custom,children:q("customDeck")})]})]}):e.jsxs("select",{value:t.selectedDeck,onChange:ut,className:"w-full bg-gray-700 border border-gray-600 rounded p-2 mb-2",children:[Ae.map(I=>e.jsx("option",{value:I.id,children:X.deckNames[I.id]||I.name},I.id)),e.jsx("option",{value:Qe.Custom,children:q("customDeck")})]})]}),e.jsx("div",{className:"flex-grow flex flex-col min-h-0",children:e.jsx(Bt,{onDrop:()=>{y&&(f(y,{target:"hand",playerId:t.id}),C(null))},className:"flex-grow bg-gray-800 rounded-lg p-2 overflow-y-scroll border border border-gray-700 custom-scrollbar",children:e.jsx("div",{className:"flex flex-col gap-[2px]",children:t.hand.map((I,K)=>{var Pe;const Ce=P==null?void 0:P.some(Le=>Le.playerId===t.id&&Le.cardIndex===K),de=(Pe=J==null?void 0:J.handTargets)==null?void 0:Pe.some(Le=>Le.playerId===t.id&&Le.cardIndex===K),Oe=Ce||de,Ie=(J==null?void 0:J.playerId)??we??T,Ye=Ie!=null?v.get(Ie):null,le=Zt(Ye,{r:37,g:99,b:235}),_e=Date.now(),vt=te==null?void 0:te.find(Le=>Le.playerId===t.id&&Le.cardIndex===K&&_e-Le.timestamp<1e3),Ge=(V==null?void 0:V.filter(Le=>{var Lt,Et;return Le.location==="hand"&&((Lt=Le.handTarget)==null?void 0:Lt.playerId)===t.id&&((Et=Le.handTarget)==null?void 0:Et.cardIndex)===K}))||[],st=Oe?{boxShadow:`0 0 12px 2px ${Dt(da(le),.5)}`,border:"3px solid rgb(255, 255, 255)"}:{};return e.jsxs("div",{className:"relative",children:[Oe&&e.jsx("div",{className:"absolute inset-0 rounded pointer-events-none animate-glow-pulse",style:{zIndex:10,background:`radial-gradient(circle at center, transparent 30%, ${Dt(le,.4)} 100%)`}}),vt&&e.jsx("div",{className:"absolute inset-0 rounded pointer-events-none animate-deck-selection",style:{zIndex:15,border:"3px solid",borderColor:`rgb(${le.r}, ${le.g}, ${le.b})`,background:`radial-gradient(circle at center, transparent 20%, ${Dt(le,.6)} 100%)`}}),e.jsxs("div",{className:`flex items-center bg-gray-900 border rounded p-2 min-w-0 ${Oe?"border-transparent":"border-gray-700"}`,style:st,draggable:qe,onDragStart:()=>qe&&C({card:I,source:"hand",playerId:t.id,cardIndex:K,isManual:!0}),onDragEnd:()=>{setTimeout(()=>C(null),Ht.DRAG_END_FALLBACK)},onContextMenu:Le=>Ee&&B(Le,"handCard",{card:I,player:t,cardIndex:K}),onDoubleClick:()=>p(t,I,K),onClick:()=>{L&&o!==null&&L("hand",void 0,{playerId:t.id,cardIndex:K}),g==null||g(t,I,K)},"data-hand-card":`${t.id},${K}`,"data-interactive":"true",children:[e.jsx("div",{className:"aspect-square flex-shrink-0 mr-3 w-[28.75%] max-w-[230px] min-w-[40px] overflow-hidden rounded",children:e.jsx(Nt,{card:I,isFaceUp:!0,playerColorMap:v,localPlayerId:o,imageRefreshVersion:U,loadPriority:n?"high":"low",disableTooltip:!0,disableActiveHighlights:$,preserveDeployAbilities:G,playerColor:t.color})}),e.jsx("div",{className:"flex-grow min-w-0",children:e.jsx(Za,{card:I,className:"relative flex flex-col text-left w-full h-full justify-start whitespace-normal break-words",hideOwner:I.ownerId===t.id})})]}),Ge.map(Le=>e.jsx(Ga,{timestamp:Le.timestamp,playerColor:Le.playerColor},Le.timestamp))]},`card-${I.id}`)})})})})]})}if(S==="list-remote"){const W=ke?"border-yellow-400":"border-gray-700";return e.jsxs("div",{className:`w-full h-full flex flex-col p-1 pt-[3px] bg-panel-bg border-2 ${W} rounded-lg shadow-xl ${et?"opacity-60":""} relative`,children:[e.jsxs("div",{className:"flex items-center gap-1 px-1 min-h-[20px] mt-[2px] relative z-10",children:[e.jsx(Vn,{player:t,canEditSettings:!l&&Ee,selectedColors:ne,onColorChange:a,compact:!0}),e.jsx("span",{className:"font-bold text-white text-[14px] truncate leading-tight flex-1 min-w-0 relative z-10",children:t.name}),e.jsxs("div",{className:"flex items-center gap-[2px] flex-shrink-0",children:[!l&&Ee&&Ae.length>0&&(t.selectedDeck===Qe.Custom?e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"file",ref:M,onChange:H,accept:".txt",className:"hidden"}),e.jsx("button",{onClick:ie,className:"text-[11px] bg-transparent border border-gray-500 hover:bg-gray-700 text-white rounded px-1 py-0 h-5 flex-shrink-0",children:q("loadDeck")}),e.jsxs("select",{value:t.selectedDeck,onChange:ut,className:"text-[11px] bg-gray-700 text-white border border-gray-600 rounded px-1 py-0 h-5 w-[90px] focus:outline-none truncate flex-shrink-0",children:[Ae.map(I=>e.jsx("option",{value:I.id,children:X.deckNames[I.id]||I.name},I.id)),e.jsx("option",{value:Qe.Custom,children:q("customDeck")})]})]}):e.jsxs("select",{value:t.selectedDeck,onChange:ut,className:"text-[11px] bg-gray-700 text-white border border-gray-600 rounded px-1 py-0 h-5 w-[110px] focus:outline-none truncate flex-shrink-0",children:[Ae.map(I=>e.jsx("option",{value:I.id,children:X.deckNames[I.id]||I.name},I.id)),e.jsx("option",{value:Qe.Custom,children:q("customDeck")})]})),Je>0&&e.jsx("img",{src:ct,alt:"Round Winner",className:"w-[19px] h-[17.7] flex-shrink-0 mt-[1.3px]",title:"Round Winner"}),dt&&e.jsx("img",{src:Ze,className:"w-[16.75px] h-[16.75px] flex-shrink-0",title:"First Player"}),e.jsx("div",{className:"flex-shrink-0 transition-all duration-200",title:ke?"Active Player":"Inactive Player",children:e.jsxs("svg",{width:"17",height:"17",viewBox:"0 0 28 28",className:`transition-all duration-200 ${ke?"drop-shadow-[0_0_6px_rgba(250,204,21,0.8)]":"opacity-40"}`,children:[e.jsx("circle",{cx:"14",cy:"14",r:"12",fill:"none",strokeWidth:"2.5",className:ke?"stroke-yellow-400":"stroke-gray-500"}),e.jsx("circle",{cx:"14",cy:"14",r:"6",className:ke?"fill-yellow-400":"fill-gray-600"}),ke&&e.jsx("circle",{cx:"14",cy:"14",r:"9",fill:"none",strokeWidth:"1",className:"stroke-yellow-300 opacity-50 animate-pulse"})]})})]})]}),e.jsx("div",{className:"relative flex flex-col flex-1 min-h-0 overflow-hidden",children:e.jsxs("div",{className:"flex flex-col flex-1 min-h-0 gap-1 px-1 mt-[4px]",children:[e.jsxs("div",{className:"grid grid-cols-6 gap-1 flex-shrink-0 scale-[0.975] origin-left",children:[e.jsx("div",{className:"aspect-square relative",children:e.jsx(Bt,{className:"w-full h-full",onDrop:()=>y&&f(y,{target:"deck",playerId:t.id,deckPosition:"top"}),onContextMenu:I=>B(I,"deckPile",{player:t}),isOverClassName:"rounded ring-2 ring-white",children:(()=>{const I=_,K=(J==null?void 0:J.isDeckSelectable)??!1,Ce=I||K,de=(J==null?void 0:J.playerId)??T,Oe=de!=null?v.get(de):null,Ie=Zt(Oe,{r:37,g:99,b:235}),Ye=Ce?{boxShadow:`0 0 12px 2px ${Dt(da(Ie),.5)}`,border:"3px solid rgb(255, 255, 255)"}:{},le=Date.now(),_e=ee==null?void 0:ee.find(st=>st.playerId===t.id&&le-st.timestamp<1e3),vt=_e!=null&&_e.selectedByPlayerId?v.get(_e.selectedByPlayerId):null,Ge=Zt(vt,Ie);return e.jsxs("div",{className:"relative w-full h-full",children:[Ce&&e.jsx("div",{className:"absolute inset-0 rounded pointer-events-none animate-glow-pulse",style:{zIndex:10,background:`radial-gradient(circle at center, transparent 30%, rgba(${Ie.r}, ${Ie.g}, ${Ie.b}, 0.4) 100%)`}}),_e&&e.jsx("div",{className:"absolute inset-0 rounded pointer-events-none animate-deck-selection",style:{zIndex:15,border:"3px solid",borderColor:`rgb(${Ge.r}, ${Ge.g}, ${Ge.b})`,background:`radial-gradient(circle at center, transparent 20%, rgba(${Ge.r}, ${Ge.g}, ${Ge.b}, 0.6) 100%)`}}),e.jsx(Bn,{label:q("deck"),count:ve(),onClick:Q,className:"bg-card-back",style:Ye,delta:ce})]})})()})}),e.jsx("div",{className:"aspect-square relative",children:e.jsx(Bt,{className:"w-full h-full",onDrop:()=>y&&f(y,{target:"discard",playerId:t.id}),onContextMenu:I=>B(I,"discardPile",{player:t}),isOverClassName:"rounded ring-2 ring-white",children:e.jsx(Bn,{label:q("discard"),count:t.discard.length,className:"bg-gray-700"})})}),e.jsx("div",{className:"aspect-square relative",children:e.jsx(Bt,{className:"w-full h-full",onDrop:()=>y&&f(y,{target:"announced",playerId:t.id}),isOverClassName:"rounded ring-2 ring-white",children:e.jsx("div",{className:"w-full h-full bg-gray-800 border border-dashed border-gray-600 rounded flex items-center justify-center relative overflow-hidden",children:t.announcedCard?e.jsx("div",{className:"w-full h-full",draggable:qe,onDragStart:()=>qe&&C({card:t.announcedCard,source:"announced",playerId:t.id,isManual:!0}),onDragEnd:()=>{setTimeout(()=>C(null),Ht.DRAG_END_FALLBACK)},onContextMenu:I=>t.announcedCard&&B(I,"announcedCard",{card:t.announcedCard,player:t}),onDoubleClick:()=>z==null?void 0:z(t,t.announcedCard),children:e.jsx(Nt,{card:t.announcedCard,isFaceUp:!0,playerColorMap:v,imageRefreshVersion:U,loadPriority:n?"high":"low",disableTooltip:!1,disableActiveHighlights:$,preserveDeployAbilities:G,playerColor:t.color})}):e.jsx("span",{className:"text-[9px] font-bold text-gray-500 select-none uppercase",children:"SHOW"})})})}),e.jsx("div",{className:"aspect-square"}),e.jsx("div",{className:"aspect-square"}),e.jsx("div",{className:"aspect-square",children:e.jsx(Gn,{score:t.score,onChange:i,canEdit:Ee})})]}),e.jsx("div",{onDragOver:I=>I.preventDefault(),onDrop:I=>{I.preventDefault(),I.stopPropagation(),y&&f(y,{target:"hand",playerId:t.id})},className:"grid grid-cols-6 gap-1 overflow-y-scroll custom-scrollbar flex-grow content-start min-h-[30px]",children:t.hand.map((I,K)=>{var ha,Yt;const Ce=P==null?void 0:P.some(ue=>ue.playerId===t.id&&ue.cardIndex===K),de=(ha=J==null?void 0:J.handTargets)==null?void 0:ha.some(ue=>ue.playerId===t.id&&ue.cardIndex===K),Oe=Ce||de,Ie=(J==null?void 0:J.playerId)??we??T,Ye=Ie!=null?v.get(Ie):null,le=Zt(Ye,{r:37,g:99,b:235}),_e=Date.now(),vt=te==null?void 0:te.find(ue=>ue.playerId===t.id&&ue.cardIndex===K&&_e-ue.timestamp<1e3),Ge=(V==null?void 0:V.filter(ue=>{var ba,Wt;return ue.location==="hand"&&((ba=ue.handTarget)==null?void 0:ba.playerId)===t.id&&((Wt=ue.handTarget)==null?void 0:Wt.cardIndex)===K}))||[],st=Oe?{boxShadow:`0 0 12px 2px ${Dt(da(le),.5)}`,border:"3px solid rgb(255, 255, 255)"}:{},Pe=I.revealedTo==="all",Le=o!==null&&Array.isArray(I.revealedTo)&&I.revealedTo.includes(o),Lt=o!==null&&((Yt=I.statuses)==null?void 0:Yt.some(ue=>ue.type==="Revealed"&&ue.addedByPlayerId===o)),Et=h.find(ue=>ue.id===I.ownerId),Ia=Et==null?void 0:Et.isDummy,fa=o===I.ownerId||!!Ia&&(!oe||!!Pe||!!Le||!!Lt)||xt||Pe||!!Le||!!Lt;return e.jsxs("div",{className:"aspect-square relative",draggable:qe,onDragStart:()=>qe&&C({card:I,source:"hand",playerId:t.id,cardIndex:K,isManual:!0}),onDragEnd:()=>{setTimeout(()=>C(null),Ht.DRAG_END_FALLBACK)},onContextMenu:ue=>{ue.preventDefault(),ue.stopPropagation(),B(ue,"handCard",{card:I,player:t,cardIndex:K})},onDoubleClick:()=>p(t,I,K),onClick:()=>{L&&o!==null&&L("hand",void 0,{playerId:t.id,cardIndex:K}),g==null||g(t,I,K)},onDragOver:ue=>{ue.preventDefault(),ue.stopPropagation()},onDrop:ue=>{ue.preventDefault(),ue.stopPropagation(),y&&(y.playerId===t.id&&y.source==="hand"?f(y,{target:"hand",playerId:t.id,cardIndex:K}):f(y,{target:"hand",playerId:t.id}))},"data-hand-card":`${t.id},${K}`,"data-interactive":"true",children:[Oe&&e.jsx("div",{className:"absolute inset-0 rounded pointer-events-none animate-glow-pulse",style:{zIndex:10,background:`radial-gradient(circle at center, transparent 30%, rgba(${le.r}, ${le.g}, ${le.b}, 0.4) 100%)`}}),vt&&e.jsx("div",{className:"absolute inset-0 rounded pointer-events-none animate-deck-selection",style:{zIndex:15,border:"3px solid",borderColor:`rgb(${le.r}, ${le.g}, ${le.b})`,background:`radial-gradient(circle at center, transparent 20%, rgba(${le.r}, ${le.g}, ${le.b}, 0.6) 100%)`}}),e.jsx("div",{className:"w-full h-full rounded",style:st,children:e.jsx(Nt,{card:I,isFaceUp:fa,playerColorMap:v,localPlayerId:o,imageRefreshVersion:U,loadPriority:n?"high":"low",disableTooltip:!fa,disableActiveHighlights:$,smallStatusIcons:!0,preserveDeployAbilities:G,playerColor:t.color})}),Ge.map(ue=>e.jsx(Ga,{timestamp:ue.timestamp,playerColor:ue.playerColor},ue.timestamp))]},`${t.id}-hand-${K}-${I.id}`)})})]})})]})}return null},(t,n)=>{var a,i,m,b,u,f,y,C;const o=t.cursorStack===null&&n.cursorStack===null||t.cursorStack!==null&&n.cursorStack!==null&&t.cursorStack.type===n.cursorStack.type&&t.cursorStack.count===n.cursorStack.count,l=t.draggedItem===n.draggedItem||((a=t.draggedItem)==null?void 0:a.card.id)===((i=n.draggedItem)==null?void 0:i.card.id)&&((m=t.draggedItem)==null?void 0:m.source)===((b=n.draggedItem)==null?void 0:b.source)&&((u=t.draggedItem)==null?void 0:u.playerId)===((f=n.draggedItem)==null?void 0:f.playerId),d=x=>x.deck.length??0;return t.player.id===n.player.id&&t.player.score===n.player.score&&t.player.color===n.player.color&&t.player.name===n.player.name&&t.player.selectedDeck===n.player.selectedDeck&&t.player.hand.length===n.player.hand.length&&d(t.player)===d(n.player)&&t.player.discard.length===n.player.discard.length&&((y=t.player.announcedCard)==null?void 0:y.id)===((C=n.player.announcedCard)==null?void 0:C.id)&&t.isGameStarted===n.isGameStarted&&t.activePlayerId===n.activePlayerId&&t.currentPhase===n.currentPhase&&t.imageRefreshVersion===n.imageRefreshVersion&&t.currentRound===n.currentRound&&t.validHandTargets===n.validHandTargets&&o&&l});function as(t,n,o=!1,l){const d=window.location.origin+window.location.pathname,a=localStorage.getItem("websocket_url")||"",i=a?btoa(encodeURIComponent(a)):"";if(!t)return{url:i?`${d}#s=${i}`:d,type:"mainMenu",description:i?"Share server configuration":"Share game site"};const m=i?`${d}#game=${t}&s=${i}`:`${d}#game=${t}`;return n?{url:m,type:"inGame",description:o?"Share private game (spectator)":"Share game link (spectator)"}:{url:m,type:"lobby",description:o?"Share private game invite":"Share game invite"}}const io=r.memo(({connectionStatus:t,isReconnecting:n,reconnectProgress:o})=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"relative flex h-3 w-3",title:t,children:[t==="Connected"&&!n&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-green-500"})]}),(t==="Connecting"||n)&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-yellow-400 opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-yellow-500"})]}),t==="Disconnected"&&!n&&e.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-red-500"})]}),n&&o&&e.jsxs("span",{className:"text-xs text-yellow-400 animate-pulse",children:["Reconnecting (",Math.round(o.timeRemaining/1e3),"s)"]})]}));io.displayName="StatusIndicator";const lo=r.memo(({currentRound:t,turnNumber:n,onMouseEnter:o,onMouseLeave:l,showTooltip:d,isGameStarted:a,t:i})=>{const m=r.useMemo(()=>t*10+10,[t]);return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:`flex items-center bg-gray-800 rounded-lg px-3 py-1.5 border border-gray-700 shadow-md ${a?"cursor-help":"opacity-50"}`,onMouseEnter:o,onMouseLeave:l,children:[e.jsxs("span",{className:"text-yellow-500 font-bold text-sm tracking-wider",children:[i("round").toUpperCase()," ",t]}),e.jsx("span",{className:"text-gray-500 mx-2",children:"|"}),e.jsxs("span",{className:"text-gray-300 text-xs font-mono",children:[i("turn").toUpperCase()," ",n]})]}),d&&e.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 mt-2 z-[100] bg-gray-900 text-white p-3 rounded-lg shadow-xl border border-gray-700 text-sm whitespace-nowrap min-w-max",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"font-bold text-yellow-400 mb-1 whitespace-nowrap",children:[i("round")," ",t," ",i("roundVictoryCondition")]}),e.jsxs("p",{className:"whitespace-nowrap",children:[i("reach")," ",e.jsxs("span",{className:"font-bold text-white",children:[m," ",i("scorePoints")]})," ",i("toWinRound")]}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:i("checkedAtFirstPlayer")})]})})]})});lo.displayName="RoundTracker";const co=r.memo(({isOpen:t,onClose:n,anchorEl:o,isAutoAbilitiesEnabled:l,onToggleAutoAbilities:d,isAutoDrawEnabled:a,onToggleAutoDraw:i,dummyPlayerCount:m,onDummyPlayerCountChange:b,realPlayerCount:u,activeGridSize:f,onGridSizeChange:y,gameMode:C,onGameModeChange:x,isGameStarted:p,isHost:v,hideDummyCards:h,onToggleHideDummyCards:O,t:T})=>{const A=r.useRef(null),U=r.useMemo(()=>[0,1,2,3],[]);if(r.useEffect(()=>{if(!t)return;const g=P=>{A.current&&!A.current.contains(P.target)&&!(o!=null&&o.contains(P.target))&&n()};return document.addEventListener("mousedown",g),()=>document.removeEventListener("mousedown",g)},[t,n,o]),!t||!o)return null;const S=o.getBoundingClientRect();return e.jsxs("div",{ref:A,className:"fixed z-[100] bg-gray-800 rounded-lg shadow-xl border border-gray-700 p-4 min-w-[280px]",style:{top:S.bottom+8,left:S.left},children:[e.jsx("h3",{className:"text-white font-bold mb-4 text-sm border-b border-gray-700 pb-2",children:T("gameSettings")}),e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-gray-300 text-sm",children:T("autoAbilities")}),e.jsx("button",{onClick:()=>d(!l),disabled:!v,className:`px-3 py-1 rounded text-xs font-bold transition-colors ${l?"bg-green-600 text-white":"bg-gray-600 text-gray-400"} ${v?"":"opacity-50 cursor-not-allowed"}`,children:T(l?"on":"off")})]}),e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-gray-300 text-sm",children:T("autoDraw")}),e.jsx("button",{onClick:()=>i(!a),className:`px-3 py-1 rounded text-xs font-bold transition-colors ${a?"bg-green-600 text-white":"bg-gray-600 text-gray-400"}`,children:T(a?"on":"off")})]}),e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-gray-300 text-sm",children:T("dummyPlayers")}),e.jsxs("div",{className:"flex gap-1 items-center",children:[U.map(g=>e.jsx("button",{onClick:()=>b(g),disabled:!v||p||u+g>Mn,className:`w-8 h-8 rounded text-xs font-bold transition-colors ${m===g?"bg-indigo-600 text-white":"bg-gray-700 text-gray-400 hover:bg-gray-600"} ${!v||p||u+g>Mn?"opacity-50 cursor-not-allowed":""}`,children:g},g)),e.jsx("button",{onClick:()=>O(!h),className:`w-8 h-8 rounded text-xs font-bold transition-colors ${h?"bg-red-600 text-white":"bg-gray-700 text-gray-400 hover:bg-gray-600"}`,title:T("hideDummyCardsTooltip"),children:"🙈"})]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-gray-300 text-sm",children:T("gridSize")}),e.jsx("div",{className:"flex gap-1",children:[4,5,6,7].map(g=>e.jsxs("button",{onClick:()=>y(g),disabled:!v||p,className:`w-10 h-8 rounded text-xs font-bold transition-colors ${f===g?"bg-indigo-600 text-white":"bg-gray-700 text-gray-400 hover:bg-gray-600"} ${!v||p?"opacity-50 cursor-not-allowed":""}`,children:[g,"x",g]},g))})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-300 text-sm",children:T("gameMode")}),e.jsxs("select",{value:C,onChange:g=>x(g.target.value),disabled:!v||p,className:"bg-gray-700 border border-gray-600 text-white text-xs rounded px-2 py-1 disabled:opacity-50",children:[e.jsx("option",{value:ca.FreeForAll,children:T("ffa")}),e.jsx("option",{value:ca.TwoVTwo,children:T("2v2")}),e.jsx("option",{value:ca.ThreeVOne,children:T("3v1")})]})]})]})});co.displayName="GameSettingsMenu";const uo=r.memo(({isOpen:t,onClose:n,anchorEl:o,gameId:l,isPrivate:d,onPrivacyChange:a,isHost:i,isGameStarted:m,hostId:b,t:u})=>{const f=r.useRef(null),[y,C]=r.useState(!1),[x,p]=r.useState(!1);r.useEffect(()=>{if(!t)return;const T=A=>{f.current&&!f.current.contains(A.target)&&!(o!=null&&o.contains(A.target))&&n()};return document.addEventListener("mousedown",T),()=>document.removeEventListener("mousedown",T)},[t,n,o]),r.useEffect(()=>{t||(C(!1),p(!1))},[t]);const v=r.useCallback(()=>{l&&navigator.clipboard.writeText(l).then(()=>{C(!0),setTimeout(()=>C(!1),1500)}).catch(T=>{Ke.error("Failed to copy:",T)})},[l]),h=r.useCallback(()=>{if(!l)return;const T=Da();let A;if(T&&b)A=`${window.location.origin+window.location.pathname}#hostId=${encodeURIComponent(b)}`;else{const{url:U}=as(l,m,d);A=U}navigator.clipboard.writeText(A).then(()=>{p(!0),setTimeout(()=>p(!1),2e3)}).catch(U=>{Ke.error("Failed to copy:",U)})},[l,m,d,b]);if(!t||!o)return null;const O=o.getBoundingClientRect();return e.jsxs("div",{ref:f,className:"fixed z-[100] bg-gray-800 rounded-lg shadow-xl border border-gray-700 p-4 min-w-[300px]",style:{top:O.bottom+8,left:Math.max(8,O.right-300)},children:[e.jsx("h3",{className:"text-white font-bold mb-4 text-sm border-b border-gray-700 pb-2",children:u("invitePlayer")}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"bg-gray-900 rounded px-3 py-2 flex items-center justify-between gap-2",children:[e.jsx("span",{className:"font-mono text-indigo-300 text-sm truncate flex-1",children:l||"-"}),e.jsx("button",{onClick:v,disabled:!l,className:`w-8 h-8 flex items-center justify-center rounded transition-colors ${y?"bg-green-600 text-white":"bg-gray-700 hover:bg-gray-600 text-gray-300"} ${l?"":"opacity-50 cursor-not-allowed"}`,title:u("copy"),children:y?e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})}):e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),e.jsx("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]})})]})}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("span",{className:"text-gray-300 text-sm",children:u("hiddenGame")}),e.jsxs("div",{className:`flex rounded overflow-hidden ${!i||m?"opacity-50":""}`,children:[e.jsx("button",{onClick:()=>!d&&a(!0),disabled:!i||m,className:`w-10 h-8 flex items-center justify-center transition-colors ${d?"bg-red-600 text-white":"bg-gray-700 text-gray-400 hover:bg-gray-600"} ${!i||m?"cursor-not-allowed":""}`,title:u("private"),children:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:[e.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M1 1l22 22"}),e.jsx("path",{d:"M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19"})]})}),e.jsx("button",{onClick:()=>d&&a(!1),disabled:!i||m,className:`w-10 h-8 flex items-center justify-center transition-colors ${d?"bg-gray-700 text-gray-400 hover:bg-gray-600":"bg-green-600 text-white"} ${!i||m?"cursor-not-allowed":""}`,title:u("public"),children:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:[e.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),e.jsx("circle",{cx:"12",cy:"12",r:"3"})]})})]})]}),e.jsx("button",{onClick:h,disabled:!l,className:`w-full py-2 rounded text-sm font-bold transition-colors ${x?"bg-green-600 text-white":"bg-indigo-600 hover:bg-indigo-700 text-white"} ${l?"":"opacity-50 cursor-not-allowed"}`,children:u(x?"copied":"copyInviteLink")})]})});uo.displayName="InvitePlayerMenu";const ns=r.memo(({gameId:t,isGameStarted:n,onResetGame:o,onPlayerReady:l,players:d,localPlayerId:a,activeGridSize:i,onGridSizeChange:m,dummyPlayerCount:b,onDummyPlayerCountChange:u,realPlayerCount:f,connectionStatus:y,onExitGame:C,onOpenTokensModal:x,onOpenCountersModal:p,gameMode:v,onGameModeChange:h,isPrivate:O,onPrivacyChange:T,isHost:A,hostId:U,onSyncGame:S,currentPhase:g,onSetPhase:P,onNextPhase:z,onPrevPhase:R,activePlayerId:$,playerColorMap:G,isAutoAbilitiesEnabled:pe,onToggleAutoAbilities:je,isAutoDrawEnabled:Ne,onToggleAutoDraw:_,hideDummyCards:oe,onToggleHideDummyCards:ee,currentRound:te=1,turnNumber:De=1,isScoringStep:J=!1,hasLastPlayedCard:we=!1,isReconnecting:Te=!1,reconnectProgress:V=null})=>{const{t:L}=rt(),[q,X]=r.useState(!1),[M,B]=r.useState(!1),ve=r.useRef(null),[he,ce]=r.useState(!1),se=r.useRef(null),lt=r.useCallback(()=>{X(!0)},[]),yt=r.useCallback(()=>{X(!1)},[]);return e.jsxs(e.Fragment,{children:[e.jsxs("header",{className:"fixed top-0 left-0 right-0 h-14 bg-panel-bg bg-opacity-80 backdrop-blur-sm z-50 flex items-center justify-between px-4 shadow-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(io,{connectionStatus:y,isReconnecting:Te,reconnectProgress:V}),e.jsx("div",{className:"w-px h-8 bg-gray-600"}),e.jsx("button",{ref:ve,onClick:()=>B(!M),className:"bg-gray-700 hover:bg-gray-600 text-white font-medium py-2 px-3 rounded text-sm transition-colors",children:L("gameSettings")}),e.jsx("button",{ref:se,onClick:()=>ce(!he),disabled:n,className:`font-medium py-2 px-3 rounded text-sm transition-colors ${n?"bg-gray-700 text-gray-500 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-700 text-white"}`,children:L("invitePlayer")})]}),e.jsx("div",{className:"absolute left-1/2 transform -translate-x-1/2 flex items-center z-10",style:{marginLeft:"-280px"},children:e.jsx(lo,{currentRound:te,turnNumber:De,onMouseEnter:lt,onMouseLeave:yt,showTooltip:q,isGameStarted:n,t:L})}),e.jsx("div",{className:"absolute left-1/2 transform -translate-x-1/2 flex items-center z-10",children:e.jsxs("div",{className:`flex items-center bg-gray-800 rounded-lg p-1 border border-gray-700 shadow-md ${n?"":"opacity-50"}`,children:[e.jsx("button",{onClick:R,disabled:!n,className:"w-8 h-8 flex items-center justify-center text-gray-300 hover:text-white hover:bg-gray-700 rounded transition-colors disabled:cursor-not-allowed disabled:opacity-50 mr-1",children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M15 6 L8 12 L15 18 Z"})})}),hr.map((Ee,qe)=>{var ct;const ke=qe+1,xt=g===ke||g===0,et=$!==null?G.get($):void 0,Ae=et?(ct=ot[et])==null?void 0:ct.bg:"bg-yellow-500",ne=ke===4,Je=ne&&(J||we),dt=n&&xt?`${Ae} text-white`:"text-gray-400 hover:text-white",Ze=!n||ne&&!Je&&!J;return e.jsx("div",{onClick:()=>!Ze&&P(ke),className:`
                    px-3 py-1.5 text-sm font-bold uppercase transition-all duration-200 rounded
                    
                    ${Ze?"opacity-40 cursor-not-allowed":"cursor-pointer"}
                    ${Ze?"":"hover:bg-gray-700"}
                    ${dt}
                  `,children:Ee},Ee)}),e.jsx("button",{onClick:z,disabled:!n,className:"w-8 h-8 flex items-center justify-center text-gray-300 hover:text-white hover:bg-gray-700 rounded transition-colors disabled:cursor-not-allowed disabled:opacity-50 ml-1",children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M9 6 L16 12 L9 18 Z"})})})]})}),e.jsxs("div",{className:"absolute left-1/2 transform -translate-x-1/2 flex items-center z-10",style:{marginLeft:"280px"},children:[e.jsx("button",{onClick:x,className:"bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-3 rounded text-sm",children:L("tokens")}),e.jsx("button",{onClick:p,className:"bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-3 rounded text-sm ml-[5px]",children:L("counters")})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[!n&&d&&e.jsxs("button",{onClick:l,disabled:a===null,className:`font-bold py-2 px-4 rounded text-sm ${a!==null&&d.some(Ee=>Ee.id===a&&Ee.isReady)?"bg-blue-600 hover:bg-blue-700":"bg-green-600 hover:bg-green-700 animate-pulse"} disabled:bg-gray-600 disabled:opacity-70 disabled:cursor-not-allowed disabled:animate-none`,children:[L("imReady")," [",d.filter(Ee=>Ee.isReady).length,"/",d.length,"]"]}),n&&o&&e.jsx("button",{onClick:o,disabled:!A,className:"bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded text-sm disabled:bg-gray-600 disabled:opacity-70 disabled:cursor-not-allowed",title:"Reset game to lobby (keeps players and decks)",children:L("resetGame")}),e.jsx("div",{className:"w-px h-8 bg-gray-600"}),e.jsx("button",{onClick:C,className:`bg-${n?"red":"gray"}-600 hover:bg-${n?"red":"gray"}-700 text-white font-bold py-2 px-4 rounded text-sm`,children:L("exit")})]})]}),e.jsx(co,{isOpen:M,onClose:()=>B(!1),anchorEl:ve.current,isAutoAbilitiesEnabled:pe,onToggleAutoAbilities:je,isAutoDrawEnabled:Ne,onToggleAutoDraw:_,dummyPlayerCount:b,onDummyPlayerCountChange:u,realPlayerCount:f,activeGridSize:i,onGridSizeChange:m,gameMode:v,onGameModeChange:h,isGameStarted:n,isHost:A,hideDummyCards:oe,onToggleHideDummyCards:ee,t:L}),e.jsx(uo,{isOpen:he,onClose:()=>ce(!1),anchorEl:se.current,gameId:t,isPrivate:O,onPrivacyChange:T,isHost:A,isGameStarted:n,hostId:U,t:L})]})}),os=r.memo(({card:t,playerColorMap:n,localPlayerId:o,imageRefreshVersion:l,disableActiveHighlights:d})=>{const[m,b]=r.useState(()=>{if(!t.imageUrl)return t.imageUrl;const f=Tt(t.imageUrl)?Pt(t.imageUrl,100):t.imageUrl;return nt(f,l)});r.useEffect(()=>{if(!t.imageUrl)return;if(!Tt(t.imageUrl)){b(nt(t.imageUrl,l));return}const f=Pt(t.imageUrl,100),y=Pt(t.imageUrl,130),C=nt(f,l),x=nt(y,l);b(C);const p=new Image,v=()=>{b(x)};p.onload=v,p.onerror=()=>{console.warn("Failed to load target image:",x)},p.src=x,p.complete&&p.naturalWidth>0&&v()},[t.imageUrl,t.id,l]);const u=r.useMemo(()=>({...t,imageUrl:m}),[t,m]);return e.jsx(Nt,{card:u,isFaceUp:!0,playerColorMap:n,localPlayerId:o,loadPriority:"high",disableActiveHighlights:d})}),mo=({isOpen:t,onClose:n,title:o,player:l,cards:d,setDraggedItem:a,onCardContextMenu:i,onCardDoubleClick:m,onCardClick:b,onReorder:u,canInteract:f,isDeckView:y=!1,playerColorMap:C,localPlayerId:x,imageRefreshVersion:p,highlightFilter:v,cursorStack:h=null})=>{const{t:O}=rt(),[T,A]=r.useState(null),[U,S]=r.useState(null),[g,P]=r.useState(null),[z,R]=r.useState(d),[$,G]=r.useState(!1),pe=r.useRef(null),je=r.useRef(null);r.useEffect(()=>{t&&(A(null),S(null),P(null),R(d),G(!1),je.current=null)},[t,d]);const Ne=r.useMemo(()=>{if(U!==null&&g!==null&&U!==g){const V=[...z],[L]=V.splice(U,1);return V.splice(g,0,L),V}return z},[z,U,g]),_=r.useCallback((V,L)=>{f&&(S(L),A(V.id),je.current=V,G(!1))},[f]),oe=r.useCallback((V,L)=>{V.preventDefault(),V.dataTransfer.dropEffect="move",g!==L&&P(L)},[g]),ee=r.useCallback(V=>{if(!je.current||!pe.current)return;const L=pe.current.getBoundingClientRect(),q=V.clientX,X=V.clientY;if(q<L.left||q>L.right||X<L.top||X>L.bottom){const M=je.current,B=U??0;a({card:M,source:y?"deck":"discard",playerId:l.id,cardIndex:B}),G(!0),n()}},[U,y,l.id,a,n]),te=r.useCallback(()=>{$||(A(null),S(null),P(null)),je.current=null},[$]),De=r.useCallback((V,L)=>{if(V.preventDefault(),V.stopPropagation(),$)return;if(U===null||U===L){S(null),A(null),P(null);return}const q=[...z],[X]=q.splice(U,1);q.splice(L,0,X),R(q),u&&u(l.id,q),S(null),A(null),P(null)},[U,z,u,l.id,$]),we=Math.ceil(d.length/5)>5,Te="calc(5 * 7rem + 4 * 0.5rem + 1rem)";return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 pointer-events-auto",onClick:n,onContextMenu:V=>V.preventDefault(),children:e.jsxs("div",{ref:pe,onClick:V=>V.stopPropagation(),onDragLeave:ee,className:"bg-gray-800 rounded-lg p-4 shadow-xl w-auto max-w-4xl max-h-[95vh] flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2 flex-shrink-0",children:[e.jsx("h2",{className:"text-xl font-bold",children:o}),e.jsx("button",{onClick:n,className:"bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-1 px-3 rounded text-sm",children:O("close")})]}),e.jsx("div",{className:`bg-gray-900 rounded p-2 ${we?"overflow-y-auto":""}`,style:we?{height:Te}:{},children:e.jsxs("div",{className:"grid grid-cols-5 gap-2",children:[Ne.map((V,L)=>{const q=z.findIndex(se=>se.id===V.id),X=v?v(V):!0,M=X,B=T===V.id,ve=g===L&&U!==L,he=f&&X&&!h,ce=B?.5:X?1:.3;return e.jsx("div",{style:{opacity:ce},draggable:he,onDragStart:()=>_(V,q),onDragOver:se=>oe(se,L),onDragEnd:te,onDrop:se=>De(se,L),onContextMenu:se=>{se.preventDefault(),se.stopPropagation(),i&&i(se,q)},onClick:()=>he&&(b==null?void 0:b(q)),onDoubleClick:()=>he&&(m==null?void 0:m(q)),"data-interactive":he,className:`w-28 h-28 relative transition-all rounded-lg
                    ${he?"cursor-grab active:cursor-grabbing":"cursor-default"}
                    ${ve?"scale-105 z-10":""}
                    ${B?"scale-95":"hover:scale-105"}
                  `,children:e.jsx("div",{className:`w-full h-full ${M&&v?"ring-3 ring-cyan-400 rounded-md shadow-[0_0_9px_#22d3ee]":""}`,children:e.jsx(os,{card:V,playerColorMap:C,localPlayerId:x,imageRefreshVersion:p,disableActiveHighlights:!X})})},`${V.id}-${L}`)}),Ne.length===0&&e.jsx("p",{className:"col-span-5 w-full text-center text-gray-400 py-8",children:O("empty")})]})}),e.jsx("p",{className:"text-gray-400 text-xs mt-2 text-center",children:O("dragCardsReorder")})]})}):null},rs=Object.freeze(Object.defineProperty({__proto__:null,DeckViewModal:mo},Symbol.toStringTag,{value:"Module"})),po=({isOpen:t,onClose:n,setDraggedItem:o,openContextMenu:l,canInteract:d,anchorEl:a,imageRefreshVersion:i,localPlayerId:m,activePlayerId:b,players:u})=>{const{t:f}=rt(),[y,C]=r.useState(null),[x,p]=r.useState(!1),v=r.useRef(null),h=r.useRef(null);if(r.useEffect(()=>{t&&(C(null),p(!1),h.current=null)},[t]),!t||!a)return null;const O=(br[Qe.Tokens]||[]).filter(g=>!g.allowedPanels||g.allowedPanels.includes("TOKEN_PANEL")),T={position:"fixed",top:`${a.top}px`,left:`${a.left}px`,zIndex:60},A=g=>{d&&(C(g.id),h.current=g,p(!1))},U=g=>{if(!h.current||!v.current)return;const P=v.current.getBoundingClientRect(),z=g.clientX,R=g.clientY;if(z<P.left||z>P.right||R<P.top||R>P.bottom){const $=u==null?void 0:u.find(pe=>pe.id===b),G=$!=null&&$.isDummy&&b!==null?b:m??void 0;o({card:h.current,source:"token_panel",ownerId:G}),p(!0),n()}},S=()=>{x||C(null),h.current=null};return e.jsx("div",{style:T,className:"pointer-events-auto",ref:v,onDragLeave:U,children:e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 shadow-xl w-96 max-w-[90vw] h-auto flex flex-col",onClick:g=>g.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h2",{className:"text-xl font-bold",children:f("tokens")}),e.jsx("button",{onClick:n,className:"bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-1 px-3 rounded text-sm",children:f("close")})]}),e.jsx("div",{className:"flex-grow bg-gray-900 rounded p-2 overflow-y-auto",children:e.jsx("div",{className:"grid grid-cols-3 gap-2",children:O.map(g=>{const P=y===g.id,z=P?.5:1;return e.jsx("div",{style:{opacity:z},draggable:d,onDragStart:()=>A(g),onDragEnd:S,onContextMenu:R=>d&&l(R,"token_panel_item",{card:g}),"data-interactive":d,className:`w-24 h-24 transition-all rounded-lg ${d?"cursor-grab active:cursor-grabbing hover:scale-105":"cursor-not-allowed"} ${P?"scale-95":""}`,children:e.jsx(Nt,{card:g,isFaceUp:!0,playerColorMap:new Map,imageRefreshVersion:i})},g.id)})})}),e.jsx("p",{className:"text-gray-400 text-xs mt-2 text-center",children:f("dragOutsideToPlaceToken")})]})})},ss=Object.freeze(Object.defineProperty({__proto__:null,TokensModal:po},Symbol.toStringTag,{value:"Module"})),go=({isOpen:t,onClose:n,canInteract:o,anchorEl:l,imageRefreshVersion:d,onCounterMouseDown:a,cursorStack:i})=>{const{getCounterTranslation:m,t:b}=rt(),[u,f]=r.useState(null),[y,C]=r.useState({x:0,y:0}),x=r.useMemo(()=>yr(),[xr().size]);if(!t||!l)return null;const p={position:"fixed",top:`${l.top}px`,left:`${l.left}px`,zIndex:60},v=S=>{let g=ma[S];if(g&&d){const P=g.includes("?")?"&":"?";g=`${g}${P}v=${d}`}return g},h=(S,g,P)=>{if(S.button===2){const z=m(g),R=z?z.name:P,$=z?z.description:Ta[g]||"",G={id:`tooltip_${g}_${Date.now()}`,deck:"counter",name:R,imageUrl:"",fallbackImage:"",power:0,ability:$,types:[],statuses:[]};f(G),C({x:S.clientX,y:S.clientY})}else S.button===0&&o&&a(g,S)},O=()=>{f(null)},T=S=>{u&&C({x:S.clientX,y:S.clientY})},A=()=>{i&&n(),f(null)},U=S=>{const g=S.currentTarget.getBoundingClientRect(),P=S.clientX,z=S.clientY;(P<g.left||P>=g.right||z<g.top||z>=g.bottom)&&n()};return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:p,className:"pointer-events-auto counter-modal-content",onMouseLeave:A,onDragLeave:U,children:e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 shadow-xl w-80 max-w-[90vw] h-auto flex flex-col",onClick:S=>S.stopPropagation(),children:[e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold",children:b("counters")}),e.jsx("button",{onClick:n,className:"bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-1 px-3 rounded text-sm",children:b("close")})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:b("holdRightClickViewHints")})]}),e.jsx("div",{className:"bg-gray-900 rounded p-4",children:e.jsx("div",{className:"grid grid-cols-4 gap-1",children:x.map(S=>{const g=v(S.type),P=S.type.startsWith("Power"),z=m(S.type),R=z?z.name:S.label;return e.jsx("button",{onContextMenu:$=>$.preventDefault(),onMouseDown:$=>h($,S.type,R),onMouseUp:O,onMouseMove:T,className:"w-12 h-12 rounded-full border-2 border-white shadow-lg mx-auto relative select-none",style:{backgroundColor:"rgb(107, 114, 128)",cursor:o?"pointer":"not-allowed"},children:g?e.jsx("img",{src:g,alt:R,className:"w-full h-full object-contain p-1 pointer-events-none"}):e.jsx("span",{className:`font-bold text-white pointer-events-none ${P?"text-sm":"text-lg"}`,style:{textShadow:"0 0 2px black"},children:P?R:S.type.charAt(0)})},S.type)})})})]})}),u&&e.jsx(ao,{x:y.x,y:y.y,children:e.jsx(Za,{card:u,statusDescriptions:Ta})})]})},is=Object.freeze(Object.defineProperty({__proto__:null,CountersModal:go},Symbol.toStringTag,{value:"Module"})),fo=({player:t,onDragStart:n})=>{const o=ot[t.color]||ot.blue;return e.jsxs("div",{draggable:!0,onDragStart:l=>n(l,t.id),className:"flex items-center gap-2 bg-gray-600 p-2 rounded-md cursor-grab active:cursor-grabbing",children:[e.jsx("div",{className:`w-4 h-4 rounded-full ${o.bg} border border-white/50`}),e.jsx("span",{className:"font-medium",children:t.name})]})},Wn=({teamId:t,teamName:n,players:o,capacity:l,onDrop:d,onDragOver:a,onDragLeave:i,onPlayerDragStart:m,isOver:b})=>e.jsxs("div",{onDrop:u=>d(u,t),onDragOver:a,onDragLeave:i,className:`bg-gray-800 p-4 rounded-lg border-2 ${b?"border-indigo-500":"border-gray-700"} transition-colors`,children:[e.jsxs("h3",{className:"text-lg font-bold mb-3 border-b border-gray-700 pb-2",children:[n," (",o.length,"/",l,")"]}),e.jsx("div",{className:"space-y-2 min-h-[4rem]",children:o.map(u=>e.jsx(fo,{player:u,onDragStart:m},u.id))})]}),ho=({players:t,gameMode:n,onCancel:o,onConfirm:l})=>{const{t:d}=rt(),[a,i]=r.useState(t),[m,b]=r.useState([]),[u,f]=r.useState([]),[y,C]=r.useState(null),[x,p]=r.useState(null),{team1Capacity:v,team2Capacity:h}=r.useMemo(()=>n===ca.TwoVTwo?{team1Capacity:2,team2Capacity:2}:n===ca.ThreeVOne?{team1Capacity:3,team2Capacity:1}:(Ke.warn(`Unexpected gameMode: ${n}, falling back to TwoVTwo capacities`),{team1Capacity:2,team2Capacity:2}),[n]),O=a.length===0&&m.length===v&&u.length===h,T=(g,P)=>{g.dataTransfer.effectAllowed="move",C(P)},A=g=>{g.preventDefault(),g.dataTransfer.dropEffect="move"},U=(g,P)=>{if(g.preventDefault(),y===null)return;const z=t.find(_=>_.id===y);if(!z)return;const R=[...a],$=[...m],G=[...u],pe=R.findIndex(_=>_.id===y);pe>-1&&R.splice(pe,1);const je=$.findIndex(_=>_.id===y);je>-1&&$.splice(je,1);const Ne=G.findIndex(_=>_.id===y);Ne>-1&&G.splice(Ne,1),P===1&&$.length<v?$.push(z):P===2&&G.length<h?G.push(z):R.push(z),i(R),b($),f(G),C(null),p(null)},S=()=>{if(!O)return;const g={1:m.map(P=>P.id),2:u.map(P=>P.id)};l(g)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-900 border border-gray-700 rounded-lg p-8 shadow-xl w-full max-w-4xl",children:[e.jsx("h2",{className:"text-3xl font-bold mb-2",children:d("assignTeams")}),e.jsx("p",{className:"text-gray-400 mb-6",children:d("dragToReorder")}),e.jsxs("div",{className:"grid grid-cols-3 gap-6",children:[e.jsxs("div",{onDrop:g=>U(g,"unassigned"),onDragOver:g=>{A(g),p("unassigned")},onDragLeave:()=>p(null),className:`bg-gray-800 p-4 rounded-lg border-2 ${x==="unassigned"?"border-indigo-500":"border-gray-700"} transition-colors`,children:[e.jsx("h3",{className:"text-lg font-bold mb-3 border-b border-gray-700 pb-2",children:d("unassigned")}),e.jsx("div",{className:"space-y-2",children:a.map(g=>e.jsx(fo,{player:g,onDragStart:T},g.id))})]}),e.jsx(Wn,{teamId:1,teamName:`${d("team")} 1`,players:m,capacity:v,onDrop:U,onDragOver:g=>{A(g),p(1)},onDragLeave:()=>p(null),onPlayerDragStart:T,isOver:x===1}),e.jsx(Wn,{teamId:2,teamName:`${d("team")} 2`,players:u,capacity:h,onDrop:U,onDragOver:g=>{A(g),p(2)},onDragLeave:()=>p(null),onPlayerDragStart:T,isOver:x===2})]}),e.jsxs("div",{className:"flex justify-end mt-8 space-x-4",children:[e.jsx("button",{type:"button",onClick:o,className:"bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded",children:d("cancel")}),e.jsx("button",{type:"button",onClick:S,disabled:!O,className:"bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors",children:d("confirmTeams")})]})]})})},ls=Object.freeze(Object.defineProperty({__proto__:null,TeamAssignmentModal:ho},Symbol.toStringTag,{value:"Module"})),Qa=({card:t,ownerPlayer:n,onClose:o,statusDescriptions:l,allPlayers:d,imageRefreshVersion:a})=>{var U,S,g,P,z;const{getCardTranslation:i,getCounterTranslation:m,resources:b}=rt(),u=b.abilityKeywords,[f,y]=r.useState(t.imageUrl),C=t.baseId?i(t.baseId):void 0,x=C?{...t,...C}:t;r.useEffect(()=>{let R=t.imageUrl;if(a&&R){const $=R.includes("?")?"&":"?";R=`${R}${$}v=${a}`}y(R)},[t.imageUrl,a]);const p=()=>{let R=t.fallbackImage;if(a&&R){const $=R.includes("?")?"&":"?";R=`${R}${$}v=${a}`}f!==R&&y(R??"")},v=n==null?void 0:n.color,h=v?((U=ot[v])==null?void 0:U.border)||((S=Fa[t.deck])==null?void 0:S.color)||"border-gray-300":((g=Fa[t.deck])==null?void 0:g.color)||"border-gray-300",O=r.useMemo(()=>(n==null?void 0:n.teamId)===void 0?null:`Team ${n.teamId}`,[n]),T=["readyDeploy","readySetup","readyCommit","setupUsedThisTurn","commitUsedThisTurn"],A=(t.statuses??[]).reduce((R,$)=>(T.includes($.type)||(R[$.type]||(R[$.type]=[]),R[$.type].push($.addedByPlayerId)),R),{});return e.jsx("div",{onClick:o,className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-[300]",children:e.jsxs("div",{onClick:R=>R.stopPropagation(),className:`bg-gray-800 rounded-lg shadow-2xl w-full max-w-4xl h-[40rem] p-6 flex gap-6 border-4 ${h}`,children:[e.jsx("div",{className:"w-1/2 h-full flex-shrink-0",children:f?e.jsx("img",{src:f,onError:p,alt:x.name,className:"w-full h-full object-contain rounded-lg"}):e.jsx("div",{className:"w-full h-full bg-gray-700 rounded-lg flex items-center justify-center text-2xl font-bold text-center p-4",children:x.name})}),e.jsxs("div",{className:"w-1/2 h-full flex flex-col gap-4 overflow-y-auto pr-2 text-left",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-4xl font-bold",children:x.name}),e.jsx("p",{className:"text-lg text-gray-400 capitalize",children:((P=x.types)==null?void 0:P.join(", "))||`${x.deck} Card`})]}),e.jsxs("div",{className:"bg-gray-900 p-4 rounded-lg",children:[e.jsxs("p",{children:[e.jsx("strong",{className:"text-indigo-400 text-lg",children:"Power:"})," ",e.jsx("span",{className:"text-xl font-bold",children:x.power})]}),e.jsxs("p",{className:"mt-2",children:[e.jsx("strong",{className:"text-indigo-400 text-lg",children:"Ability:"})," ",e.jsx("span",{className:"text-gray-200 text-base",children:qa(x.ability,u)})]})]}),n&&e.jsxs("div",{className:"bg-gray-900 p-4 rounded-lg text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{className:"text-indigo-400",children:"Owner:"})," ",n.name]}),O&&e.jsxs("p",{className:"mt-1",children:[e.jsx("strong",{className:"text-indigo-400",children:"Team:"})," ",O]})]}),t.statuses&&t.statuses.length>0&&e.jsxs("div",{className:"bg-gray-900 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-indigo-400 text-lg font-bold mb-2",children:"Statuses"}),e.jsx("ul",{className:"space-y-2 text-sm",children:Object.entries(A).map(([R,$])=>{const G=$.reduce((_,oe)=>(_[oe]=(_[oe]||0)+1,_),{}),pe=Object.entries(G).map(([_,oe])=>{var te;return`${((te=d.find(De=>De.id===Number(_)))==null?void 0:te.name)||`Player ${_}`} (x${oe})`}).join(", "),je=m(R),Ne=je?je.description:l[R]||"No description available.";return e.jsxs("li",{children:[e.jsx("strong",{className:"text-gray-200",children:R})," ",e.jsxs("span",{className:"text-gray-400 text-xs ml-1",children:["- ",pe]}),e.jsx("p",{className:"text-gray-400 text-xs pl-2 mt-0.5",children:Ne})]},R)})})]}),x.flavorText&&e.jsxs("div",{className:"bg-gray-900 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-indigo-400 font-bold mb-1",children:"Flavor Text"}),e.jsx("p",{className:"italic text-gray-400",children:(z=x.flavorText)==null?void 0:z.split(`
`).map((R,$)=>e.jsxs(Ot.Fragment,{children:[$>0&&e.jsx("br",{}),R]},$))})]}),e.jsx("button",{onClick:o,className:"mt-auto bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded self-end",children:"Close"})]})]})})},ds=Object.freeze(Object.defineProperty({__proto__:null,CardDetailModal:Qa},Symbol.toStringTag,{value:"Module"})),bo=({fromPlayer:t,cardCount:n,onAccept:o,onDecline:l})=>e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[105]",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg p-8 shadow-xl w-full max-w-md text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Reveal Request"}),e.jsxs("p",{className:"text-gray-300 mb-6",children:[e.jsx("span",{className:"font-bold",children:t.name})," would like to see ",n>1?`${n} of your hidden cards`:"one of your hidden cards","."]}),e.jsxs("div",{className:"flex justify-center space-x-4",children:[e.jsx("button",{onClick:l,className:"bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-6 rounded transition-colors",children:"Decline"}),e.jsx("button",{onClick:o,className:"bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded transition-colors",children:"Accept"})]})]})}),cs=Object.freeze(Object.defineProperty({__proto__:null,RevealRequestModal:bo},Symbol.toStringTag,{value:"Module"})),yo=({x:t,y:n,items:o,onClose:l})=>{const d=r.useRef(null),[a,i]=r.useState({top:n,left:t});return r.useEffect(()=>{if(d.current){const{innerWidth:m,innerHeight:b}=window,{offsetWidth:u,offsetHeight:f}=d.current,y=t+u>m?m-u-10:t,C=n+f>b?b-f-10:n;i({top:C,left:y})}},[t,n,o]),Zn.createPortal(e.jsx("div",{ref:d,className:"fixed bg-gray-900 border border-gray-700 rounded-md shadow-lg z-[9999] py-1",style:{top:a.top,left:a.left,opacity:d.current?1:0},onClick:m=>m.stopPropagation(),children:o.map((m,b)=>"isDivider"in m?e.jsx("hr",{className:"border-gray-700 my-1"},`divider-${b}`):"onClick"in m?e.jsx("button",{onClick:()=>{m.disabled||(m.onClick(),l())},disabled:m.disabled,className:"block w-full text-left px-4 py-1 text-sm text-white hover:bg-indigo-600 disabled:text-gray-500 disabled:cursor-not-allowed disabled:bg-gray-800",style:{fontWeight:m.isBold?"bold":"normal"},children:m.label},b):e.jsxs("div",{className:"flex items-center justify-between px-4 py-1 text-sm text-white w-full space-x-2",children:[e.jsx("button",{onClick:u=>{u.stopPropagation(),m.onRemove()},disabled:m.removeDisabled,className:"w-7 h-6 flex items-center justify-center bg-gray-700 hover:bg-red-600 rounded disabled:bg-gray-800 disabled:text-gray-500 disabled:cursor-not-allowed font-mono text-lg",children:"-"}),e.jsx("span",{className:"flex-grow text-center",children:m.label}),e.jsx("button",{onClick:u=>{u.stopPropagation(),m.onAdd()},className:"w-7 h-6 flex items-center justify-center bg-gray-700 hover:bg-green-600 rounded font-mono text-lg",children:"+"})]},b))}),document.body)},xo=({isOpen:t,card:n,playerColorMap:o,onConfirm:l,onCancel:d})=>{const{getCardTranslation:a,t:i,resources:m}=rt(),b=m.abilityKeywords,u=n.baseId?a(n.baseId):void 0,f=u?{...n,...u}:n,y=f.ability||"",C=Ot.useMemo(()=>y.split("●").map(p=>p.trim()).filter(p=>p.length>0),[y]);return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-[200] backdrop-blur-sm",children:e.jsxs("div",{className:"bg-gray-900 rounded-xl border-2 border-yellow-500 shadow-2xl p-6 w-full max-w-4xl flex gap-6",children:[e.jsxs("div",{className:"w-1/3 flex flex-col items-center justify-center border-r border-gray-700 pr-6",children:[e.jsx("div",{className:"w-72 h-72 relative transform hover:scale-105 transition-transform duration-300",children:e.jsx(Nt,{card:f,isFaceUp:!0,playerColorMap:o,disableTooltip:!0})}),e.jsx("h2",{className:"text-2xl font-bold text-yellow-500 mt-6 text-center leading-tight",children:f.name})]}),e.jsxs("div",{className:"w-2/3 flex flex-col",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-4 border-b border-gray-700 pb-2",children:"Select Module"}),e.jsxs("div",{className:"flex flex-col gap-3 flex-grow justify-center overflow-y-auto max-h-[60vh] pr-2",children:[C.map((x,p)=>e.jsxs("button",{onClick:()=>l(p),className:"group relative bg-gray-800 hover:bg-indigo-900 border-2 border-gray-600 hover:border-indigo-400 rounded-lg p-4 transition-all duration-200 text-left shadow-lg hover:shadow-indigo-500/20 flex items-start gap-4 shrink-0",children:[e.jsx("div",{className:"bg-gray-700 text-gray-400 w-6 h-6 flex-shrink-0 flex items-center justify-center rounded-full font-bold text-xs group-hover:bg-indigo-500 group-hover:text-white transition-colors mt-1",children:p+1}),e.jsx("div",{className:"text-gray-200 group-hover:text-white text-base font-medium leading-snug",children:qa(x,b)})]},p)),C.length===0&&e.jsx("div",{className:"text-gray-500 text-center italic",children:"No selectable modules found on this card."})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx("button",{onClick:d,className:"px-6 py-2 rounded bg-gray-700 hover:bg-gray-600 text-white font-bold transition-colors text-sm",children:i("cancel")})})]})]})}):null},us=Object.freeze(Object.defineProperty({__proto__:null,CommandModal:xo},Symbol.toStringTag,{value:"Module"})),vo="0.2.11",ms=r.memo(({handleCreateGame:t,handleJoinGame:n,gamesList:o,requestGamesList:l,setViewingCard:d,handleSaveSettings:a,viewingCard:i,gameState:m,imageRefreshVersion:b,t:u,connectionStatus:f,forceReconnect:y,gameId:C=null,isGameStarted:x=!1,isPrivate:p=!1,initializeWebrtcHost:v})=>{const[h,O]=r.useState(!1),T=vr(),A=jr(),U=kr(),S=wr(),g=Da();r.useEffect(()=>{T.isOpen&&l()},[T.isOpen,l]);const P=()=>{T.open({games:o,onJoin:n,onRefreshGames:l})},z=()=>{A.open({setViewingCard:d})},R=()=>{U.open({connectionStatus:f,onReconnect:y,onSave:a,gameId:C,isGameStarted:x,isPrivate:p})},$=()=>{S.open({})},G=async()=>{if(v){O(!0);try{await v()&&t()}catch(pe){console.error("Failed to initialize host:",pe)}finally{O(!1)}}};return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gray-900 text-white relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 z-0 opacity-30",style:{backgroundImage:"url(https://images.unsplash.com/photo-1614728853975-69c960c725af?q=80&w=1920&auto=format&fit=crop)",backgroundSize:"cover",backgroundPosition:"center"}}),e.jsxs("div",{className:"z-10 text-center p-8 bg-black bg-opacity-60 rounded-xl shadow-2xl border border-gray-700 max-w-md w-full",children:[e.jsx("h1",{className:"text-5xl font-bold mb-2 text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-600 drop-shadow-lg",children:"New Avalon"}),e.jsx("h2",{className:"text-2xl font-light mb-6 text-gray-300 tracking-widest",children:"SKIRMISH"}),e.jsxs("div",{className:"space-y-4 w-full",children:[e.jsx("button",{onClick:g?G:t,disabled:!g&&f!=="Connected",className:`w-full font-bold py-3 px-6 rounded-lg shadow-lg transition-all transform flex items-center justify-center gap-2 ${g&&!h||!g&&f==="Connected"?"bg-indigo-600 hover:bg-indigo-700 text-white hover:scale-105":"bg-gray-800 text-gray-500 cursor-not-allowed"}`,children:g?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 12h14M12 5l7 7-7 7"})}),h?u("connecting")+"...":u("hostGame")]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),u("startGame")]})}),e.jsxs("button",{onClick:P,disabled:g||f!=="Connected",className:`w-full font-bold py-3 px-6 rounded-lg shadow-lg transition-all transform flex items-center justify-center gap-2 ${!g&&f==="Connected"?"bg-gray-700 hover:bg-gray-600 text-white hover:scale-105":"bg-gray-800 text-gray-500 cursor-not-allowed"}`,title:g?"Join via invite link in WebRTC mode":"",children:[e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),u("joinGame")]}),e.jsxs("button",{disabled:!0,className:"w-full bg-gray-800 text-gray-500 font-bold py-3 px-6 rounded-lg shadow-inner flex items-center justify-center gap-2 cursor-not-allowed border border-gray-700",title:u("comingSoon"),children:[e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})}),u("storyMode")]}),e.jsxs("button",{disabled:!0,className:"w-full bg-gray-800 text-gray-500 font-bold py-3 px-6 rounded-lg shadow-inner flex items-center justify-center gap-2 cursor-not-allowed border border-gray-700",title:u("comingSoon"),children:[e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})}),u("puzzles")]}),e.jsxs("button",{onClick:z,className:"w-full bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-all transform hover:scale-105 flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})}),u("deckBuilding")]}),e.jsxs("button",{onClick:$,className:"w-full bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-all transform hover:scale-105 flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})}),u("rules")]}),e.jsxs("button",{onClick:R,className:"w-full bg-gray-800 hover:bg-gray-700 text-gray-300 font-bold py-2 px-6 rounded-lg shadow transition-all flex items-center justify-center gap-2 border border-gray-600",children:[e.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),u("settings")]})]}),e.jsxs("div",{className:"mt-6 flex items-center justify-center gap-2",children:[e.jsxs("span",{className:"relative flex h-3 w-3",children:[g&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-blue-500"})]}),!g&&f==="Connected"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-green-500"})]}),!g&&f==="Connecting"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-yellow-400 opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-yellow-500"})]}),!g&&f==="Disconnected"&&e.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-red-500"})]}),e.jsx("span",{className:"text-sm text-gray-400",children:g?u("peerToPeer"):e.jsxs(e.Fragment,{children:[f==="Connected"&&u("connected"),f==="Connecting"&&u("connecting"),f==="Disconnected"&&u("disconnected")]})}),!g&&f==="Disconnected"&&e.jsx("button",{onClick:y,className:"ml-2 text-xs text-blue-400 hover:text-blue-300 underline",children:u("reconnect")})]}),e.jsxs("div",{className:"mt-8 pt-6 border-t border-gray-700 flex justify-center gap-6",children:[e.jsx("a",{href:"https://t.me/NeurohoretApp",target:"_blank",rel:"noopener noreferrer",className:"transition-transform hover:scale-110",title:"Telegram",children:e.jsx("img",{src:"https://res.cloudinary.com/dxxh6meej/image/upload/v1764190409/Telegram_logo.svg_rnhkud.webp",alt:"Telegram",className:"w-8 h-8"})}),e.jsx("a",{href:"https://discord.gg/U5zKADsZZY",target:"_blank",rel:"noopener noreferrer",className:"transition-transform hover:scale-110",title:"Discord",children:e.jsx("img",{src:"https://res.cloudinary.com/dxxh6meej/image/upload/v1764190408/discord-icon_nhgjyx.svg",alt:"Discord",className:"w-8 h-8"})}),e.jsx("a",{href:"https://www.donationalerts.com/r/anahoret",target:"_blank",rel:"noopener noreferrer",className:"transition-transform hover:scale-110",title:"DonationAlerts",children:e.jsx("img",{src:"https://res.cloudinary.com/dxxh6meej/image/upload/v1764190414/donationalerts_hpjtbe.png",alt:"DonationAlerts",className:"w-8 h-8 rounded"})}),e.jsx("a",{href:"https://www.patreon.com/c/AnchoriteComics",target:"_blank",rel:"noopener noreferrer",className:"transition-transform hover:scale-110",title:"Patreon",children:e.jsx("img",{src:"https://res.cloudinary.com/dxxh6meej/image/upload/v1764190408/Patreon_logo.svg_ala7gn.png",alt:"Patreon",className:"w-8 h-8"})})]})]}),e.jsxs("div",{className:"absolute bottom-4 text-gray-500 text-xs",children:["v",vo]}),i&&e.jsx(Qa,{card:i.card,ownerPlayer:i.player,onClose:()=>d(null),statusDescriptions:Ta,allPlayers:m.players,imageRefreshVersion:b})]})}),ps="https://res.cloudinary.com/dxxh6meej/image/upload/v1771365397/medal_tavarc.webp",jo=({gameState:t,onContinueGame:n,onStartNextRound:o,onExit:l})=>{const{t:d}=rt();if(!t.isRoundEndModalOpen)return null;const a=t.roundWinners[t.currentRound]||[],m=!!t.gameWinner,b=t.currentRound+1,u=b*10+10,f=[...t.players].sort((p,v)=>p.id-v.id),y=t.startingPlayerId||1,C=f.findIndex(p=>p.id===y);let x=[];return C!==-1?x=[...f.slice(C),...f.slice(0,C)]:x=f,e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-[200] backdrop-blur-sm",children:e.jsxs("div",{className:"bg-gray-900 rounded-lg border-2 border-gray-700 shadow-2xl p-6 w-full max-w-md text-left relative",children:[e.jsx("div",{className:"mb-4 text-center",children:e.jsx("h2",{className:"text-sm font-bold text-gray-400 uppercase tracking-widest leading-none",children:m?d("gameOver"):`${d("round")} ${t.currentRound} ${d("complete")}`})}),e.jsx("div",{className:"space-y-2 mb-4",children:x.map(p=>{const v=a.includes(p.id),h=Object.values(t.roundWinners).flat().filter(T=>T===p.id).length,O=ot[p.color];return e.jsxs("div",{className:`flex items-center justify-between p-3 rounded bg-gray-800 border ${v?"border-yellow-500/50":"border-gray-700"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${(O==null?void 0:O.bg)||"bg-gray-500"}`}),e.jsx("span",{className:`font-bold text-lg ${v?"text-white":"text-gray-400"}`,children:p.name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl font-bold text-white font-mono mr-2",children:p.score}),h>0&&Array.from({length:h}).map((T,A)=>e.jsx("img",{src:ps,alt:"Winner",className:"w-6 h-6 object-contain drop-shadow-md",title:d("roundWinner")},A))]})]},p.id)})}),e.jsx("hr",{className:"border-gray-600 my-2"}),e.jsxs("div",{className:"text-xs text-gray-400 flex justify-between px-1",children:[e.jsxs("span",{children:[d("endedOnTurn")," ",t.turnNumber]}),e.jsxs("span",{children:["v",vo]})]}),e.jsx("hr",{className:"border-gray-600 my-2"}),e.jsx("div",{className:"text-sm text-gray-300 leading-snug space-y-2 mt-3",children:m?e.jsxs("div",{className:"text-center py-2",children:[e.jsx("div",{className:"text-yellow-400 font-bold text-lg mb-1",children:d("matchComplete")}),e.jsx("p",{className:"text-gray-400 text-xs",children:d("thankYouPlaying")})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:d("nextRound")}),e.jsxs("span",{className:"font-bold text-white",children:[d("round")," ",b]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:d("victoryCondition")}),e.jsxs("span",{className:"font-bold text-yellow-400",children:[u," ",d("score")]})]})]})}),e.jsx("div",{className:"mt-6 flex justify-end gap-3",children:m?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:l,className:"flex-1 bg-red-900 hover:bg-red-800 text-white font-bold py-2 px-4 rounded border border-red-700 text-sm transition-colors",children:d("returnToMenu")}),e.jsx("button",{onClick:n,className:"flex-1 bg-green-800 hover:bg-green-700 text-white font-bold py-2 px-4 rounded border border-green-600 text-sm transition-colors",children:d("continueGame")})]}):e.jsxs("button",{onClick:o,className:"bg-green-800 hover:bg-green-700 text-white font-bold py-2 px-6 rounded border border-green-600 text-sm transition-colors w-full",children:[d("startRound")," ",b]})})]})})},gs=Object.freeze(Object.defineProperty({__proto__:null,RoundEndModal:jo},Symbol.toStringTag,{value:"Module"})),Ua=t=>t.filter(o=>o.type!=="Support"&&o.type!=="Threat"&&o.type!=="LastPlayed"&&o.type!=="REMOVE_COMMIT"&&o.type!=="RESET_DEPLOY"&&o.type!=="REDEPLOY"&&o.type!=="readyDeploy"&&o.type!=="readyCommit"&&o.type!=="readySetup").reduce((o,l)=>(o[l.type]=(o[l.type]||0)+1,o),{}),ko=({isOpen:t,data:n,onConfirm:o,onCancel:l})=>{const[d,a]=r.useState(()=>Ua(n.card.statuses||[])),[i,m]=r.useState(()=>Ua(n.card.statuses||[]));if(r.useEffect(()=>{if(t&&n.card){const x=Ua(n.card.statuses||[]);a(x),m(x)}},[t,n.card]),!t)return null;const b=Object.keys(i),u=x=>{const p=d[x]||0;p>0&&a({...d,[x]:p-1})},f=x=>{const p=d[x]||0,v=i[x];p<v&&a({...d,[x]:p+1})},y=b.reduce((x,p)=>x+(i[p]-d[p]),0),C=()=>{const x={};b.forEach(p=>{const v=i[p]-d[p];v>0&&(x[p]=v)}),o(x,n)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[250]",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 shadow-xl w-96 border border-gray-600",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-4 text-center",children:"Remove Counters"}),e.jsxs("p",{className:"text-gray-400 text-sm mb-6 text-center",children:["Adjust counters on ",e.jsx("strong",{children:n.card.name}),".",e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-500",children:"Press (-) to remove, (+) to keep."})]}),e.jsxs("div",{className:"space-y-3 mb-6 bg-gray-900 p-3 rounded-lg max-h-[300px] overflow-y-auto",children:[b.length===0&&e.jsx("p",{className:"text-center text-gray-500 italic py-4",children:"No removable counters found."}),b.map(x=>{const p=d[x],v=i[x],h=ma[x];return e.jsxs("div",{className:"flex items-center justify-between bg-gray-800 border border-gray-700 p-3 rounded",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 flex items-center justify-center bg-gray-700 rounded-sm",children:h?e.jsx("img",{src:h,className:"w-6 h-6 object-contain",alt:`${x} icon`}):e.jsx("span",{className:"font-bold text-white",children:x[0]})}),e.jsx("div",{children:e.jsx("div",{className:"text-gray-200 font-medium leading-none",children:x})})]}),e.jsxs("div",{className:"flex items-center bg-gray-700 rounded border border-gray-600",children:[e.jsx("button",{onClick:()=>u(x),disabled:p===0,className:"w-8 h-8 flex items-center justify-center text-gray-400 hover:text-white hover:bg-gray-600 disabled:opacity-30 disabled:hover:bg-transparent transition-colors",children:"-"}),e.jsx("div",{className:"w-8 text-center font-bold text-white select-none",children:p}),e.jsx("button",{onClick:()=>f(x),disabled:p>=v,className:"w-8 h-8 flex items-center justify-center text-gray-400 hover:text-white hover:bg-gray-600 disabled:opacity-30 disabled:hover:bg-transparent transition-colors",children:"+"})]})]},x)})]}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t border-gray-700",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400 text-sm",children:"Total Removed:"}),e.jsx("span",{className:"text-indigo-400 font-bold text-xl ml-2",children:y})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:l,className:"px-4 py-2 rounded bg-gray-700 hover:bg-gray-600 text-sm font-medium transition-colors",children:"Cancel"}),e.jsx("button",{onClick:C,className:"px-4 py-2 rounded bg-green-600 hover:bg-green-500 font-bold text-sm text-white shadow-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:y===0,children:"Confirm"})]})]})]})})},fs=Object.freeze(Object.defineProperty({__proto__:null,CounterSelectionModal:ko},Symbol.toStringTag,{value:"Module"})),hs=r.memo(({card:t,playerColorMap:n,localPlayerId:o,imageRefreshVersion:l})=>{const[i,m]=r.useState(()=>{if(!t.imageUrl)return t.imageUrl;const u=Tt(t.imageUrl)?Pt(t.imageUrl,100):t.imageUrl;return nt(u,l)});r.useEffect(()=>{if(!t.imageUrl)return;if(!Tt(t.imageUrl)){m(nt(t.imageUrl,l));return}const u=Pt(t.imageUrl,100),f=Pt(t.imageUrl,150),y=nt(u,l),C=nt(f,l);m(y);const x=new Image,p=()=>{m(C)};x.onload=p,x.onerror=()=>{console.warn("Failed to load target image:",C)},x.src=C,x.complete&&x.naturalWidth>0&&p()},[t.imageUrl,t.id,l]);const b=r.useMemo(()=>({...t,imageUrl:i}),[t,i]);return e.jsx(Nt,{card:b,isFaceUp:!0,playerColorMap:n,localPlayerId:o,loadPriority:"high"})}),bs=r.memo(({isOpen:t,player:n,onClose:o,onReorder:l,onMoveToBottom:d,onMoveToHand:a,onMoveToDiscard:i,onPlayCard:m,onViewCard:b,setDraggedItem:u,playerColorMap:f,localPlayerId:y,imageRefreshVersion:C,initialCount:x=3,isLocked:p=!1})=>{const{t:v}=rt(),[h,O]=r.useState(x),[T,A]=r.useState(null),[U,S]=r.useState(null),[g,P]=r.useState(null),[z,R]=r.useState(null),[$,G]=r.useState([]),[pe,je]=r.useState(!1),Ne=r.useRef(null),_=r.useRef(null);r.useEffect(()=>{t&&(O(x),S(null),P(null),R(null),je(!1),_.current=null)},[t,x]),r.useEffect(()=>{const M=n.deck.slice(0,Math.min(h,n.deck.length));G(M)},[n.deck,h]);const oe=r.useMemo(()=>{if(g!==null&&z!==null&&g!==z){const M=[...$],[B]=M.splice(g,1);return M.splice(z,0,B),M}return $},[$,g,z]),ee=r.useCallback((M,B)=>{M.preventDefault(),M.stopPropagation(),A({x:M.clientX,y:M.clientY,cardIndex:B})},[]),te=r.useCallback(()=>{A(null)},[]),De=r.useCallback(()=>{!p&&h<n.deck.length&&O(M=>M+1)},[p,h,n.deck.length]),J=r.useCallback(()=>{!p&&h>1&&O(M=>M-1)},[p,h]),we=r.useCallback((M,B)=>{P(B),S(M.id),_.current=M,je(!1)},[]),Te=r.useCallback((M,B)=>{M.preventDefault(),M.dataTransfer.dropEffect="move",z!==B&&R(B)},[z]),V=r.useCallback(M=>{if(!_.current||!Ne.current)return;const B=Ne.current.getBoundingClientRect(),ve=M.clientX,he=M.clientY;if(ve<B.left||ve>B.right||he<B.top||he>B.bottom){const ce=_.current,se=g??0;u&&u({card:ce,source:"deck",playerId:n.id,cardIndex:se}),je(!0),o()}},[g,n.id,u,o]),L=r.useCallback(()=>{pe||(S(null),P(null),R(null)),_.current=null},[pe]),q=r.useCallback((M,B)=>{if(M.preventDefault(),M.stopPropagation(),R(null),pe)return;if(g===null||g===B){P(null),S(null);return}const ve=[...$],[he]=ve.splice(g,1);ve.splice(B,0,he),G(ve),l(n.id,ve),P(null),S(null)},[g,$,l,n.id,pe]),X=r.useMemo(()=>T?[{label:v("view"),isBold:!0,onClick:()=>b(oe[T.cardIndex])},{label:v("play"),disabled:p,onClick:()=>{m(T.cardIndex)}},{label:v("moveToBottom"),onClick:()=>{d(T.cardIndex),O(M=>Math.max(0,M-1))}},{isDivider:!0},{label:v("toHand"),disabled:p,onClick:()=>{a(T.cardIndex),O(M=>Math.max(0,M-1))}},{label:v("toDiscard"),disabled:p,onClick:()=>{i(T.cardIndex),O(M=>Math.max(0,M-1))}}]:[],[oe,p,b,m,d,a,i,T,v]);return t?e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-[250] backdrop-blur-sm",children:[e.jsxs("div",{ref:Ne,onDragLeave:V,className:"bg-gray-800 rounded-lg p-6 shadow-xl w-auto max-w-5xl border border-gray-600 relative flex flex-col items-center",onClick:M=>M.stopPropagation(),children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-2 text-center",children:v("topDeckView")}),e.jsxs("div",{className:"flex items-center gap-4 mb-4 bg-gray-900 p-2 rounded-full border border-gray-700",children:[e.jsx("button",{onClick:J,disabled:p||h<=1,className:"w-8 h-8 flex items-center justify-center bg-gray-700 hover:bg-red-600 rounded-full text-white font-bold disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:"-"}),e.jsx("span",{className:"text-xl font-mono font-bold text-indigo-400 w-8 text-center",children:h}),e.jsx("button",{onClick:De,disabled:p||h>=n.deck.length,className:"w-8 h-8 flex items-center justify-center bg-gray-700 hover:bg-green-600 rounded-full text-white font-bold disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:"+"})]}),e.jsxs("p",{className:"text-gray-400 text-xs mb-6 text-center",children:[v("dragToReorder")," ",v("rightClickForActions")]}),e.jsx("div",{className:"flex justify-center flex-wrap gap-4 mb-8 min-h-[140px] px-4",children:oe.length===0?e.jsx("p",{className:"text-gray-500 italic",children:v("deckEmpty")}):oe.map((M,B)=>{const ve=$.findIndex(se=>se.id===M.id),he=z===B&&g!==B,ce=U===M.id;return e.jsxs("div",{draggable:!0,onDragStart:()=>we(M,ve),onDragOver:se=>Te(se,B),onDragEnd:L,onDrop:se=>q(se,B),onContextMenu:se=>ee(se,ve),className:"w-32 h-32 relative rounded-lg flex items-center justify-center cursor-grab active:cursor-grabbing hover:scale-105 transition-transform",style:{opacity:ce?.5:1,zIndex:he?10:0,transform:he?"scale(1.05)":ce?"scale(0.95)":"scale(1)"},children:[e.jsxs("div",{className:"absolute -top-3 -left-2 z-20 bg-gray-900 text-gray-400 text-xs font-bold px-2 py-0.5 rounded-full border border-gray-600 shadow-md",children:["#",B+1]}),e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(hs,{card:M,playerColorMap:f,localPlayerId:y,imageRefreshVersion:C})})]},M.id||B)})}),e.jsx("p",{className:"text-gray-400 text-xs mb-4 text-center",children:v("dragOutsideToMove")}),e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{onClick:o,className:"bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-8 rounded shadow-lg transition-colors",children:v("done")})})]}),T&&e.jsx("div",{className:"fixed inset-0 z-[255]",onClick:te}),T&&e.jsx(yo,{x:T.x,y:T.y,onClose:te,items:X})]}):null}),ys=({isOpen:t,message:n,onExit:o})=>{const{t:l}=rt(),[d,a]=r.useState(""),i=()=>{Cr(),o&&o(),window.location.reload()};return r.useEffect(()=>{if(!t){a("");return}const m=[l("connectingToHost")||"Connecting to host...",l("reconnectingDescription")||"Attempting to restore connection..."];let b=0;a(m[0]);const u=setInterval(()=>{b=(b+1)%m.length,a(m[b])},2e3);return()=>clearInterval(u)},[t,l]),t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-[300] backdrop-blur-sm",children:e.jsxs("div",{className:"bg-gray-900 rounded-lg border-2 border-blue-500 shadow-2xl p-8 w-full max-w-md text-center",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsxs("div",{className:"relative w-16 h-16",children:[e.jsx("div",{className:"absolute inset-0 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsx("div",{className:"absolute inset-2 border-4 border-blue-400 border-t-transparent rounded-full animate-spin",style:{animationDuration:"1.5s"}})]})}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:l("reconnecting")}),e.jsx("p",{className:"text-blue-300 mb-4 min-h-[24px] flex items-center justify-center",children:n||d}),e.jsx("p",{className:"text-sm text-gray-400",children:l("pleaseWait")}),e.jsx("p",{className:"text-xs text-gray-500 mt-4",children:l("doNotClose")||"Do not close this window while reconnecting"}),e.jsxs("div",{className:"flex justify-center gap-2 mt-6 mb-6",children:[e.jsx("span",{className:"w-3 h-3 bg-blue-500 rounded-full animate-pulse",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-3 h-3 bg-blue-500 rounded-full animate-pulse",style:{animationDelay:"200ms"}}),e.jsx("span",{className:"w-3 h-3 bg-blue-500 rounded-full animate-pulse",style:{animationDelay:"400ms"}})]}),e.jsx("button",{onClick:i,className:"mt-4 px-6 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition font-medium",children:l("cancel")||"Cancel"})]})}):null},xs="modulepreload",vs=function(t){return"/"+t},Kn={},pt=function(n,o,l){let d=Promise.resolve();if(o&&o.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),m=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));d=Promise.allSettled(o.map(b=>{if(b=vs(b),b in Kn)return;Kn[b]=!0;const u=b.endsWith(".css"),f=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${b}"]${f}`))return;const y=document.createElement("link");if(y.rel=u?"stylesheet":xs,u||(y.as="script"),y.crossOrigin="",y.href=b,m&&y.setAttribute("nonce",m),document.head.appendChild(y),u)return new Promise((C,x)=>{y.addEventListener("load",C),y.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${b}`)))})}))}function a(i){const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=i,window.dispatchEvent(m),!m.defaultPrevented)throw i}return d.then(i=>{for(const m of i||[])m.status==="rejected"&&a(m.reason);return n().catch(a)})},js={sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl",full:"max-w-full max-h-full m-4"},la=({isOpen:t,onClose:n,title:o,children:l,className:d="",size:a="lg",showCloseButton:i=!0,closeOnEscape:m=!0,closeOnBackdropClick:b=!0})=>{const{t:u}=rt(),f=r.useRef(null),[y,C]=r.useState(!1),[x,p]=r.useState(!1);if(r.useEffect(()=>{t?(C(!0),setTimeout(()=>p(!0),50)):(p(!1),setTimeout(()=>C(!1),200))},[t]),r.useEffect(()=>{if(!t||!m)return;const h=O=>{O.key==="Escape"&&n()};return document.addEventListener("keydown",h),()=>document.removeEventListener("keydown",h)},[t,n,m]),r.useEffect(()=>(t?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[t]),r.useEffect(()=>{if(t&&f.current){const O=f.current.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')[0];O==null||O.focus()}},[t]),!y)return null;const v=h=>{b&&h.target===f.current&&n()};return e.jsxs("div",{ref:f,className:`fixed inset-0 z-50 flex items-center justify-center p-4 ${d}`,onClick:v,children:[e.jsx("div",{className:`absolute inset-0 bg-black/60 transition-opacity duration-200 ${x?"opacity-100":"opacity-0"}`}),e.jsxs("div",{className:`bg-gray-800 rounded-lg shadow-2xl w-full ${js[a]} border border-white/10 relative transition-all duration-200 ${x?"opacity-100 scale-100 translate-y-0":"opacity-95 scale-95 translate-y-4"}`,onClick:h=>h.stopPropagation(),children:[(o||i)&&e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-700",children:[o&&e.jsx("h2",{className:"text-xl font-bold text-white",children:o}),i&&e.jsx("button",{onClick:n,className:"text-gray-400 hover:text-white transition-colors p-1 rounded hover:bg-gray-700","aria-label":u("close")||"Close",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"p-4 max-h-[calc(100vh-12rem)] overflow-y-auto custom-scrollbar",children:l})]})]})},ks=r.lazy(()=>pt(()=>Promise.resolve().then(()=>rs),void 0).then(t=>({default:t.DeckViewModal}))),ws=r.lazy(()=>pt(()=>Promise.resolve().then(()=>ds),void 0).then(t=>({default:t.CardDetailModal}))),Cs=r.lazy(()=>pt(()=>Promise.resolve().then(()=>ss),void 0).then(t=>({default:t.TokensModal}))),Ds=r.lazy(()=>pt(()=>Promise.resolve().then(()=>is),void 0).then(t=>({default:t.CountersModal}))),Ts=r.lazy(()=>pt(()=>Promise.resolve().then(()=>ls),void 0).then(t=>({default:t.TeamAssignmentModal}))),Is=r.lazy(()=>pt(()=>import("./RulesModal-LCSizd2Y-0.2.11.js"),__vite__mapDeps([0,1,2,3,4])).then(t=>({default:t.RulesModal}))),Ss=r.lazy(()=>pt(()=>import("./SettingsModal-DoqlDE4Z-0.2.11.js"),__vite__mapDeps([5,1,2,3,4])).then(t=>({default:t.SettingsModal}))),Ns=r.lazy(()=>pt(()=>Promise.resolve().then(()=>us),void 0).then(t=>({default:t.CommandModal}))),Ps=r.lazy(()=>pt(()=>Promise.resolve().then(()=>fs),void 0).then(t=>({default:t.CounterSelectionModal}))),Es=r.lazy(()=>pt(()=>Promise.resolve().then(()=>cs),void 0).then(t=>({default:t.RevealRequestModal}))),As=r.lazy(()=>pt(()=>Promise.resolve().then(()=>gs),void 0).then(t=>({default:t.RoundEndModal}))),zs=r.lazy(()=>pt(()=>import("./JoinGameModal-Bo0JYWTe-0.2.11.js"),__vite__mapDeps([6,1,2,3,4])).then(t=>({default:t.JoinGameModal}))),Rs=r.lazy(()=>pt(()=>import("./DeckBuilderModal-ChBig7oL-0.2.11.js"),__vite__mapDeps([7,1,2,3,4])).then(t=>({default:t.DeckBuilderModal}))),Ms=()=>e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500"})}),qn=()=>{const{openModal:t,close:n,getData:o,getSize:l}=Dr();if(!t)return null;const d=o(),a=l(),{onJoin:i,onSave:m,onConfirm:b,onReady:u,onCancel:f,onAccept:y,onDecline:C,onContinueGame:x,onStartNextRound:p,onExit:v,...h}=d;return e.jsxs(r.Suspense,{fallback:e.jsx(Ms,{}),children:[t==="deckView"&&e.jsx(la,{title:h.title||"Deck View",onClose:n,size:a,isOpen:!0,children:e.jsx(ks,{isOpen:!0,onClose:n,title:h.title||"Deck View",player:h.player,cards:h.cards||[],setDraggedItem:h.setDraggedItem||(()=>{}),onCardContextMenu:h.onCardContextMenu,onCardDoubleClick:h.onCardDoubleClick,onCardClick:h.onCardClick,onReorder:h.onReorder,canInteract:h.canInteract??!0,isDeckView:h.isDeckView,playerColorMap:h.playerColorMap,localPlayerId:h.localPlayerId??null,imageRefreshVersion:h.imageRefreshVersion,highlightFilter:h.highlightFilter})}),t==="cardDetail"&&e.jsx(la,{title:"Card Details",onClose:n,size:"md",isOpen:!0,children:e.jsx(ws,{card:h.card??null,ownerPlayer:h.ownerPlayer??null,onClose:n,statusDescriptions:h.statusDescriptions??{},allPlayers:h.allPlayers??[],imageRefreshVersion:h.imageRefreshVersion})}),t==="tokens"&&e.jsx(Cs,{isOpen:!0,onClose:n,setDraggedItem:h.setDraggedItem||(()=>{}),openContextMenu:h.openContextMenu||(()=>{}),canInteract:h.canInteract??!0,anchorEl:h.anchorEl??null,imageRefreshVersion:h.imageRefreshVersion,localPlayerId:h.localPlayerId??null}),t==="counters"&&e.jsx(Ds,{isOpen:!0,onClose:n,canInteract:h.canInteract??!0,anchorEl:h.anchorEl??null,imageRefreshVersion:h.imageRefreshVersion,onCounterMouseDown:h.onCounterMouseDown||(()=>{}),cursorStack:h.cursorStack??null}),t==="teamAssignment"&&e.jsx(la,{title:"Assign Teams",onClose:f||n,size:"lg",isOpen:!0,children:e.jsx(Ts,{players:h.players??[],gameMode:h.gameMode,onCancel:f||n,onConfirm:b||(()=>{})})}),t==="rules"&&e.jsx(Is,{isOpen:!0,onClose:n}),t==="settings"&&e.jsx(Ss,{isOpen:!0,onClose:n,onSave:m||n,connectionStatus:h.connectionStatus,onReconnect:h.onReconnect,gameId:h.gameId,isGameStarted:h.isGameStarted,isPrivate:h.isPrivate}),t==="command"&&e.jsx(Ns,{isOpen:!0,card:h.card,playerColorMap:h.playerColorMap,onConfirm:b||(()=>{}),onCancel:f||n}),t==="counterSelection"&&e.jsx(Ps,{isOpen:!0,data:h.data,onConfirm:b||(()=>{}),onCancel:f||n}),t==="revealRequest"&&e.jsx(la,{title:"Reveal Request",onClose:C||n,size:"md",isOpen:!0,children:e.jsx(Es,{fromPlayer:h.fromPlayer,cardCount:h.cardCount,onAccept:y||n,onDecline:C||n})}),t==="roundEnd"&&e.jsx(la,{title:"Round Complete",onClose:v||n,size:"lg",isOpen:!0,children:e.jsx(As,{gameState:h.gameState,onContinueGame:x||n,onStartNextRound:p||n,onExit:v||n})}),t==="joinGame"&&e.jsx(zs,{isOpen:!0,onClose:n,onJoin:i||(()=>{}),onRefreshGames:h.onRefreshGames||(()=>{}),games:h.games??[]}),t==="deckBuilder"&&e.jsx(Rs,{isOpen:!0,onClose:n,setViewingCard:h.setViewingCard})]})};function Os(t,n,o){const l=t.targetType,d=Qn(t.type);return{type:"ENTER_MODE",mode:"SELECT_TARGET",sourceCoords:t.sourceCoords,payload:{filter:a=>{var i,m;if(!d.allowHand||l&&!((i=a.types)!=null&&i.includes(l))||t.excludeOwnerId!==void 0&&a.ownerId===t.excludeOwnerId)return!1;if(t.onlyOpponents){const b=n.players.find(u=>u.id===o);if(b&&a.ownerId===b.id)return!1}if(t.onlyFaceDown&&((m=a.statuses)==null?void 0:m.some(u=>u.type==="Revealed")))return!1;if(t.targetOwnerId!==void 0){if(t.targetOwnerId===-1){const b=n.players.find(u=>u.id===o);if(b&&a.ownerId===b.id)return!1}else if(a.ownerId!==t.targetOwnerId)return!1}return!0},...t.maxDistanceFromSource!==void 0&&{range:t.maxDistanceFromSource}},originalOwnerId:t.originalOwnerId}}function Jn(t){return{type:"ENTER_MODE",mode:"SELECT_TARGET",...t.payload&&{payload:t.payload}}}function Ls(t,n,o,l,d,a,i){var y,C;let m=null;if((t==null?void 0:t.ownerId)!==void 0&&typeof t.ownerId=="number"&&(m=t.ownerId),m===null&&(n!=null&&n.sourceCoords)){const{row:x,col:p}=n.sourceCoords;if(x>=0&&x<i&&p>=0&&p<l.board[x].length){const v=(y=l.board[x][p])==null?void 0:y.card;(v==null?void 0:v.ownerId)!==void 0&&typeof v.ownerId=="number"&&(m=v.ownerId)}}m===null&&(o==null?void 0:o.originalOwnerId)!==void 0&&typeof o.originalOwnerId=="number"&&(m=o.originalOwnerId),m===null&&((C=o==null?void 0:o.sourceCard)==null?void 0:C.ownerId)!==void 0&&typeof o.sourceCard.ownerId=="number"&&(m=o.sourceCard.ownerId);const b=typeof l.activePlayerId=="number"?l.activePlayerId:null;return m=m??b??(typeof d=="number"?d:null)??(typeof a=="number"?a:0),m}const $s=function(){var Cn,Dn,Tn,In,Sn,Nn,Pn,En;const{t:n}=rt(),[o,l]=r.useState(null),d=Ir({abilityMode:o,setAbilityMode:l}),{gameState:a,localPlayerId:i,setLocalPlayerId:m,createGame:b,joinGameViaModal:u,joinAsInvite:f,playerReady:y,assignTeams:C,setGameMode:x,setGamePrivacy:p,setActiveGridSize:v,setDummyPlayerCount:h,updatePlayerName:O,changePlayerColor:T,updatePlayerScore:A,changePlayerDeck:U,loadCustomDeck:S,drawCard:g,drawCardsBatch:P,handleDrop:z,draggedItem:R,setDraggedItem:$,connectionStatus:G,gamesList:pe,requestGamesList:je,exitGame:Ne,moveItem:_,updateState:oe,shufflePlayerDeck:ee,addBoardCardStatus:te,removeBoardCardStatus:De,removeBoardCardStatusByOwner:J,modifyBoardCardPower:we,addAnnouncedCardStatus:Te,removeAnnouncedCardStatus:V,modifyAnnouncedCardPower:L,addHandCardStatus:q,removeHandCardStatus:X,flipBoardCard:M,flipBoardCardFaceDown:B,revealHandCard:ve,revealBoardCard:he,requestCardReveal:ce,respondToRevealRequest:se,syncGame:lt,toggleActivePlayer:yt,toggleAutoDraw:Ee,forceReconnect:qe,triggerHighlight:ke,latestHighlight:xt,latestFloatingTexts:et,latestNoTarget:Ae,triggerNoTarget:ne,triggerDeckSelection:Je,triggerHandCardSelection:dt,triggerClickWave:Ze,clickWaves:ct,syncValidTargets:ut,setTargetingMode:H,clearTargetingMode:ie,nextPhase:Q,prevPhase:W,setPhase:I,markAbilityUsed:K,applyGlobalEffect:Ce,swapCards:de,transferStatus:Oe,transferAllCounters:Ie,transferAllStatusesWithoutException:Ye,destroyCard:le,recoverDiscardedCard:_e,resurrectDiscardedCard:vt,spawnToken:Ge,scoreLine:st,closeRoundEndModal:Pe,closeRoundEndModalOnly:Le,resetGame:Lt,resetDeployStatus:Et,scoreDiagonal:Ia,removeStatusByType:en,reorderTopDeck:Sa,reorderCards:fa,triggerFloatingText:ha,latestDeckSelections:Yt,latestHandCardSelections:ue,webrtcHostId:ba,webrtcIsHost:Wt,initializeWebrtcHost:Co,connectAsGuest:Na,requestDeckView:tn,sendFullDeckToHost:an,shareHostDeckWithGuests:nn,isReconnecting:on,reconnectProgress:Do}=d,[$t,jt]=r.useState({isJoinModalOpen:!1,isDeckBuilderOpen:!1,isSettingsModalOpen:!1,isTokensModalOpen:!1,isCountersModalOpen:!1,isRulesModalOpen:!1,isTeamAssignOpen:!1}),[ze,ya]=r.useState(null),[xa,Xt]=r.useState(null),[me,Kt]=r.useState(null),[rn,Qt]=r.useState({tokensModalAnchor:null,countersModalAnchor:null}),[re,At]=r.useState(null),[va,wt]=r.useState(null),[kt,sn]=r.useState(()=>{try{const c=localStorage.getItem("image_refresh_data");if(c){const{version:k,timestamp:D}=JSON.parse(c),j=12*60*60*1e3;if(Date.now()-D<j)return k}}catch(c){Ke.error("Error parsing image refresh data",c)}const s=Date.now();return localStorage.setItem("image_refresh_data",JSON.stringify({version:s,timestamp:s})),s}),[Pa,Ea]=r.useState(null),[Re,it]=r.useState(null),[To,ln]=r.useState(null),[Io,dn]=r.useState([]),[Aa,So]=r.useState(()=>{try{const s=localStorage.getItem("auto_abilities_enabled");return s===null?!0:s==="true"}catch{return!0}});r.useEffect(()=>{try{localStorage.setItem("auto_abilities_enabled",String(Aa))}catch{}},[Aa]);const No=r.useMemo(()=>{if(!i||!a)return!1;const s=a.players.find(c=>c.id===i);return(s==null?void 0:s.autoDrawEnabled)??!0},[a,i]),zt=r.useMemo(()=>{var s;return((s=a==null?void 0:a.board)==null?void 0:s.length)??6},[(Cn=a==null?void 0:a.board)==null?void 0:Cn.length]);r.useEffect(()=>{if(!i||!a)return;const s=a.players.find(c=>c.id===i);if(s&&s.autoDrawEnabled!==void 0)try{localStorage.setItem("auto_draw_enabled",String(s.autoDrawEnabled))}catch{}},[i,a]);const[ea,Po]=r.useState(()=>{try{const s=localStorage.getItem("hide_dummy_cards");return s===null?!1:s==="true"}catch{return!1}});r.useEffect(()=>{try{localStorage.setItem("hide_dummy_cards",String(ea))}catch{}},[ea]);const[za,cn]=r.useState(!1),[Ra,ja]=r.useState([]),[un,qt]=r.useState([]),[ta,It]=r.useState([]),[Eo,mn]=r.useState(null),[Ct,aa]=r.useState({}),[Ao,Ma]=r.useState(0),zo=r.useRef(null),Ro=r.useRef(null),[pn,Mo]=r.useState(void 0),_t=r.useRef(!1),ka=r.useRef(!1),Oa=r.useRef(void 0),[w,na]=r.useState(null),gn=r.useMemo(()=>{var s,c,k;return(o==null?void 0:o.originalOwnerId)!==void 0?o.originalOwnerId:((s=o==null?void 0:o.sourceCard)==null?void 0:s.ownerId)!==void 0?o.sourceCard.ownerId:(w==null?void 0:w.originalOwnerId)!==void 0?w.originalOwnerId:((c=w==null?void 0:w.sourceCard)==null?void 0:c.ownerId)!==void 0?w.sourceCard.ownerId:((k=Re==null?void 0:Re.card)==null?void 0:k.ownerId)!==void 0?Re.card.ownerId:(ze==null?void 0:ze.ownerId)!==void 0?ze.ownerId:(a==null?void 0:a.activePlayerId)??0},[o,w,Re,ze,a==null?void 0:a.activePlayerId]),oa=r.useMemo(()=>{var s;return!i||!a?null:(s=a.revealRequests)==null?void 0:s.find(c=>c.toPlayerId===i)},[a,i]),{playCommandCard:ra,handleCommandConfirm:Oo,handleCounterSelectionConfirm:Lo}=Sr({gameState:a,localPlayerId:i,setActionQueue:ja,setCommandContext:aa,setCommandModalCard:ya,setCounterSelectionData:Xt,moveItem:_,updatePlayerScore:A,updateState:oe}),$o=r.useCallback(()=>{cn(!0),Q()},[Q]),{executeAction:sa,handleBoardCardClick:_o,handleEmptyCellClick:Uo,handleHandCardClick:fn}=Nr({gameState:a,localPlayerId:i,abilityMode:o,setAbilityMode:l,cursorStack:w,setCursorStack:na,commandContext:Ct,setCommandContext:aa,setViewingDiscard:At,triggerNoTarget:ne,triggerClickWave:Ze,playMode:Re,setPlayMode:it,setCounterSelectionData:Xt,interactionLock:_t,onAbilityComplete:()=>Ma(s=>s+1),moveItem:_,drawCardsBatch:P,updatePlayerScore:A,markAbilityUsed:K,applyGlobalEffect:Ce,swapCards:de,transferStatus:Oe,transferAllCounters:Ie,transferAllStatusesWithoutException:Ye,destroyCard:le,resurrectDiscardedCard:vt,spawnToken:Ge,scoreLine:st,nextPhase:$o,modifyBoardCardPower:we,addBoardCardStatus:te,removeBoardCardStatus:De,removeBoardCardStatusByOwner:J,resetDeployStatus:Et,scoreDiagonal:Ia,removeStatusByType:en,triggerFloatingText:ha,triggerHandCardSelection:dt,clearValidTargets:()=>qt([]),setTargetingMode:H,clearTargetingMode:ie,validTargets:un}),hn=(s,c)=>{if(o||w||_t.current)return;const k=s.id===i,D=!!s.isDummy;if(k||D){if(c.deck===Qe.Command){gt(),ra(c,{card:c,source:"announced",playerId:s.id});return}gt();const F={card:c,source:"announced",playerId:s.id};it({card:c,sourceItem:F,faceDown:!1})}else wt({card:c,player:s})},{cursorFollowerRef:Fo,handleCounterMouseDown:Vo}=Pr({gameState:a,localPlayerId:i,handleDrop:z,markAbilityUsed:K,requestCardReveal:ce,interactionLock:_t,setCommandContext:aa,onAction:sa,cursorStack:w,setCursorStack:na,setAbilityMode:l,triggerClickWave:Ze,clearTargetingMode:ie}),Ut=r.useMemo(()=>i===null&&a.gameId!==null,[i,a.gameId]),Go=r.useMemo(()=>{var s;return((s=a.players)==null?void 0:s.filter(c=>!c.isDummy).length)||0},[a.players]),Bo=r.useMemo(()=>i===1,[i]),Be=r.useMemo(()=>{var s;return(s=a==null?void 0:a.players)==null?void 0:s.find(c=>c.id===i)},[a==null?void 0:a.players,i]),Ho=r.useMemo(()=>{var c;const s=(a==null?void 0:a.gameId)&&(Be||Ut);return Da()&&Ke.debug("[isGameActive] Check:",{hasGameId:!!(a!=null&&a.gameId),gameId:a==null?void 0:a.gameId,hasLocalPlayer:!!Be,hasIsSpectator:Ut,localPlayerId:i,playersCount:((c=a==null?void 0:a.players)==null?void 0:c.length)||0,isActive:s}),s},[a==null?void 0:a.gameId,Be,Ut,i]),Ft=r.useMemo(()=>{var c;const s=new Map;return(c=a==null?void 0:a.players)==null||c.forEach(k=>s.set(k.id,k.color)),s},[a==null?void 0:a.players]),wa=r.useMemo(()=>{if(!(a!=null&&a.players)||!i)return(a==null?void 0:a.players)||[];if(a.players.findIndex(xe=>xe.id===i)===-1)return a.players;if(!(!!a.isGameStarted&&a.startingPlayerId!==void 0))return[...a.players].sort((xe,Ue)=>xe.id-Ue.id);const k=[...a.players].sort((xe,Ue)=>xe.id-Ue.id),D=a.startingPlayerId,j=k.findIndex(xe=>xe.id===D),F=[...k.slice(j),...k.slice(0,j)],ge=F.findIndex(xe=>xe.id===i),Se=F.slice(ge+1),fe=F.slice(0,ge);return[...Se,...fe]},[a==null?void 0:a.players,i,a==null?void 0:a.isGameStarted,a==null?void 0:a.startingPlayerId]),La=r.useMemo(()=>!!o||!!w,[o,w]),bn=r.useCallback(s=>{var D,j,F;const c=(o==null?void 0:o.mode)==="SELECT_DECK",k=((D=a.targetingMode)==null?void 0:D.isDeckSelectable)===!0;if(c||k){const ge=o||a.targetingMode;if(!ge)return;const Se=o?o.sourceCard:(F=(j=a.targetingMode)==null?void 0:j.action)==null?void 0:F.sourceCard,fe=o==null?void 0:o.isDeployAbility,xe=ge.sourceCoords;Je(s,a.activePlayerId??i??1),Kt({targetPlayerId:s,isLocked:!0,initialCount:3,...Se&&{sourceCard:Se},...fe!==void 0&&{isDeployAbility:fe},...xe&&{sourceCoords:xe}}),l(null),ie()}},[o,a.targetingMode,a.activePlayerId,i,Je,ie]);r.useEffect(()=>{var c,k;const s=o||w||Re||ze;(c=a.targetingMode)!=null&&c.handTargets&&!s?It(a.targetingMode.handTargets):!((k=a.targetingMode)!=null&&k.handTargets)&&!s&&It([])},[(Dn=a.targetingMode)==null?void 0:Dn.handTargets,(Tn=a.targetingMode)==null?void 0:Tn.timestamp,o,w,Re,ze]);const Wo=r.useCallback((s,c)=>{Sa(s,c)},[Sa]),Ko=r.useCallback(s=>{if(!me)return;const c=a.players.find(D=>D.id===me.targetPlayerId);if(!c||c.deck.length<=s)return;const k=c.deck[s];k&&_({card:k,source:"deck",playerId:me.targetPlayerId,cardIndex:s},{target:"deck",playerId:me.targetPlayerId,deckPosition:"bottom"})},[me,a.players,_]),qo=r.useCallback(s=>{if(!me)return;const c=a.players.find(D=>D.id===me.targetPlayerId);if(!c||c.deck.length<=s)return;const k=c.deck[s];k&&_({card:k,source:"deck",playerId:me.targetPlayerId,cardIndex:s},{target:"hand",playerId:me.targetPlayerId})},[me,a.players,_]),Jo=r.useCallback(s=>{if(!me)return;const c=a.players.find(D=>D.id===me.targetPlayerId);if(!c||c.deck.length<=s)return;const k=c.deck[s];k&&_({card:k,source:"deck",playerId:me.targetPlayerId,cardIndex:s},{target:"discard",playerId:me.targetPlayerId})},[me,a.players,_]),Zo=r.useCallback(s=>{if(!me)return;const c=a.players.find(j=>j.id===me.targetPlayerId);if(!c||c.deck.length<=s)return;const k=c.deck[s];if(!k)return;Kt(null);const D={card:k,source:"deck",playerId:me.targetPlayerId,cardIndex:s};it({card:k,sourceItem:D,faceDown:!1})},[me,a.players,it]),Yo=r.useCallback(()=>{me&&me.isLocked&&me.sourceCard&&(me.sourceCard.ownerId!==void 0&&g(me.sourceCard.ownerId),me.sourceCoords&&K(me.sourceCoords,me.isDeployAbility)),Kt(null)},[me,g,K]),yn=r.useMemo(()=>me?a.players.find(s=>s.id===me.targetPlayerId):null,[me,a.players]);r.useLayoutEffect(()=>{const s=()=>{const D=window.innerHeight-56,F=(window.innerWidth-D)/2;Mo(Math.max(0,F))};return window.addEventListener("resize",s),s(),()=>window.removeEventListener("resize",s)},[]),r.useEffect(()=>{let s=!0;return Er().then(()=>{s&&Object.keys(Yn).length>0&&sn(c=>c+1)}).catch(c=>{Ke.error("Failed to load content database:",c)}),()=>{s=!1}},[]),r.useEffect(()=>{const s=c=>{_t.current&&(c.stopPropagation(),c.preventDefault())};return window.addEventListener("click",s,!0),()=>window.removeEventListener("click",s,!0)},[]),r.useEffect(()=>{const s=()=>{o!=null&&o.sourceCoords&&o.sourceCoords.row>=0&&K(o.sourceCoords,o.isDeployAbility,!1,o.readyStatusToRemove),w!=null&&w.sourceCoords&&w.sourceCoords.row>=0&&K(w.sourceCoords,w.isDeployAbility),a.players.forEach(D=>{(D.id===i||D.isDummy)&&D.announcedCard&&_({card:D.announcedCard,source:"announced",playerId:D.id},{target:"discard",playerId:D.id})}),na(null),it(null),l(null),At(null),ya(null),ja([]),aa({}),Xt(null),Kt(null)},c=D=>{["INPUT","TEXTAREA","SELECT"].includes(D.target.tagName)||(D.code==="Space"&&(D.preventDefault(),a.isGameStarted&&Q()),D.key==="Escape"&&s())},k=D=>{(w||Re||o)&&(D.preventDefault(),s())};return window.addEventListener("keydown",c),window.addEventListener("contextmenu",k),()=>{window.removeEventListener("keydown",c),window.removeEventListener("contextmenu",k)}},[w,Re,o,K,a.isGameStarted,Q,Be,_,a.players,i]),r.useEffect(()=>{if(Ae){mn(Ae.coords);const s=setTimeout(()=>mn(null),Ht.NO_TARGET_DURATION);return()=>clearTimeout(s)}},[Ae]);const xn=r.useRef("");r.useEffect(()=>{cn(!1)},[a==null?void 0:a.currentPhase]),r.useEffect(()=>{Ma(s=>s+1)},[a==null?void 0:a.currentPhase]),r.useEffect(()=>{if(!a)return;const s=a.activePlayerId;if(s===void 0)return;let c="";a.board.forEach(k=>{k.forEach(D=>{var j;if(((j=D.card)==null?void 0:j.ownerId)===s&&D.card.statuses){const F=D.card.statuses.filter(fe=>fe.type==="Support").length,ge=D.card.statuses.filter(fe=>fe.type==="Threat").length,Se=D.card.statuses.filter(fe=>fe.type==="Stun").length;c+=`${D.card.id}:${F}:${ge}:${Se};`}})}),xn.current!==c&&(xn.current=c,Ma(k=>k+1))},[a]),r.useEffect(()=>{var fe,xe,Ue,Z,Vt,N,E,be,Me,He,at,We,ft;if(a.targetingMode&&a.targetingMode.playerId!==i)return;if(a.targetingMode&&o){const Y=((fe=a.targetingMode.action)==null?void 0:fe.mode)===o.mode,ae=!a.targetingMode.sourceCoords||!o.sourceCoords||a.targetingMode.sourceCoords.row===o.sourceCoords.row&&a.targetingMode.sourceCoords.col===o.sourceCoords.col;if(Y&&ae)return}let s=null;w?s={type:"CREATE_STACK",tokenType:w.type,count:w.count,...w.sourceCard&&{sourceCard:w.sourceCard},...w.onlyFaceDown!==void 0&&{onlyFaceDown:w.onlyFaceDown},...w.onlyOpponents!==void 0&&{onlyOpponents:w.onlyOpponents},...w.targetOwnerId!==void 0&&{targetOwnerId:w.targetOwnerId},...w.excludeOwnerId!==void 0&&{excludeOwnerId:w.excludeOwnerId},...w.targetType&&{targetType:w.targetType},...w.requiredTargetStatus&&{requiredTargetStatus:w.requiredTargetStatus},...w.requireStatusFromSourceOwner!==void 0&&{requireStatusFromSourceOwner:w.requireStatusFromSourceOwner},...w.mustBeAdjacentToSource&&{mustBeAdjacentToSource:w.mustBeAdjacentToSource},...w.mustBeInLineWithSource&&{mustBeInLineWithSource:w.mustBeInLineWithSource},...w.maxDistanceFromSource!==void 0&&{maxDistanceFromSource:w.maxDistanceFromSource},...w.maxOrthogonalDistance!==void 0&&{maxOrthogonalDistance:w.maxOrthogonalDistance},...w.sourceCoords&&{sourceCoords:w.sourceCoords}}:o&&!w&&(s=o);let c=i||a.activePlayerId||null;if((xe=s==null?void 0:s.sourceCard)!=null&&xe.ownerId)c=s.sourceCard.ownerId;else if(s!=null&&s.sourceCoords&&s.sourceCoords.row>=0&&s.sourceCoords.row<zt&&s.sourceCoords.col>=0&&s.sourceCoords.col<a.board[s.sourceCoords.row].length){const Y=a.board[s.sourceCoords.row][s.sourceCoords.col],ae=Y==null?void 0:Y.card;ae!=null&&ae.ownerId&&(c=ae.ownerId)}else if(a.activePlayerId){const Y=a.players.find(ae=>ae.id===a.activePlayerId);Y!=null&&Y.isDummy&&(c=Y.id)}const k=s?On(s,a,c??null,Ct):[],D=[];if(Re&&!o&&!w){const Y=Re.card;((Ue=Y==null?void 0:Y.types)==null?void 0:Ue.includes("Unit"))&&a.board.slice(0,zt).forEach((Fe,ye)=>{Fe.slice(0,Fe.length).forEach((Xe,Ve)=>{Xe.card||k.push({row:ye,col:Ve})})})}if(ze&&!o&&!w){const Y=a.players.find(ae=>ae.id===ze.ownerId);if(((Z=Y==null?void 0:Y.announcedCard)==null?void 0:Z.id)===ze.id){const ae=(ze.baseId||ze.id.split("_")[1]||ze.id).toLowerCase();if(["overwatch","tacticalmaneuver","repositioning","inspiration","datainterception","falseorders","experimentalstimulants","logisticschain","quickresponseteam","temporaryshelter","enhancedinterrogation"].some(Fe=>ae.includes(Fe)))try{Ar(ze.id,0,ze,a,ze.ownerId).forEach(ye=>{On(ye,a,ze.ownerId,Ct).forEach(Xe=>{k.some(Ve=>Ve.row===Xe.row&&Ve.col===Xe.col)||k.push(Xe)})})}catch{}}}if((o==null?void 0:o.type)==="ENTER_MODE"&&o.mode==="SELECT_TARGET"&&!w&&(Ke.info("[App.tsx] ENTER_MODE SELECT_TARGET detected",{actionType:(Vt=o.payload)==null?void 0:Vt.actionType,hasFilter:!!((N=o.payload)!=null&&N.filter),filterType:typeof((E=o.payload)==null?void 0:E.filter),sourceCardName:(be=o.sourceCard)==null?void 0:be.name}),(o.payload.actionType==="SELECT_HAND_FOR_DEPLOY"||o.payload.filter)&&a.players.forEach(Y=>{Y.hand.forEach((ae,$e)=>{var Fe,ye;(ye=(Fe=o.payload).filter)!=null&&ye.call(Fe,ae)&&(o.payload.actionType==="SELECT_HAND_FOR_DEPLOY"?Y.id===c&&D.push({playerId:Y.id,cardIndex:$e}):D.push({playerId:Y.id,cardIndex:$e}))})})),w&&(Qn(w.type).allowHand?a.players.forEach(ae=>{ae.hand.forEach(($e,Fe)=>{const ye={...w.targetOwnerId!==void 0&&{targetOwnerId:w.targetOwnerId},...w.excludeOwnerId!==void 0&&{excludeOwnerId:w.excludeOwnerId},onlyOpponents:w.onlyOpponents||w.targetOwnerId===-1,...w.onlyFaceDown!==void 0&&{onlyFaceDown:w.onlyFaceDown},...w.targetType&&{targetType:w.targetType},...w.requiredTargetStatus&&{requiredTargetStatus:w.requiredTargetStatus},tokenType:w.type};zr({card:$e,ownerId:ae.id,location:"hand"},ye,c,a.players)&&D.push({playerId:ae.id,cardIndex:Fe})})}):D.length=0),o&&!w&&(o.mode==="SCORE_LAST_PLAYED_LINE"||o.mode==="SELECT_LINE_END"||o.mode==="INTEGRATOR_LINE_SELECT"||o.mode==="ZIUS_LINE_SELECT")){const Y=zt;if(o.sourceCoords){for(let ae=0;ae<Y;ae++)k.push({row:o.sourceCoords.row,col:ae});for(let ae=0;ae<Y;ae++)k.push({row:ae,col:o.sourceCoords.col})}else for(let ae=0;ae<Y;ae++)for(let $e=0;$e<Y;$e++)k.push({row:ae,col:$e})}qt(k),It(D);const j=Re&&((He=(Me=Re.card)==null?void 0:Me.types)==null?void 0:He.includes("Unit")),ge=w||o||j||!!ze,Se=(o==null?void 0:o.mode)==="SELECT_DECK";if(ge&&(k.length>0||D.length>0||Se)){let Y=null,ae;if(w&&c!==null?(Y=Os(w,a,c),ae=w.sourceCoords):Re&&o||ze&&o?Y=Jn(o):o&&(Y=o,ae=o.sourceCoords),Y&&c!==null){const $e=Ls(ze,o,w,a,i,c,zt);Ke.info("[App.tsx] Calling setTargetingMode",{mode:Y.mode,actionType:(at=Y.payload)==null?void 0:at.actionType,hasFilter:!!((We=Y.payload)!=null&&We.filter),targetingPlayerId:$e,boardTargetsCount:k.length,handTargetsCount:D.length,hasCursorStack:!!w,hasAbilityMode:!!o}),H(Y,$e,ae,k,Ct,D)}}else ge||(((ft=a.targetingMode)==null?void 0:ft.playerId)===i&&ie(),It([]))},[o,w,Re,ze,a.board,a.players,i,Ct,a.activePlayerId,H,ie]),r.useEffect(()=>{const s=a.activePlayerId;if(!s||s!==i)return;const c=ta.length>0,k=(o==null?void 0:o.mode)==="SELECT_DECK";!c&&!k||ut({validHandTargets:ta,isDeckSelectable:k})},[o,o==null?void 0:o.mode,ta,a.activePlayerId,i,ut]),r.useEffect(()=>{!w&&!o&&!Re&&(qt([]),It([]))},[w,o,Re]),r.useEffect(()=>{if(xt){ln(xt);const s=setTimeout(()=>ln(null),Ht.HIGHLIGHT_DURATION);return()=>clearTimeout(s)}},[xt]),r.useEffect(()=>{if(et&&et.length>0){const s=et.map(k=>({...k,id:`float_${Date.now()}_${Math.random()}`}));dn(k=>[...k,...s]);const c=setTimeout(()=>{dn(k=>k.filter(D=>!s.find(j=>j.id===D.id)))},2e3);return()=>clearTimeout(c)}},[et]),r.useEffect(()=>{if(a.targetingMode){const s=a.targetingMode.boardTargets||[];qt(s),a.targetingMode.handTargets?It(a.targetingMode.handTargets):It([]),ka.current=!0,Oa.current=a.targetingMode.playerId}else if(!o&&!w&&!Re){if(ka.current&&Oa.current!==i)return;ka.current&&(qt([]),It([]),ka.current=!1,Oa.current=void 0)}},[a.targetingMode,o,w,Re,i]),r.useEffect(()=>{var s,c;if(!a.isScoringStep&&(o==null?void 0:o.mode)==="SCORE_LAST_PLAYED_LINE"){l(null);return}if(a.isScoringStep&&!o){const k=a.activePlayerId,D=a.players.find(F=>F.id===k);if(D&&(D.id===i||D.isDummy)){let F=!1,ge=null;for(let Se=0;Se<zt;Se++){for(let fe=0;fe<zt;fe++){const xe=(s=a.board[Se])==null?void 0:s[fe],Ue=xe==null?void 0:xe.card;if((c=Ue==null?void 0:Ue.statuses)!=null&&c.some(Z=>Z.type==="LastPlayed"&&Z.addedByPlayerId===k)){ge={row:Se,col:fe},F=!0;break}}if(F)break}F&&ge?l({type:"ENTER_MODE",mode:"SCORE_LAST_PLAYED_LINE",sourceCoords:ge}):(k===i||D!=null&&D.isDummy)&&Q()}}},[a==null?void 0:a.isScoringStep,a==null?void 0:a.activePlayerId,i,a==null?void 0:a.board,o,Q,a==null?void 0:a.players,zt]),r.useEffect(()=>{(o==null?void 0:o.mode)==="SCORE_LAST_PLAYED_LINE"&&a.currentPhase!==4&&l(null)},[a==null?void 0:a.currentPhase,o]),r.useEffect(()=>{var s,c,k,D,j,F,ge,Se,fe,xe;if(Ra.length>0&&!o&&!w){const Ue=Ra[0];ja(N=>N.slice(1));const Z={...Ue};if(Z.mode==="SELECT_CELL"&&Ct.lastMovedCardCoords&&((s=Z.payload)!=null&&s.useContextCard)){const{row:N,col:E}=Ct.lastMovedCardCoords;if(typeof N=="number"&&typeof E=="number"&&N>=0&&N<zt&&a.board[N]&&E>=0&&E<a.board[N].length&&a.board[N][E]){const be=a.board[N][E].card;be&&(Z.sourceCard=be,Z.sourceCoords=Ct.lastMovedCardCoords,Z.recordContext=!0)}}const Vt=(N,E,be=0)=>{let Me=be;return N==="Aim"?a.board.forEach(He=>He.forEach(at=>{var We;(We=at.card)!=null&&We.statuses&&(Me+=at.card.statuses.filter(ft=>ft.type==="Aim"&&ft.addedByPlayerId===E).length)})):N==="Exploit"&&a.board.forEach(He=>He.forEach(at=>{var We;(We=at.card)!=null&&We.statuses&&(Me+=at.card.statuses.filter(ft=>ft.type==="Exploit"&&ft.addedByPlayerId===E).length)})),Me};if(Z.type==="GLOBAL_AUTO_APPLY")if((c=Z.payload)!=null&&c.cleanupCommand){const N=Z.payload.ownerId!==void 0?Z.payload.ownerId:(k=Z.sourceCard)==null?void 0:k.ownerId;if(N!==void 0){const E=a.players.find(Me=>Me.id===N),be=(E==null?void 0:E.announcedCard)||Z.sourceCard;be&&be.id!=="dummy"&&_({card:be,source:"announced",playerId:N},{target:"discard",playerId:N})}}else if((D=Z.payload)!=null&&D.dynamicResource){const{type:N,factor:E,baseCount:be,ownerId:Me}=Z.payload.dynamicResource,He=((j=Z.sourceCard)==null?void 0:j.ownerId)??Z.originalOwnerId??Me??i,at=Vt(E,He,be);N==="draw"&&at>0&&P(He,at)}else if((F=Z.payload)!=null&&F.resourceChange){const{draw:N,score:E}=Z.payload.resourceChange,be=((ge=Z.sourceCard)==null?void 0:ge.ownerId)||a.activePlayerId;be!=null&&(N&&P(be,typeof N=="number"?N:1),E&&A(be,E))}else(Se=Z.payload)!=null&&Se.contextReward&&Z.sourceCard?sa(Z,Z.sourceCoords||{row:-1,col:-1}):(fe=Z.payload)!=null&&fe.customAction&&Z.sourceCard&&sa(Z,Z.sourceCoords||{row:-1,col:-1});else if(Z.type==="CREATE_STACK"||Z.type==="OPEN_MODAL")sa(Z,Z.sourceCoords||{row:-1,col:-1});else{const N=((xe=Z.sourceCard)==null?void 0:xe.ownerId)||i;Rr(Z,a,N,Ct)?l(Z):Z.sourceCoords&&Z.sourceCoords.row>=0&&ne(Z.sourceCoords)}}},[Ra,o,w,i,g,A,a.activePlayerId,a.board,_,Ct,te,a.players,sa,ne]);const gt=r.useCallback(()=>{jt(s=>({...s,isTokensModalOpen:!1,isCountersModalOpen:!1,isRulesModalOpen:!1})),At(null),wt(null),ya(null),Xt(null),Kt(null),Qt({tokensModalAnchor:null,countersModalAnchor:null})},[]),Xo=r.useCallback(s=>{C(s),jt(c=>({...c,isTeamAssignOpen:!1}))},[C]),Qo=r.useCallback(s=>{u(s),jt(c=>({...c,isJoinModalOpen:!1}))},[u]),er=r.useCallback(()=>{b(),m(1)},[b,m]),tr=r.useCallback(s=>{const c=s.trim(),k=localStorage.getItem("custom_ws_url")||"";c!==k&&(localStorage.setItem("custom_ws_url",c),qe()),jt(D=>({...D,isSettingsModalOpen:!1}))},[qe]);r.useEffect(()=>{const s=sessionStorage.getItem("invite_host_id"),c=sessionStorage.getItem("invite_auto_join");s&&c&&typeof Na=="function"&&(sessionStorage.removeItem("invite_host_id"),sessionStorage.removeItem("invite_auto_join"),Na(s).then(k=>{k||Ke.error("[App] Failed to connect to WebRTC host")}).catch(k=>{Ke.error("[App] Error connecting to WebRTC host:",k)}))},[Na]),r.useEffect(()=>{const s=sessionStorage.getItem("invite_game_id"),c=sessionStorage.getItem("invite_auto_join");if(s&&c&&G==="Connected")if(!a.gameId||a.gameId!==s){Ke.warn("[App] Auto-joining game from invite link:",s),sessionStorage.removeItem("invite_game_id"),sessionStorage.removeItem("invite_auto_join");const D=`Player ${Math.floor(Math.random()*1e3)}`;f(s,D)}else sessionStorage.removeItem("invite_game_id"),sessionStorage.removeItem("invite_auto_join")},[G,a.gameId,f]);const ar=r.useCallback(()=>{const s=Date.now();sn(s),localStorage.setItem("image_refresh_data",JSON.stringify({version:s,timestamp:s})),lt()},[lt]),Rt=r.useCallback(s=>{i!==null&&ke({...s,playerId:i})},[i,ke]),Mt=r.useCallback(()=>Ea(null),[]),ia=r.useCallback((s,c,k)=>{s.preventDefault(),!(o||w||Re)&&(s.stopPropagation(),i!==null&&Ea({x:s.clientX,y:s.clientY,type:c,data:k}))},[o,w,Re,i]),nr=(s,c)=>{var ge,Se;if(o||w||_t.current)return;const k=s.ownerId===i;if(k&&s.isFaceDown){M(c);return}const D=s.ownerId?(ge=a==null?void 0:a.players)==null?void 0:ge.find(fe=>fe.id===s.ownerId):void 0,j=(Se=s.statuses)==null?void 0:Se.some(fe=>fe.type==="Revealed"&&fe.addedByPlayerId===i);!s.isFaceDown||s.revealedTo==="all"||Array.isArray(s.revealedTo)&&s.revealedTo.includes(i)||j||k?wt({card:s,player:D}):i!==null&&ce({source:"board",ownerId:s.ownerId,boardCoords:c},i)},or=s=>{o||w||_t.current||Rt({type:"cell",row:s.row,col:s.col})},$a=r.useCallback(()=>{var s,c;if(o&&o.isDeployAbility&&o.sourceCoords){const{row:k,col:D}=o.sourceCoords;if(k>=0&&D>=0){const j=Mr(a),F=(c=(s=j.board[k])==null?void 0:s[D])==null?void 0:c.card;if(F&&F.ownerId&&F.statuses&&F.statuses.some(Se=>Se.type==="readyDeploy")){F.statuses=F.statuses.filter(xe=>xe.type!=="readyDeploy");const Se=j.activePlayerId===F.ownerId,fe=F.statuses.some(xe=>xe.type==="Stun");if(Se&&!fe){const xe=Or(F);let Ue=null;j.currentPhase===1&&xe.includes("setup")?Ue="readySetup":j.currentPhase===3&&xe.includes("commit")&&(Ue="readyCommit"),Ue&&!F.statuses.some(Z=>Z.type===Ue)&&F.statuses.push({type:Ue,addedByPlayerId:F.ownerId})}oe(j)}}}o&&l(null),w&&na(null),Re&&it(null),ie(),It([]),qt([])},[o,w,Re,ie,a,oe]),vn=(s,c,k)=>{var D;if(!(o||w)&&!_t.current){if(s.id===i||s.isDummy){if(c.deck===Qe.Command){gt(),ra(c,{card:c,source:"hand",playerId:s.id,cardIndex:k});return}gt();const j={card:c,source:"hand",playerId:s.id,cardIndex:k};it({card:c,sourceItem:j,faceDown:!1})}else if(i!==null){const j=c.revealedTo==="all",F=Array.isArray(c.revealedTo)&&c.revealedTo.includes(i),ge=(D=c.statuses)==null?void 0:D.some(fe=>fe.type==="Revealed"&&fe.addedByPlayerId===i);j||F||ge||!!s.isDummy||!!s.isDisconnected?wt({card:c,player:s}):ce({source:"hand",ownerId:s.id,cardIndex:k},i)}}},jn=r.useCallback(s=>{const c=Da(),k=s.id!==i;if(c&&!Wt&&i!==null){const D=a.players.find(j=>j.id===i);D&&D.deck.length>0&&(Ke.info(`[handleViewDeck] Sending full deck data to host (${D.deck.length} cards)`),an(i,D.deck,D.deck.length))}c&&Wt&&s.id===i&&s.deck.length>0&&(Ke.info(`[handleViewDeck] Host sharing deck with guests (${s.deck.length} cards)`),nn(s.deck,s.deck.length)),c&&k&&s.deck.length===0&&(Ke.info(`[handleViewDeck] Requesting deck data for player ${s.id}`),tn(s.id)),At({player:s,isDeckView:!0})},[i,tn,an,nn,a.players,Wt]),kn=r.useCallback(s=>{At({player:s,isDeckView:!1})},[]),tt=r.useMemo(()=>re?a.players.find(s=>s.id===re.player.id)||re.player:null,[re,a.players]),rr=r.useMemo(()=>{var s,c,k,D;if(((s=re==null?void 0:re.pickConfig)==null?void 0:s.filterType)==="Unit")return j=>{var F;return!!((F=j.types)!=null&&F.includes("Unit"))};if(((c=re==null?void 0:re.pickConfig)==null?void 0:c.filterType)==="Command")return j=>{var F;return j.deck===Qe.Command||!!((F=j.types)!=null&&F.includes("Command"))};if(((k=re==null?void 0:re.pickConfig)==null?void 0:k.filterType)==="Device")return j=>{var F;return!!((F=j.types)!=null&&F.includes("Device"))};if(((D=re==null?void 0:re.pickConfig)==null?void 0:D.filterType)==="Optimates")return j=>{var F,ge;return!!((F=j.types)!=null&&F.includes("Unit"))&&!!((ge=j.types)!=null&&ge.includes("Optimates"))}},[(In=re==null?void 0:re.pickConfig)==null?void 0:In.filterType]),wn=s=>{if(!(re!=null&&re.pickConfig))return;const{action:c,isDeck:k}=re.pickConfig;c==="recover"?(k?(_({card:tt.deck[s],source:"deck",playerId:tt.id,cardIndex:s},{target:"hand",playerId:tt.id}),o!=null&&o.sourceCard&&(o.sourceCard.name.includes("Mr. Pearl")||o.sourceCard.name.includes("Lucius")||o.sourceCard.name.includes("Quick Response")||o.sourceCard.name.includes("Michael Falk"))&&oe(j=>{const F=j.players.find(ge=>ge.id===tt.id);return F&&(F.deck=Lr(F.deck)),j})):_e(tt.id,s),At(null)):c==="resurrect"&&(o==null?void 0:o.mode)==="IMMUNIS_RETRIEVE"&&(l(D=>({...D,payload:{...D.payload,selectedCardIndex:s}})),At(null))},sr=(s,c)=>{var ge;if(!re||!tt)return;const k=re.isDeckView||((ge=re.pickConfig)==null?void 0:ge.isDeck),D=k?"deckCard":"discardCard",F=(k?tt.deck:tt.discard)[c];F&&ia(s,D,{card:F,player:tt,cardIndex:c})},ir=r.useMemo(()=>{var F,ge,Se,fe,xe,Ue,Z,Vt;if(!Pa||i===null||!a)return null;const{type:s,data:c,x:k,y:D}=Pa;let j=[];if(s==="emptyBoardCell")j.push({label:n("highlightCell"),onClick:()=>Rt({type:"cell",row:c.boardCoords.row,col:c.boardCoords.col})}),j.push({label:n("highlightColumn"),onClick:()=>Rt({type:"col",col:c.boardCoords.col})}),j.push({label:n("highlightRow"),onClick:()=>Rt({type:"row",row:c.boardCoords.row})});else if(s==="boardItem"||s==="announcedCard"){const N=s==="boardItem";let E=N?a.board[c.boardCoords.row][c.boardCoords.col].card:c.card,be=N?null:c.player;if(!N&&be){const ye=(F=a.players)==null?void 0:F.find(ht=>ht.id===be.id);ye&&(be=ye,E=ye.announcedCard||E)}if(!E)return Ea(null),null;const Me=E.ownerId?(ge=a.players)==null?void 0:ge.find(ye=>ye.id===E.ownerId):void 0,He=E.ownerId===i,at=!!(Me!=null&&Me.isDummy),We=He||at,ft=(Se=E.statuses)==null?void 0:Se.some(ye=>ye.type==="Revealed"&&ye.addedByPlayerId===i),Y=!E.isFaceDown||E.revealedTo==="all"||Array.isArray(E.revealedTo)&&E.revealedTo.includes(i)||ft;(Y||He&&E.isFaceDown)&&j.push({label:n("view"),isBold:!0,onClick:()=>wt({card:E,player:Me})}),!N&&We&&E.deck===Qe.Command&&j.push({label:n("play"),isBold:!0,onClick:()=>{ra(E,{card:E,source:"announced",playerId:be.id})}}),N&&We&&(E.isFaceDown?j.push({label:n("flipUp"),isBold:!0,onClick:()=>M(c.boardCoords)}):j.push({label:n("flipDown"),onClick:()=>B(c.boardCoords)}));const ae=N?{card:E,source:"board",boardCoords:c.boardCoords}:{card:E,source:"announced",playerId:be.id},$e=E.ownerId,Fe=(E==null?void 0:E.deck)===Qe.Tokens||(E==null?void 0:E.deck)==="counter";if(N&&(We&&E.isFaceDown&&j.push({label:n("revealToAll"),onClick:()=>he(c.boardCoords,"all")}),!He&&!Y&&j.push({label:n("requestReveal"),onClick:()=>ce({source:"board",ownerId:E.ownerId,boardCoords:c.boardCoords},i)})),j.length>0&&j.push({isDivider:!0}),We&&Y&&(j.push({label:n("toHand"),disabled:Fe,onClick:()=>_(ae,{target:"hand",playerId:$e})}),$e)){const ye=n(Fe?"remove":"toDiscard");j.push({label:ye,onClick:()=>_(ae,{target:"discard",playerId:$e})}),j.push({label:n("toDeckTop"),disabled:Fe,onClick:()=>_(ae,{target:"deck",playerId:$e,deckPosition:"top"})}),j.push({label:n("toDeckBottom"),disabled:Fe,onClick:()=>_(ae,{target:"deck",playerId:$e,deckPosition:"bottom"})})}if(N&&(j.push({isDivider:!0}),j.push({label:n("highlightCell"),onClick:()=>Rt({type:"cell",row:c.boardCoords.row,col:c.boardCoords.col})}),j.push({label:n("highlightColumn"),onClick:()=>Rt({type:"col",col:c.boardCoords.col})}),j.push({label:n("highlightRow"),onClick:()=>Rt({type:"row",row:c.boardCoords.row})})),Y&&(We||N)){const ye=["Aim","Exploit","Stun","Shield","Support","Threat","Revealed"],ht=[];ye.forEach(Xe=>{var Jt;(((Jt=E.statuses)==null?void 0:Jt.filter(cr=>cr.type===Xe).length)||0)>0&&ht.push({type:"statusControl",label:Xe,onAdd:()=>N?te(c.boardCoords,Xe,i):Te(be.id,Xe,i),onRemove:()=>N?De(c.boardCoords,Xe):V(be.id,Xe),removeDisabled:!1})}),ht.length>0&&(j.length>0&&!("isDivider"in j[j.length-1])&&j.push({isDivider:!0}),j.push(...ht)),j.length>0&&!("isDivider"in j[j.length-1])&&j.push({isDivider:!0}),j.push({type:"statusControl",label:n("power"),onAdd:()=>N?we(c.boardCoords,1):L(be.id,1),onRemove:()=>N?we(c.boardCoords,-1):L(be.id,-1),removeDisabled:!1})}}else if(s==="token_panel_item"){const{card:N}=c,E={card:N,source:"token_panel"};j.push({label:n("view"),isBold:!0,onClick:()=>wt({card:N})}),j.push({isDivider:!0}),j.push({label:n("play"),isBold:!0,onClick:()=>{gt(),it({card:N,sourceItem:E,faceDown:!1})}}),j.push({label:n("playFaceDown"),onClick:()=>{gt(),it({card:N,sourceItem:E,faceDown:!0})}})}else if(["handCard","discardCard","deckCard"].includes(s)){let{card:N,player:E}=c;const{boardCoords:be,cardIndex:Me}=c,He=(fe=a.players)==null?void 0:fe.find(Ve=>Ve.id===E.id);He&&(E=He,s==="handCard"?N=He.hand[Me]||N:s==="discardCard"?N=He.discard[Me]||N:s==="deckCard"&&(N=He.deck[Me]||N));const at=E.id===i||!!E.isDummy,We=(xe=a.players)==null?void 0:xe.find(Ve=>Ve.id===i),ft=(We==null?void 0:We.teamId)!==void 0&&E.teamId===We.teamId,Y=N.revealedTo==="all"||Array.isArray(N.revealedTo)&&N.revealedTo.includes(i),ae=(Ue=N.statuses)==null?void 0:Ue.some(Ve=>Ve.type==="Revealed"&&Ve.addedByPlayerId===i),$e=s!=="handCard"?!0:E.id===i||ft||!!E.isDummy||!!E.isDisconnected||Y||ae;let Fe;s==="handCard"?Fe="hand":s==="discardCard"?Fe="discard":Fe="deck";const ye={card:N,source:Fe,playerId:E==null?void 0:E.id,cardIndex:Me,boardCoords:be},ht=N.ownerId,Xe=(N==null?void 0:N.deck)===Qe.Tokens||(N==null?void 0:N.deck)==="counter";if($e){const Ve=N.ownerId?(Z=a==null?void 0:a.players)==null?void 0:Z.find(Jt=>Jt.id===N.ownerId):void 0;j.push({label:n("view"),isBold:!0,onClick:()=>wt({card:N,player:Ve})})}if(at){if(N.deck===Qe.Command?j.push({label:n("play"),isBold:!0,onClick:()=>{gt(),ra(N,ye)}}):s==="handCard"?(j.push({label:n("play"),isBold:!0,onClick:()=>{gt(),it({card:N,sourceItem:ye,faceDown:!1})}}),j.push({label:n("playFaceDown"),onClick:()=>{gt(),it({card:N,sourceItem:ye,faceDown:!0})}})):$e&&["discardCard","deckCard"].includes(s)&&(j.push({label:n("play"),isBold:!0,onClick:()=>{gt(),it({card:N,sourceItem:ye,faceDown:!1})}}),j.push({label:n("playFaceDown"),onClick:()=>{gt(),it({card:N,sourceItem:ye,faceDown:!0})}})),j.length>0&&j.push({isDivider:!0}),s==="handCard"&&j.push({label:n("revealToAll"),onClick:()=>ve(E.id,Me,"all")}),j.length>0&&!("isDivider"in j[j.length-1])&&j.push({isDivider:!0}),s==="discardCard"){const Ve=ht??E.id;j.push({label:n("toHand"),disabled:Xe,onClick:()=>_(ye,{target:"hand",playerId:Ve})})}else s==="handCard"&&j.push({label:n("toDiscard"),onClick:()=>_(ye,{target:"discard",playerId:ht})});if(["handCard","discardCard"].includes(s)){const Ve=ht??E.id;j.push({label:n("toDeckTop"),disabled:Xe,onClick:()=>_(ye,{target:"deck",playerId:Ve,deckPosition:"top"})}),j.push({label:n("toDeckBottom"),disabled:Xe,onClick:()=>_(ye,{target:"deck",playerId:Ve,deckPosition:"bottom"})})}s==="deckCard"&&(j.push({label:n("toHand"),disabled:Xe,onClick:()=>_(ye,{target:"hand",playerId:E.id})}),j.push({label:n("toDiscard"),onClick:()=>_(ye,{target:"discard",playerId:E.id})})),s==="handCard"&&(((Vt=N.statuses)==null?void 0:Vt.filter(Jt=>Jt.type==="Revealed").length)||0)>0&&(j.length>0&&!("isDivider"in j[j.length-1])&&j.push({isDivider:!0}),j.push({type:"statusControl",label:n("revealed"),onAdd:()=>q(E.id,Me,"Revealed",i),onRemove:()=>X(E.id,Me,"Revealed"),removeDisabled:!1}))}else s==="handCard"&&!$e&&j.push({label:n("requestReveal"),onClick:()=>ce({source:"hand",ownerId:E.id,cardIndex:Me},i)})}else if(s==="deckPile"){const{player:N}=c;(N.id===i||!!N.isDummy)&&(j.push({label:n("drawCard"),onClick:()=>g(N.id)}),j.push({label:n("drawStartingHand"),onClick:()=>{for(let be=0;be<6;be++)g(N.id)}}),j.push({label:n("viewTopCards"),onClick:()=>Kt({targetPlayerId:N.id,isLocked:!1,initialCount:1})}),j.push({label:n("shuffle"),onClick:()=>ee(N.id)})),j.push({label:n("view"),onClick:()=>jn(N)})}else if(s==="discardPile"){const{player:N}=c;j.push({label:n("view"),onClick:()=>kn(N)})}return j=j.filter((N,E)=>"isDivider"in N?!(E===0||E===j.length-1||"isDivider"in j[E-1]):!0),e.jsx(yo,{x:k,y:D,items:j,onClose:Mt})},[a,i,_,Rt,te,De,we,Te,V,L,q,X,g,ee,M,B,ve,he,ce,n,ra,Pa,gt,Mt,jn,kn]);r.useEffect(()=>{window.addEventListener("click",Mt);const s=c=>{c.target.closest("[data-interactive]")||Mt()};return window.addEventListener("contextmenu",s),()=>{window.removeEventListener("click",Mt),window.removeEventListener("contextmenu",s)}},[Mt]),r.useEffect(()=>{R&&Mt()},[R,Mt]);const lr=r.useCallback(s=>{if($t.isTokensModalOpen)jt(c=>({...c,isTokensModalOpen:!1})),Qt(c=>({...c,tokensModalAnchor:null}));else{jt(k=>({...k,isTokensModalOpen:!0,isCountersModalOpen:!1}));const c=s.currentTarget.getBoundingClientRect();Qt({tokensModalAnchor:{top:c.top,left:c.left},countersModalAnchor:null})}},[$t.isTokensModalOpen]),dr=r.useCallback(s=>{if($t.isCountersModalOpen)jt(c=>({...c,isCountersModalOpen:!1})),Qt(c=>({...c,countersModalAnchor:null}));else{jt(k=>({...k,isCountersModalOpen:!0,isTokensModalOpen:!1}));const c=s.currentTarget.getBoundingClientRect();Qt({countersModalAnchor:{top:c.top,left:c.left},tokensModalAnchor:null})}},[$t.isCountersModalOpen]);return Ho?e.jsx(e.Fragment,{children:e.jsxs("div",{className:`relative w-screen h-screen overflow-hidden ${w?"cursor-none cursor-stack-active":""}`,children:[e.jsx(ns,{gameId:a.gameId,isGameStarted:a.isGameStarted,onResetGame:Lt,onPlayerReady:y,players:a.players,localPlayerId:i,activeGridSize:a.activeGridSize,onGridSizeChange:v,dummyPlayerCount:a.dummyPlayerCount,onDummyPlayerCountChange:h,realPlayerCount:Go,connectionStatus:G,onExitGame:Ne,onOpenTokensModal:lr,onOpenCountersModal:dr,gameMode:a.gameMode,onGameModeChange:x,isPrivate:a.isPrivate,onPrivacyChange:p,isHost:Bo,hostId:ba,onSyncGame:ar,currentPhase:a.currentPhase,onSetPhase:I,onNextPhase:Q,onPrevPhase:W,activePlayerId:a.activePlayerId,playerColorMap:Ft,isAutoAbilitiesEnabled:Aa,onToggleAutoAbilities:So,isAutoDrawEnabled:No,onToggleAutoDraw:s=>{i&&Ee(i,s)},hideDummyCards:ea,onToggleHideDummyCards:Po,currentRound:a.currentRound,turnNumber:a.turnNumber,isScoringStep:a.isScoringStep,hasLastPlayedCard:_s(a),isReconnecting:on,reconnectProgress:Do}),e.jsx(ys,{isOpen:on}),e.jsx(qn,{}),a.isRoundEndModalOpen&&e.jsx(jo,{gameState:a,onContinueGame:Le,onStartNextRound:Pe,onExit:Ne}),$t.isTeamAssignOpen&&e.jsx(ho,{players:a.players,gameMode:a.gameMode,onCancel:()=>jt(s=>({...s,isTeamAssignOpen:!1})),onConfirm:Xo}),oa&&e.jsx(bo,{fromPlayer:a.players.find(s=>s.id===oa.fromPlayerId),cardCount:oa.cardIdentifiers.length,onAccept:()=>se(oa.fromPlayerId,!0),onDecline:()=>se(oa.fromPlayerId,!1)}),ze&&e.jsx(xo,{isOpen:!!ze,card:ze,playerColorMap:new Map(a.players.map(s=>[s.id,s.color])),onConfirm:s=>Oo(s,ze),onCancel:()=>{ya(null),ja([]),aa({})}}),xa&&e.jsx(ko,{isOpen:!!xa,data:xa,onConfirm:s=>Lo(s,xa),onCancel:()=>{Xt(null),l(null)}}),me&&yn&&e.jsx(bs,{isOpen:!!me,player:yn,onClose:Yo,onReorder:Wo,onMoveToBottom:Ko,onViewCard:s=>wt({card:s}),onMoveToHand:qo,onMoveToDiscard:Jo,onPlayCard:Zo,playerColorMap:Ft,localPlayerId:i,imageRefreshVersion:kt,initialCount:me.initialCount,isLocked:me.isLocked}),va&&e.jsx(Qa,{card:va.card,ownerPlayer:va.player,onClose:()=>wt(null),statusDescriptions:Ta,allPlayers:wa,imageRefreshVersion:kt}),re&&tt&&e.jsx(mo,{isOpen:!!re,onClose:()=>{At(null),l(null)},title:re.isDeckView||(Sn=re.pickConfig)!=null&&Sn.isDeck?re.pickConfig?n("selectCardFromDeck"):n("deckView"):re.pickConfig?n("selectCardFromDiscard"):n("discardView"),player:tt,cards:re.isDeckView||(Nn=re.pickConfig)!=null&&Nn.isDeck?tt.deck:tt.discard,setDraggedItem:$,canInteract:!!re.pickConfig||tt.id===i||!!tt.isDummy,onCardClick:wn,onCardDoubleClick:wn,onCardContextMenu:sr,onReorder:(s,c)=>{var D;const k=re.isDeckView||(D=re.pickConfig)!=null&&D.isDeck?"deck":"discard";fa(s,c,k)},isDeckView:re.isDeckView||((Pn=re.pickConfig)==null?void 0:Pn.isDeck),playerColorMap:Ft,localPlayerId:i,imageRefreshVersion:kt,highlightFilter:rr,cursorStack:w}),e.jsx(po,{isOpen:$t.isTokensModalOpen,onClose:()=>jt(s=>({...s,isTokensModalOpen:!1})),setDraggedItem:$,openContextMenu:ia,canInteract:!!i&&!Ut,anchorEl:rn.tokensModalAnchor,imageRefreshVersion:kt,localPlayerId:i,activePlayerId:a.activePlayerId,players:a.players}),e.jsx(go,{isOpen:$t.isCountersModalOpen,onClose:()=>jt(s=>({...s,isCountersModalOpen:!1})),canInteract:!!i&&!Ut,anchorEl:rn.countersModalAnchor,imageRefreshVersion:kt,onCounterMouseDown:Vo,cursorStack:w}),ir,w&&e.jsx("div",{ref:Fo,className:"fixed top-0 left-0 pointer-events-none z-[99999] flex items-center justify-center",style:{willChange:"transform"},children:(()=>{const s=a.players.find(F=>F.id===a.activePlayerId),c=s!=null&&s.isDummy&&a.activePlayerId!==null?a.activePlayerId:i??1,k=Ft.get(c),D=k?ua[k]:null,j=D?`rgba(${D.r}, ${D.g}, ${D.b}, 0.75)`:"rgba(107, 114, 128, 0.75)";return e.jsxs("div",{className:"w-12 h-12 rounded-full border-2 border-white flex items-center justify-center relative shadow-lg",style:{backgroundColor:j},children:[ma[w.type]?e.jsx("img",{src:`${ma[w.type]}${kt?`?v=${kt}`:""}`,alt:w.type,className:"w-8 h-8 object-contain"}):e.jsx("span",{className:`font-bold text-white drop-shadow-md ${w.type.startsWith("Power")?"text-sm":"text-lg"}`,children:w.type.startsWith("Power")?w.type:w.type.charAt(0)}),w.count>1&&e.jsx("div",{className:"absolute -top-2 -right-2 bg-red-600 text-white text-xs font-bold w-6 h-6 flex items-center justify-center rounded-full border-2 border-white shadow-sm z-10",children:w.count})]})})()}),e.jsxs("div",{className:"relative h-full w-full pt-14 overflow-hidden bg-gray-900",children:[Be&&e.jsx("div",{ref:zo,className:"absolute left-0 top-14 bottom-[2px] z-30 bg-panel-bg shadow-xl flex flex-col w-fit min-w-0 pl-[2px] py-[2px] pr-0 transition-all duration-100 overflow-hidden",style:{width:pn},children:e.jsx(Hn,{player:Be,isLocalPlayer:!0,localPlayerId:i,isSpectator:Ut,isGameStarted:a.isGameStarted,onNameChange:s=>O(Be.id,s),onColorChange:s=>T(Be.id,s),onScoreChange:s=>A(Be.id,s),onDeckChange:s=>U(Be.id,s),onLoadCustomDeck:s=>S(Be.id,s),onDrawCard:()=>g(Be.id),handleDrop:z,draggedItem:R,setDraggedItem:$,openContextMenu:ia,onHandCardDoubleClick:vn,playerColorMap:Ft,allPlayers:wa,localPlayerTeamId:Be==null?void 0:Be.teamId,activePlayerId:a.activePlayerId,onToggleActivePlayer:yt,imageRefreshVersion:kt,layoutMode:"list-local",onCardClick:fn,validHandTargets:ta,onAnnouncedCardDoubleClick:hn,currentPhase:a.currentPhase,disableActiveHighlights:La,preserveDeployAbilities:za,roundWinners:a.roundWinners,startingPlayerId:a.startingPlayerId,currentRound:a.currentRound,onDeckClick:bn,isDeckSelectable:(o==null?void 0:o.mode)==="SELECT_DECK"||((En=a.targetingMode)==null?void 0:En.isDeckSelectable)===!0,hideDummyCards:ea,deckSelections:Yt,handCardSelections:ue,cursorStack:w,targetingMode:a.targetingMode,highlightOwnerId:gn,onCancelAllModes:$a,clickWaves:ct,triggerClickWave:Ze},Be.id)}),e.jsx("div",{className:"absolute top-14 bottom-0 z-10 flex items-center justify-center pointer-events-none w-full left-0",children:e.jsx("div",{ref:Ro,className:"pointer-events-auto h-full aspect-square flex items-center justify-center py-[2px]",children:e.jsx(ro,{board:a.board,isGameStarted:a.isGameStarted,activeGridSize:a.activeGridSize,handleDrop:z,draggedItem:R,setDraggedItem:$,openContextMenu:ia,playMode:Re,setPlayMode:it,highlight:To,playerColorMap:Ft,localPlayerId:i,onCardDoubleClick:nr,onEmptyCellDoubleClick:or,imageRefreshVersion:kt,cursorStack:w,setCursorStack:na,currentPhase:a.currentPhase,activePlayerId:a.activePlayerId,onCardClick:_o,onEmptyCellClick:Uo,validTargets:un,targetingMode:a.targetingMode,noTargetOverlay:Eo,disableActiveHighlights:La,preserveDeployAbilities:za,activeFloatingTexts:Io,abilitySourceCoords:(o==null?void 0:o.sourceCoords)||null,abilityCheckKey:Ao,clickWaves:ct,triggerClickWave:Ze,onCancelAllModes:$a})})}),e.jsx("div",{className:"absolute right-0 top-14 bottom-[2px] z-30 bg-panel-bg shadow-xl flex flex-col min-w-0 pr-[2px] py-[2px] pl-0 transition-all duration-100 overflow-hidden",style:{width:pn},children:e.jsx("div",{className:"flex flex-col h-full w-full",children:wa.filter(s=>s.id!==i).map(s=>{var c;return e.jsx("div",{className:"w-full flex-1 min-h-0 flex flex-col",children:e.jsx(Hn,{player:s,isLocalPlayer:!1,localPlayerId:i,isSpectator:Ut,isGameStarted:a.isGameStarted,onNameChange:k=>O(s.id,k),onColorChange:k=>T(s.id,k),onScoreChange:k=>A(s.id,k),onDeckChange:k=>U(s.id,k),onLoadCustomDeck:k=>S(s.id,k),onDrawCard:()=>g(s.id),handleDrop:z,draggedItem:R,setDraggedItem:$,openContextMenu:ia,onHandCardDoubleClick:vn,playerColorMap:Ft,allPlayers:wa,localPlayerTeamId:Be==null?void 0:Be.teamId,activePlayerId:a.activePlayerId,onToggleActivePlayer:yt,imageRefreshVersion:kt,layoutMode:"list-remote",onCardClick:fn,currentPhase:a.currentPhase,validHandTargets:ta,onAnnouncedCardDoubleClick:hn,disableActiveHighlights:La,preserveDeployAbilities:za,roundWinners:a.roundWinners,startingPlayerId:a.startingPlayerId,currentRound:a.currentRound,onDeckClick:bn,isDeckSelectable:(o==null?void 0:o.mode)==="SELECT_DECK"||((c=a.targetingMode)==null?void 0:c.isDeckSelectable)===!0,hideDummyCards:ea,deckSelections:Yt,handCardSelections:ue,cursorStack:w,targetingMode:a.targetingMode,highlightOwnerId:gn,onCancelAllModes:$a,clickWaves:ct,triggerClickWave:Ze})},s.id)})})})]})]})}):e.jsxs(e.Fragment,{children:[e.jsx(ms,{handleCreateGame:er,handleJoinGame:Qo,gamesList:pe,requestGamesList:je,setViewingCard:wt,handleSaveSettings:tr,viewingCard:va,gameState:a,imageRefreshVersion:kt,t:n,connectionStatus:G,forceReconnect:qe,gameId:a.gameId,isGameStarted:a.isGameStarted,isPrivate:a.isPrivate,initializeWebrtcHost:Co}),e.jsx(qn,{})]})};function _s(t){var o,l,d;const n=t.activePlayerId;if(!n)return!1;for(let a=0;a<t.board.length;a++)for(let i=0;i<t.board[a].length;i++){const m=(l=(o=t.board[a])==null?void 0:o[i])==null?void 0:l.card;if((d=m==null?void 0:m.statuses)!=null&&d.some(b=>b.type==="LastPlayed"&&b.addedByPlayerId===n))return!0}return!1}const Us=r.memo(function(){return e.jsx(Tr,{children:e.jsx($s,{})})}),pa=new URLSearchParams(window.location.search),ga=new URLSearchParams(window.location.hash.slice(1));Ke.info("[index.tsx] URL params:",{search:window.location.search,hash:window.location.hash,urlParams:Object.fromEntries(pa.entries()),hashParams:Object.fromEntries(ga.entries())});const Ba=pa.get("game")||ga.get("game"),Ha=pa.get("server")||ga.get("server"),Wa=pa.get("s")||ga.get("s"),Ka=pa.get("hostId")||ga.get("hostId");Ba&&(sessionStorage.setItem("invite_game_id",Ba),sessionStorage.setItem("invite_auto_join","true"));Ka&&(sessionStorage.setItem("invite_host_id",Ka),sessionStorage.setItem("invite_auto_join","true"),localStorage.setItem("webrtc_enabled","true"));Ha&&localStorage.setItem("websocket_url",Ha);if(Wa)try{const t=decodeURIComponent(atob(Wa));t&&(t.startsWith("ws://")||t.startsWith("wss://"))&&(localStorage.setItem("websocket_url",t),localStorage.setItem("custom_ws_url",t))}catch(t){Ke.error("Failed to decode server URL:",t)}(Ba||Ha||Wa||Ka)&&window.history.replaceState({},"",window.location.pathname);localStorage.getItem("webrtc_enabled")===null&&localStorage.setItem("webrtc_enabled","true");class Fs extends Ot.Component{constructor(n){super(n),this.state={hasError:!1}}static getDerivedStateFromError(n){return{hasError:!0}}componentDidCatch(n,o){Ke.error("Uncaught error:",n,o)}render(){return this.state.hasError?e.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-gray-900 text-white p-4 text-center",children:[e.jsx("h1",{className:"text-3xl font-bold mb-4",children:"Something went wrong"}),e.jsx("p",{className:"mb-6 text-gray-400",children:"The application encountered an unexpected error."}),e.jsx("button",{onClick:()=>window.location.reload(),className:"bg-indigo-600 px-6 py-3 rounded-lg hover:bg-indigo-700 transition font-bold shadow-lg",children:"Reload Game"})]}):this.props.children}}const wo=document.getElementById("root");if(!wo)throw new Error("Could not find root element to mount to");const Vs=ur.createRoot(wo);Vs.render(e.jsx(Fs,{children:e.jsx(Wr,{children:e.jsx(Us,{})})}));export{Ks as A,Nt as C,qs as L,$n as M,Za as a,St as b,Js as e,as as g,ts as p,rt as u};
