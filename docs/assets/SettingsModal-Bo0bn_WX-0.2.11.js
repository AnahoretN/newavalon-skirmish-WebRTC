import{r as l,j as e}from"./vendor-react-JYPVbgc1-0.2.11.js";import{u as M,A as T,L as W,g as R,b as f}from"./index-H2ds1tjw-0.2.11.js";import{m as B}from"./game-logic-BOmmpEd8-0.2.11.js";import"./vendor-BPR6uEV2-0.2.11.js";import"./vendor-webrtc-BBsnVRmn-0.2.11.js";const J=({isOpen:r,onClose:b,onSave:z,connectionStatus:a,onReconnect:p,gameId:C=null,isGameStarted:k=!1,isPrivate:S=!1,webrtcEnabled:c=!1,onWebrtcToggle:y})=>{const{language:L,setLanguage:_,t}=M(),[n,j]=l.useState(""),[v,d]=l.useState(!1),[E,g]=l.useState(!1),[U,o]=l.useState(!1),[x,A]=l.useState(!1),[i,m]=l.useState(c),u=a==="Connected";if(l.useEffect(()=>{m(c)},[c]),l.useEffect(()=>{if(r){const s=localStorage.getItem("webrtc_enabled");m(s==="true")}},[r]),l.useEffect(()=>{if(u){const s=localStorage.getItem("custom_ws_url")||"";n.trim()===s&&o(!1)}},[u,a,n]),l.useEffect(()=>{if(r){const s=localStorage.getItem("custom_ws_url")||"";j(s),d(!1),g(!1),o(!1)}},[r]),!r)return null;const w=()=>{const s=n.trim();localStorage.setItem("custom_ws_url",s),o(!1),p(),b()},I=()=>{const s=n.trim();localStorage.setItem("custom_ws_url",s),o(!1),g(!0),p(),setTimeout(()=>g(!1),2e3)},G=s=>{j(s),o(!0)},$=()=>{const{url:s}=R(C,k,S);navigator.clipboard.writeText(s).then(()=>{d(!0),setTimeout(()=>d(!1),2e3)}).catch(h=>{B.error("Failed to copy:",h)})},D=()=>{A(!0),localStorage.clear(),sessionStorage.clear(),f&&typeof f.clear=="function"&&f.clear(),"caches"in window&&caches.keys().then(s=>{s.forEach(h=>caches.delete(h))}),setTimeout(()=>{window.location.reload()},1e3)},F=s=>{m(s),localStorage.setItem("webrtc_enabled",s.toString()),y&&y(s)},N=u&&!U;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg p-8 shadow-xl w-full max-w-xl",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:t("settings")}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"language-select",className:"block text-sm font-medium text-gray-300 mb-1",children:t("language")}),e.jsx("select",{id:"language-select",value:L,onChange:s=>_(s.target.value),className:"w-full bg-gray-700 border border-gray-600 text-white font-sans rounded-lg p-2 focus:ring-indigo-500 focus:border-indigo-500",children:T.map(s=>e.jsx("option",{value:s,children:W[s]},s))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:t("webrtcMode")}),e.jsx("p",{className:"text-xs text-gray-400",children:t("webrtcModeDesc")})]}),e.jsx("button",{onClick:()=>F(!i),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${i?"bg-indigo-600":"bg-gray-600"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${i?"translate-x-6":"translate-x-1"}`})})]}),i&&e.jsx("div",{className:"mt-2 p-2 bg-indigo-900 bg-opacity-30 rounded border border-indigo-700",children:e.jsxs("p",{className:"text-xs text-indigo-300",children:[e.jsxs("span",{className:"font-bold",children:[t("peerToPeer"),":"]})," ",t("directConnection")]})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"server-url",className:"block text-sm font-medium text-gray-300 mb-1",children:t("serverAddress")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"server-url",type:"text",value:n,onChange:s=>G(s.target.value),placeholder:"wss://your-server.ngrok-free.app",className:"flex-1 bg-gray-700 border border-gray-600 text-white font-mono rounded-lg p-2 focus:ring-indigo-500 focus:border-indigo-500",onKeyDown:s=>s.key==="Enter"&&w()}),e.jsx("button",{onClick:I,className:`w-10 h-10 flex items-center justify-center rounded transition-colors ${E?"bg-green-600 text-white animate-pulse":"bg-gray-700 hover:bg-gray-600 text-gray-300"}`,title:t("reconnect"),children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:[e.jsx("polyline",{points:"23 4 23 10 17 10"}),e.jsx("path",{d:"M20.49 15a9 9 0 1 1-2.12-9.36L23 10"})]})}),e.jsx("div",{className:`w-10 h-10 flex items-center justify-center rounded bg-gray-900 border border-gray-700 ${a==="Connected"?"cursor-help":""}`,title:a,children:e.jsxs("span",{className:"relative flex h-3 w-3",children:[a==="Connected"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-green-500"})]}),a==="Connecting"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-yellow-400 opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-yellow-500"})]}),a==="Disconnected"&&e.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-red-500"})]})})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"WebSocket URL сервера игры (ws:// или wss://)"})]}),e.jsxs("div",{className:"-mt-3",children:[e.jsx("button",{onClick:$,disabled:!N,className:`w-full py-2 rounded text-sm font-bold transition-colors ${N?v?"bg-green-600 text-white":"bg-indigo-600 hover:bg-indigo-700 text-white":"bg-gray-600 text-gray-400 cursor-not-allowed"}`,children:t(v?"copied":"copyGameLink")}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:t("copyGameLinkDesc")})]}),e.jsxs("div",{className:"-mt-3",children:[e.jsx("button",{onClick:D,disabled:x,className:`w-full py-2 rounded text-sm font-bold transition-colors ${x?"bg-orange-600 text-white":"bg-red-700 hover:bg-red-600 text-white"}`,children:t(x?"cacheCleared":"clearCache")}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:t("clearCacheDesc")})]})]}),e.jsxs("div",{className:"flex justify-end mt-8 space-x-3",children:[e.jsx("button",{type:"button",onClick:b,className:"bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded",children:t("cancel")}),e.jsx("button",{onClick:w,className:"bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded transition-colors",children:t("saveApply")})]})]})})};export{J as SettingsModal};
